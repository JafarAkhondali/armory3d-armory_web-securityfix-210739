(function($hx_exports,$global){"use strict";$hx_exports["kha"]=$hx_exports["kha"]||{};$hx_exports["kha"]["input"]=$hx_exports["kha"]["input"]||{};$hx_exports["kha"]["_Color"]=$hx_exports["kha"]["_Color"]||{};var $hxClasses={},$estr=function(){return js_Boot.__string_rec(this,"")},$hxEnums=$hxEnums||{},$_;function $extend(from,fields){var proto=Object.create(from);for(var name in fields)proto[name]=fields[name];if(fields.toString!==Object.prototype.toString)proto.toString=fields.toString;return proto}var EReg=function(r,opt){this.r=new RegExp(r,opt.split("u").join(""))};$hxClasses["EReg"]=EReg;EReg.__name__=true;EReg.prototype={match:function(s){if(this.r.global){this.r.lastIndex=0}this.r.m=this.r.exec(s);this.r.s=s;return this.r.m!=null},matched:function(n){if(this.r.m!=null&&n>=0&&n<this.r.m.length){return this.r.m[n]}else{throw new js__$Boot_HaxeError("EReg::matched")}},__class__:EReg};var HxOverrides=function(){};$hxClasses["HxOverrides"]=HxOverrides;HxOverrides.__name__=true;HxOverrides.strDate=function(s){switch(s.length){case 8:var k=s.split(":");var d=new Date;d["setTime"](0);d["setUTCHours"](k[0]);d["setUTCMinutes"](k[1]);d["setUTCSeconds"](k[2]);return d;case 10:var k1=s.split("-");return new Date(k1[0],k1[1]-1,k1[2],0,0,0);case 19:var k2=s.split(" ");var y=k2[0].split("-");var t=k2[1].split(":");return new Date(y[0],y[1]-1,y[2],t[0],t[1],t[2]);default:throw new js__$Boot_HaxeError("Invalid date format : "+s)}};HxOverrides.cca=function(s,index){var x=s.charCodeAt(index);if(x!=x){return js_Lib.get_undefined()}return x};HxOverrides.substr=function(s,pos,len){if(len==null){len=s.length}else if(len<0){if(pos==0){len=s.length+len}else{return""}}return s.substr(pos,len)};HxOverrides.remove=function(a,obj){var i=a.indexOf(obj);if(i==-1){return false}a.splice(i,1);return true};HxOverrides.iter=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var Main=function(){};$hxClasses["Main"]=Main;Main.__name__=true;Main.main=function(){armory_system_Starter.main("Scene",1,true,true,true,1600,900,2,true,armory_renderpath_RenderPathCreator.get)};Math.__name__=true;var Reflect=function(){};$hxClasses["Reflect"]=Reflect;Reflect.__name__=true;Reflect.hasField=function(o,field){return Object.prototype.hasOwnProperty.call(o,field)};Reflect.field=function(o,field){try{return o[field]}catch(e){var e1=e instanceof js__$Boot_HaxeError?e.val:e;return null}};Reflect.setField=function(o,field,value){o[field]=value};Reflect.setProperty=function(o,field,value){var tmp;var tmp1;if(o.__properties__){tmp=o.__properties__["set_"+field];tmp1=tmp}else{tmp1=false}if(tmp1){o[tmp](value)}else{o[field]=value}};Reflect.callMethod=function(o,func,args){return func.apply(o,args)};Reflect.isFunction=function(f){if(typeof f=="function"){return!(js_Boot.isClass(f)||js_Boot.isEnum(f))}else{return false}};var Std=function(){};$hxClasses["Std"]=Std;Std.__name__=true;Std.string=function(s){return js_Boot.__string_rec(s,"")};Std.int=function(x){return x|0};Std.parseInt=function(x){var v=parseInt(x,x&&x[0]=="0"&&(x[1]=="x"||x[1]=="X")?16:10);if(isNaN(v)){return null}return v};Std.parseFloat=function(x){return parseFloat(x)};var StringTools=function(){};$hxClasses["StringTools"]=StringTools;StringTools.__name__=true;StringTools.urlDecode=function(s){return decodeURIComponent(s.split("+").join(" "))};StringTools.startsWith=function(s,start){if(s.length>=start.length){return HxOverrides.substr(s,0,start.length)==start}else{return false}};StringTools.endsWith=function(s,end){var elen=end.length;var slen=s.length;if(slen>=elen){return HxOverrides.substr(s,slen-elen,elen)==end}else{return false}};StringTools.replace=function(s,sub,by){return s.split(sub).join(by)};StringTools.fastCodeAt=function(s,index){return s.charCodeAt(index)};StringTools.isEof=function(c){return c!=c};var Type=function(){};$hxClasses["Type"]=Type;Type.__name__=true;Type.getClass=function(o){if(o==null){return null}else{return js_Boot.getClass(o)}};Type.resolveClass=function(name){return $hxClasses[name]};Type.resolveEnum=function(name){return $hxEnums[name]};Type.createInstance=function(cl,args){return new(Function.prototype.bind.apply(cl,[null].concat(args)))};Type.createEmptyInstance=function(cl){return Object.create(cl.prototype)};Type.createEnum=function(e,constr,params){var f=Reflect.field(e,constr);if(f==null){throw new js__$Boot_HaxeError("No such constructor "+constr)}if(Reflect.isFunction(f)){if(params==null){throw new js__$Boot_HaxeError("Constructor "+constr+" need parameters")}return Reflect.callMethod(e,f,params)}if(params!=null&&params.length!=0){throw new js__$Boot_HaxeError("Constructor "+constr+" does not need parameters")}return f};Type.getEnumConstructs=function(e){return e.__constructs__.slice()};var iron_Trait=function(){this._render2D=null;this._render=null;this._lateUpdate=null;this._update=null;this._remove=null;this._init=null;this._add=null};$hxClasses["iron.Trait"]=iron_Trait;iron_Trait.__name__=true;iron_Trait.prototype={remove:function(){this.object.removeTrait(this)},notifyOnAdd:function(f){if(this._add==null){this._add=[]}this._add.push(f)},notifyOnInit:function(f){if(this._init==null){this._init=[]}this._init.push(f);iron_App.notifyOnInit(f)},notifyOnUpdate:function(f){if(this._update==null){this._update=[]}this._update.push(f);iron_App.notifyOnUpdate(f)},notifyOnRender2D:function(f){if(this._render2D==null){this._render2D=[]}this._render2D.push(f);iron_App.notifyOnRender2D(f)},__class__:iron_Trait};var arm_App=function(){iron_Trait.call(this);iron_data_Data.getFont("font_default.ttf",function(f){arm_App.font=f;iron_Scene.active.root.addTrait(new arm_UINodes)})};$hxClasses["arm.App"]=arm_App;arm_App.__name__=true;arm_App.w=function(){var res=Std.int(kha_System.windowWidth()/3);if(res>0){return res}else{return 1}};arm_App.h=function(){var res=0;res=kha_System.windowHeight();if(res>0){return res}else{return 1}};arm_App.x=function(){return 0};arm_App.y=function(){return 0};arm_App.realw=function(){return kha_System.windowWidth()};arm_App.realh=function(){return kha_System.windowHeight()};arm_App.resize=function(){iron_Scene.active.camera.buildProjection();if(arm_UINodes.inst.grid!=null){arm_UINodes.inst.grid.unload();arm_UINodes.inst.grid=null}};arm_App.render=function(g){if(arm_App.lastW>=0&&arm_App.realw()>0&&(arm_App.lastW!=arm_App.realw()||arm_App.lastH!=arm_App.realh())){arm_App.resize()}arm_App.lastW=arm_App.realw();arm_App.lastH=arm_App.realh()};arm_App.__super__=iron_Trait;arm_App.prototype=$extend(iron_Trait.prototype,{__class__:arm_App});var arm_NodeCreatorLogic=function(){};$hxClasses["arm.NodeCreatorLogic"]=arm_NodeCreatorLogic;arm_NodeCreatorLogic.__name__=true;arm_NodeCreatorLogic.nodeColor=function(type){switch(type){case"Action":return-5025958;case"Animation":return-5025958;case"Event":return-5025958;case"Input":return-5025958;case"Logic":return-5025958;case"Native":return-5025958;case"Navmesh":return-5025958;case"Physics":return-5025958;case"Sound":return-5025958;case"Value":return-5025958;case"Variable":return-5025958}return-5025958};arm_NodeCreatorLogic.socketColor=function(type){switch(type){case"ACTION":return-3388340;case"BOOL":return-10238109;case"INTEGER":return-10238109;case"OBJECT":return-14250817;case"RGBA":return-10238109;case"SHADER":return-11959648;case"STRING":return-1;case"VALUE":return-10238109;case"VECTOR":return-10238109}return-5025958};arm_NodeCreatorLogic.socketDefault=function(type){switch(type){case"ACTION":return 0;case"BOOL":return false;case"INTEGER":return 0;case"OBJECT":return 0;case"RGBA":return[0,0,0,0];case"SHADER":return 0;case"STRING":return"";case"VALUE":return 0;case"VECTOR":return[0,0,0]}return 0};arm_NodeCreatorLogic.draw=function(cat){var ui=arm_UINodes.inst.ui;var getNodeX=($_=arm_UINodes.inst,$bind($_,$_.getNodeX));var getNodeY=($_=arm_UINodes.inst,$bind($_,$_.getNodeY));var nodes=arm_UINodes.inst.nodes;var canvas=arm_UINodes.inst.canvasLogic;var c=arm_NodeCreatorLogic.list.categories[cat];var _g=0;var _g1=c.nodes;while(_g<_g1.length){var cnode=_g1[_g];++_g;if(ui.button(cnode.name)){var node_id=nodes.getNodeId(canvas.nodes);var n={id:node_id,name:cnode.name,type:cnode.type,x:getNodeX(),y:getNodeY(),color:arm_NodeCreatorLogic.nodeColor(cnode.type),inputs:[],outputs:[],buttons:[]};var _g2=0;var _g11=cnode.inputs;while(_g2<_g11.length){var cinp=_g11[_g2];++_g2;var soc={id:nodes.getSocketId(canvas.nodes),node_id:node_id,name:cinp.name,type:cinp.type,color:arm_NodeCreatorLogic.socketColor(cinp.type),default_value:arm_NodeCreatorLogic.socketDefault(cinp.type)};n.inputs.push(soc)}var _g21=0;var _g3=cnode.outputs;while(_g21<_g3.length){var cout=_g3[_g21];++_g21;var soc1={id:nodes.getSocketId(canvas.nodes),node_id:node_id,name:cout.name,type:cout.type,color:arm_NodeCreatorLogic.socketColor(cout.type),default_value:arm_NodeCreatorLogic.socketDefault(cout.type)};n.outputs.push(soc1)}var _g4=0;var _g5=cnode.buttons;while(_g4<_g5.length){var cbut=_g5[_g4];++_g4;var but={name:cbut.name,type:cbut.type,output:0,default_value:cbut.default_value,data:cbut.data};n.buttons.push(but)}canvas.nodes.push(n);nodes.nodeDrag=n;nodes.nodeSelected=n}}};var arm_UINodes=function(){this.lastT=null;this.hwnd=zui_Handle.global.nest(0,null);this.grid=null;this.changed=false;this.canvasLogic=null;this.nodes=new zui_Nodes;this.urlParsed=false;this.popupY=0;this.popupX=0;this.addNodeButton=false;this.menuCategory=0;this.hideMenu=false;this.showMenu=false;this.drawMenu=false;var _gthis=this;iron_Trait.call(this);arm_UINodes.inst=this;iron_data_Data.getBlob("logic_nodes.json",function(bnodes){var s='{"nodes":[],"links":[]}';var url=StringTools.urlDecode(window.location.href);if(url.indexOf("?")>0){s=url.split("?")[1];s=_gthis.decode(s);_gthis.urlParsed=true}_gthis.canvasLogic=JSON.parse(s);arm_NodeCreatorLogic.list=JSON.parse(bnodes.toString());arm_NodeCreatorLogic.list.categories.sort(function(a,b){if(a.name<b.name){return-1}else if(a.name>b.name){return 1}return 0});var t=zui_Themes.dark;t.ELEMENT_H=18;t.BUTTON_H=16;var scale=armory_data_Config.raw.window_scale;_gthis.ui=new zui_Zui({font:arm_App.font,color_wheel:arm_App.color_wheel,scaleFactor:scale});_gthis.ui.scrollEnabled=false;_gthis.notifyOnRender2D($bind(_gthis,_gthis.render2D));_gthis.notifyOnUpdate($bind(_gthis,_gthis.update));_gthis.notifyOnInit($bind(_gthis,_gthis.parseLogic));kha_System.notifyOnCutCopyPaste($bind(_gthis,_gthis.onCut),$bind(_gthis,_gthis.onCopy),$bind(_gthis,_gthis.onPaste))})};$hxClasses["arm.UINodes"]=arm_UINodes;arm_UINodes.__name__=true;arm_UINodes.__super__=iron_Trait;arm_UINodes.prototype=$extend(iron_Trait.prototype,{encode:function(str){str=StringTools.replace(str,'{"nodes":[{',"~0");str=StringTools.replace(str,'"id":',"~1");str=StringTools.replace(str,',"name":"',"~2");str=StringTools.replace(str,'","type":"ACTION","color":-3388340',"~3");str=StringTools.replace(str,'","type":"OBJECT","color":-3388340',"~4");str=StringTools.replace(str,'","type":"SHADER","color":-11959648',"~5");str=StringTools.replace(str,'","type":"INTEGER","color":-3388340',"~6");str=StringTools.replace(str,'","type":"VALUE","color":-3388340',"~7");str=StringTools.replace(str,'","type":"VECTOR","color":-3388340',"~8");str=StringTools.replace(str,'","type":"RGBA","color":-3388340',"~9");str=StringTools.replace(str,'","type":"STRING","color":-3388340',"~a");str=StringTools.replace(str,'","type":"BOOL","color":-3388340',"~b");str=StringTools.replace(str,'","type":"',"~c");str=StringTools.replace(str,'","x":',"~d");str=StringTools.replace(str,',"y":',"~e");str=StringTools.replace(str,',"color":-5025958',"~f");str=StringTools.replace(str,',"inputs":[',"~g");str=StringTools.replace(str,',"outputs":[',"~h");str=StringTools.replace(str,',"node_id":',"~i");str=StringTools.replace(str,',"default_value":',"~j");str=StringTools.replace(str,',"buttons":[',"~k");str=StringTools.replace(str,',"links":[{',"~l");str=StringTools.replace(str,',"from_id":',"~m");str=StringTools.replace(str,',"from_socket":',"~n");str=StringTools.replace(str,',"to_id":',"~o");str=StringTools.replace(str,',"to_socket":',"~p");str=StringTools.replace(str,"[0.0, 0.0, 0.0]","~q");str=StringTools.replace(str,"[0.0, 0.0, 0.0, 0.0]","~r");str=StringTools.replace(str,"},{","~s");str=StringTools.replace(str,',"color":',"~t");str=StringTools.replace(str,',"data":',"~u");str=StringTools.replace(str,',"output":',"~v");return str},decode:function(str){str=StringTools.replace(str,"~v",',"output":');str=StringTools.replace(str,"~u",',"data":');str=StringTools.replace(str,"~t",',"color":');str=StringTools.replace(str,"~s","},{");str=StringTools.replace(str,"~r","[0.0, 0.0, 0.0, 0.0]");str=StringTools.replace(str,"~q","[0.0, 0.0, 0.0]");str=StringTools.replace(str,"~p",',"to_socket":');str=StringTools.replace(str,"~o",',"to_id":');str=StringTools.replace(str,"~n",',"from_socket":');str=StringTools.replace(str,"~m",',"from_id":');str=StringTools.replace(str,"~l",',"links":[{');str=StringTools.replace(str,"~k",',"buttons":[');str=StringTools.replace(str,"~j",',"default_value":');str=StringTools.replace(str,"~i",',"node_id":');str=StringTools.replace(str,"~h",',"outputs":[');str=StringTools.replace(str,"~g",',"inputs":[');str=StringTools.replace(str,"~f",',"color":-5025958');str=StringTools.replace(str,"~e",',"y":');str=StringTools.replace(str,"~d",'","x":');str=StringTools.replace(str,"~c",'","type":"');str=StringTools.replace(str,"~b",'","type":"BOOL","color":-3388340');str=StringTools.replace(str,"~a",'","type":"STRING","color":-3388340');str=StringTools.replace(str,"~9",'","type":"RGBA","color":-3388340');str=StringTools.replace(str,"~8",'","type":"VECTOR","color":-3388340');str=StringTools.replace(str,"~7",'","type":"VALUE","color":-3388340');str=StringTools.replace(str,"~6",'","type":"INTEGER","color":-3388340');str=StringTools.replace(str,"~5",'","type":"SHADER","color":-11959648');str=StringTools.replace(str,"~4",'","type":"OBJECT","color":-3388340');str=StringTools.replace(str,"~3",'","type":"ACTION","color":-3388340');str=StringTools.replace(str,"~2",',"name":"');str=StringTools.replace(str,"~1",'"id":');str=StringTools.replace(str,"~0",'{"nodes":[{');return str},onCut:function(){return this.onCopy()},onCopy:function(){return"https://armory3d.org/logic/?"+this.encode(JSON.stringify(this.canvasLogic))},onPaste:function(s){},update:function(){var mouse=iron_system_Input.getMouse();var keyboard=iron_system_Input.getKeyboard();if(this.ui.changed||this.changed){this.parseLogic();this.changed=false}this.wx=Std.int(iron_App.w());this.wy=0;var mx=mouse.x+arm_App.x();var my=mouse.y+arm_App.y();if(mx<this.wx||my<this.wy){return}if(this.ui.isTyping){return}if(this.addNodeButton){this.showMenu=true;this.addNodeButton=false}else if(mouse.released()){this.hideMenu=true}if(keyboard.started("x")||keyboard.started("backspace")){if(this.nodes.nodeSelected!=null){var c=this.canvasLogic;this.nodes.removeNode(this.nodes.nodeSelected,c);this.changed=true}}if(keyboard.started("p")){var c1=this.canvasLogic;var str=JSON.stringify(c1);haxe_Log.trace(str,{fileName:"arm/UINodes.hx",lineNumber:188,className:"arm.UINodes",methodName:"update"})}},getNodeX:function(){var mouse=iron_system_Input.getMouse();return Std.int((mouse.x+arm_App.x()-this.wx-this.nodes.PAN_X())/this.nodes.SCALE)},getNodeY:function(){var mouse=iron_system_Input.getMouse();return Std.int((mouse.y+arm_App.y()-this.wy-this.nodes.PAN_Y())/this.nodes.SCALE)},drawGrid:function(){var ww=arm_App.realw()-iron_App.w();var wh=iron_App.h();var w=ww+80;var h=wh+80;this.grid=kha_Image.createRenderTarget(w,h);this.grid.get_g2().begin(true,-14408668);var _g=0;var _g1=Std.int(h/40)+1;while(_g<_g1){var i=_g++;this.grid.get_g2().set_color(-14145496);this.grid.get_g2().drawLine(0,i*40,w,i*40);this.grid.get_g2().set_color(-13487566);this.grid.get_g2().drawLine(0,i*40+20,w,i*40+20)}var _g2=0;var _g3=Std.int(w/40)+1;while(_g2<_g3){var i1=_g2++;this.grid.get_g2().set_color(-14145496);this.grid.get_g2().drawLine(i1*40,0,i1*40,h);this.grid.get_g2().set_color(-13487566);this.grid.get_g2().drawLine(i1*40+20,0,i1*40+20,h)}this.grid.get_g2().end()},render2D:function(g){g.end();if(this.grid==null){this.drawGrid()}this.ui.begin(g);this.ww=Std.int(arm_App.realw()-iron_App.w());var lay=0;this.wx=Std.int(iron_App.w());this.wy=0;var ew=Std.int(this.ui.ELEMENT_W());if(this.ui.window(this.hwnd,this.wx,this.wy,this.ww,iron_App.h())){this.ui.g.set_color(-1);this.ui.g.drawImage(this.grid,this.nodes.panX*this.nodes.SCALE%40-40,this.nodes.panY*this.nodes.SCALE%40-40);this.ui.g.set_font(arm_App.font);this.ui.g.set_fontSize(22);if(!this.urlParsed){var title="Ctrl + C to copy URL";var titlew=this.ui.g.get_font().width(22,title);var titleh=this.ui.g.get_font().height(22);this.ui.g.drawString(title,this.ww-titlew-20,iron_App.h()-titleh-10)}var c=this.canvasLogic;this.nodes.nodeCanvas(this.ui,c);this.ui.g.set_color(this.ui.t.WINDOW_BG_COL);this.ui.g.set_color(-1);this.ui._x=3;this.ui._y=3;this.ui._w=ew;if(!this.urlParsed){if(this.ui.button("Action")){this.addNodeButton=true;this.menuCategory=0;this.popupX=this.wx+this.ui._x;this.popupY=this.wy+this.ui._y}this.ui._x+=ew+3;this.ui._y=3;if(this.ui.button("Animation")){this.addNodeButton=true;this.menuCategory=1;this.popupX=this.wx+this.ui._x;this.popupY=this.wy+this.ui._y}this.ui._x+=ew+3;this.ui._y=3;if(this.ui.button("Array")){this.addNodeButton=true;this.menuCategory=2;this.popupX=this.wx+this.ui._x;this.popupY=this.wy+this.ui._y}this.ui._x+=ew+3;this.ui._y=3;if(this.ui.button("Canvas")){this.addNodeButton=true;this.menuCategory=3;this.popupX=this.wx+this.ui._x;this.popupY=this.wy+this.ui._y}this.ui._x+=ew+3;this.ui._y=3;if(this.ui.button("Event")){this.addNodeButton=true;this.menuCategory=4;this.popupX=this.wx+this.ui._x;this.popupY=this.wy+this.ui._y}this.ui._x+=ew+3;this.ui._y=3;if(this.ui.button("Input")){this.addNodeButton=true;this.menuCategory=5;this.popupX=this.wx+this.ui._x;this.popupY=this.wy+this.ui._y}this.ui._x=3;this.ui._y=30;if(this.ui.button("Logic")){this.addNodeButton=true;this.menuCategory=6;this.popupX=this.wx+this.ui._x;this.popupY=this.wy+this.ui._y}this.ui._x=ew+3;this.ui._y=30;if(this.ui.button("Navmesh")){this.addNodeButton=true;this.menuCategory=8;this.popupX=this.wx+this.ui._x;this.popupY=this.wy+this.ui._y}this.ui._x+=ew+3;this.ui._y=30;if(this.ui.button("Physics")){this.addNodeButton=true;this.menuCategory=9;this.popupX=this.wx+this.ui._x;this.popupY=this.wy+this.ui._y}this.ui._x+=ew+3;this.ui._y=30;if(this.ui.button("Sound")){this.addNodeButton=true;this.menuCategory=10;this.popupX=this.wx+this.ui._x;this.popupY=this.wy+this.ui._y}this.ui._x+=ew+3;this.ui._y=30;if(this.ui.button("Value")){this.addNodeButton=true;this.menuCategory=11;this.popupX=this.wx+this.ui._x;this.popupY=this.wy+this.ui._y}this.ui._x+=ew+3;this.ui._y=30;if(this.ui.button("Variable")){this.addNodeButton=true;this.menuCategory=12;this.popupX=this.wx+this.ui._x;this.popupY=this.wy+this.ui._y}}}this.ui.endWindow();if(this.drawMenu){var numNodes=0;numNodes=arm_NodeCreatorLogic.list.categories[this.menuCategory].nodes.length;var ph=numNodes*20;var py=this.popupY;g.set_color(-14540254);g.fillRect(this.popupX,py,ew,ph);this.ui.beginLayout(g,Std.int(this.popupX),Std.int(py),ew);arm_NodeCreatorLogic.draw(this.menuCategory);this.ui.endLayout()}this.ui.end();g.begin(false);if(this.showMenu){this.showMenu=false;this.drawMenu=true}if(this.hideMenu){this.hideMenu=false;this.drawMenu=false}},parseLogic:function(){if(this.lastT!=null){iron_Scene.active.getChild("Cube").removeTrait(this.lastT)}armory_system_Logic.packageName="armory.logicnode";var t=armory_system_Logic.parse(this.canvasLogic);this.lastT=t;iron_Scene.active.getChild("Cube").addTrait(t)},__class__:arm_UINodes});var armory_data_Config=function(){};$hxClasses["armory.data.Config"]=armory_data_Config;armory_data_Config.__name__=true;var armory_logicnode_LogicNode=function(tree){this.outputs=[];this.inputs=[];this.tree=tree};$hxClasses["armory.logicnode.LogicNode"]=armory_logicnode_LogicNode;armory_logicnode_LogicNode.__name__=true;armory_logicnode_LogicNode.prototype={addInput:function(node,from){this.inputs.push(new armory_logicnode_LogicNodeInput(node,from))},addOutputs:function(nodes){this.outputs.push(nodes)},__class__:armory_logicnode_LogicNode};var armory_logicnode_LogicNodeInput=function(node,from){this.node=node;this.from=from};$hxClasses["armory.logicnode.LogicNodeInput"]=armory_logicnode_LogicNodeInput;armory_logicnode_LogicNodeInput.__name__=true;armory_logicnode_LogicNodeInput.prototype={__class__:armory_logicnode_LogicNodeInput};var armory_logicnode_LogicTree=function(){iron_Trait.call(this)};$hxClasses["armory.logicnode.LogicTree"]=armory_logicnode_LogicTree;armory_logicnode_LogicTree.__name__=true;armory_logicnode_LogicTree.__super__=iron_Trait;armory_logicnode_LogicTree.prototype=$extend(iron_Trait.prototype,{__class__:armory_logicnode_LogicTree});var kha_math_FastMatrix4=function(_00,_10,_20,_30,_01,_11,_21,_31,_02,_12,_22,_32,_03,_13,_23,_33){this._00=_00;this._10=_10;this._20=_20;this._30=_30;this._01=_01;this._11=_11;this._21=_21;this._31=_31;this._02=_02;this._12=_12;this._22=_22;this._32=_32;this._03=_03;this._13=_13;this._23=_23;this._33=_33};$hxClasses["kha.math.FastMatrix4"]=kha_math_FastMatrix4;kha_math_FastMatrix4.__name__=true;kha_math_FastMatrix4.orthogonalProjection=function(left,right,bottom,top,zn,zf){var tx=-(right+left)/(right-left);var ty=-(top+bottom)/(top-bottom);var tz=-(zf+zn)/(zf-zn);return new kha_math_FastMatrix4(2/(right-left),0,0,tx,0,2/(top-bottom),0,ty,0,0,-2/(zf-zn),tz,0,0,0,1)};kha_math_FastMatrix4.prototype={__class__:kha_math_FastMatrix4};var iron_math_Vec4=function(x,y,z,w){if(w==null){w=1}if(z==null){z=0}if(y==null){y=0}if(x==null){x=0}this.x=x;this.y=y;this.z=z;this.w=w};$hxClasses["iron.math.Vec4"]=iron_math_Vec4;iron_math_Vec4.__name__=true;iron_math_Vec4.distance=function(v1,v2){return iron_math_Vec4.distancef(v1.x,v1.y,v1.z,v2.x,v2.y,v2.z)};iron_math_Vec4.distancef=function(v1x,v1y,v1z,v2x,v2y,v2z){var vx=v1x-v2x;var vy=v1y-v2y;var vz=v1z-v2z;return iron_math_Math.sqrt(vx*vx+vy*vy+vz*vz)};iron_math_Vec4.prototype={set:function(x,y,z,w){if(w==null){w=1}this.x=x;this.y=y;this.z=z;this.w=w;return this},addf:function(x,y,z){this.x+=x;this.y+=y;this.z+=z;return this},addvecs:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},normalize:function(){var n=this.length();if(n>0){var invN=1/n;this.x*=invN;this.y*=invN;this.z*=invN}return this},mult:function(f){this.x*=f;this.y*=f;this.z*=f;return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z},setFrom:function(v){this.x=v.x;this.y=v.y;this.z=v.z;this.w=v.w;return this},lerp:function(from,to,s){this.x=from.x+(to.x-from.x)*s;this.y=from.y+(to.y-from.y)*s;this.z=from.z+(to.z-from.z)*s;return this},applymat4:function(m){var x=this.x;var y=this.y;var z=this.z;var w=this.w;this.x=m.get__00()*x+m.get__10()*y+m.get__20()*z+m.get__30()*w;this.y=m.get__01()*x+m.get__11()*y+m.get__21()*z+m.get__31()*w;this.z=m.get__02()*x+m.get__12()*y+m.get__22()*z+m.get__32()*w;this.w=m.get__03()*x+m.get__13()*y+m.get__23()*z+m.get__33()*w;return this},length:function(){return iron_math_Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},__class__:iron_math_Vec4};var iron_math_Mat4=function(_00,_10,_20,_30,_01,_11,_21,_31,_02,_12,_22,_32,_03,_13,_23,_33){this.self=new kha_math_FastMatrix4(_00,_10,_20,_30,_01,_11,_21,_31,_02,_12,_22,_32,_03,_13,_23,_33)};$hxClasses["iron.math.Mat4"]=iron_math_Mat4;iron_math_Mat4.__name__=true;iron_math_Mat4.fromFloat32Array=function(a,offset){if(offset==null){offset=0}return new iron_math_Mat4(a[offset],a[1+offset],a[2+offset],a[3+offset],a[4+offset],a[5+offset],a[6+offset],a[7+offset],a[8+offset],a[9+offset],a[10+offset],a[11+offset],a[12+offset],a[13+offset],a[14+offset],a[15+offset])};iron_math_Mat4.identity=function(){return new iron_math_Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)};iron_math_Mat4.persp=function(fovY,aspect,zn,zf){var uh=1/iron_math_Math.tan(fovY/2);var uw=uh/aspect;return new iron_math_Mat4(uw,0,0,0,0,uh,0,0,0,0,(zf+zn)/(zn-zf),2*zf*zn/(zn-zf),0,0,-1,0)};iron_math_Mat4.ortho=function(left,right,bottom,top,near,far){var rl=right-left;var tb=top-bottom;var fn=far-near;var tx=-(right+left)/rl;var ty=-(top+bottom)/tb;var tz=-(far+near)/fn;return new iron_math_Mat4(2/rl,0,0,tx,0,2/tb,0,ty,0,0,-2/fn,tz,0,0,0,1)};iron_math_Mat4.prototype={compose:function(loc,quat,sc){this.fromQuat(quat);this.scale(sc);this.setLoc(loc);return this},decompose:function(loc,quat,scale){loc.x=this.get__30();loc.y=this.get__31();loc.z=this.get__32();scale.x=iron_math_Mat4.helpVec.set(this.get__00(),this.get__01(),this.get__02()).length();scale.y=iron_math_Mat4.helpVec.set(this.get__10(),this.get__11(),this.get__12()).length();scale.z=iron_math_Mat4.helpVec.set(this.get__20(),this.get__21(),this.get__22()).length();var _this=this.self;var m3=_this._12;var m4=_this._22;var m5=_this._32;var m6=_this._13;var m7=_this._23;var m8=_this._33;var c00=_this._11*(m4*m8-m5*m7)-_this._21*(m3*m8-m5*m6)+_this._31*(m3*m7-m4*m6);var m31=_this._12;var m41=_this._22;var m51=_this._32;var m61=_this._13;var m71=_this._23;var m81=_this._33;var c01=_this._10*(m41*m81-m51*m71)-_this._20*(m31*m81-m51*m61)+_this._30*(m31*m71-m41*m61);var m32=_this._11;var m42=_this._21;var m52=_this._31;var m62=_this._13;var m72=_this._23;var m82=_this._33;var c02=_this._10*(m42*m82-m52*m72)-_this._20*(m32*m82-m52*m62)+_this._30*(m32*m72-m42*m62);var m33=_this._11;var m43=_this._21;var m53=_this._31;var m63=_this._12;var m73=_this._22;var m83=_this._32;var c03=_this._10*(m43*m83-m53*m73)-_this._20*(m33*m83-m53*m63)+_this._30*(m33*m73-m43*m63);if(_this._00*c00-_this._01*c01+_this._02*c02-_this._03*c03<0){scale.x=-scale.x}var invs=1/scale.x;iron_math_Mat4.helpMat.set__00(this.get__00()*invs);iron_math_Mat4.helpMat.set__01(this.get__01()*invs);iron_math_Mat4.helpMat.set__02(this.get__02()*invs);invs=1/scale.y;iron_math_Mat4.helpMat.set__10(this.get__10()*invs);iron_math_Mat4.helpMat.set__11(this.get__11()*invs);iron_math_Mat4.helpMat.set__12(this.get__12()*invs);invs=1/scale.z;iron_math_Mat4.helpMat.set__20(this.get__20()*invs);iron_math_Mat4.helpMat.set__21(this.get__21()*invs);iron_math_Mat4.helpMat.set__22(this.get__22()*invs);quat.fromRotationMat(iron_math_Mat4.helpMat);return this},setLoc:function(v){this.set__30(v.x);this.set__31(v.y);this.set__32(v.z);return this},fromQuat:function(q){var x=q.x;var y=q.y;var z=q.z;var w=q.w;var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;this.set__00(1-(yy+zz));this.set__10(xy-wz);this.set__20(xz+wy);this.set__01(xy+wz);this.set__11(1-(xx+zz));this.set__21(yz-wx);this.set__02(xz-wy);this.set__12(yz+wx);this.set__22(1-(xx+yy));this.set__03(0);this.set__13(0);this.set__23(0);this.set__30(0);this.set__31(0);this.set__32(0);this.set__33(1);return this},setIdentity:function(){this.set__00(1);this.set__01(0);this.set__02(0);this.set__03(0);this.set__10(0);this.set__11(1);this.set__12(0);this.set__13(0);this.set__20(0);this.set__21(0);this.set__22(1);this.set__23(0);this.set__30(0);this.set__31(0);this.set__32(0);this.set__33(1);return this},scale:function(v){var x=v.x;var y=v.y;var z=v.z;var _g=this;_g.set__00(_g.get__00()*x);var _g1=this;_g1.set__01(_g1.get__01()*x);var _g2=this;_g2.set__02(_g2.get__02()*x);var _g3=this;_g3.set__03(_g3.get__03()*x);var _g4=this;_g4.set__10(_g4.get__10()*y);var _g5=this;_g5.set__11(_g5.get__11()*y);var _g6=this;_g6.set__12(_g6.get__12()*y);var _g7=this;_g7.set__13(_g7.get__13()*y);var _g8=this;_g8.set__20(_g8.get__20()*z);var _g9=this;_g9.set__21(_g9.get__21()*z);var _g10=this;_g10.set__22(_g10.get__22()*z);var _g11=this;_g11.set__23(_g11.get__23()*z);return this},multmats3x4:function(a,b){var a00=a.get__00();var a01=a.get__01();var a02=a.get__02();var a03=a.get__03();var a10=a.get__10();var a11=a.get__11();var a12=a.get__12();var a13=a.get__13();var a20=a.get__20();var a21=a.get__21();var a22=a.get__22();var a23=a.get__23();var a30=a.get__30();var a31=a.get__31();var a32=a.get__32();var a33=a.get__33();var b0=b.get__00();var b1=b.get__10();var b2=b.get__20();var b3=b.get__30();this.set__00(a00*b0+a01*b1+a02*b2+a03*b3);this.set__10(a10*b0+a11*b1+a12*b2+a13*b3);this.set__20(a20*b0+a21*b1+a22*b2+a23*b3);this.set__30(a30*b0+a31*b1+a32*b2+a33*b3);b0=b.get__01();b1=b.get__11();b2=b.get__21();b3=b.get__31();this.set__01(a00*b0+a01*b1+a02*b2+a03*b3);this.set__11(a10*b0+a11*b1+a12*b2+a13*b3);this.set__21(a20*b0+a21*b1+a22*b2+a23*b3);this.set__31(a30*b0+a31*b1+a32*b2+a33*b3);b0=b.get__02();b1=b.get__12();b2=b.get__22();b3=b.get__32();this.set__02(a00*b0+a01*b1+a02*b2+a03*b3);this.set__12(a10*b0+a11*b1+a12*b2+a13*b3);this.set__22(a20*b0+a21*b1+a22*b2+a23*b3);this.set__32(a30*b0+a31*b1+a32*b2+a33*b3);this.set__03(0);this.set__13(0);this.set__23(0);this.set__33(1);return this},multmats:function(b,a){var a00=a.get__00();var a01=a.get__01();var a02=a.get__02();var a03=a.get__03();var a10=a.get__10();var a11=a.get__11();var a12=a.get__12();var a13=a.get__13();var a20=a.get__20();var a21=a.get__21();var a22=a.get__22();var a23=a.get__23();var a30=a.get__30();var a31=a.get__31();var a32=a.get__32();var a33=a.get__33();var b0=b.get__00();var b1=b.get__10();var b2=b.get__20();var b3=b.get__30();this.set__00(a00*b0+a01*b1+a02*b2+a03*b3);this.set__10(a10*b0+a11*b1+a12*b2+a13*b3);this.set__20(a20*b0+a21*b1+a22*b2+a23*b3);this.set__30(a30*b0+a31*b1+a32*b2+a33*b3);b0=b.get__01();b1=b.get__11();b2=b.get__21();b3=b.get__31();this.set__01(a00*b0+a01*b1+a02*b2+a03*b3);this.set__11(a10*b0+a11*b1+a12*b2+a13*b3);this.set__21(a20*b0+a21*b1+a22*b2+a23*b3);this.set__31(a30*b0+a31*b1+a32*b2+a33*b3);b0=b.get__02();b1=b.get__12();b2=b.get__22();b3=b.get__32();this.set__02(a00*b0+a01*b1+a02*b2+a03*b3);this.set__12(a10*b0+a11*b1+a12*b2+a13*b3);this.set__22(a20*b0+a21*b1+a22*b2+a23*b3);this.set__32(a30*b0+a31*b1+a32*b2+a33*b3);b0=b.get__03();b1=b.get__13();b2=b.get__23();b3=b.get__33();this.set__03(a00*b0+a01*b1+a02*b2+a03*b3);this.set__13(a10*b0+a11*b1+a12*b2+a13*b3);this.set__23(a20*b0+a21*b1+a22*b2+a23*b3);this.set__33(a30*b0+a31*b1+a32*b2+a33*b3);return this},multmat:function(m){var a00=this.get__00();var a01=this.get__01();var a02=this.get__02();var a03=this.get__03();var a10=this.get__10();var a11=this.get__11();var a12=this.get__12();var a13=this.get__13();var a20=this.get__20();var a21=this.get__21();var a22=this.get__22();var a23=this.get__23();var a30=this.get__30();var a31=this.get__31();var a32=this.get__32();var a33=this.get__33();var b0=m.get__00();var b1=m.get__10();var b2=m.get__20();var b3=m.get__30();this.set__00(a00*b0+a01*b1+a02*b2+a03*b3);this.set__10(a10*b0+a11*b1+a12*b2+a13*b3);this.set__20(a20*b0+a21*b1+a22*b2+a23*b3);this.set__30(a30*b0+a31*b1+a32*b2+a33*b3);b0=m.get__01();b1=m.get__11();b2=m.get__21();b3=m.get__31();this.set__01(a00*b0+a01*b1+a02*b2+a03*b3);this.set__11(a10*b0+a11*b1+a12*b2+a13*b3);this.set__21(a20*b0+a21*b1+a22*b2+a23*b3);this.set__31(a30*b0+a31*b1+a32*b2+a33*b3);b0=m.get__02();b1=m.get__12();b2=m.get__22();b3=m.get__32();this.set__02(a00*b0+a01*b1+a02*b2+a03*b3);this.set__12(a10*b0+a11*b1+a12*b2+a13*b3);this.set__22(a20*b0+a21*b1+a22*b2+a23*b3);this.set__32(a30*b0+a31*b1+a32*b2+a33*b3);b0=m.get__03();b1=m.get__13();b2=m.get__23();b3=m.get__33();this.set__03(a00*b0+a01*b1+a02*b2+a03*b3);this.set__13(a10*b0+a11*b1+a12*b2+a13*b3);this.set__23(a20*b0+a21*b1+a22*b2+a23*b3);this.set__33(a30*b0+a31*b1+a32*b2+a33*b3);return this},getInverse:function(m){var a00=m.get__00();var a01=m.get__01();var a02=m.get__02();var a03=m.get__03();var a10=m.get__10();var a11=m.get__11();var a12=m.get__12();var a13=m.get__13();var a20=m.get__20();var a21=m.get__21();var a22=m.get__22();var a23=m.get__23();var a30=m.get__30();var a31=m.get__31();var a32=m.get__32();var a33=m.get__33();var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;var det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(det==0){return this.setIdentity()}det=1/det;this.set__00((a11*b11-a12*b10+a13*b09)*det);this.set__01((a02*b10-a01*b11-a03*b09)*det);this.set__02((a31*b05-a32*b04+a33*b03)*det);this.set__03((a22*b04-a21*b05-a23*b03)*det);this.set__10((a12*b08-a10*b11-a13*b07)*det);this.set__11((a00*b11-a02*b08+a03*b07)*det);this.set__12((a32*b02-a30*b05-a33*b01)*det);this.set__13((a20*b05-a22*b02+a23*b01)*det);this.set__20((a10*b10-a11*b08+a13*b06)*det);this.set__21((a01*b08-a00*b10-a03*b06)*det);this.set__22((a30*b04-a31*b02+a33*b00)*det);this.set__23((a21*b02-a20*b04-a23*b00)*det);this.set__30((a11*b07-a10*b09-a12*b06)*det);this.set__31((a00*b09-a01*b07+a02*b06)*det);this.set__32((a31*b01-a30*b03-a32*b00)*det);this.set__33((a20*b03-a21*b01+a22*b00)*det);return this},transpose:function(){var f=this.get__01();this.set__01(this.get__10());this.set__10(f);f=this.get__02();this.set__02(this.get__20());this.set__20(f);f=this.get__03();this.set__03(this.get__30());this.set__30(f);f=this.get__12();this.set__12(this.get__21());this.set__21(f);f=this.get__13();this.set__13(this.get__31());this.set__31(f);f=this.get__23();this.set__23(this.get__32());this.set__32(f);return this},transpose3x3:function(){var f=this.get__01();this.set__01(this.get__10());this.set__10(f);f=this.get__02();this.set__02(this.get__20());this.set__20(f);f=this.get__12();this.set__12(this.get__21());this.set__21(f);return this},setF32:function(a,offset){if(offset==null){offset=0}this.set__00(a[offset]);this.set__10(a[1+offset]);this.set__20(a[2+offset]);this.set__30(a[3+offset]);this.set__01(a[4+offset]);this.set__11(a[5+offset]);this.set__21(a[6+offset]);this.set__31(a[7+offset]);this.set__02(a[8+offset]);this.set__12(a[9+offset]);this.set__22(a[10+offset]);this.set__32(a[11+offset]);this.set__03(a[12+offset]);this.set__13(a[13+offset]);this.set__23(a[14+offset]);this.set__33(a[15+offset]);return this},setFrom:function(m){this.set__00(m.get__00());this.set__01(m.get__01());this.set__02(m.get__02());this.set__03(m.get__03());this.set__10(m.get__10());this.set__11(m.get__11());this.set__12(m.get__12());this.set__13(m.get__13());this.set__20(m.get__20());this.set__21(m.get__21());this.set__22(m.get__22());this.set__23(m.get__23());this.set__30(m.get__30());this.set__31(m.get__31());this.set__32(m.get__32());this.set__33(m.get__33());return this},getLoc:function(){return new iron_math_Vec4(this.get__30(),this.get__31(),this.get__32(),this.get__33())},getScale:function(){return new iron_math_Vec4(iron_math_Math.sqrt(this.get__00()*this.get__00()+this.get__10()*this.get__10()+this.get__20()*this.get__20()),iron_math_Math.sqrt(this.get__01()*this.get__01()+this.get__11()*this.get__11()+this.get__21()*this.get__21()),iron_math_Math.sqrt(this.get__02()*this.get__02()+this.get__12()*this.get__12()+this.get__22()*this.get__22()))},toRotation:function(){var scale=1/iron_math_Mat4.helpVec.set(this.get__00(),this.get__01(),this.get__02()).length();this.set__00(this.get__00()*scale);this.set__01(this.get__01()*scale);this.set__02(this.get__02()*scale);scale=1/iron_math_Mat4.helpVec.set(this.get__10(),this.get__11(),this.get__12()).length();this.set__10(this.get__10()*scale);this.set__11(this.get__11()*scale);this.set__12(this.get__12()*scale);scale=1/iron_math_Mat4.helpVec.set(this.get__20(),this.get__21(),this.get__22()).length();this.set__20(this.get__20()*scale);this.set__21(this.get__21()*scale);this.set__22(this.get__22()*scale);this.set__03(0);this.set__13(0);this.set__23(0);this.set__30(0);this.set__31(0);this.set__32(0);this.set__33(1);return this},setLookAt:function(eye,center,up){var f0=center.x-eye.x;var f1=center.y-eye.y;var f2=center.z-eye.z;var n=1/iron_math_Math.sqrt(f0*f0+f1*f1+f2*f2);f0*=n;f1*=n;f2*=n;var s0=f1*up.z-f2*up.y;var s1=f2*up.x-f0*up.z;var s2=f0*up.y-f1*up.x;n=1/iron_math_Math.sqrt(s0*s0+s1*s1+s2*s2);s0*=n;s1*=n;s2*=n;var u0=s1*f2-s2*f1;var u1=s2*f0-s0*f2;var u2=s0*f1-s1*f0;var d0=-eye.x*s0-eye.y*s1-eye.z*s2;var d1=-eye.x*u0-eye.y*u1-eye.z*u2;var d2=eye.x*f0+eye.y*f1+eye.z*f2;this.set__00(s0);this.set__10(s1);this.set__20(s2);this.set__30(d0);this.set__01(u0);this.set__11(u1);this.set__21(u2);this.set__31(d1);this.set__02(-f0);this.set__12(-f1);this.set__22(-f2);this.set__32(d2);this.set__03(0);this.set__13(0);this.set__23(0);this.set__33(1);return this},get__00:function(){return this.self._00},set__00:function(f){return this.self._00=f},get__01:function(){return this.self._01},set__01:function(f){return this.self._01=f},get__02:function(){return this.self._02},set__02:function(f){return this.self._02=f},get__03:function(){return this.self._03},set__03:function(f){return this.self._03=f},get__10:function(){return this.self._10},set__10:function(f){return this.self._10=f},get__11:function(){return this.self._11},set__11:function(f){return this.self._11=f},get__12:function(){return this.self._12},set__12:function(f){return this.self._12=f},get__13:function(){return this.self._13},set__13:function(f){return this.self._13=f},get__20:function(){return this.self._20},set__20:function(f){return this.self._20=f},get__21:function(){return this.self._21},set__21:function(f){return this.self._21=f},get__22:function(){return this.self._22},set__22:function(f){return this.self._22=f},get__23:function(){return this.self._23},set__23:function(f){return this.self._23=f},get__30:function(){return this.self._30},set__30:function(f){return this.self._30=f},get__31:function(){return this.self._31},set__31:function(f){return this.self._31=f},get__32:function(){return this.self._32},set__32:function(f){return this.self._32=f},get__33:function(){return this.self._33},set__33:function(f){return this.self._33=f},__class__:iron_math_Mat4,__properties__:{set__33:"set__33",get__33:"get__33",set__32:"set__32",get__32:"get__32",set__31:"set__31",get__31:"get__31",set__30:"set__30",get__30:"get__30",set__23:"set__23",get__23:"get__23",set__22:"set__22",get__22:"get__22",set__21:"set__21",get__21:"get__21",set__20:"set__20",get__20:"get__20",set__13:"set__13",get__13:"get__13",set__12:"set__12",get__12:"get__12",set__11:"set__11",get__11:"get__11",set__10:"set__10",get__10:"get__10",set__03:"set__03",get__03:"get__03",set__02:"set__02",get__02:"get__02",set__01:"set__01",get__01:"get__01",set__00:"set__00",get__00:"get__00"}};var iron_math_Quat=function(x,y,z,w){if(w==null){w=1}if(z==null){z=0}if(y==null){y=0}if(x==null){x=0}this.x=x;this.y=y;this.z=z;this.w=w};$hxClasses["iron.math.Quat"]=iron_math_Quat;iron_math_Quat.__name__=true;iron_math_Quat.prototype={fromRotationMat:function(m){var m11=m.get__00();var m12=m.get__10();var m13=m.get__20();var m21=m.get__01();var m22=m.get__11();var m23=m.get__21();var m31=m.get__02();var m32=m.get__12();var m33=m.get__22();var tr=m11+m22+m33;var s=0;if(tr>0){s=.5/iron_math_Math.sqrt(tr+1);this.w=.25/s;this.x=(m32-m23)*s;this.y=(m13-m31)*s;this.z=(m21-m12)*s}else if(m11>m22&&m11>m33){s=2*iron_math_Math.sqrt(1+m11-m22-m33);this.w=(m32-m23)/s;this.x=.25*s;this.y=(m12+m21)/s;this.z=(m13+m31)/s}else if(m22>m33){s=2*iron_math_Math.sqrt(1+m22-m11-m33);this.w=(m13-m31)/s;this.x=(m12+m21)/s;this.y=.25*s;this.z=(m23+m32)/s}else{s=2*iron_math_Math.sqrt(1+m33-m11-m22);this.w=(m21-m12)/s;this.x=(m13+m31)/s;this.y=(m23+m32)/s;this.z=.25*s}return this},multquats:function(q1,q2){var q1x=q1.x;var q1y=q1.y;var q1z=q1.z;var q1w=q1.w;var q2x=q2.x;var q2y=q2.y;var q2z=q2.z;var q2w=q2.w;this.x=q1x*q2w+q1w*q2x+q1y*q2z-q1z*q2y;this.y=q1w*q2y-q1x*q2z+q1y*q2w+q1z*q2x;this.z=q1w*q2z+q1x*q2y-q1y*q2x+q1z*q2w;this.w=q1w*q2w-q1x*q2x-q1y*q2y-q1z*q2z;return this},normalize:function(){var l=iron_math_Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(l==0){this.x=0;this.y=0;this.z=0;this.w=0}else{l=1/l;this.x*=l;this.y*=l;this.z*=l;this.w*=l}return this},fromEuler:function(x,y,z){var f=x/2;var c1=iron_math_Math.cos(f);var s1=iron_math_Math.sin(f);f=y/2;var c2=iron_math_Math.cos(f);var s2=iron_math_Math.sin(f);f=z/2;var c3=iron_math_Math.cos(f);var s3=iron_math_Math.sin(f);this.x=s1*c2*c3+c1*s2*s3;this.y=c1*s2*c3+s1*c2*s3;this.z=c1*c2*s3-s1*s2*c3;this.w=c1*c2*c3-s1*s2*s3;return this},lerp:function(from,to,s){var fromx=from.x;var fromy=from.y;var fromz=from.z;var fromw=from.w;var dot=from.dot(to);if(dot<0){fromx=-fromx;fromy=-fromy;fromz=-fromz;fromw=-fromw}this.x=fromx+(to.x-fromx)*s;this.y=fromy+(to.y-fromy)*s;this.z=fromz+(to.z-fromz)*s;this.w=fromw+(to.w-fromw)*s;return this.normalize()},dot:function(q){return this.x*q.x+this.y*q.y+this.z*q.z+this.w*q.w},__class__:iron_math_Quat};var armory_object_Uniforms=function(){};$hxClasses["armory.object.Uniforms"]=armory_object_Uniforms;armory_object_Uniforms.__name__=true;armory_object_Uniforms.register=function(){iron_object_Uniforms.externalTextureLinks=[armory_object_Uniforms.textureLink];iron_object_Uniforms.externalVec3Links=[armory_object_Uniforms.vec3Link];iron_object_Uniforms.externalFloatLinks=[armory_object_Uniforms.floatLink]};armory_object_Uniforms.textureLink=function(object,mat,link){if(link=="_smaaSearch"){return iron_Scene.active.embedded.get("smaa_search.png")}else if(link=="_smaaArea"){return iron_Scene.active.embedded.get("smaa_area.png")}else if(link=="_lensTexture"){return iron_Scene.active.embedded.get("lenstexture.jpg")}else if(link=="_lutTexture"){return iron_Scene.active.embedded.get("luttexture.jpg")}else if(link=="_cloudsTexture"){return iron_Scene.active.embedded.get("cloudstexture.png")}return null};armory_object_Uniforms.vec3Link=function(object,mat,link){var v=null;return v};armory_object_Uniforms.floatLink=function(object,mat,link){return null};var armory_renderpath_Inc=function(){};$hxClasses["armory.renderpath.Inc"]=armory_renderpath_Inc;armory_renderpath_Inc.__name__=true;armory_renderpath_Inc.init=function(_path){armory_renderpath_Inc.path=_path};armory_renderpath_Inc.bindShadowMap=function(){var _g=0;var _g1=iron_Scene.active.lights;while(_g<_g1.length){var l=_g1[_g];++_g;if(!l.visible||!l.data.raw.cast_shadow||l.data.raw.type!="sun"){continue}var n="shadowMap";armory_renderpath_Inc.path.bindTarget(n,n);break}var _g2=0;var _g3=armory_renderpath_Inc.pointIndex;while(_g2<_g3){var i=_g2++;var n1="shadowMapPoint["+i+"]";armory_renderpath_Inc.path.bindTarget(n1,n1)}var _g4=0;var _g5=armory_renderpath_Inc.spotIndex;while(_g4<_g5){var i1=_g4++;var n2="shadowMapSpot["+i1+"]";armory_renderpath_Inc.path.bindTarget(n2,n2)}};armory_renderpath_Inc.shadowMapName=function(l){if(l.data.raw.type=="sun"){return"shadowMap"}if(l.data.raw.type=="point"){return"shadowMapPoint["+armory_renderpath_Inc.pointIndex+"]"}else{return"shadowMapSpot["+armory_renderpath_Inc.spotIndex+"]"}};armory_renderpath_Inc.getShadowMap=function(l){var target=armory_renderpath_Inc.shadowMapName(l);var rt=armory_renderpath_Inc.path.renderTargets.get(target);if(rt==null){if(armory_renderpath_Inc.path.light.data.raw.shadowmap_cube){var size=armory_renderpath_Inc.path.light.data.raw.shadowmap_size;var t=new iron_RenderTargetRaw;t.name=target;t.width=size;t.height=size;t.format="DEPTH16";t.is_cubemap=true;rt=armory_renderpath_Inc.path.createRenderTarget(t)}else{var sizew=armory_renderpath_Inc.path.light.data.raw.shadowmap_size;var sizeh=sizew;var t1=new iron_RenderTargetRaw;t1.name=target;t1.width=sizew;t1.height=sizeh;t1.format="DEPTH16";rt=armory_renderpath_Inc.path.createRenderTarget(t1)}}return target};armory_renderpath_Inc.drawShadowMap=function(){armory_renderpath_Inc.pointIndex=0;armory_renderpath_Inc.spotIndex=0;var _g=0;var _g1=iron_Scene.active.lights;while(_g<_g1.length){var l=_g1[_g];++_g;if(!l.visible||!l.data.raw.cast_shadow){continue}armory_renderpath_Inc.path.light=l;var shadowmap=armory_renderpath_Inc.getShadowMap(l);var faces=l.data.raw.shadowmap_cube?6:1;var _g2=0;var _g11=faces;while(_g2<_g11){var i=_g2++;if(faces>1){armory_renderpath_Inc.path.currentFace=i}armory_renderpath_Inc.path.setTarget(shadowmap);armory_renderpath_Inc.path.clearTarget(null,1);armory_renderpath_Inc.path.drawMeshes("shadowmap")}armory_renderpath_Inc.path.currentFace=-1;if(l.data.raw.type=="point"){armory_renderpath_Inc.pointIndex++}else if(l.data.raw.type=="spot"){armory_renderpath_Inc.spotIndex++}}};var armory_renderpath_RenderPathForward=function(){};$hxClasses["armory.renderpath.RenderPathForward"]=armory_renderpath_RenderPathForward;armory_renderpath_RenderPathForward.__name__=true;armory_renderpath_RenderPathForward.drawMeshes=function(){armory_renderpath_RenderPathForward.path.drawMeshes("mesh")};armory_renderpath_RenderPathForward.init=function(_path){armory_renderpath_RenderPathForward.path=_path};armory_renderpath_RenderPathForward.commands=function(){armory_renderpath_Inc.drawShadowMap();armory_renderpath_RenderPathForward.path.setTarget("");armory_renderpath_RenderPathForward.path.clearTarget(-1,1);armory_renderpath_Inc.bindShadowMap();armory_renderpath_RenderPathCreator.drawMeshes()};var armory_renderpath_RenderPathCreator=function(){};$hxClasses["armory.renderpath.RenderPathCreator"]=armory_renderpath_RenderPathCreator;armory_renderpath_RenderPathCreator.__name__=true;armory_renderpath_RenderPathCreator.get=function(){armory_renderpath_RenderPathCreator.path=new iron_RenderPath;armory_renderpath_Inc.init(armory_renderpath_RenderPathCreator.path);armory_renderpath_RenderPathForward.init(armory_renderpath_RenderPathCreator.path);armory_renderpath_RenderPathCreator.path.commands=armory_renderpath_RenderPathForward.commands;return armory_renderpath_RenderPathCreator.path};var armory_system_Event=function(){};$hxClasses["armory.system.Event"]=armory_system_Event;armory_system_Event.__name__=true;armory_system_Event.get=function(name){return armory_system_Event.events.get(name)};var armory_system_Logic=function(){};$hxClasses["armory.system.Logic"]=armory_system_Logic;armory_system_Logic.__name__=true;armory_system_Logic.getNode=function(id){var _g=0;var _g1=armory_system_Logic.nodes;while(_g<_g1.length){var n=_g1[_g];++_g;if(n.id==id){return n}}return null};armory_system_Logic.getInputLink=function(inp){var _g=0;var _g1=armory_system_Logic.links;while(_g<_g1.length){var l=_g1[_g];++_g;if(l.to_id==inp.node_id){var node=armory_system_Logic.getNode(inp.node_id);if(node.inputs.length<=l.to_socket){return null}if(node.inputs[l.to_socket]==inp){return l}}}return null};armory_system_Logic.getOutputLinks=function(out){var res=[];var _g=0;var _g1=armory_system_Logic.links;while(_g<_g1.length){var l=_g1[_g];++_g;if(l.from_id==out.node_id){var node=armory_system_Logic.getNode(out.node_id);if(node.outputs.length<=l.from_socket){continue}if(node.outputs[l.from_socket]==out){res.push(l)}}}return res};armory_system_Logic.safesrc=function(s){return StringTools.replace(s," ","")};armory_system_Logic.node_name=function(node){var s=armory_system_Logic.safesrc(node.name)+node.id;return s};armory_system_Logic.parse=function(canvas,onAdd){if(onAdd==null){onAdd=true}armory_system_Logic.nodes=canvas.nodes;armory_system_Logic.links=canvas.links;armory_system_Logic.parsed_nodes=[];armory_system_Logic.parsed_labels=new haxe_ds_StringMap;armory_system_Logic.nodeMap=new haxe_ds_StringMap;var root_nodes=armory_system_Logic.get_root_nodes(canvas);armory_system_Logic.tree=new armory_logicnode_LogicTree;if(onAdd){armory_system_Logic.tree.notifyOnAdd(function(){var _g=0;while(_g<root_nodes.length){var node=root_nodes[_g];++_g;armory_system_Logic.build_node(node)}})}else{var _g1=0;while(_g1<root_nodes.length){var node1=root_nodes[_g1];++_g1;armory_system_Logic.build_node(node1)}}return armory_system_Logic.tree};armory_system_Logic.build_node=function(node){var name=armory_system_Logic.node_name(node);if(armory_system_Logic.parsed_nodes.indexOf(name)!=-1){return name}armory_system_Logic.parsed_nodes.push(name);var v=armory_system_Logic.createClassInstance(node.type,[armory_system_Logic.tree]);armory_system_Logic.nodeMap.set(name,v);var _g=0;var _g1=node.buttons;while(_g<_g1.length){var b=_g1[_g];++_g;if(b.name=="property"+0){Reflect.setProperty(v,b.name,b.data[b.default_value])}}var _g2=0;var _g11=node.buttons;while(_g2<_g11.length){var b1=_g11[_g2];++_g2;if(b1.name=="property"+1){Reflect.setProperty(v,b1.name,b1.data[b1.default_value])}}var _g3=0;var _g12=node.buttons;while(_g3<_g12.length){var b2=_g12[_g3];++_g3;if(b2.name=="property"+2){Reflect.setProperty(v,b2.name,b2.data[b2.default_value])}}var _g4=0;var _g13=node.buttons;while(_g4<_g13.length){var b3=_g13[_g4];++_g4;if(b3.name=="property"+3){Reflect.setProperty(v,b3.name,b3.data[b3.default_value])}}var _g5=0;var _g14=node.buttons;while(_g5<_g14.length){var b4=_g14[_g5];++_g5;if(b4.name=="property"+4){Reflect.setProperty(v,b4.name,b4.data[b4.default_value])}}var inp_node=null;var inp_from=0;var _g6=0;var _g15=node.inputs.length;while(_g6<_g15){var i=_g6++;var inp=node.inputs[i];var l=armory_system_Logic.getInputLink(inp);if(l!=null){var n=armory_system_Logic.getNode(l.from_id);var socket=n.outputs[l.from_socket];inp_node=armory_system_Logic.nodeMap.get(armory_system_Logic.build_node(n));var _g7=0;var _g16=n.outputs.length;while(_g7<_g16){var i1=_g7++;if(n.outputs[i1]==socket){inp_from=i1;break}}}else{inp_node=armory_system_Logic.build_default_node(inp);inp_from=0}v.addInput(inp_node,inp_from)}var _g21=0;var _g31=node.outputs;while(_g21<_g31.length){var out=_g31[_g21];++_g21;var outNodes=[];var ls=armory_system_Logic.getOutputLinks(out);if(ls!=null&&ls.length>0){var _g22=0;while(_g22<ls.length){var l1=ls[_g22];++_g22;var n1=armory_system_Logic.getNode(l1.to_id);var out_name=armory_system_Logic.build_node(n1);outNodes.push(armory_system_Logic.nodeMap.get(out_name))}}else{outNodes.push(armory_system_Logic.build_default_node(out))}v.addOutputs(outNodes)}return name};armory_system_Logic.get_root_nodes=function(node_group){var roots=[];var _g=0;var _g1=node_group.nodes;while(_g<_g1.length){var node=_g1[_g];++_g;var linked=false;var _g2=0;var _g11=node.outputs;while(_g2<_g11.length){var out=_g11[_g2];++_g2;var ls=armory_system_Logic.getOutputLinks(out);if(ls!=null&&ls.length>0){linked=true;break}}if(!linked){roots.push(node)}}return roots};armory_system_Logic.build_default_node=function(inp){var v=null;if(inp.type=="OBJECT"){v=armory_system_Logic.createClassInstance("ObjectNode",[armory_system_Logic.tree,inp.default_value])}else if(inp.type=="ANIMACTION"){v=armory_system_Logic.createClassInstance("StringNode",[armory_system_Logic.tree,inp.default_value])}else if(inp.type=="VECTOR"){if(inp.default_value==null){inp.default_value=[0,0,0]}v=armory_system_Logic.createClassInstance("VectorNode",[armory_system_Logic.tree,inp.default_value[0],inp.default_value[1],inp.default_value[2]])}else if(inp.type=="RGBA"){if(inp.default_value==null){inp.default_value=[0,0,0]}v=armory_system_Logic.createClassInstance("ColorNode",[armory_system_Logic.tree,inp.default_value[0],inp.default_value[1],inp.default_value[2],inp.default_value[3]])}else if(inp.type=="RGB"){if(inp.default_value==null){inp.default_value=[0,0,0]}v=armory_system_Logic.createClassInstance("ColorNode",[armory_system_Logic.tree,inp.default_value[0],inp.default_value[1],inp.default_value[2]])}else if(inp.type=="VALUE"){v=armory_system_Logic.createClassInstance("FloatNode",[armory_system_Logic.tree,inp.default_value])}else if(inp.type=="INT"){v=armory_system_Logic.createClassInstance("IntegerNode",[armory_system_Logic.tree,inp.default_value])}else if(inp.type=="BOOLEAN"){v=armory_system_Logic.createClassInstance("BooleanNode",[armory_system_Logic.tree,inp.default_value])}else if(inp.type=="STRING"){v=armory_system_Logic.createClassInstance("StringNode",[armory_system_Logic.tree,inp.default_value])}else{v=armory_system_Logic.createClassInstance("NullNode",[armory_system_Logic.tree])}return v};armory_system_Logic.createClassInstance=function(className,args){var cname=Type.resolveClass(armory_system_Logic.packageName+"."+className);if(cname==null){return null}return Type.createInstance(cname,args)};var armory_system_Starter=function(){};$hxClasses["armory.system.Starter"]=armory_system_Starter;armory_system_Starter.__name__=true;armory_system_Starter.main=function(scene,mode,resize,min,max,w,h,msaa,vsync,getRenderPath){var start=function(){if(armory_system_Starter.tasks>0){return}if(armory_data_Config.raw==null){armory_data_Config.raw={}}var c=armory_data_Config.raw;if(c.window_mode==null){c.window_mode=mode}if(c.window_resizable==null){c.window_resizable=resize}if(c.window_minimizable==null){c.window_minimizable=min}if(c.window_maximizable==null){c.window_maximizable=max}if(c.window_w==null){c.window_w=w}if(c.window_h==null){c.window_h=h}if(c.window_msaa==null){c.window_msaa=msaa}if(c.window_vsync==null){c.window_vsync=vsync}armory_object_Uniforms.register();var windowMode=c.window_mode==0?0:1;var windowFeatures=0;if(c.window_resizable){windowFeatures=windowFeatures|1}if(c.window_maximizable){windowFeatures=windowFeatures|4}if(c.window_minimizable){windowFeatures=windowFeatures|2}kha_System.start(new kha_SystemOptions("ArmorLogic",c.window_w,c.window_h,new kha_WindowOptions(null,null,null,null,null,null,null,windowFeatures,windowMode),new kha_FramebufferOptions(null,c.window_vsync,null,null,null,c.window_msaa)),function($window){if(!kha_SystemImpl.gl2){haxe_Log.trace("WebGL 2 is not supported on this browser",{fileName:"Sources/armory/system/Starter.hx",lineNumber:41,className:"armory.system.Starter",methodName:"main"})}iron_App.init(function(){iron_Scene.setActive(scene,function(object){iron_RenderPath.setActive(getRenderPath())})})})};armory_system_Starter.tasks=1;armory_system_Starter.tasks--;start()};var armory_trait_internal_CanvasScript=function(canvasName){this.onReady=null;this.canvas=null;var _gthis=this;iron_Trait.call(this);iron_data_Data.getBlob(canvasName+".json",function(blob){iron_data_Data.getFont("font_default.ttf",function(f){_gthis.cui=new zui_Zui({font:f,theme:zui_Themes.light});var c=JSON.parse(blob.toString());if(c.assets==null||c.assets.length==0){_gthis.canvas=c}else{var loaded=0;var _g=0;var _g1=c.assets;while(_g<_g1.length){var asset=[_g1[_g]];++_g;var file=asset[0].name;iron_data_Data.getImage(file,function(asset1){return function(image){zui_Canvas.assetMap.set(asset1[0].id,image);if((loaded+=1)>=c.assets.length){_gthis.canvas=c}}}(asset))}}})});this.notifyOnRender2D(function(g){if(_gthis.canvas==null){return}var events=zui_Canvas.draw(_gthis.cui,_gthis.canvas,g);var _g2=0;while(_g2<events.length){var e=events[_g2];++_g2;var all=armory_system_Event.get(e);if(all!=null){var _g3=0;while(_g3<all.length){var entry=all[_g3];++_g3;entry.onEvent()}}}if(_gthis.onReady!=null){_gthis.onReady();_gthis.onReady=null}})};$hxClasses["armory.trait.internal.CanvasScript"]=armory_trait_internal_CanvasScript;armory_trait_internal_CanvasScript.__name__=true;armory_trait_internal_CanvasScript.__super__=iron_Trait;armory_trait_internal_CanvasScript.prototype=$extend(iron_Trait.prototype,{__class__:armory_trait_internal_CanvasScript});var armory_trait_navigation_Navigation=function(){iron_Trait.call(this)};$hxClasses["armory.trait.navigation.Navigation"]=armory_trait_navigation_Navigation;armory_trait_navigation_Navigation.__name__=true;armory_trait_navigation_Navigation.__super__=iron_Trait;armory_trait_navigation_Navigation.prototype=$extend(iron_Trait.prototype,{__class__:armory_trait_navigation_Navigation});var armory_trait_physics_PhysicsWorld=function(){iron_Trait.call(this)};$hxClasses["armory.trait.physics.PhysicsWorld"]=armory_trait_physics_PhysicsWorld;armory_trait_physics_PhysicsWorld.__name__=true;armory_trait_physics_PhysicsWorld.__super__=iron_Trait;armory_trait_physics_PhysicsWorld.prototype=$extend(iron_Trait.prototype,{__class__:armory_trait_physics_PhysicsWorld});var armory_trait_physics_RigidBody=function(){iron_Trait.call(this)};$hxClasses["armory.trait.physics.RigidBody"]=armory_trait_physics_RigidBody;armory_trait_physics_RigidBody.__name__=true;armory_trait_physics_RigidBody.__super__=iron_Trait;armory_trait_physics_RigidBody.prototype=$extend(iron_Trait.prototype,{__class__:armory_trait_physics_RigidBody});var haxe_IMap=function(){};$hxClasses["haxe.IMap"]=haxe_IMap;haxe_IMap.__name__=true;var haxe_Log=function(){};$hxClasses["haxe.Log"]=haxe_Log;haxe_Log.__name__=true;haxe_Log.formatOutput=function(v,infos){var str=Std.string(v);if(infos==null){return str}var pstr=infos.fileName+":"+infos.lineNumber;if(infos!=null&&infos.customParams!=null){var _g=0;var _g1=infos.customParams;while(_g<_g1.length){var v1=_g1[_g];++_g;str+=", "+Std.string(v1)}}return pstr+": "+str};haxe_Log.trace=function(v,infos){var str=haxe_Log.formatOutput(v,infos);if(typeof console!="undefined"&&console.log!=null){console.log(str)}};var haxe__$Unserializer_DefaultResolver=function(){};$hxClasses["haxe._Unserializer.DefaultResolver"]=haxe__$Unserializer_DefaultResolver;haxe__$Unserializer_DefaultResolver.__name__=true;haxe__$Unserializer_DefaultResolver.prototype={resolveClass:function(name){return Type.resolveClass(name)},resolveEnum:function(name){return Type.resolveEnum(name)},__class__:haxe__$Unserializer_DefaultResolver};var haxe_Unserializer=function(buf){this.buf=buf;this.length=buf.length;this.pos=0;this.scache=[];this.cache=[];var r=haxe_Unserializer.DEFAULT_RESOLVER;if(r==null){r=new haxe__$Unserializer_DefaultResolver;haxe_Unserializer.DEFAULT_RESOLVER=r}this.resolver=r};$hxClasses["haxe.Unserializer"]=haxe_Unserializer;haxe_Unserializer.__name__=true;haxe_Unserializer.initCodes=function(){var codes=[];var _g=0;var _g1=haxe_Unserializer.BASE64.length;while(_g<_g1){var i=_g++;codes[StringTools.fastCodeAt(haxe_Unserializer.BASE64,i)]=i}return codes};haxe_Unserializer.run=function(v){return new haxe_Unserializer(v).unserialize()};haxe_Unserializer.prototype={get:function(p){return StringTools.fastCodeAt(this.buf,p)},readDigits:function(){var k=0;var s=false;var fpos=this.pos;while(true){var c=this.get(this.pos);if(StringTools.isEof(c)){break}if(c==45){if(this.pos!=fpos){break}s=true;this.pos++;continue}if(c<48||c>57){break}k=k*10+(c-48);this.pos++}if(s){k*=-1}return k},readFloat:function(){var p1=this.pos;while(true){var c=this.get(this.pos);if(StringTools.isEof(c)){break}if(c>=43&&c<58||c==101||c==69){this.pos++}else{break}}return Std.parseFloat(HxOverrides.substr(this.buf,p1,this.pos-p1))},unserializeObject:function(o){while(true){if(this.pos>=this.length){throw new js__$Boot_HaxeError("Invalid object")}if(this.get(this.pos)==103){break}var k=this.unserialize();if(typeof k!="string"){throw new js__$Boot_HaxeError("Invalid object key")}var v=this.unserialize();Reflect.setField(o,k,v)}this.pos++},unserializeEnum:function(edecl,tag){if(this.get(this.pos++)!=58){throw new js__$Boot_HaxeError("Invalid enum format")}var nargs=this.readDigits();if(nargs==0){return Type.createEnum(edecl,tag)}var args=[];while(nargs-- >0)args.push(this.unserialize());return Type.createEnum(edecl,tag,args)},unserialize:function(){switch(this.get(this.pos++)){case 65:var name=this.unserialize();var cl=this.resolver.resolveClass(name);if(cl==null){throw new js__$Boot_HaxeError("Class not found "+name)}return cl;case 66:var name1=this.unserialize();var e=this.resolver.resolveEnum(name1);if(e==null){throw new js__$Boot_HaxeError("Enum not found "+name1)}return e;case 67:var name2=this.unserialize();var cl1=this.resolver.resolveClass(name2);if(cl1==null){throw new js__$Boot_HaxeError("Class not found "+name2)}var o=Type.createEmptyInstance(cl1);this.cache.push(o);o.hxUnserialize(this);if(this.get(this.pos++)!=103){throw new js__$Boot_HaxeError("Invalid custom data")}return o;case 77:var h=new haxe_ds_ObjectMap;this.cache.push(h);var buf=this.buf;while(this.get(this.pos)!=104){var s=this.unserialize();h.set(s,this.unserialize())}this.pos++;return h;case 82:var n=this.readDigits();if(n<0||n>=this.scache.length){throw new js__$Boot_HaxeError("Invalid string reference")}return this.scache[n];case 97:var buf1=this.buf;var a=[];this.cache.push(a);while(true){var c=this.get(this.pos);if(c==104){this.pos++;break}if(c==117){this.pos++;var n1=this.readDigits();a[a.length+n1-1]=null}else{a.push(this.unserialize())}}return a;case 98:var h1=new haxe_ds_StringMap;this.cache.push(h1);var buf2=this.buf;while(this.get(this.pos)!=104){var s1=this.unserialize();h1.set(s1,this.unserialize())}this.pos++;return h1;case 99:var name3=this.unserialize();var cl2=this.resolver.resolveClass(name3);if(cl2==null){throw new js__$Boot_HaxeError("Class not found "+name3)}var o1=Type.createEmptyInstance(cl2);this.cache.push(o1);this.unserializeObject(o1);return o1;case 100:return this.readFloat();case 102:return false;case 105:return this.readDigits();case 106:var name4=this.unserialize();var edecl=this.resolver.resolveEnum(name4);if(edecl==null){throw new js__$Boot_HaxeError("Enum not found "+name4)}this.pos++;var index=this.readDigits();var tag=Type.getEnumConstructs(edecl)[index];if(tag==null){throw new js__$Boot_HaxeError("Unknown enum index "+name4+"@"+index)}var e1=this.unserializeEnum(edecl,tag);this.cache.push(e1);return e1;case 107:return NaN;case 108:var l=new haxe_ds_List;this.cache.push(l);var buf3=this.buf;while(this.get(this.pos)!=104)l.add(this.unserialize());this.pos++;return l;case 109:return-Infinity;case 110:return null;case 111:var o2={};this.cache.push(o2);this.unserializeObject(o2);return o2;case 112:return Infinity;case 113:var h2=new haxe_ds_IntMap;this.cache.push(h2);var buf4=this.buf;var c1=this.get(this.pos++);while(c1==58){var i=this.readDigits();h2.set(i,this.unserialize());c1=this.get(this.pos++)}if(c1!=104){throw new js__$Boot_HaxeError("Invalid IntMap format")}return h2;case 114:var n2=this.readDigits();if(n2<0||n2>=this.cache.length){throw new js__$Boot_HaxeError("Invalid reference")}return this.cache[n2];case 115:var len=this.readDigits();var buf5=this.buf;if(this.get(this.pos++)!=58||this.length-this.pos<len){throw new js__$Boot_HaxeError("Invalid bytes length")}var codes=haxe_Unserializer.CODES;if(codes==null){codes=haxe_Unserializer.initCodes();haxe_Unserializer.CODES=codes}var i1=this.pos;var rest=len&3;var size=(len>>2)*3+(rest>=2?rest-1:0);var max=i1+(len-rest);var bytes=haxe_io_Bytes.alloc(size);var bpos=0;while(i1<max){var c11=codes[StringTools.fastCodeAt(buf5,i1++)];var c2=codes[StringTools.fastCodeAt(buf5,i1++)];bytes.set(bpos++,c11<<2|c2>>4);var c3=codes[StringTools.fastCodeAt(buf5,i1++)];bytes.set(bpos++,c2<<4|c3>>2);var c4=codes[StringTools.fastCodeAt(buf5,i1++)];bytes.set(bpos++,c3<<6|c4)}if(rest>=2){var c12=codes[StringTools.fastCodeAt(buf5,i1++)];var c21=codes[StringTools.fastCodeAt(buf5,i1++)];bytes.set(bpos++,c12<<2|c21>>4);if(rest==3){var c31=codes[StringTools.fastCodeAt(buf5,i1++)];bytes.set(bpos++,c21<<4|c31>>2)}}this.pos+=len;this.cache.push(bytes);return bytes;case 116:return true;case 118:var d;if(this.get(this.pos)>=48&&this.get(this.pos)<=57&&this.get(this.pos+1)>=48&&this.get(this.pos+1)<=57&&this.get(this.pos+2)>=48&&this.get(this.pos+2)<=57&&this.get(this.pos+3)>=48&&this.get(this.pos+3)<=57&&this.get(this.pos+4)==45){d=HxOverrides.strDate(HxOverrides.substr(this.buf,this.pos,19));this.pos+=19}else{d=new Date(this.readFloat())}this.cache.push(d);return d;case 119:var name5=this.unserialize();var edecl1=this.resolver.resolveEnum(name5);if(edecl1==null){throw new js__$Boot_HaxeError("Enum not found "+name5)}var e2=this.unserializeEnum(edecl1,this.unserialize());this.cache.push(e2);return e2;case 120:throw js__$Boot_HaxeError.wrap(this.unserialize());case 121:var len1=this.readDigits();if(this.get(this.pos++)!=58||this.length-this.pos<len1){throw new js__$Boot_HaxeError("Invalid string length")}var s2=HxOverrides.substr(this.buf,this.pos,len1);this.pos+=len1;s2=StringTools.urlDecode(s2);this.scache.push(s2);return s2;case 122:return 0;default:}this.pos--;throw new js__$Boot_HaxeError("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos)},__class__:haxe_Unserializer};var haxe_io_Bytes=function(data){this.length=data.byteLength;this.b=new Uint8Array(data);this.b.bufferValue=data;data.hxBytes=this;data.bytes=this.b};$hxClasses["haxe.io.Bytes"]=haxe_io_Bytes;haxe_io_Bytes.__name__=true;haxe_io_Bytes.alloc=function(length){return new haxe_io_Bytes(new ArrayBuffer(length))};haxe_io_Bytes.ofData=function(b){var hb=b.hxBytes;if(hb!=null){return hb}return new haxe_io_Bytes(b)};haxe_io_Bytes.prototype={get:function(pos){return this.b[pos]},set:function(pos,v){this.b[pos]=v},blit:function(pos,src,srcpos,len){if(pos<0||srcpos<0||len<0||pos+len>this.length||srcpos+len>src.length){throw new js__$Boot_HaxeError(haxe_io_Error.OutsideBounds)}if(srcpos==0&&len==src.b.byteLength){this.b.set(src.b,pos)}else{this.b.set(src.b.subarray(srcpos,srcpos+len),pos)}},sub:function(pos,len){if(pos<0||len<0||pos+len>this.length){throw new js__$Boot_HaxeError(haxe_io_Error.OutsideBounds)}return new haxe_io_Bytes(this.b.buffer.slice(pos+this.b.byteOffset,pos+this.b.byteOffset+len))},initData:function(){if(this.data==null){this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)}},setInt32:function(pos,v){this.initData();this.data.setInt32(pos,v,true)},getString:function(pos,len,encoding){if(pos<0||len<0||pos+len>this.length){throw new js__$Boot_HaxeError(haxe_io_Error.OutsideBounds)}if(encoding==null){encoding=haxe_io_Encoding.UTF8}var s="";var b=this.b;var i=pos;var max=pos+len;switch(encoding._hx_index){case 0:var debug=pos>0;while(i<max){var c=b[i++];if(c<128){if(c==0){break}s+=String.fromCodePoint(c)}else if(c<224){var code=(c&63)<<6|b[i++]&127;s+=String.fromCodePoint(code)}else if(c<240){var c2=b[i++];var code1=(c&31)<<12|(c2&127)<<6|b[i++]&127;s+=String.fromCodePoint(code1)}else{var c21=b[i++];var c3=b[i++];var u=(c&15)<<18|(c21&127)<<12|(c3&127)<<6|b[i++]&127;s+=String.fromCodePoint(u)}}break;case 1:while(i<max){var c1=b[i++]|b[i++]<<8;s+=String.fromCodePoint(c1)}break}return s},toString:function(){return this.getString(0,this.length)},getData:function(){return this.b.bufferValue},__class__:haxe_io_Bytes};var haxe_io_Encoding=$hxEnums["haxe.io.Encoding"]={__ename__:true,__constructs__:["UTF8","RawNative"],UTF8:{_hx_index:0,__enum__:"haxe.io.Encoding",toString:$estr},RawNative:{_hx_index:1,__enum__:"haxe.io.Encoding",toString:$estr}};var haxe_ds_IntMap=function(){this.h={}};$hxClasses["haxe.ds.IntMap"]=haxe_ds_IntMap;haxe_ds_IntMap.__name__=true;haxe_ds_IntMap.__interfaces__=[haxe_IMap];haxe_ds_IntMap.prototype={set:function(key,value){this.h[key]=value},get:function(key){return this.h[key]},exists:function(key){return this.h.hasOwnProperty(key)},__class__:haxe_ds_IntMap};var haxe_ds_List=function(){this.length=0};$hxClasses["haxe.ds.List"]=haxe_ds_List;haxe_ds_List.__name__=true;haxe_ds_List.prototype={add:function(item){var x=new haxe_ds__$List_ListNode(item,null);if(this.h==null){this.h=x}else{this.q.next=x}this.q=x;this.length++},__class__:haxe_ds_List};var haxe_ds__$List_ListNode=function(item,next){this.item=item;this.next=next};$hxClasses["haxe.ds._List.ListNode"]=haxe_ds__$List_ListNode;haxe_ds__$List_ListNode.__name__=true;haxe_ds__$List_ListNode.prototype={__class__:haxe_ds__$List_ListNode};var haxe_ds_ObjectMap=function(){this.h={__keys__:{}}};$hxClasses["haxe.ds.ObjectMap"]=haxe_ds_ObjectMap;haxe_ds_ObjectMap.__name__=true;haxe_ds_ObjectMap.__interfaces__=[haxe_IMap];haxe_ds_ObjectMap.assignId=function(obj){return obj.__id__=++haxe_ds_ObjectMap.count};haxe_ds_ObjectMap.getId=function(obj){return obj.__id__};haxe_ds_ObjectMap.prototype={set:function(key,value){var id=haxe_ds_ObjectMap.getId(key)||haxe_ds_ObjectMap.assignId(key);this.h[id]=value;this.h.__keys__[id]=key},__class__:haxe_ds_ObjectMap};var haxe_ds__$StringMap_StringMapIterator=function(map,keys){this.map=map;this.keys=keys;this.index=0;this.count=keys.length};$hxClasses["haxe.ds._StringMap.StringMapIterator"]=haxe_ds__$StringMap_StringMapIterator;haxe_ds__$StringMap_StringMapIterator.__name__=true;haxe_ds__$StringMap_StringMapIterator.prototype={hasNext:function(){return this.index<this.count},next:function(){return this.map.get(this.keys[this.index++])},__class__:haxe_ds__$StringMap_StringMapIterator};var haxe_ds_StringMap=function(){this.h={}};$hxClasses["haxe.ds.StringMap"]=haxe_ds_StringMap;haxe_ds_StringMap.__name__=true;haxe_ds_StringMap.__interfaces__=[haxe_IMap];haxe_ds_StringMap.prototype={isReserved:function(key){return __map_reserved[key]!=null},set:function(key,value){if(this.isReserved(key)){this.setReserved(key,value)}else{this.h[key]=value}},get:function(key){if(this.isReserved(key)){return this.getReserved(key)}return this.h[key]},setReserved:function(key,value){if(this.rh==null){this.rh={}}this.rh["$"+key]=value},getReserved:function(key){if(this.rh==null){return null}else{return this.rh["$"+key]}},remove:function(key){if(this.isReserved(key)){key="$"+key;if(this.rh==null||!this.rh.hasOwnProperty(key)){return false}delete this.rh[key];return true}else{if(!this.h.hasOwnProperty(key)){return false}delete this.h[key];return true}},arrayKeys:function(){var out=[];for(var key in this.h){if(this.h.hasOwnProperty(key)){out.push(key)}}if(this.rh!=null){for(var key in this.rh){if(key.charCodeAt(0)==36){out.push(key.substr(1))}}}return out},iterator:function(){return new haxe_ds__$StringMap_StringMapIterator(this,this.arrayKeys())},__class__:haxe_ds_StringMap};var haxe_io_Input=function(){};$hxClasses["haxe.io.Input"]=haxe_io_Input;haxe_io_Input.__name__=true;haxe_io_Input.prototype={readByte:function(){throw new js__$Boot_HaxeError("Not implemented")},readBytes:function(s,pos,len){var k=len;var b=s.b;if(pos<0||len<0||pos+len>s.length){throw new js__$Boot_HaxeError(haxe_io_Error.OutsideBounds)}try{while(k>0){b[pos]=this.readByte();++pos;--k}}catch(eof){var eof1=eof instanceof js__$Boot_HaxeError?eof.val:eof;if(eof1 instanceof haxe_io_Eof){var eof2=eof1}else{throw eof}}return len-k},set_bigEndian:function(b){this.bigEndian=b;return b},readFullBytes:function(s,pos,len){while(len>0){var k=this.readBytes(s,pos,len);if(k==0){throw new js__$Boot_HaxeError(haxe_io_Error.Blocked)}pos+=k;len-=k}},read:function(nbytes){var s=haxe_io_Bytes.alloc(nbytes);var p=0;while(nbytes>0){var k=this.readBytes(s,p,nbytes);if(k==0){throw new js__$Boot_HaxeError(haxe_io_Error.Blocked)}p+=k;nbytes-=k}return s},readFloat:function(){return haxe_io_FPHelper.i32ToFloat(this.readInt32())},readInt8:function(){var n=this.readByte();if(n>=128){return n-256}return n},readInt16:function(){var ch1=this.readByte();var ch2=this.readByte();var n=this.bigEndian?ch2|ch1<<8:ch1|ch2<<8;if((n&32768)!=0){return n-65536}return n},readUInt16:function(){var ch1=this.readByte();var ch2=this.readByte();if(this.bigEndian){return ch2|ch1<<8}else{return ch1|ch2<<8}},readInt32:function(){var ch1=this.readByte();var ch2=this.readByte();var ch3=this.readByte();var ch4=this.readByte();if(this.bigEndian){return ch4|ch3<<8|ch2<<16|ch1<<24}else{return ch1|ch2<<8|ch3<<16|ch4<<24}},readString:function(len,encoding){var b=haxe_io_Bytes.alloc(len);this.readFullBytes(b,0,len);return b.getString(0,len,encoding)},__class__:haxe_io_Input,__properties__:{set_bigEndian:"set_bigEndian"}};var haxe_io_BytesInput=function(b,pos,len){if(pos==null){pos=0}if(len==null){len=b.length-pos}if(pos<0||len<0||pos+len>b.length){throw new js__$Boot_HaxeError(haxe_io_Error.OutsideBounds)}this.b=b.b;this.pos=pos;this.len=len;this.totlen=len};$hxClasses["haxe.io.BytesInput"]=haxe_io_BytesInput;haxe_io_BytesInput.__name__=true;haxe_io_BytesInput.__super__=haxe_io_Input;haxe_io_BytesInput.prototype=$extend(haxe_io_Input.prototype,{get_position:function(){return this.pos},get_length:function(){return this.totlen},set_position:function(p){if(p<0){p=0}else if(p>this.get_length()){p=this.get_length()}this.len=this.totlen-p;return this.pos=p},readByte:function(){if(this.len==0){throw new js__$Boot_HaxeError(new haxe_io_Eof)}this.len--;return this.b[this.pos++]},readBytes:function(buf,pos,len){if(pos<0||len<0||pos+len>buf.length){throw new js__$Boot_HaxeError(haxe_io_Error.OutsideBounds)}if(this.len==0&&len>0){throw new js__$Boot_HaxeError(new haxe_io_Eof)}if(this.len<len){len=this.len}var b1=this.b;var b2=buf.b;var _g=0;var _g1=len;while(_g<_g1){var i=_g++;b2[pos+i]=b1[this.pos+i]}this.pos+=len;this.len-=len;return len},__class__:haxe_io_BytesInput,__properties__:$extend(haxe_io_Input.prototype.__properties__,{get_length:"get_length",set_position:"set_position",get_position:"get_position"})});var haxe_io_Eof=function(){};$hxClasses["haxe.io.Eof"]=haxe_io_Eof;haxe_io_Eof.__name__=true;haxe_io_Eof.prototype={toString:function(){return"Eof"},__class__:haxe_io_Eof};var haxe_io_Error=$hxEnums["haxe.io.Error"]={__ename__:true,__constructs__:["Blocked","Overflow","OutsideBounds","Custom"],Blocked:{_hx_index:0,__enum__:"haxe.io.Error",toString:$estr},Overflow:{_hx_index:1,__enum__:"haxe.io.Error",toString:$estr},OutsideBounds:{_hx_index:2,__enum__:"haxe.io.Error",toString:$estr},Custom:($_=function(e){return{_hx_index:3,e:e,__enum__:"haxe.io.Error",toString:$estr}},$_.__params__=["e"],$_)};var haxe_io_FPHelper=function(){};$hxClasses["haxe.io.FPHelper"]=haxe_io_FPHelper;haxe_io_FPHelper.__name__=true;haxe_io_FPHelper.i32ToFloat=function(i){haxe_io_FPHelper.helper.setInt32(0,i,true);return haxe_io_FPHelper.helper.getFloat32(0,true)};var haxe_io__$UInt8Array_UInt8Array_$Impl_$={};$hxClasses["haxe.io._UInt8Array.UInt8Array_Impl_"]=haxe_io__$UInt8Array_UInt8Array_$Impl_$;haxe_io__$UInt8Array_UInt8Array_$Impl_$.__name__=true;haxe_io__$UInt8Array_UInt8Array_$Impl_$.fromBytes=function(bytes,bytePos,length){if(bytePos==null){bytePos=0}if(length==null){length=bytes.length-bytePos}return new Uint8Array(bytes.getData(),bytePos,length)};var iron_App=function(_appReady){_appReady();kha_System.notifyOnFrames(iron_App.render);kha_Scheduler.addTimeTask(iron_App.update,0,iron_system_Time.get_delta())};$hxClasses["iron.App"]=iron_App;iron_App.__name__=true;iron_App.w=function(){return arm_App.w()};iron_App.h=function(){return arm_App.h()};iron_App.x=function(){return arm_App.x()};iron_App.y=function(){return arm_App.y()};iron_App.init=function(_appReady){new iron_App(_appReady)};iron_App.update=function(){if(iron_Scene.active==null||!iron_Scene.active.ready){return}if(iron_App.pauseUpdates){return}iron_Scene.active.updateFrame();var i=0;var l=iron_App.traitUpdates.length;while(i<l){if(iron_App.traitInits.length>0){var _g=0;var _g1=iron_App.traitInits;while(_g<_g1.length){var f=_g1[_g];++_g;if(iron_App.traitInits.length>0){f()}else{break}}iron_App.traitInits.splice(0,iron_App.traitInits.length)}iron_App.traitUpdates[i]();if(l<=iron_App.traitUpdates.length){++i}else{l=iron_App.traitUpdates.length}}i=0;l=iron_App.traitLateUpdates.length;while(i<l){iron_App.traitLateUpdates[i]();if(l<=iron_App.traitLateUpdates.length){++i}else{l=iron_App.traitLateUpdates.length}}if(iron_App.onEndFrames!=null){var _g2=0;var _g11=iron_App.onEndFrames;while(_g2<_g11.length){var f1=_g11[_g2];++_g2;f1()}}if(iron_App.lastw==-1){iron_App.lastw=iron_App.w();iron_App.lasth=iron_App.h()}if(iron_App.lastw!=iron_App.w()||iron_App.lasth!=iron_App.h()){if(iron_Scene.active!=null&&iron_Scene.active.camera!=null){iron_Scene.active.camera.buildProjection()}}iron_App.lastw=iron_App.w();iron_App.lasth=iron_App.h()};iron_App.render=function(frames){var frame=frames[0];iron_App.framebuffer=frame;iron_system_Time.update();if(iron_Scene.active==null||!iron_Scene.active.ready){iron_App.render2D(frame);return}if(iron_App.traitInits.length>0){var _g=0;var _g1=iron_App.traitInits;while(_g<_g1.length){var f=_g1[_g];++_g;if(iron_App.traitInits.length>0){f()}else{break}}iron_App.traitInits.splice(0,iron_App.traitInits.length)}iron_Scene.active.renderFrame(frame.get_g4());var _g2=0;var _g11=iron_App.traitRenders;while(_g2<_g11.length){var f1=_g11[_g2];++_g2;if(iron_App.traitRenders.length>0){f1(frame.get_g4())}else{break}}iron_App.render2D(frame)};iron_App.render2D=function(frame){if(iron_App.traitRenders2D.length>0){frame.get_g2().begin(false);var _g=0;var _g1=iron_App.traitRenders2D;while(_g<_g1.length){var f=_g1[_g];++_g;if(iron_App.traitRenders2D.length>0){f(frame.get_g2())}else{break}}frame.get_g2().end()}};iron_App.notifyOnInit=function(f){iron_App.traitInits.push(f)};iron_App.removeInit=function(f){HxOverrides.remove(iron_App.traitInits,f)};iron_App.notifyOnUpdate=function(f){iron_App.traitUpdates.push(f)};iron_App.removeUpdate=function(f){HxOverrides.remove(iron_App.traitUpdates,f)};iron_App.removeLateUpdate=function(f){HxOverrides.remove(iron_App.traitLateUpdates,f)};iron_App.removeRender=function(f){HxOverrides.remove(iron_App.traitRenders,f)};iron_App.notifyOnRender2D=function(f){iron_App.traitRenders2D.push(f)};iron_App.removeRender2D=function(f){HxOverrides.remove(iron_App.traitRenders2D,f)};iron_App.notifyOnReset=function(f){if(iron_App.onResets==null){iron_App.onResets=[]}iron_App.onResets.push(f)};iron_App.notifyOnEndFrame=function(f){if(iron_App.onEndFrames==null){iron_App.onEndFrames=[]}iron_App.onEndFrames.push(f)};iron_App.prototype={__class__:iron_App};var iron_RenderPath=function(){this.depthBuffers=[];this.depthToRenderTarget=new haxe_ds_StringMap;this.renderTargets=new haxe_ds_StringMap;this.commands=null;this.loading=0;this.paused=false;this.drawOrder=1;this.lastFrameTime=0;this.viewportScaled=false;this.scissorSet=false;this.lastH=0;this.lastW=0;this.isProbe=false;this.isProbeCube=false;this.isProbePlanar=false;this.point=null;this.sun=null;this.light=null;this.currentTarget=null;this.frameTime=0;this.frameScissorH=0;this.frameScissorW=0;this.frameScissorY=0;this.frameScissorX=0;this.frameScissor=false};$hxClasses["iron.RenderPath"]=iron_RenderPath;iron_RenderPath.__name__=true;iron_RenderPath.setActive=function(renderPath){iron_RenderPath.active=renderPath};iron_RenderPath.sortMeshesDistance=function(meshes){meshes.sort(function(a,b){if(a.cameraDistance>=b.cameraDistance){return 1}else{return-1}})};iron_RenderPath.sortMeshesShader=function(meshes){meshes.sort(function(a,b){if(a.materials[0].name>=b.materials[0].name){return 1}else{return-1}})};iron_RenderPath.prototype={get_ready:function(){return this.loading==0},renderFrame:function(g){if(!this.get_ready()||this.paused||iron_App.w()==0||iron_App.h()==0){return}if(this.lastW>0&&(this.lastW!=iron_App.w()||this.lastH!=iron_App.h())){this.resize()}this.lastW=iron_App.w();this.lastH=iron_App.h();this.frameTime=iron_system_Time.time()-this.lastFrameTime;this.lastFrameTime=iron_system_Time.time();var cam=iron_Scene.active.camera;this.isProbePlanar=cam!=null&&cam.renderTarget!=null;this.isProbeCube=cam!=null&&cam.renderTargetCube!=null;this.isProbe=this.isProbePlanar||this.isProbeCube;if(this.isProbePlanar){this.frameG=cam.renderTarget.get_g4()}else if(this.isProbeCube){this.frameG=cam.renderTargetCube.get_g4()}else{this.frameG=g}this.currentG=this.frameG;this.currentW=iron_App.w();this.currentH=iron_App.h();this.currentD=1;this.currentFace=-1;this.meshesSorted=false;var _g=0;var _g1=iron_Scene.active.lights;while(_g<_g1.length){var l=_g1[_g];++_g;if(l.visible){l.buildMatrix(iron_Scene.active.camera)}if(l.data.raw.type=="sun"){this.sun=l}else{this.point=l}}this.light=iron_Scene.active.lights[0];this.commands()},setTarget:function(target,additional,viewportScale){if(viewportScale==null){viewportScale=1}if(target==""){this.currentG=this.frameG;this.currentD=1;this.currentTarget=null;this.currentFace=-1;if(this.isProbeCube){this.currentW=iron_Scene.active.camera.renderTargetCube.get_width();this.currentH=iron_Scene.active.camera.renderTargetCube.get_height();this.begin(this.currentG,null,iron_Scene.active.camera.currentFace)}else{this.currentW=iron_App.w();this.currentH=iron_App.h();if(this.frameScissor){this.setFrameScissor()}this.begin(this.currentG);if(!this.isProbe){this.setCurrentViewport(iron_App.w(),iron_App.h());this.setCurrentScissor(iron_App.w(),iron_App.h())}}}else{var rt=this.renderTargets.get(target);this.currentTarget=rt;var additionalImages=null;if(additional!=null){additionalImages=[];var _g=0;while(_g<additional.length){var s=additional[_g];++_g;var t=this.renderTargets.get(s);additionalImages.push(t.image)}}this.currentG=rt.isCubeMap?rt.cubeMap.get_g4():rt.image.get_g4();this.currentW=rt.isCubeMap?rt.cubeMap.get_width():rt.image.get_width();this.currentH=rt.isCubeMap?rt.cubeMap.get_height():rt.image.get_height();if(rt.is3D){this.currentD=rt.image.get_depth()}this.begin(this.currentG,additionalImages,this.currentFace)}if(viewportScale!=1){this.viewportScaled=true;var viewW=Std.int(this.currentW*viewportScale);var viewH=Std.int(this.currentH*viewportScale);this.currentG.viewport(0,viewH,viewW,viewH);this.currentG.scissor(0,viewH,viewW,viewH)}else if(this.viewportScaled){this.viewportScaled=false;this.setCurrentViewport(this.currentW,this.currentH);this.setCurrentScissor(this.currentW,this.currentH)}this.bindParams=null},begin:function(g,additionalRenderTargets,face){if(face==null){face=-1}if(face>=0){g.beginFace(face)}else{g.begin(additionalRenderTargets)}},end:function(g){g.end();if(this.scissorSet){g.disableScissor();this.scissorSet=false}this.bindParams=null},setCurrentViewport:function(viewW,viewH){this.currentG.viewport(iron_App.x(),this.currentH-viewH-iron_App.y(),viewW,viewH)},setCurrentScissor:function(viewW,viewH){this.currentG.scissor(iron_App.x(),this.currentH-viewH-iron_App.y(),viewW,viewH);this.scissorSet=true},setFrameScissor:function(){this.frameG.scissor(this.frameScissorX,this.currentH-(this.frameScissorH-this.frameScissorY),this.frameScissorW,this.frameScissorH)},clearTarget:function(colorFlag,depthFlag){if(colorFlag==-1){if(iron_Scene.active.world!=null){colorFlag=iron_Scene.active.world.raw.background_color}else if(iron_Scene.active.camera!=null){var cc=iron_Scene.active.camera.data.raw.clear_color;if(cc!=null){colorFlag=kha__$Color_Color_$Impl_$.fromFloats(cc[0],cc[1],cc[2])}}}this.currentG.clear(colorFlag,depthFlag,null)},drawMeshes:function(context){var isShadows=context=="shadowmap";if(isShadows){if(this.light==null||!this.light.data.raw.cast_shadow||!this.light.visible||this.light.data.raw.strength==0){return}}if(this.currentFace>=0&&this.light!=null){this.light.setCubeFace(this.currentFace,iron_Scene.active.camera)}var g=this.currentG;var drawn=false;if(!drawn){this.submitDraw(context)}this.end(g)},submitDraw:function(context){var camera=iron_Scene.active.camera;var meshes=iron_Scene.active.meshes;var g=this.currentG;iron_object_MeshObject.lastPipeline=null;if(!this.meshesSorted&&camera!=null){var camX=camera.transform.worldx();var camY=camera.transform.worldy();var camZ=camera.transform.worldz();var _g=0;while(_g<meshes.length){var mesh=meshes[_g];++_g;mesh.computeCameraDistance(camX,camY,camZ)}if(this.drawOrder==1){iron_RenderPath.sortMeshesShader(meshes)}else{iron_RenderPath.sortMeshesDistance(meshes)}this.meshesSorted=true}var _g1=0;while(_g1<meshes.length){var m=meshes[_g1];++_g1;m.render(g,context,this.bindParams)}},bindTarget:function(target,uniform){if(this.bindParams!=null){this.bindParams.push(target);this.bindParams.push(uniform)}else{this.bindParams=[target,uniform]}},resize:function(){var rt=this.renderTargets.iterator();while(rt.hasNext()){var rt1=rt.next();if(rt1.raw.width==0){rt1.image.unload();rt1.image=this.createImage(rt1.raw,rt1.depthStencil);if(rt1.depthStencilFrom!=""){rt1.image.setDepthStencilFrom(this.depthToRenderTarget.get(rt1.depthStencilFrom).image)}}}},createRenderTarget:function(t){var rt=this.createTarget(t);this.renderTargets.set(t.name,rt);return rt},createTarget:function(t){var rt=new iron_RenderTarget(t);if(t.depth_buffer!=null){rt.hasDepth=true;var depthTarget=this.depthToRenderTarget.get(t.depth_buffer);if(depthTarget==null){var _g=0;var _g1=this.depthBuffers;while(_g<_g1.length){var db=_g1[_g];++_g;if(db.name==t.depth_buffer){this.depthToRenderTarget.set(db.name,rt);rt.depthStencil=this.getDepthStencilFormat(db.format);rt.image=this.createImage(t,rt.depthStencil);break}}}else{rt.depthStencil=0;rt.depthStencilFrom=t.depth_buffer;rt.image=this.createImage(t,rt.depthStencil);rt.image.setDepthStencilFrom(depthTarget.image)}}else{rt.hasDepth=false;if(t.depth!=null&&t.depth>1){rt.is3D=true}if(t.is_cubemap){rt.isCubeMap=true;rt.depthStencil=0;rt.cubeMap=this.createCubeMap(t,rt.depthStencil)}else{rt.depthStencil=0;rt.image=this.createImage(t,rt.depthStencil)}}return rt},createImage:function(t,depthStencil){var width=t.width==0?iron_App.w():t.width;var height=t.height==0?iron_App.h():t.height;var depth=t.depth!=null?t.depth:0;if(t.displayp!=null){if(width>height){width=Std.int(width*(t.displayp/height));height=t.displayp}else{height=Std.int(height*(t.displayp/width));width=t.displayp}}if(t.scale!=null){width=Std.int(width*t.scale);height=Std.int(height*t.scale);depth=Std.int(depth*t.scale)}if(t.depth!=null&&t.depth>1){var img=kha_Image.create3D(width,height,depth,t.format!=null?this.getTextureFormat(t.format):0);if(t.mipmaps){img.generateMipmaps(1e3)}return img}else if(t.is_image!=null&&t.is_image){return kha_Image.create(width,height,t.format!=null?this.getTextureFormat(t.format):0)}else{return kha_Image.createRenderTarget(width,height,t.format!=null?this.getTextureFormat(t.format):0,depthStencil)}},createCubeMap:function(t,depthStencil){return kha_graphics4_CubeMap.createRenderTarget(t.width,t.format!=null?this.getTextureFormat(t.format):0,depthStencil)},getTextureFormat:function(s){switch(s){case"A16":return 6;case"A32":return 5;case"A8":return 1;case"DEPTH16":return 3;case"R16":return 6;case"R32":return 5;case"R8":return 1;case"RGBA128":return 2;case"RGBA32":return 0;case"RGBA64":return 4;default:return 0}},getDepthStencilFormat:function(s){if(s==null||s==""){return 1}switch(s){case"DEPTH16":return 5;case"DEPTH24":return 1;default:return 1}},__class__:iron_RenderPath,__properties__:{get_ready:"get_ready"}};var iron_RenderTargetRaw=function(){this.is_cubemap=null;this.is_image=null;this.depth=null;this.mipmaps=null;this.depth_buffer=null;this.displayp=null;this.scale=null;this.format=null};$hxClasses["iron.RenderTargetRaw"]=iron_RenderTargetRaw;iron_RenderTargetRaw.__name__=true;iron_RenderTargetRaw.prototype={__class__:iron_RenderTargetRaw};var iron_RenderTarget=function(raw){this.isCubeMap=false;this.is3D=false;this.hasDepth=false;this.cubeMap=null;this.image=null;this.depthStencilFrom="";this.raw=raw};$hxClasses["iron.RenderTarget"]=iron_RenderTarget;iron_RenderTarget.__name__=true;iron_RenderTarget.prototype={__class__:iron_RenderTarget};var iron_Scene=function(){this.traitRemoves=[];this.traitInits=[];this.groups=null;this.uid=iron_Scene.uidCounter++;this.meshes=[];this.lights=[];this.cameras=[];this.speakers=[];this.empties=[];this.animations=[];this.armatures=[];this.embedded=new haxe_ds_StringMap;this.root=new iron_object_Object;this.root.name="Root";this.traitInits=[];this.traitRemoves=[];if(iron_Scene.global==null){iron_Scene.global=new iron_object_Object}};$hxClasses["iron.Scene"]=iron_Scene;iron_Scene.__name__=true;iron_Scene.create=function(format,done){iron_Scene.active=new iron_Scene;iron_Scene.active.ready=false;iron_Scene.active.raw=format;iron_data_Data.getWorld(format.name,format.world_ref,function(world){iron_Scene.active.world=world;iron_Scene.active.addScene(format.name,null,function(sceneObject){if(iron_Scene.active.cameras.length==0){haxe_Log.trace('No camera found for scene "'+format.name+'"',{fileName:"Sources/iron/Scene.hx",lineNumber:91,className:"iron.Scene",methodName:"create"})}iron_Scene.active.camera=iron_Scene.active.getCamera(format.camera_ref);iron_Scene.active.ready=true;var _g=0;var _g1=iron_Scene.active.traitInits;while(_g<_g1.length){var f=_g1[_g];++_g;f()}iron_Scene.active.traitInits=[];iron_Scene.active.sceneParent=sceneObject;done(sceneObject)})})};iron_Scene.setActive=function(sceneName,done){if(!iron_Scene.framePassed){return}iron_Scene.framePassed=false;if(iron_Scene.active!=null){iron_Scene.active.remove()}iron_data_Data.getSceneRaw(sceneName,function(format){iron_Scene.create(format,function(o){if(done!=null){done(o)}})})};iron_Scene.generateTransform=function(object,transform){transform.world=object.transform!=null?iron_math_Mat4.fromFloat32Array(object.transform.values):iron_math_Mat4.identity();transform.world.decompose(transform.loc,transform.rot,transform.scale);if(object.local_only!=null){transform.localOnly=object.local_only}if(transform.object.parent!=null){transform.update()}};iron_Scene.createTraits=function(traits,object){if(traits==null){return}var _g=0;while(_g<traits.length){var t=traits[_g];++_g;if(t.type=="Script"){var args=[];if(t.parameters!=null){var _g1=0;var _g11=t.parameters;while(_g1<_g11.length){var param=_g11[_g1];++_g1;args.push(iron_Scene.parseArg(param))}}var traitInst=iron_Scene.createTraitClassInstance(t.class_name,args);if(traitInst==null){haxe_Log.trace("Error: Trait '"+t.class_name+"' referenced in object '"+object.name+"' not found",{fileName:"Sources/iron/Scene.hx",lineNumber:621,className:"iron.Scene",methodName:"createTraits"});continue}if(t.props!=null){var _g2=0;var _g12=Std.int(t.props.length/2);while(_g2<_g12){var i=_g2++;var pname=t.props[i*2];var pval=t.props[i*2+1];if(pval!=""){Reflect.setProperty(traitInst,pname,iron_Scene.parseArg(pval))}}}object.addTrait(traitInst)}}};iron_Scene.parseArg=function(str){if(str=="true"){return true}else if(str=="false"){return false}else if(str=="null"){return null}else if(str.charAt(0)=="'"){return StringTools.replace(str,"'","")}else if(str.charAt(0)=='"'){return StringTools.replace(str,'"',"")}else if(str.charAt(0)=="["){str=StringTools.replace(str,"[","");str=StringTools.replace(str,"]","");str=StringTools.replace(str," ","");var ar=[];var vals=str.split(",");var _g=0;while(_g<vals.length){var v=vals[_g];++_g;ar.push(iron_Scene.parseArg(v))}return ar}else{var f=Std.parseFloat(str);var i=Std.parseInt(str);if(f==i){return i}else{return f}}};iron_Scene.createConstraints=function(constraints,object){if(constraints==null){return}object.constraints=[];var _g=0;while(_g<constraints.length){var c=constraints[_g];++_g;var constr=new iron_object_Constraint(c);object.constraints.push(constr)}};iron_Scene.createTraitClassInstance=function(traitName,args){var cname=Type.resolveClass(traitName);if(cname==null){return null}return Type.createInstance(cname,args)};iron_Scene.prototype={remove:function(){var _g=0;var _g1=this.traitRemoves;while(_g<_g1.length){var f=_g1[_g];++_g;f()}var _g2=0;var _g3=this.meshes;while(_g2<_g3.length){var o=_g3[_g2];++_g2;o.remove()}var _g4=0;var _g5=this.lights;while(_g4<_g5.length){var o1=_g5[_g4];++_g4;o1.remove()}var _g6=0;var _g7=this.cameras;while(_g6<_g7.length){var o2=_g7[_g6];++_g6;o2.remove()}var _g8=0;var _g9=this.speakers;while(_g8<_g9.length){var o3=_g9[_g8];++_g8;o3.remove()}var _g10=0;var _g11=this.empties;while(_g10<_g11.length){var o4=_g11[_g10];++_g10;o4.remove()}this.groups=null;this.root.remove()},updateFrame:function(){if(!this.ready){return}var _g=0;var _g1=this.animations;while(_g<_g1.length){var anim=_g1[_g];++_g;anim.update(iron_system_Time.get_delta())}var _g2=0;var _g3=this.empties;while(_g2<_g3.length){var e=_g3[_g2];++_g2;if(e!=null&&e.parent!=null){e.transform.update()}}},renderFrame:function(g){if(!this.ready||iron_RenderPath.active==null){return}iron_Scene.framePassed=true;if(this.camera!=null){this.camera.renderFrame(g)}else{iron_RenderPath.active.renderFrame(g)}},addObject:function(parent){var object=new iron_object_Object;if(parent!=null){parent.addChild(object)}else{this.root.addChild(object)}return object},getChild:function(name){return this.root.getChild(name)},getCamera:function(name){var _g=0;var _g1=this.cameras;while(_g<_g1.length){var c=_g1[_g];++_g;if(c.name==name){return c}}return null},addMeshObject:function(data,materials,parent){var object=new iron_object_MeshObject(data,materials);if(parent!=null){parent.addChild(object)}else{this.root.addChild(object)}return object},addLightObject:function(data,parent){var object=new iron_object_LightObject(data);if(parent!=null){parent.addChild(object)}else{this.root.addChild(object)}return object},addCameraObject:function(data,parent){var object=new iron_object_CameraObject(data);if(parent!=null){parent.addChild(object)}else{this.root.addChild(object)}return object},addSpeakerObject:function(data,parent){var object=new iron_object_SpeakerObject(data);if(parent!=null){parent.addChild(object)}else{this.root.addChild(object)}return object},addScene:function(sceneName,parent,done){var _gthis=this;if(parent==null){parent=this.addObject();parent.name=sceneName}iron_data_Data.getSceneRaw(sceneName,function(format){iron_Scene.createTraits(format.traits,parent);_gthis.loadEmbeddedData(format.embedded_datas,function(){var objectsTraversed=0;var objectsCount=_gthis.getObjectsCount(format.objects);var traverseObjects=null;traverseObjects=function(parent1,objects,parentObject,done1){if(objects==null){return}var _g=0;var _g1=objects.length;while(_g<_g1){var i=_g++;var o=[objects[i]];if(o[0].spawn!=null&&o[0].spawn==false){if((objectsTraversed+=1)==objectsCount){done1()}continue}var o1=o[0];var traverseObjects1=function(o2){return function(object){if(object!=null){traverseObjects(object,o2[0].children,o2[0],done1)}if((objectsTraversed+=1)==objectsCount){done1()}}}(o);_gthis.createObject(o1,format,parent1,parentObject,traverseObjects1)}};if(format.objects==null||format.objects.length==0){done(parent)}else{traverseObjects(parent,format.objects,null,function(){done(parent)})}})})},getObjectsCount:function(objects,discardNoSpawn){if(discardNoSpawn==null){discardNoSpawn=true}if(objects==null){return 0}var result=objects.length;var _g=0;while(_g<objects.length){var o=objects[_g];++_g;if(discardNoSpawn&&o.spawn!=null&&o.spawn==false){continue}if(o.children!=null){result+=this.getObjectsCount(o.children)}}return result},spawnObject:function(name,parent,done,spawnChildren){if(spawnChildren==null){spawnChildren=true}var _gthis=this;var objectsTraversed=0;var obj=this.getObj(this.raw,name);var objectsCount=spawnChildren?this.getObjectsCount([obj],false):1;var spawnObjectTree=null;spawnObjectTree=function(obj1,parent1,parentObject,done1){_gthis.createObject(obj1,_gthis.raw,parent1,parentObject,function(object){if(spawnChildren&&obj1.children!=null){var _g=0;var _g1=obj1.children;while(_g<_g1.length){var child=_g1[_g];++_g;spawnObjectTree(child,object,obj1,done1)}}if((objectsTraversed+=1)==objectsCount&&done1!=null){done1(object)}})};spawnObjectTree(obj,parent,null,done)},getObj:function(format,name){return this.traverseObjs(format.objects,name)},traverseObjs:function(children,name){var _g=0;while(_g<children.length){var o=children[_g];++_g;if(o.name==name){return o}if(o.children!=null){var res=this.traverseObjs(o.children,name);if(res!=null){return res}}}return null},createObject:function(o,format,parent,parentObject,done){var _gthis=this;var sceneName=format.name;if(o.type=="camera_object"){iron_data_Data.getCamera(sceneName,o.data_ref,function(b){var object=_gthis.addCameraObject(b,parent);_gthis.returnObject(object,o,done)})}else if(o.type=="light_object"){iron_data_Data.getLight(sceneName,o.data_ref,function(b1){var object1=_gthis.addLightObject(b1,parent);_gthis.returnObject(object1,o,done)})}else if(o.type=="mesh_object"){if(o.material_refs==null||o.material_refs.length==0){var object2=this.addObject(parent);this.returnObject(object2,o,done)}else{var this1=new Array(o.material_refs.length);var materials=this1;var materialsLoaded=0;var _g=0;var _g1=o.material_refs.length;while(_g<_g1){var i=[_g++];var ref=o.material_refs[i[0]];var tmp=function(i1){return function(mat){materials[i1[0]]=mat;materialsLoaded+=1;if(materialsLoaded==o.material_refs.length){var ref1=o.data_ref.split("/");var object_file="";var data_ref="";if(ref1.length==2){object_file=ref1[0];data_ref=ref1[1]}else{object_file=sceneName;data_ref=o.data_ref}if(parentObject!=null&&parentObject.bone_actions!=null){var bactions=[];var _g2=0;var _g11=parentObject.bone_actions;while(_g2<_g11.length){var ref2=_g11[_g2];++_g2;iron_data_Data.getSceneRaw(ref2,function(){return function(action){bactions.push(action);if(bactions.length==parentObject.bone_actions.length){var armature=null;var _g3=0;var _g12=_gthis.armatures;while(_g3<_g12.length){var a=_g12[_g3];++_g3;if(a.uid==parent.uid){armature=a;break}}if(armature==null){var _g21=0;var _g31=_gthis.armatures;while(_g21<_g31.length){var a1=_g31[_g21];++_g21;if(a1.name==parent.name){parent.name+="."+parent.uid;break}}armature=new iron_data_Armature(parent.uid,parent.name,bactions);_gthis.armatures.push(armature)}_gthis.returnMeshObject(object_file,data_ref,sceneName,armature,materials,parent,o,done)}}}())}}else{_gthis.returnMeshObject(object_file,data_ref,sceneName,null,materials,parent,o,done)}}}}(i);iron_data_Data.getMaterial(sceneName,ref,tmp)}}}else if(o.type=="speaker_object"){var object3=this.addSpeakerObject(iron_data_Data.getSpeakerRawByName(format.speaker_datas,o.data_ref),parent);this.returnObject(object3,o,done)}else if(o.type=="object"){var object4=this.addObject(parent);this.returnObject(object4,o,function(ro){if(o.group_ref!=null){var spawned=0;var object_refs=_gthis.getGroupObjectRefs(o.group_ref);if(object_refs.length==0){done(ro)}else{var _g4=0;while(_g4<object_refs.length){var s=object_refs[_g4];++_g4;_gthis.spawnObject(s,ro,function(so){if((spawned+=1)==object_refs.length){done(ro)}})}}}else{done(ro)}})}else{done(null)}},getGroupObjectRefs:function(group_ref){var _g=0;var _g1=this.raw.groups;while(_g<_g1.length){var g=_g1[_g];++_g;if(g.name==group_ref){return g.object_refs}}return null},returnMeshObject:function(object_file,data_ref,sceneName,armature,materials,parent,o,done){var _gthis=this;iron_data_Data.getMesh(object_file,data_ref,function(mesh){if(mesh.isSkinned){var g=mesh.geom;if(armature!=null){g.addArmature(armature)}else{g.addAction(mesh.format.objects,"none")}}var object=_gthis.addMeshObject(mesh,materials,parent);if(o.tilesheet_ref!=null){js_Boot.__cast(object,iron_object_MeshObject).setupTilesheet(sceneName,o.tilesheet_ref,o.tilesheet_action_ref)}_gthis.returnObject(object,o,done)})},returnObject:function(object,o,done){var _gthis=this;if(object!=null&&o.object_actions!=null){var oactions=[];while(oactions.length<o.object_actions.length)oactions.push(null);var actionsLoaded=0;var _g=0;var _g1=o.object_actions.length;while(_g<_g1){var i=[_g++];var ref=o.object_actions[i[0]];if(ref=="null"){actionsLoaded+=1;continue}iron_data_Data.getSceneRaw(ref,function(i1){return function(action){oactions[i1[0]]=action;actionsLoaded+=1;if(actionsLoaded==o.object_actions.length){_gthis.returnObjectLoaded(object,o,oactions,done)}}}(i))}}else{this.returnObjectLoaded(object,o,null,done)}},returnObjectLoaded:function(object,o,oactions,done){if(object!=null){object.raw=o;object.name=o.name;if(o.visible!=null){object.visible=o.visible}if(o.visible_mesh!=null){object.visibleMesh=o.visible_mesh}if(o.visible_shadow!=null){object.visibleShadow=o.visible_shadow}iron_Scene.createConstraints(o.constraints,object);iron_Scene.generateTransform(o,object.transform);object.setupAnimation(oactions);if(o.groups!=null){if(this.groups==null){this.groups=new haxe_ds_StringMap}var _g=0;var _g1=o.groups;while(_g<_g1.length){var gname=_g1[_g];++_g;var g=this.groups.get(gname);if(g==null){g=[];this.groups.set(gname,g)}g.push(object)}}if(o.properties!=null){object.properties=new haxe_ds_StringMap;var _g2=0;var _g11=o.properties;while(_g2<_g11.length){var p=_g11[_g2];++_g2;object.properties.set(p.name,p.value)}}iron_Scene.createTraits(o.traits,object)}done(object)},loadEmbeddedData:function(datas,done){var _gthis=this;if(datas==null){done();return}var loaded=0;var _g=0;while(_g<datas.length){var file=[datas[_g]];++_g;iron_data_Data.getImage(file[0],function(file1){return function(image){_gthis.embedded.set(file1[0],image);loaded+=1;if(loaded==datas.length){done()}}}(file))}},__class__:iron_Scene};var iron_data_Armature=function(uid,name,actions){this.actions=[];this.uid=uid;this.name=name;var _g=0;while(_g<actions.length){var a=actions[_g];++_g;var _g1=0;var _g11=a.objects;while(_g1<_g11.length){var o=_g11[_g1];++_g1;iron_data_Armature.setParents(o)}var bones=[[]];iron_data_Armature.traverseBones(a.objects,function(bones1){return function(object){bones1[0].push(object)}}(bones));this.actions.push({name:a.name,bones:bones[0],mats:null})}};$hxClasses["iron.data.Armature"]=iron_data_Armature;iron_data_Armature.__name__=true;iron_data_Armature.setParents=function(object){if(object.children==null){return}var _g=0;var _g1=object.children;while(_g<_g1.length){var o=_g1[_g];++_g;o.parent=object;iron_data_Armature.setParents(o)}};iron_data_Armature.traverseBones=function(objects,callback){var _g=0;var _g1=objects.length;while(_g<_g1){var i=_g++;iron_data_Armature.traverseBonesStep(objects[i],callback)}};iron_data_Armature.traverseBonesStep=function(object,callback){if(object.type=="bone_object"){callback(object)}if(object.children==null){return}var _g=0;var _g1=object.children.length;while(_g<_g1){var i=_g++;iron_data_Armature.traverseBonesStep(object.children[i],callback)}};iron_data_Armature.prototype={__class__:iron_data_Armature};var iron_data_CameraData=function(raw,done){this.raw=raw;this.name=raw.name;done(this)};$hxClasses["iron.data.CameraData"]=iron_data_CameraData;iron_data_CameraData.__name__=true;iron_data_CameraData.parse=function(name,id,done){iron_data_Data.getSceneRaw(name,function(format){var raw=iron_data_Data.getCameraRawByName(format.camera_datas,id);if(raw==null){haxe_Log.trace('Camera data "'+id+'" not found!',{fileName:"Sources/iron/data/CameraData.hx",lineNumber:20,className:"iron.data.CameraData",methodName:"parse"});done(null)}new iron_data_CameraData(raw,done)})};iron_data_CameraData.prototype={__class__:iron_data_CameraData};var iron_data_Data=function(){};$hxClasses["iron.data.Data"]=iron_data_Data;iron_data_Data.__name__=true;iron_data_Data.getMesh=function(file,name,done){var handle=file+name;var cached=iron_data_Data.cachedMeshes.get(handle);if(cached!=null){done(cached);return}var loading=iron_data_Data.loadingMeshes.get(handle);if(loading!=null){loading.push(done);return}iron_data_Data.loadingMeshes.set(handle,[done]);iron_data_MeshData.parse(file,name,function(b){iron_data_Data.cachedMeshes.set(handle,b);b.handle=handle;var _g=0;var _g1=iron_data_Data.loadingMeshes.get(handle);while(_g<_g1.length){var f=_g1[_g];++_g;f(b)}iron_data_Data.loadingMeshes.remove(handle)})};iron_data_Data.getLight=function(file,name,done){var handle=file+name;var cached=iron_data_Data.cachedLights.get(handle);if(cached!=null){done(cached);return}var loading=iron_data_Data.loadingLights.get(handle);if(loading!=null){loading.push(done);return}iron_data_Data.loadingLights.set(handle,[done]);iron_data_LightData.parse(file,name,function(b){iron_data_Data.cachedLights.set(handle,b);var _g=0;var _g1=iron_data_Data.loadingLights.get(handle);while(_g<_g1.length){var f=_g1[_g];++_g;f(b)}iron_data_Data.loadingLights.remove(handle)})};iron_data_Data.getCamera=function(file,name,done){var handle=file+name;var cached=iron_data_Data.cachedCameras.get(handle);if(cached!=null){done(cached);return}var loading=iron_data_Data.loadingCameras.get(handle);if(loading!=null){loading.push(done);return}iron_data_Data.loadingCameras.set(handle,[done]);iron_data_CameraData.parse(file,name,function(b){iron_data_Data.cachedCameras.set(handle,b);var _g=0;var _g1=iron_data_Data.loadingCameras.get(handle);while(_g<_g1.length){var f=_g1[_g];++_g;f(b)}iron_data_Data.loadingCameras.remove(handle)})};iron_data_Data.getMaterial=function(file,name,done){var handle=file+name;var cached=iron_data_Data.cachedMaterials.get(handle);if(cached!=null){done(cached);return}var loading=iron_data_Data.loadingMaterials.get(handle);if(loading!=null){loading.push(done);return}iron_data_Data.loadingMaterials.set(handle,[done]);iron_data_MaterialData.parse(file,name,function(b){iron_data_Data.cachedMaterials.set(handle,b);var _g=0;var _g1=iron_data_Data.loadingMaterials.get(handle);while(_g<_g1.length){var f=_g1[_g];++_g;f(b)}iron_data_Data.loadingMaterials.remove(handle)})};iron_data_Data.getWorld=function(file,name,done){if(name==null){done(null);return}var handle=file+name;var cached=iron_data_Data.cachedWorlds.get(handle);if(cached!=null){done(cached);return}var loading=iron_data_Data.loadingWorlds.get(handle);if(loading!=null){loading.push(done);return}iron_data_Data.loadingWorlds.set(handle,[done]);iron_data_WorldData.parse(file,name,function(b){iron_data_Data.cachedWorlds.set(handle,b);var _g=0;var _g1=iron_data_Data.loadingWorlds.get(handle);while(_g<_g1.length){var f=_g1[_g];++_g;f(b)}iron_data_Data.loadingWorlds.remove(handle)})};iron_data_Data.getShader=function(file,name,done,overrideContext){var cacheName=name;if(overrideContext!=null){cacheName+="2"}var cached=iron_data_Data.cachedShaders.get(cacheName);if(cached!=null){done(cached);return}var loading=iron_data_Data.loadingShaders.get(cacheName);if(loading!=null){loading.push(done);return}iron_data_Data.loadingShaders.set(cacheName,[done]);iron_data_ShaderData.parse(file,name,function(b){iron_data_Data.cachedShaders.set(cacheName,b);var _g=0;var _g1=iron_data_Data.loadingShaders.get(cacheName);while(_g<_g1.length){var f=_g1[_g];++_g;f(b)}iron_data_Data.loadingShaders.remove(cacheName)},overrideContext)};iron_data_Data.getSceneRaw=function(file,done){var cached=iron_data_Data.cachedSceneRaws.get(file);if(cached!=null){done(cached);return}var loading=iron_data_Data.loadingSceneRaws.get(file);if(loading!=null){loading.push(done);return}iron_data_Data.loadingSceneRaws.set(file,[done]);var compressed=StringTools.endsWith(file,".zip");var isJson=StringTools.endsWith(file,".json");var ext=compressed||isJson||StringTools.endsWith(file,".arm")?"":".arm";iron_data_Data.getBlob(file+ext,function(b){var compressed1=compressed;var parsed=null;if(isJson){var s=b.toString();parsed=s.charAt(0)=="{"?JSON.parse(s):iron_system_ArmPack.decode(b.toBytes())}else{parsed=iron_system_ArmPack.decode(b.toBytes())}iron_data_Data.returnSceneRaw(file,parsed)})};iron_data_Data.returnSceneRaw=function(file,parsed){iron_data_Data.cachedSceneRaws.set(file,parsed);var _g=0;var _g1=iron_data_Data.loadingSceneRaws.get(file);while(_g<_g1.length){var f=_g1[_g];++_g;f(parsed)}iron_data_Data.loadingSceneRaws.remove(file)};iron_data_Data.getMeshRawByName=function(datas,name){if(name==""){return datas[0]}var _g=0;while(_g<datas.length){var dat=datas[_g];++_g;if(dat.name==name){return dat}}return null};iron_data_Data.getLightRawByName=function(datas,name){if(name==""){return datas[0]}var _g=0;while(_g<datas.length){var dat=datas[_g];++_g;if(dat.name==name){return dat}}return null};iron_data_Data.getCameraRawByName=function(datas,name){if(name==""){return datas[0]}var _g=0;while(_g<datas.length){var dat=datas[_g];++_g;if(dat.name==name){return dat}}return null};iron_data_Data.getMaterialRawByName=function(datas,name){if(name==""){return datas[0]}var _g=0;while(_g<datas.length){var dat=datas[_g];++_g;if(dat.name==name){return dat}}return null};iron_data_Data.getWorldRawByName=function(datas,name){if(name==""){return datas[0]}var _g=0;while(_g<datas.length){var dat=datas[_g];++_g;if(dat.name==name){return dat}}return null};iron_data_Data.getShaderRawByName=function(datas,name){if(name==""){return datas[0]}var _g=0;while(_g<datas.length){var dat=datas[_g];++_g;if(dat.name==name){return dat}}return null};iron_data_Data.getSpeakerRawByName=function(datas,name){if(name==""){return datas[0]}var _g=0;while(_g<datas.length){var dat=datas[_g];++_g;if(dat.name==name){return dat}}return null};iron_data_Data.getBlob=function(file,done){var cached=iron_data_Data.cachedBlobs.get(file);if(cached!=null){done(cached);return}var loading=iron_data_Data.loadingBlobs.get(file);if(loading!=null){loading.push(done);return}iron_data_Data.loadingBlobs.set(file,[done]);var p=file.charAt(0)=="/"||file.charAt(1)==":"?file:iron_data_Data.dataPath+file;kha_Assets.loadBlobFromPath(p,function(b){iron_data_Data.cachedBlobs.set(file,b);var _g=0;var _g1=iron_data_Data.loadingBlobs.get(file);while(_g<_g1.length){var f=_g1[_g];++_g;f(b)}iron_data_Data.loadingBlobs.remove(file);iron_data_Data.assetsLoaded++},null,{fileName:"Sources/iron/data/Data.hx",lineNumber:378,className:"iron.data.Data",methodName:"getBlob"})};iron_data_Data.getImage=function(file,done,readable,format){if(format==null){format="RGBA32"}if(readable==null){readable=false}var cached=iron_data_Data.cachedImages.get(file);if(cached!=null){done(cached);return}var loading=iron_data_Data.loadingImages.get(file);if(loading!=null){loading.push(done);return}iron_data_Data.loadingImages.set(file,[done]);var p=file.charAt(0)=="/"||file.charAt(1)==":"?file:iron_data_Data.dataPath+file;kha_Assets.loadImageFromPath(p,readable,function(b){iron_data_Data.cachedImages.set(file,b);var _g=0;var _g1=iron_data_Data.loadingImages.get(file);while(_g<_g1.length){var f=_g1[_g];++_g;f(b)}iron_data_Data.loadingImages.remove(file);iron_data_Data.assetsLoaded++},null,{fileName:"Sources/iron/data/Data.hx",lineNumber:403,className:"iron.data.Data",methodName:"getImage"})};iron_data_Data.getSound=function(file,done){done(null);return};iron_data_Data.getFont=function(file,done){var cached=iron_data_Data.cachedFonts.get(file);if(cached!=null){done(cached);return}var loading=iron_data_Data.loadingFonts.get(file);if(loading!=null){loading.push(done);return}iron_data_Data.loadingFonts.set(file,[done]);var p=file.charAt(0)=="/"||file.charAt(1)==":"?file:iron_data_Data.dataPath+file;kha_Assets.loadFontFromPath(p,function(b){iron_data_Data.cachedFonts.set(file,b);var _g=0;var _g1=iron_data_Data.loadingFonts.get(file);while(_g<_g1.length){var f=_g1[_g];++_g;f(b)}iron_data_Data.loadingFonts.remove(file);iron_data_Data.assetsLoaded++},null,{fileName:"Sources/iron/data/Data.hx",lineNumber:494,className:"iron.data.Data",methodName:"getFont"})};var iron_data_Geometry=function(data,indices,materialIndices,positions,normals,uvs,uvs1,cols,tangents,bones,weights,usage){this.mats=null;this.actions=null;this.skeletonBoneLens=null;this.skeletonBoneRefs=null;this.skeletonTransformsI=null;this.skinBoneWeights=null;this.skinBoneIndices=null;this.skinBoneCounts=null;this.instanceCount=0;this.instanced=false;this.instancedVB=null;this.numTris=0;this.ready=false;this.name="";this.count=-1;this.start=0;this.vertexBufferMap=new haxe_ds_StringMap;if(usage==null){usage=0}this.indices=indices;this.materialIndices=materialIndices;this.usage=usage;this.positions=positions;this.normals=normals;this.uvs=uvs;this.uvs1=uvs1;this.cols=cols;this.tangents=tangents;this.bones=bones;this.weights=weights;this.data=data;this.struct=iron_data_Geometry.getVertexStructure(positions!=null,normals!=null,uvs!=null,uvs1!=null,cols!=null,tangents!=null,bones!=null,weights!=null);this.structLength=Std.int(this.struct.byteSize()/2);this.structStr="";var _g=0;var _g1=this.struct.elements;while(_g<_g1.length){var e=_g1[_g];++_g;this.structStr+=e.name}};$hxClasses["iron.data.Geometry"]=iron_data_Geometry;iron_data_Geometry.__name__=true;iron_data_Geometry.getVertexStructure=function(pos,nor,tex,tex1,col,tang,bone,weight){if(weight==null){weight=false}if(bone==null){bone=false}if(tang==null){tang=false}if(col==null){col=false}if(tex1==null){tex1=false}if(tex==null){tex=false}if(nor==null){nor=false}if(pos==null){pos=false}var structure=new kha_graphics4_VertexStructure;if(pos){structure.add("pos",6)}if(nor){structure.add("nor",5)}if(tex){structure.add("tex",5)}if(tex1){structure.add("tex1",5)}if(col){structure.add("col",6)}if(tang){structure.add("tang",6)}if(bone){structure.add("bone",6)}if(weight){structure.add("weight",6)}return structure};iron_data_Geometry.buildVertices=function(vertices,pa,na,uva,uva1,ca,tanga,bonea,weighta,offset,fakeUVs){if(fakeUVs==null){fakeUVs=false}if(offset==null){offset=0}var numVertices=Std.int(pa.length/4);var di=-1+offset;var _g=0;var _g1=numVertices;while(_g<_g1){var i=_g++;vertices[++di]=pa[i*4];vertices[++di]=pa[i*4+1];vertices[++di]=pa[i*4+2];vertices[++di]=pa[i*4+3];if(na!=null){vertices[++di]=na[i*2];vertices[++di]=na[i*2+1]}if(uva!=null){vertices[++di]=uva[i*2];vertices[++di]=uva[i*2+1]}else if(fakeUVs){vertices[++di]=0;vertices[++di]=0}if(uva1!=null){vertices[++di]=uva1[i*2];vertices[++di]=uva1[i*2+1]}if(ca!=null){vertices[++di]=ca[i*3];vertices[++di]=ca[i*3+1];vertices[++di]=ca[i*3+2];vertices[++di]=0}if(tanga!=null){vertices[++di]=tanga[i*3];vertices[++di]=tanga[i*3+1];vertices[++di]=tanga[i*3+2];vertices[++di]=0}if(bonea!=null){vertices[++di]=bonea[i*4];vertices[++di]=bonea[i*4+1];vertices[++di]=bonea[i*4+2];vertices[++di]=bonea[i*4+3]}if(weighta!=null){vertices[++di]=weighta[i*4];vertices[++di]=weighta[i*4+1];vertices[++di]=weighta[i*4+2];vertices[++di]=weighta[i*4+3]}}};iron_data_Geometry.prototype={setupInstanced:function(data,instancedType,usage){var structure=new kha_graphics4_VertexStructure;structure.instanced=true;this.instanced=true;structure.add("ipos",2);if(instancedType==2||instancedType==4){structure.add("irot",2)}if(instancedType==3||instancedType==4){structure.add("iscl",2)}this.instanceCount=Std.int(data.length/Std.int(structure.byteSize()/4));this.instancedVB=new kha_graphics4_VertexBuffer(this.instanceCount,structure,usage,1);var vertices=this.instancedVB.lock();var _g=0;var _g1=vertices.length;while(_g<_g1){var i=_g++;vertices[i]=data[i]}this.instancedVB.unlock()},hasAttrib:function(s,vs){var _g=0;while(_g<vs.length){var e=vs[_g];++_g;if(e.name==s){return true}}return false},get:function(vs){var s="";var _g=0;while(_g<vs.length){var e=vs[_g];++_g;s+=e.name}var vb=this.vertexBufferMap.get(s);if(vb==null){var apos=this.hasAttrib("pos",vs);var anor=this.hasAttrib("nor",vs);var atex=this.hasAttrib("tex",vs);var atex1=this.hasAttrib("tex1",vs);var acol=this.hasAttrib("col",vs);var atang=this.hasAttrib("tang",vs);var abone=this.hasAttrib("bone",vs);var aweight=this.hasAttrib("weight",vs);var struct=iron_data_Geometry.getVertexStructure(apos,anor,atex,atex1,acol,atang,abone,aweight);vb=new kha_graphics4_VertexBuffer(Std.int(this.positions.length/4),struct,this.usage);this.vertices=vb.lockInt16();iron_data_Geometry.buildVertices(this.vertices,apos?this.positions:null,anor?this.normals:null,atex?this.uvs:null,atex1?this.uvs1:null,acol?this.cols:null,atang?this.tangents:null,abone?this.bones:null,aweight?this.weights:null,0,atex&&this.uvs==null);vb.unlock();this.vertexBufferMap.set(s,vb);if(atex&&this.uvs==null){haxe_Log.trace("Armory Warning: Geometry "+this.name+" is missing UV map",{fileName:"Sources/iron/data/Geometry.hx",lineNumber:321,className:"iron.data.Geometry",methodName:"get"})}if(acol&&this.cols==null){haxe_Log.trace("Armory Warning: Geometry "+this.name+" is missing vertex colors",{fileName:"Sources/iron/data/Geometry.hx",lineNumber:322,className:"iron.data.Geometry",methodName:"get"})}}return vb},build:function(){if(this.ready){return}this.vertexBuffer=new kha_graphics4_VertexBuffer(Std.int(this.positions.length/4),this.struct,this.usage);this.vertices=this.vertexBuffer.lockInt16();iron_data_Geometry.buildVertices(this.vertices,this.positions,this.normals,this.uvs,this.uvs1,this.cols,this.tangents,this.bones,this.weights);this.vertexBuffer.unlock();this.vertexBufferMap.set(this.structStr,this.vertexBuffer);this.indexBuffers=[];var _g=0;var _g1=this.indices;while(_g<_g1.length){var id=_g1[_g];++_g;if(id.length==0){continue}var indexBuffer=new kha_graphics4_IndexBuffer(id.length,this.usage);this.numTris+=Std.int(id.length/3);indexBuffer._data=id;indexBuffer.unlock();this.indexBuffers.push(indexBuffer)}if(this.data.raw.instanced_data!=null){this.setupInstanced(this.data.raw.instanced_data,this.data.raw.instanced_type,this.usage)}this.ready=true},addArmature:function(armature){var _g=0;var _g1=armature.actions;while(_g<_g1.length){var a=_g1[_g];++_g;this.addAction(a.bones,a.name)}},addAction:function(bones,name){if(bones==null){return}if(this.actions==null){this.actions=new haxe_ds_StringMap;this.mats=new haxe_ds_StringMap}if(this.actions.get(name)!=null){return}var actionBones=[];var _g=0;var _g1=this.skeletonBoneRefs;while(_g<_g1.length){var s=_g1[_g];++_g;var _g2=0;while(_g2<bones.length){var b=bones[_g2];++_g2;if(b.name==s){actionBones.push(b)}}}this.actions.set(name,actionBones);var actionMats=[];var _g21=0;while(_g21<actionBones.length){var b1=actionBones[_g21];++_g21;actionMats.push(iron_math_Mat4.fromFloat32Array(b1.transform.values))}this.mats.set(name,actionMats)},initSkeletonTransforms:function(transformsI){this.skeletonTransformsI=[];var _g=0;while(_g<transformsI.length){var t=transformsI[_g];++_g;var mi=iron_math_Mat4.fromFloat32Array(t);this.skeletonTransformsI.push(mi)}},__class__:iron_data_Geometry};var iron_data_LightData=function(raw,done){this.colorTexture=null;var _gthis=this;this.raw=raw;this.name=raw.name;if(raw.color_texture!=null){iron_data_Data.getImage(raw.color_texture,function(image){_gthis.colorTexture=image;done(_gthis)})}else{done(this)}};$hxClasses["iron.data.LightData"]=iron_data_LightData;iron_data_LightData.__name__=true;iron_data_LightData.parse=function(name,id,done){iron_data_Data.getSceneRaw(name,function(format){var raw=iron_data_Data.getLightRawByName(format.light_datas,id);if(raw==null){haxe_Log.trace('Light data "'+id+'" not found!',{fileName:"Sources/iron/data/LightData.hx",lineNumber:40,className:"iron.data.LightData",methodName:"parse"});done(null)}new iron_data_LightData(raw,done)})};iron_data_LightData.prototype={__class__:iron_data_LightData};var iron_data_MaterialData=function(raw,done,file){if(file==null){file=""}this.contexts=null;var _gthis=this;this.uid=++iron_data_MaterialData.uidCounter;this.raw=raw;this.name=raw.name;var ref=raw.shader.split("/");var object_file="";var data_ref="";if(ref.length==2){object_file=ref[0];data_ref=ref[1]}else{object_file=file;data_ref=raw.shader}iron_data_Data.getShader(object_file,data_ref,function(b){_gthis.shader=b;_gthis.contexts=[];while(_gthis.contexts.length<raw.contexts.length)_gthis.contexts.push(null);var contextsLoaded=0;var _g=0;var _g1=raw.contexts.length;while(_g<_g1){var i=[_g++];var c=raw.contexts[i[0]];new iron_data_MaterialContext(c,function(i1){return function(self){_gthis.contexts[i1[0]]=self;contextsLoaded+=1;if(contextsLoaded==raw.contexts.length){done(_gthis)}}}(i))}},raw.override_context)};$hxClasses["iron.data.MaterialData"]=iron_data_MaterialData;iron_data_MaterialData.__name__=true;iron_data_MaterialData.parse=function(file,name,done){iron_data_Data.getSceneRaw(file,function(format){var raw=iron_data_Data.getMaterialRawByName(format.material_datas,name);if(raw==null){haxe_Log.trace('Material data "'+name+'" not found!',{fileName:"Sources/iron/data/MaterialData.hx",lineNumber:58,className:"iron.data.MaterialData",methodName:"parse"});done(null)}new iron_data_MaterialData(raw,done,file)})};iron_data_MaterialData.prototype={getContext:function(name){var _g=0;var _g1=this.contexts;while(_g<_g1.length){var c=_g1[_g];++_g;if(HxOverrides.substr(c.raw.name,0,name.length)==name){return c}}return null},__class__:iron_data_MaterialData};var iron_data_MaterialContext=function(raw,done){this.id=0;this.textures=null;var _gthis=this;this.raw=raw;this.id=iron_data_MaterialContext.num++;if(raw.bind_textures!=null&&raw.bind_textures.length>0){var this1=new Array(raw.bind_textures.length);this.textures=this1;var texturesLoaded=0;var _g=0;var _g1=raw.bind_textures.length;while(_g<_g1){var i=[_g++];var tex=[raw.bind_textures[i[0]]];if(tex[0].file==""){texturesLoaded+=1;if(texturesLoaded==raw.bind_textures.length){done(this)}continue}iron_data_Data.getImage(tex[0].file,function(tex1,i1){return function(image){_gthis.textures[i1[0]]=image;texturesLoaded+=1;if(tex1[0].mipmaps!=null){var mipmaps=[];while(mipmaps.length<tex1[0].mipmaps.length)mipmaps.push(null);var mipmapsLoaded=0;var _g2=0;var _g11=tex1[0].mipmaps.length;while(_g2<_g11){var j=[_g2++];var name=tex1[0].mipmaps[j[0]];iron_data_Data.getImage(name,function(j1,tex2){return function(mipimg){mipmaps[j1[0]]=mipimg;mipmapsLoaded+=1;if(mipmapsLoaded==tex2[0].mipmaps.length){image.setMipmaps(mipmaps);tex2[0].mipmaps=null;tex2[0].generate_mipmaps=false;if(texturesLoaded==raw.bind_textures.length){done(_gthis)}}}}(j,tex1))}}else if(tex1[0].generate_mipmaps==true&&image!=null){image.generateMipmaps(1e3);tex1[0].mipmaps=null;tex1[0].generate_mipmaps=false;if(texturesLoaded==raw.bind_textures.length){done(_gthis)}}else if(texturesLoaded==raw.bind_textures.length){done(_gthis)}}}(tex,i),false,tex[0].format!=null?tex[0].format:"RGBA32")}}else{done(this)}};$hxClasses["iron.data.MaterialContext"]=iron_data_MaterialContext;iron_data_MaterialContext.__name__=true;iron_data_MaterialContext.prototype={setTextureParameters:function(g,textureIndex,context,unitIndex){context.setTextureParameters(g,unitIndex,this.raw.bind_textures[textureIndex])},__class__:iron_data_MaterialContext};var iron_data_MeshData=function(raw,done){this.scaleTex=1;this.scalePos=1;this.refcount=0;this.raw=raw;this.name=raw.name;if(raw.scale_pos!=null){this.scalePos=raw.scale_pos}if(raw.scale_tex!=null){this.scaleTex=raw.scale_tex}var indices=[];var materialIndices=[];var _g=0;var _g1=raw.index_arrays;while(_g<_g1.length){var ind=_g1[_g];++_g;indices.push(ind.values);materialIndices.push(ind.material)}var pa=this.getVertexArrayValues("pos");var na=this.getVertexArrayValues("nor");var uva=this.getVertexArrayValues("tex");var uva1=this.getVertexArrayValues("tex1");var ca=this.getVertexArrayValues("col");var tanga=this.getVertexArrayValues("tang");this.isSkinned=raw.skin!=null;var parsedUsage=0;if(raw.dynamic_usage!=null&&raw.dynamic_usage==true){parsedUsage=1}var usage=parsedUsage;var bonea=null;var weighta=null;if(this.isSkinned){var l=Std.int(pa.length/4)*4;var this1=new Int16Array(l);bonea=this1;var this2=new Int16Array(l);weighta=this2;var index=0;var ai=0;var _g2=0;var _g3=Std.int(pa.length/4);while(_g2<_g3){var i=_g2++;var boneCount=raw.skin.bone_count_array[i];var _g21=index;var _g31=index+boneCount;while(_g21<_g31){var j=_g21++;bonea[ai]=raw.skin.bone_index_array[j];weighta[ai]=raw.skin.bone_weight_array[j];++ai}var _g4=boneCount;var _g5=4;while(_g4<_g5){var j1=_g4++;bonea[ai]=0;weighta[ai]=0;++ai}index+=boneCount}}this.geom=new iron_data_Geometry(this,indices,materialIndices,pa,na,uva,uva1,ca,tanga,bonea,weighta,usage);this.geom.name=this.name;done(this)};$hxClasses["iron.data.MeshData"]=iron_data_MeshData;iron_data_MeshData.__name__=true;iron_data_MeshData.parse=function(name,id,done){iron_data_Data.getSceneRaw(name,function(format){var raw=iron_data_Data.getMeshRawByName(format.mesh_datas,id);if(raw==null){haxe_Log.trace('Mesh data "'+id+'" not found!',{fileName:"Sources/iron/data/MeshData.hx",lineNumber:104,className:"iron.data.MeshData",methodName:"parse"});done(null)}new iron_data_MeshData(raw,function(dat){dat.format=format;if(raw.skin!=null){dat.geom.skinBoneCounts=raw.skin.bone_count_array;dat.geom.skinBoneIndices=raw.skin.bone_index_array;dat.geom.skinBoneWeights=raw.skin.bone_weight_array;dat.geom.skeletonBoneRefs=raw.skin.bone_ref_array;dat.geom.skeletonBoneLens=raw.skin.bone_len_array;dat.geom.initSkeletonTransforms(raw.skin.transformsI)}done(dat)})})};iron_data_MeshData.prototype={getVertexArrayValues:function(attrib){var _g=0;var _g1=this.raw.vertex_arrays;while(_g<_g1.length){var va=_g1[_g];++_g;if(va.attrib==attrib){return va.values}}return null},__class__:iron_data_MeshData};var iron_data_ShaderData=function(raw,done,overrideContext){this.contexts=[];var _gthis=this;this.raw=raw;this.name=raw.name;var _g=0;var _g1=raw.contexts;while(_g<_g1.length){var c=_g1[_g];++_g;this.contexts.push(null)}var contextsLoaded=0;var _g2=0;var _g3=raw.contexts.length;while(_g2<_g3){var i=[_g2++];var c1=raw.contexts[i[0]];new iron_data_ShaderContext(c1,function(i1){return function(con){_gthis.contexts[i1[0]]=con;contextsLoaded+=1;if(contextsLoaded==raw.contexts.length){done(_gthis)}}}(i),overrideContext)}};$hxClasses["iron.data.ShaderData"]=iron_data_ShaderData;iron_data_ShaderData.__name__=true;iron_data_ShaderData.parse=function(file,name,done,overrideContext){iron_data_Data.getSceneRaw(file,function(format){var raw=iron_data_Data.getShaderRawByName(format.shader_datas,name);if(raw==null){haxe_Log.trace('Shader data "'+name+'" not found!',{fileName:"Sources/iron/data/ShaderData.hx",lineNumber:47,className:"iron.data.ShaderData",methodName:"parse"});done(null)}new iron_data_ShaderData(raw,done,overrideContext)})};iron_data_ShaderData.prototype={getContext:function(name){var _g=0;var _g1=this.contexts;while(_g<_g1.length){var c=_g1[_g];++_g;if(c.raw.name==name){return c}}return null},__class__:iron_data_ShaderData};var iron_data_ShaderContext=function(raw,done,overrideContext){this.instancingType=0;this.raw=raw;this.overrideContext=overrideContext;this.parseVertexStructure();this.compile(done)};$hxClasses["iron.data.ShaderContext"]=iron_data_ShaderContext;iron_data_ShaderContext.__name__=true;iron_data_ShaderContext.prototype={compile:function(done){if(this.pipeState!=null){this.pipeState["delete"]()}this.pipeState=new kha_graphics4_PipelineState;this.constants=[];this.textureUnits=[];if(this.instancingType>0){var instStruct=new kha_graphics4_VertexStructure;instStruct.add("ipos",2);if(this.instancingType==2||this.instancingType==4){instStruct.add("irot",2)}if(this.instancingType==3||this.instancingType==4){instStruct.add("iscl",2)}instStruct.instanced=true;this.pipeState.inputLayout=[this.structure,instStruct]}else{this.pipeState.inputLayout=[this.structure]}this.pipeState.depthWrite=this.raw.depth_write;this.pipeState.depthMode=this.getCompareMode(this.raw.compare_mode);if(this.raw.stencil_mode!=null){if(this.raw.stencil_mode=="always"){this.pipeState.stencilMode=0}else if(this.raw.stencil_mode=="equal"){this.pipeState.stencilMode=2}else if(this.raw.stencil_mode=="not_equal"){this.pipeState.stencilMode=3}}if(this.raw.stencil_pass!=null){if(this.raw.stencil_pass=="replace"){this.pipeState.stencilBothPass=2}else if(this.raw.stencil_pass=="keep"){this.pipeState.stencilBothPass=0}}if(this.raw.stencil_fail!=null&&this.raw.stencil_fail=="keep"){this.pipeState.stencilDepthFail=0;this.pipeState.stencilFail=0}if(this.raw.stencil_reference_value!=null){this.pipeState.stencilReferenceValue=kha_graphics4_StencilValue.Static(this.raw.stencil_reference_value)}this.pipeState.cullMode=this.getCullMode(this.raw.cull_mode);if(this.raw.blend_source!=null){this.pipeState.blendSource=this.getBlendingFactor(this.raw.blend_source)}if(this.raw.blend_destination!=null){this.pipeState.blendDestination=this.getBlendingFactor(this.raw.blend_destination)}if(this.raw.blend_operation!=null){this.pipeState.blendOperation=this.getBlendingOperation(this.raw.blend_operation)}if(this.raw.alpha_blend_source!=null){this.pipeState.alphaBlendSource=this.getBlendingFactor(this.raw.alpha_blend_source)}if(this.raw.alpha_blend_destination!=null){this.pipeState.alphaBlendDestination=this.getBlendingFactor(this.raw.alpha_blend_destination)}if(this.raw.alpha_blend_operation!=null){this.pipeState.alphaBlendOperation=this.getBlendingOperation(this.raw.alpha_blend_operation)}if(this.raw.color_write_red!=null){this.pipeState.set_colorWriteMaskRed(this.raw.color_write_red)}if(this.raw.color_write_green!=null){this.pipeState.set_colorWriteMaskGreen(this.raw.color_write_green)}if(this.raw.color_write_blue!=null){this.pipeState.set_colorWriteMaskBlue(this.raw.color_write_blue)}if(this.raw.color_write_alpha!=null){this.pipeState.set_colorWriteMaskAlpha(this.raw.color_write_alpha)}if(this.raw.color_writes_red!=null){var _g=0;var _g1=this.raw.color_writes_red.length;while(_g<_g1){var i=_g++;this.pipeState.colorWriteMasksRed[i]=this.raw.color_writes_red[i]}}if(this.raw.color_writes_green!=null){var _g2=0;var _g11=this.raw.color_writes_green.length;while(_g2<_g11){var i1=_g2++;this.pipeState.colorWriteMasksGreen[i1]=this.raw.color_writes_green[i1]}}if(this.raw.color_writes_blue!=null){var _g3=0;var _g12=this.raw.color_writes_blue.length;while(_g3<_g12){var i2=_g3++;this.pipeState.colorWriteMasksBlue[i2]=this.raw.color_writes_blue[i2]}}if(this.raw.color_writes_alpha!=null){var _g4=0;var _g13=this.raw.color_writes_alpha.length;while(_g4<_g13){var i3=_g4++;this.pipeState.colorWriteMasksAlpha[i3]=this.raw.color_writes_alpha[i3]}}if(this.raw.conservative_raster!=null){this.pipeState.conservativeRasterization=this.raw.conservative_raster}if(this.raw.shader_from_source){this.pipeState.fragmentShader=kha_graphics4_FragmentShader.fromSource(this.raw.fragment_shader);this.pipeState.vertexShader=kha_graphics4_VertexShader.fromSource(this.raw.vertex_shader);this.finishCompile(done)}else{var tmp=StringTools.replace(this.raw.fragment_shader,".","_");this.pipeState.fragmentShader=Reflect.field(kha_Shaders,tmp);var tmp1=StringTools.replace(this.raw.vertex_shader,".","_");this.pipeState.vertexShader=Reflect.field(kha_Shaders,tmp1);if(this.raw.geometry_shader!=null){var tmp2=StringTools.replace(this.raw.geometry_shader,".","_");this.pipeState.geometryShader=Reflect.field(kha_Shaders,tmp2)}if(this.raw.tesscontrol_shader!=null){var tmp3=StringTools.replace(this.raw.tesscontrol_shader,".","_");this.pipeState.tessellationControlShader=Reflect.field(kha_Shaders,tmp3)}if(this.raw.tesseval_shader!=null){var tmp4=StringTools.replace(this.raw.tesseval_shader,".","_");this.pipeState.tessellationEvaluationShader=Reflect.field(kha_Shaders,tmp4)}this.finishCompile(done)}},finishCompile:function(done){if(this.overrideContext!=null){if(this.overrideContext.cull_mode!=null){this.pipeState.cullMode=this.getCullMode(this.overrideContext.cull_mode)}}this.pipeState.compile();if(this.raw.constants!=null){var _g=0;var _g1=this.raw.constants;while(_g<_g1.length){var c=_g1[_g];++_g;this.addConstant(c)}}if(this.raw.texture_units!=null){var _g2=0;var _g11=this.raw.texture_units;while(_g2<_g11.length){var tu=_g11[_g2];++_g2;this.addTexture(tu)}}done(this)},parseData:function(data){if(data=="float1"){return 0}else if(data=="float2"){return 1}else if(data=="float3"){return 2}else if(data=="float4"){return 3}else if(data=="short2norm"){return 5}else if(data=="short4norm"){return 6}return 0},parseVertexStructure:function(){this.structure=new kha_graphics4_VertexStructure;var ipos=false;var irot=false;var iscl=false;var _g=0;var _g1=this.raw.vertex_elements;while(_g<_g1.length){var elem=_g1[_g];++_g;if(elem.name=="ipos"){ipos=true;continue}if(elem.name=="irot"){irot=true;continue}if(elem.name=="iscl"){iscl=true;continue}this.structure.add(elem.name,this.parseData(elem.data))}if(ipos&&!irot&&!iscl){this.instancingType=1}else if(ipos&&irot&&!iscl){this.instancingType=2}else if(ipos&&!irot&&iscl){this.instancingType=3}else if(ipos&&irot&&iscl){this.instancingType=4}},getCompareMode:function(s){switch(s){case"always":return 0;case"equal":return 2;case"greater":return 6;case"greater_equal":return 7;case"less":return 4;case"less_equal":return 5;case"never":return 1;case"not_equal":return 3;default:return 4}},getCullMode:function(s){switch(s){case"clockwise":return 0;case"none":return 2;default:return 1}},getBlendingOperation:function(s){switch(s){case"add":return 0;case"max":return 4;case"min":return 3;case"reverse_subtract":return 2;case"subtract":return 1;default:return 0}},getBlendingFactor:function(s){switch(s){case"blend_one":return 1;case"blend_zero":return 2;case"destination_alpha":return 4;case"destination_color":return 8;case"inverse_destination_alpha":return 6;case"inverse_destination_color":return 10;case"inverse_source_alpha":return 5;case"inverse_source_color":return 9;case"source_alpha":return 3;case"source_color":return 7;default:return 0}},getTextureAddresing:function(s){switch(s){case"mirror":return 1;case"repeat":return 0;default:return 2}},getTextureFilter:function(s){switch(s){case"linear":return 1;case"point":return 0;default:return 2}},getMipmapFilter:function(s){switch(s){case"no":return 0;case"point":return 1;default:return 2}},addConstant:function(c){this.constants.push(this.pipeState.getConstantLocation(c.name))},addTexture:function(tu){var unit=this.pipeState.getTextureUnit(tu.name);this.textureUnits.push(unit)},setTextureParameters:function(g,unitIndex,tex){var unit=this.textureUnits[unitIndex];g.setTextureParameters(unit,tex.u_addressing==null?0:this.getTextureAddresing(tex.u_addressing),tex.v_addressing==null?0:this.getTextureAddresing(tex.v_addressing),tex.min_filter==null?1:this.getTextureFilter(tex.min_filter),tex.mag_filter==null?1:this.getTextureFilter(tex.mag_filter),tex.mipmap_filter==null?0:this.getMipmapFilter(tex.mipmap_filter))},__class__:iron_data_ShaderContext};var iron_data_WorldData=function(raw,done){var _gthis=this;this.raw=raw;this.name=raw.name;if(raw.probe!=null){new iron_data_Probe(raw.probe,function(self){_gthis.probe=self;_gthis.loadEnvmap(done)})}else{this.loadEnvmap(done)}};$hxClasses["iron.data.WorldData"]=iron_data_WorldData;iron_data_WorldData.__name__=true;iron_data_WorldData.parse=function(name,id,done){iron_data_Data.getSceneRaw(name,function(format){var raw=iron_data_Data.getWorldRawByName(format.world_datas,id);if(raw==null){haxe_Log.trace('World data "'+id+'" not found!',{fileName:"Sources/iron/data/WorldData.hx",lineNumber:45,className:"iron.data.WorldData",methodName:"parse"});done(null)}new iron_data_WorldData(raw,done)})};iron_data_WorldData.getEmptyIrradiance=function(){if(iron_data_WorldData.emptyIrr==null){var this1=new Float32Array(28);iron_data_WorldData.emptyIrr=this1;var _g=0;var _g1=iron_data_WorldData.emptyIrr.length;while(_g<_g1){var i=_g++;iron_data_WorldData.emptyIrr[i]=0}}return iron_data_WorldData.emptyIrr};iron_data_WorldData.prototype={loadEnvmap:function(done){var _gthis=this;if(this.raw.envmap!=null){iron_data_Data.getImage(this.raw.envmap,function(image){_gthis.envmap=image;done(_gthis)})}else{done(this)}},__class__:iron_data_WorldData};var iron_data_Probe=function(raw,done){this.radianceMipmaps=[];var _gthis=this;this.raw=raw;this.setIrradiance(function(irr){_gthis.irradiance=irr;if(raw.radiance!=null){iron_data_Data.getImage(raw.radiance,function(rad){_gthis.radiance=rad;while(_gthis.radianceMipmaps.length<raw.radiance_mipmaps)_gthis.radianceMipmaps.push(null);var ext=raw.radiance.substring(raw.radiance.length-4);var base=raw.radiance.substring(0,raw.radiance.length-4);var mipsLoaded=0;var _g=0;var _g1=raw.radiance_mipmaps;while(_g<_g1){var i=[_g++];iron_data_Data.getImage(base+"_"+i[0]+ext,function(i1){return function(mipimg){_gthis.radianceMipmaps[i1[0]]=mipimg;mipsLoaded+=1;if(mipsLoaded==raw.radiance_mipmaps){_gthis.radiance.setMipmaps(_gthis.radianceMipmaps);done(_gthis)}}}(i),true)}})}else{done(_gthis)}})};$hxClasses["iron.data.Probe"]=iron_data_Probe;iron_data_Probe.__name__=true;iron_data_Probe.prototype={setIrradiance:function(done){if(this.raw.irradiance==null){var ar=[.775966,1.16761,1.498638,.133694,.215281,.056659,-.022268,-.019376,-.010651,279e-6,185e-6,0,0,-393e-6,-775e-6,.010973,.027268,.043918,.085267,.07367,.038877,0,0,0,.135177,.115614,.060794];var this1=new Float32Array(ar.length);var far=this1;var _g=0;var _g1=far.length;while(_g<_g1){var i=_g++;far[i]=ar[i]}done(far)}else{var ext=StringTools.endsWith(this.raw.irradiance,".json")?"":".arm";iron_data_Data.getBlob(this.raw.irradiance+ext,function(b){var irradianceParsed=ext==""?JSON.parse(b.toString()):iron_system_ArmPack.decode(b.toBytes());var this2=new Float32Array(28);var irr=this2;irr[0]=irradianceParsed.irradiance[0];irr[1]=irradianceParsed.irradiance[1];irr[2]=irradianceParsed.irradiance[2];irr[3]=irradianceParsed.irradiance[3];irr[4]=irradianceParsed.irradiance[4];irr[5]=irradianceParsed.irradiance[5];irr[6]=irradianceParsed.irradiance[6];irr[7]=irradianceParsed.irradiance[7];irr[8]=irradianceParsed.irradiance[8];irr[9]=irradianceParsed.irradiance[9];irr[10]=irradianceParsed.irradiance[10];irr[11]=irradianceParsed.irradiance[11];irr[12]=irradianceParsed.irradiance[12];irr[13]=irradianceParsed.irradiance[13];irr[14]=irradianceParsed.irradiance[14];irr[15]=irradianceParsed.irradiance[15];irr[16]=irradianceParsed.irradiance[16];irr[17]=irradianceParsed.irradiance[17];irr[18]=irradianceParsed.irradiance[18];irr[19]=irradianceParsed.irradiance[19];irr[20]=irradianceParsed.irradiance[20];irr[21]=irradianceParsed.irradiance[21];irr[22]=irradianceParsed.irradiance[22];irr[23]=irradianceParsed.irradiance[23];irr[24]=irradianceParsed.irradiance[24];irr[25]=irradianceParsed.irradiance[25];irr[26]=irradianceParsed.irradiance[26];irr[27]=0;done(irr)})}},__class__:iron_data_Probe};var iron_math_Mat3=function(_00,_10,_20,_01,_11,_21,_02,_12,_22){this.self=new kha_math_FastMatrix3(_00,_10,_20,_01,_11,_21,_02,_12,_22)};$hxClasses["iron.math.Mat3"]=iron_math_Mat3;iron_math_Mat3.__name__=true;iron_math_Mat3.identity=function(){return new iron_math_Mat3(1,0,0,0,1,0,0,0,1)};iron_math_Mat3.prototype={setFrom4:function(m){this.set__00(m.get__00());this.set__01(m.get__01());this.set__02(m.get__02());this.set__10(m.get__10());this.set__11(m.get__11());this.set__12(m.get__12());this.set__20(m.get__20());this.set__21(m.get__21());this.set__22(m.get__22())},set__00:function(f){return this.self._00=f},set__01:function(f){return this.self._01=f},set__02:function(f){return this.self._02=f},set__10:function(f){return this.self._10=f},set__11:function(f){return this.self._11=f},set__12:function(f){return this.self._12=f},set__20:function(f){return this.self._20=f},set__21:function(f){return this.self._21=f},set__22:function(f){return this.self._22=f},__class__:iron_math_Mat3,__properties__:{set__22:"set__22",set__21:"set__21",set__20:"set__20",set__12:"set__12",set__11:"set__11",set__10:"set__10",set__02:"set__02",set__01:"set__01",set__00:"set__00"}};var iron_math_Math=function(){};$hxClasses["iron.math.Math"]=iron_math_Math;iron_math_Math.__name__=true;iron_math_Math.cos=function(v){return Math.cos(v)};iron_math_Math.sin=function(v){return Math.sin(v)};iron_math_Math.sqrt=function(v){return Math.sqrt(v)};iron_math_Math.tan=function(v){return Math.tan(v)};var iron_object_Animation=function(){this.markerEvents=null;this.lastFrameIndex=-1;this.blendFactor=0;this.blendAction="";this.blendCurrent=0;this.blendTime=0;this.paused=false;this.onComplete=null;this.frameIndex=0;this.loop=true;this.speed=1;this.time=0;this.action="";iron_Scene.active.animations.push(this);this.frameTime=iron_Scene.active.raw.frame_time;this.play()};$hxClasses["iron.object.Animation"]=iron_object_Animation;iron_object_Animation.__name__=true;iron_object_Animation.prototype={play:function(action,onComplete,blendTime,speed,loop){if(loop==null){loop=true}if(speed==null){speed=1}if(blendTime==null){blendTime=0}if(action==null){action=""}if(blendTime>0){this.blendTime=blendTime;this.blendCurrent=0;this.blendAction=this.action}else{this.frameIndex=-1}this.action=action;this.onComplete=onComplete;this.speed=speed;this.loop=loop;this.paused=false},remove:function(){HxOverrides.remove(iron_Scene.active.animations,this)},update:function(delta){if(this.paused||this.speed==0){return}this.time+=delta*this.speed;if(this.blendTime>0&&this.blendFactor==0){this.blendCurrent+=delta;if(this.blendCurrent>=this.blendTime){this.blendTime=0}}},isTrackEnd:function(track){if(this.speed>0){return this.frameIndex>=track.frames.length-1}else{return this.frameIndex<=0}},checkFrameIndex:function(frameValues){if(this.speed>0){if(this.frameIndex+1<frameValues.length){return this.time>frameValues[this.frameIndex+1]*this.frameTime}else{return false}}else if(this.frameIndex-1>-1){return this.time<frameValues[this.frameIndex-1]*this.frameTime}else{return false}},rewind:function(track){this.frameIndex=this.speed>0?0:track.frames.length-1;this.time=track.frames[this.frameIndex]*this.frameTime},updateTrack:function(anim){if(anim==null){return}var track=anim.tracks[0];if(this.frameIndex==-1){this.rewind(track)}var sign=this.speed>0?1:-1;while(this.checkFrameIndex(track.frames))this.frameIndex+=sign;if(this.markerEvents!=null&&anim.marker_names!=null&&this.frameIndex!=this.lastFrameIndex){var _g=0;var _g1=anim.marker_frames.length;while(_g<_g1){var i=_g++;if(this.frameIndex==anim.marker_frames[i]){var ar=this.markerEvents.get(anim.marker_names[i]);var _g2=0;while(_g2<ar.length){var f=ar[_g2];++_g2;f()}}}this.lastFrameIndex=this.frameIndex}if(this.isTrackEnd(track)){if(this.loop||this.blendTime>0){this.rewind(track)}else{this.frameIndex-=sign;this.paused=true}if(this.onComplete!=null&&this.blendTime==0){this.onComplete()}}},updateAnimSampled:function(anim,m){if(anim==null){return}var track=anim.tracks[0];var sign=this.speed>0?1:-1;var t=this.time;var ti=this.frameIndex;var t1=track.frames[ti]*this.frameTime;var t2=track.frames[ti+sign]*this.frameTime;var s=(t-t1)/(t2-t1);iron_object_Animation.m1.setF32(track.values,ti*16);iron_object_Animation.m2.setF32(track.values,(ti+sign)*16);iron_object_Animation.m1.decompose(iron_object_Animation.vpos,iron_object_Animation.q1,iron_object_Animation.vscl);iron_object_Animation.m2.decompose(iron_object_Animation.vpos2,iron_object_Animation.q2,iron_object_Animation.vscl2);iron_object_Animation.vp.lerp(iron_object_Animation.vpos,iron_object_Animation.vpos2,s);iron_object_Animation.vs.lerp(iron_object_Animation.vscl,iron_object_Animation.vscl2,s);iron_object_Animation.q3.lerp(iron_object_Animation.q1,iron_object_Animation.q2,s);m.fromQuat(iron_object_Animation.q3);m.scale(iron_object_Animation.vs);m.set__30(iron_object_Animation.vp.x);m.set__31(iron_object_Animation.vp.y);m.set__32(iron_object_Animation.vp.z)},__class__:iron_object_Animation};var iron_object_Object=function(){this.isEmpty=false;this.properties=null;this.culledShadow=false;this.culledMesh=false;this.culled=false;this.visibleShadow=true;this.visibleMesh=true;this.visible=true;this.animation=null;this.lods=null;this.children=[];this.parent=null;this.traits=[];this.constraints=null;this.name="";this.raw=null;this.uid=iron_object_Object.uidCounter++;this.urandom=iron_object_Object.seededRandom();this.transform=new iron_object_Transform(this);this.isEmpty=Type.getClass(this)==iron_object_Object;if(this.isEmpty&&iron_Scene.active!=null){iron_Scene.active.empties.push(this)}};$hxClasses["iron.object.Object"]=iron_object_Object;iron_object_Object.__name__=true;iron_object_Object.seededRandom=function(){iron_object_Object.seed=(iron_object_Object.seed*9301+49297)%233280;return iron_object_Object.seed/233280};iron_object_Object.prototype={addChild:function(o,parentInverse){if(parentInverse==null){parentInverse=false}if(o.parent==this){return}this.children.push(o);o.parent=this;if(parentInverse){o.transform.applyParentInverse()}},remove:function(){if(this.isEmpty&&iron_Scene.active!=null){HxOverrides.remove(iron_Scene.active.empties,this)}if(this.animation!=null){this.animation.remove()}while(this.children.length>0)this.children[0].remove();while(this.traits.length>0)this.traits[0].remove();if(this.parent!=null){HxOverrides.remove(this.parent.children,this);this.parent=null}},getChild:function(name){if(this.name==name){return this}else{var _g=0;var _g1=this.children;while(_g<_g1.length){var c=_g1[_g];++_g;var r=c.getChild(name);if(r!=null){return r}}}return null},addTrait:function(t){this.traits.push(t);t.object=this;if(t._add!=null){var _g=0;var _g1=t._add;while(_g<_g1.length){var f=_g1[_g];++_g;f()}t._add=null}},removeTrait:function(t){if(t._init!=null){var _g=0;var _g1=t._init;while(_g<_g1.length){var f=_g1[_g];++_g;iron_App.removeInit(f)}t._init=null}if(t._update!=null){var _g2=0;var _g11=t._update;while(_g2<_g11.length){var f1=_g11[_g2];++_g2;iron_App.removeUpdate(f1)}t._update=null}if(t._lateUpdate!=null){var _g3=0;var _g12=t._lateUpdate;while(_g3<_g12.length){var f2=_g12[_g3];++_g3;iron_App.removeLateUpdate(f2)}t._lateUpdate=null}if(t._render!=null){var _g4=0;var _g13=t._render;while(_g4<_g13.length){var f3=_g13[_g4];++_g4;iron_App.removeRender(f3)}t._render=null}if(t._render2D!=null){var _g5=0;var _g14=t._render2D;while(_g5<_g14.length){var f4=_g14[_g5];++_g5;iron_App.removeRender2D(f4)}t._render2D=null}if(t._remove!=null){var _g6=0;var _g15=t._remove;while(_g6<_g15.length){var f5=_g15[_g6];++_g6;f5()}t._remove=null}HxOverrides.remove(this.traits,t)},setupAnimation:function(oactions){if(oactions==null){return}this.animation=new iron_object_ObjectAnimation(this,oactions)},__class__:iron_object_Object};var iron_object_CameraObject=function(data){this.currentFace=0;this.renderTargetCube=null;this.renderTarget=null;this.frustumPlanes=null;this.prevV=null;iron_object_Object.call(this);this.data=data;this.buildProjection();this.V=iron_math_Mat4.identity();this.VP=iron_math_Mat4.identity();if(data.raw.frustum_culling){this.frustumPlanes=[];this.frustumPlanes.push(new iron_object_FrustumPlane);this.frustumPlanes.push(new iron_object_FrustumPlane);this.frustumPlanes.push(new iron_object_FrustumPlane);this.frustumPlanes.push(new iron_object_FrustumPlane);this.frustumPlanes.push(new iron_object_FrustumPlane);this.frustumPlanes.push(new iron_object_FrustumPlane)}iron_Scene.active.cameras.push(this)};$hxClasses["iron.object.CameraObject"]=iron_object_CameraObject;iron_object_CameraObject.__name__=true;iron_object_CameraObject.buildViewFrustum=function(VP,frustumPlanes){var tmp=VP.get__03()+VP.get__00();var tmp1=VP.get__13()+VP.get__10();var tmp2=VP.get__23()+VP.get__20();var tmp3=VP.get__33()+VP.get__30();frustumPlanes[0].setComponents(tmp,tmp1,tmp2,tmp3);var tmp4=VP.get__03()-VP.get__00();var tmp5=VP.get__13()-VP.get__10();var tmp6=VP.get__23()-VP.get__20();var tmp7=VP.get__33()-VP.get__30();frustumPlanes[1].setComponents(tmp4,tmp5,tmp6,tmp7);var tmp8=VP.get__03()-VP.get__01();var tmp9=VP.get__13()-VP.get__11();var tmp10=VP.get__23()-VP.get__21();var tmp11=VP.get__33()-VP.get__31();frustumPlanes[2].setComponents(tmp8,tmp9,tmp10,tmp11);var tmp12=VP.get__03()+VP.get__01();var tmp13=VP.get__13()+VP.get__11();var tmp14=VP.get__23()+VP.get__21();var tmp15=VP.get__33()+VP.get__31();frustumPlanes[3].setComponents(tmp12,tmp13,tmp14,tmp15);var tmp16=VP.get__02();var tmp17=VP.get__12();var tmp18=VP.get__22();var tmp19=VP.get__32();frustumPlanes[4].setComponents(tmp16,tmp17,tmp18,tmp19);var tmp20=VP.get__03()-VP.get__02();var tmp21=VP.get__13()-VP.get__12();var tmp22=VP.get__23()-VP.get__22();var tmp23=VP.get__33()-VP.get__32();frustumPlanes[5].setComponents(tmp20,tmp21,tmp22,tmp23);var _g=0;while(_g<frustumPlanes.length){var plane=frustumPlanes[_g];++_g;plane.normalize()}};iron_object_CameraObject.sphereInFrustum=function(frustumPlanes,t,radiusScale,offsetX,offsetY,offsetZ){if(offsetZ==null){offsetZ=0}if(offsetY==null){offsetY=0}if(offsetX==null){offsetX=0}if(radiusScale==null){radiusScale=1}var radius=t.radius*radiusScale;var _g=0;while(_g<frustumPlanes.length){var plane=frustumPlanes[_g];++_g;iron_object_CameraObject.sphereCenter.set(t.worldx()+offsetX,t.worldy()+offsetY,t.worldz()+offsetZ);if(plane.distanceToSphere(iron_object_CameraObject.sphereCenter,radius)+radius*2<0){return false}}return true};iron_object_CameraObject.setCubeFace=function(m,eye,face){iron_object_CameraObject.vcenter.setFrom(eye);switch(face){case 0:iron_object_CameraObject.vcenter.addf(1,0,0);iron_object_CameraObject.vup.set(0,-1,0);break;case 1:iron_object_CameraObject.vcenter.addf(-1,0,0);iron_object_CameraObject.vup.set(0,-1,0);break;case 2:iron_object_CameraObject.vcenter.addf(0,1,0);iron_object_CameraObject.vup.set(0,0,1);break;case 3:iron_object_CameraObject.vcenter.addf(0,-1,0);iron_object_CameraObject.vup.set(0,0,-1);break;case 4:iron_object_CameraObject.vcenter.addf(0,0,1);iron_object_CameraObject.vup.set(0,-1,0);break;case 5:iron_object_CameraObject.vcenter.addf(0,0,-1);iron_object_CameraObject.vup.set(0,-1,0);break}m.setLookAt(eye,iron_object_CameraObject.vcenter,iron_object_CameraObject.vup)};iron_object_CameraObject.__super__=iron_object_Object;iron_object_CameraObject.prototype=$extend(iron_object_Object.prototype,{buildProjection:function(screenAspect){if(this.data.raw.ortho!=null){this.P=iron_math_Mat4.ortho(this.data.raw.ortho[0],this.data.raw.ortho[1],this.data.raw.ortho[2],this.data.raw.ortho[3],this.data.raw.near_plane,this.data.raw.far_plane)}else{if(screenAspect==null){screenAspect=iron_App.w()/iron_App.h()}var aspect=this.data.raw.aspect!=null?this.data.raw.aspect:screenAspect;this.P=iron_math_Mat4.persp(this.data.raw.fov,aspect,this.data.raw.near_plane,this.data.raw.far_plane)}},remove:function(){HxOverrides.remove(iron_Scene.active.cameras,this);iron_object_Object.prototype.remove.call(this)},renderFrame:function(g){this.buildMatrix();if(this.prevV==null){this.prevV=iron_math_Mat4.identity();this.prevV.setFrom(this.V)}iron_RenderPath.active.renderFrame(g);this.prevV.setFrom(this.V)},buildMatrix:function(){this.transform.buildMatrix();var sc=this.transform.world.getScale();if(sc.x!=1||sc.y!=1||sc.z!=1){iron_object_CameraObject.temp.set(1/sc.x,1/sc.y,1/sc.z);this.transform.world.scale(iron_object_CameraObject.temp)}this.V.getInverse(this.transform.world);this.VP.multmats(this.P,this.V);if(this.data.raw.frustum_culling){iron_object_CameraObject.buildViewFrustum(this.VP,this.frustumPlanes)}},rightWorld:function(){return new iron_math_Vec4(this.transform.world.get__00(),this.transform.world.get__01(),this.transform.world.get__02())},upWorld:function(){return new iron_math_Vec4(this.transform.world.get__10(),this.transform.world.get__11(),this.transform.world.get__12())},lookWorld:function(){return new iron_math_Vec4(-this.transform.world.get__20(),-this.transform.world.get__21(),-this.transform.world.get__22())},__class__:iron_object_CameraObject});var iron_object_FrustumPlane=function(){this.constant=0;this.normal=new iron_math_Vec4(1,0,0)};$hxClasses["iron.object.FrustumPlane"]=iron_object_FrustumPlane;iron_object_FrustumPlane.__name__=true;iron_object_FrustumPlane.prototype={normalize:function(){var inverseNormalLength=1/this.normal.length();this.normal.mult(inverseNormalLength);this.constant*=inverseNormalLength},distanceToSphere:function(sphereCenter,sphereRadius){return this.normal.dot(sphereCenter)+this.constant-sphereRadius},setComponents:function(x,y,z,w){this.normal.set(x,y,z);this.constant=w},__class__:iron_object_FrustumPlane};var iron_object_Constraint=function(constr){this.target=null;this.raw=constr};$hxClasses["iron.object.Constraint"]=iron_object_Constraint;iron_object_Constraint.__name__=true;iron_object_Constraint.prototype={apply:function(transform){if(this.target==null&&this.raw.target!=null){this.target=iron_Scene.active.getChild(this.raw.target).transform}if(this.raw.type=="COPY_LOCATION"){if(this.raw.use_x){transform.world.set__30(this.target.loc.x);if(this.raw.use_offset){var _g=transform.world;_g.set__30(_g.get__30()+transform.loc.x)}}if(this.raw.use_y){transform.world.set__31(this.target.loc.y);if(this.raw.use_offset){var _g1=transform.world;_g1.set__31(_g1.get__31()+transform.loc.y)}}if(this.raw.use_z){transform.world.set__32(this.target.loc.z);if(this.raw.use_offset){var _g2=transform.world;_g2.set__32(_g2.get__32()+transform.loc.z)}}}},__class__:iron_object_Constraint};var iron_object_LightObject=function(data){this.frustumPlanes=null;this.VP=iron_math_Mat4.identity();this.P=null;this.V=iron_math_Mat4.identity();this.camSlicedP=null;iron_object_Object.call(this);this.data=data;var type=data.raw.type;var fov=data.raw.fov;if(type=="sun"){if(iron_object_LightObject.corners==null){iron_object_LightObject.corners=[];iron_object_LightObject.corners.push(new iron_math_Vec4);iron_object_LightObject.corners.push(new iron_math_Vec4);iron_object_LightObject.corners.push(new iron_math_Vec4);iron_object_LightObject.corners.push(new iron_math_Vec4);iron_object_LightObject.corners.push(new iron_math_Vec4);iron_object_LightObject.corners.push(new iron_math_Vec4);iron_object_LightObject.corners.push(new iron_math_Vec4);iron_object_LightObject.corners.push(new iron_math_Vec4)}this.P=iron_math_Mat4.identity()}else if(type=="point"||type=="area"){this.P=iron_math_Mat4.persp(fov,1,data.raw.near_plane,data.raw.far_plane)}else if(type=="spot"){this.P=iron_math_Mat4.persp(fov,1,data.raw.near_plane,data.raw.far_plane)}iron_Scene.active.lights.push(this)};$hxClasses["iron.object.LightObject"]=iron_object_LightObject;iron_object_LightObject.__name__=true;iron_object_LightObject.setCorners=function(){iron_object_LightObject.corners[0].set(-1,-1,1);iron_object_LightObject.corners[1].set(-1,-1,-1);iron_object_LightObject.corners[2].set(-1,1,1);iron_object_LightObject.corners[3].set(-1,1,-1);iron_object_LightObject.corners[4].set(1,-1,1);iron_object_LightObject.corners[5].set(1,-1,-1);iron_object_LightObject.corners[6].set(1,1,1);iron_object_LightObject.corners[7].set(1,1,-1)};iron_object_LightObject.__super__=iron_object_Object;iron_object_LightObject.prototype=$extend(iron_object_Object.prototype,{remove:function(){if(iron_Scene.active!=null){HxOverrides.remove(iron_Scene.active.lights,this)}iron_object_Object.prototype.remove.call(this)},buildMatrix:function(camera){this.transform.buildMatrix();if(this.data.raw.type=="sun"){this.setCascade(camera,0)}else{this.V.getInverse(this.transform.world);this.updateViewFrustum(camera)}},setCascade:function(camera,cascade){iron_object_LightObject.m.setFrom(camera.V);if(this.camSlicedP==null){var ortho=camera.data.raw.ortho;if(ortho==null){var fov=camera.data.raw.fov;var near=this.data.raw.near_plane;var far=this.data.raw.far_plane;var aspect=camera.data.raw.aspect!=null?camera.data.raw.aspect:iron_App.w()/iron_App.h();this.camSlicedP=iron_math_Mat4.persp(fov,aspect,near,far)}else{this.camSlicedP=iron_math_Mat4.ortho(ortho[0],ortho[1],ortho[2],ortho[3],this.data.raw.near_plane,this.data.raw.far_plane)}}iron_object_LightObject.m.multmat(this.camSlicedP);iron_object_LightObject.m.getInverse(iron_object_LightObject.m);this.V.getInverse(this.transform.world);this.V.toRotation();iron_object_LightObject.m.multmat(this.V);iron_object_LightObject.setCorners();var _g=0;var _g1=iron_object_LightObject.corners;while(_g<_g1.length){var v=_g1[_g];++_g;v.applymat4(iron_object_LightObject.m);v.set(v.x/v.w,v.y/v.w,v.z/v.w)}var minx=iron_object_LightObject.corners[0].x;var miny=iron_object_LightObject.corners[0].y;var minz=iron_object_LightObject.corners[0].z;var maxx=iron_object_LightObject.corners[0].x;var maxy=iron_object_LightObject.corners[0].y;var maxz=iron_object_LightObject.corners[0].z;var _g2=0;var _g3=iron_object_LightObject.corners;while(_g2<_g3.length){var v1=_g3[_g2];++_g2;if(v1.x<minx){minx=v1.x}if(v1.x>maxx){maxx=v1.x}if(v1.y<miny){miny=v1.y}if(v1.y>maxy){maxy=v1.y}if(v1.z<minz){minz=v1.z}if(v1.z>maxz){maxz=v1.z}}var diag0=iron_math_Vec4.distance(iron_object_LightObject.corners[0],iron_object_LightObject.corners[7]);var offx=(diag0-(maxx-minx))*.5;var offy=(diag0-(maxy-miny))*.5;minx-=offx;maxx+=offx;miny-=offy;maxy+=offy;var smsize=this.data.raw.shadowmap_size;var worldPerTexelX=(maxx-minx)/smsize;var worldPerTexelY=(maxy-miny)/smsize;var worldPerTexelZ=(maxz-minz)/smsize;minx=Math.floor(minx/worldPerTexelX)*worldPerTexelX;miny=Math.floor(miny/worldPerTexelY)*worldPerTexelY;minz=Math.floor(minz/worldPerTexelZ)*worldPerTexelZ;maxx=Math.floor(maxx/worldPerTexelX)*worldPerTexelX;maxy=Math.floor(maxy/worldPerTexelY)*worldPerTexelY;maxz=Math.floor(maxz/worldPerTexelZ)*worldPerTexelZ;var hx=(maxx-minx)/2*iron_object_LightObject.cascadeBounds;var hy=(maxy-miny)/2*iron_object_LightObject.cascadeBounds;var hz=(maxz-minz)/2*iron_object_LightObject.cascadeBounds;this.V.set__30(-(minx+hx));this.V.set__31(-(miny+hy));this.V.set__32(-(minz+hz));iron_object_LightObject.m=iron_math_Mat4.ortho(-hx,hx,-hy,hy,-hz*4,hz);this.P.setFrom(iron_object_LightObject.m);this.updateViewFrustum(camera)},updateViewFrustum:function(camera){this.VP.multmats(this.P,this.V);if(camera.data.raw.frustum_culling){if(this.frustumPlanes==null){this.frustumPlanes=[];this.frustumPlanes.push(new iron_object_FrustumPlane);this.frustumPlanes.push(new iron_object_FrustumPlane);this.frustumPlanes.push(new iron_object_FrustumPlane);this.frustumPlanes.push(new iron_object_FrustumPlane);this.frustumPlanes.push(new iron_object_FrustumPlane);this.frustumPlanes.push(new iron_object_FrustumPlane)}iron_object_CameraObject.buildViewFrustum(this.VP,this.frustumPlanes)}},setCubeFace:function(face,camera){iron_object_LightObject.eye.set(this.transform.worldx(),this.transform.worldy(),this.transform.worldz());iron_object_CameraObject.setCubeFace(this.V,iron_object_LightObject.eye,face);this.updateViewFrustum(camera)},look:function(){return new iron_math_Vec4(this.V.get__02(),this.V.get__12(),this.V.get__22())},__class__:iron_object_LightObject});var iron_object_MeshObject=function(data,materials){this.force_context=null;this.skip_context=null;this.tilesheet=null;this.frustumCulling=true;this.screenSize=0;this.data=null;iron_object_Object.call(this);this.materials=materials;this.setData(data);iron_Scene.active.meshes.push(this)};$hxClasses["iron.object.MeshObject"]=iron_object_MeshObject;iron_object_MeshObject.__name__=true;iron_object_MeshObject.__super__=iron_object_Object;iron_object_MeshObject.prototype=$extend(iron_object_Object.prototype,{setData:function(data){this.data=data;data.refcount++;data.geom.build();this.transform.scaleWorld=data.scalePos},remove:function(){if(this.tilesheet!=null){this.tilesheet.remove()}if(iron_Scene.active!=null){HxOverrides.remove(iron_Scene.active.meshes,this)}this.data.refcount--;iron_object_Object.prototype.remove.call(this)},setupAnimation:function(oactions){iron_object_Object.prototype.setupAnimation.call(this,oactions)},setupTilesheet:function(sceneName,tilesheet_ref,tilesheet_action_ref){this.tilesheet=new iron_object_Tilesheet(sceneName,tilesheet_ref,tilesheet_action_ref)},isLodMaterial:function(){if(this.raw!=null&&this.raw.lod_material!=null){return this.raw.lod_material==true}else{return false}},setCulled:function(isShadow,b){if(isShadow){this.culledShadow=b}else{this.culledMesh=b}this.culled=this.culledMesh&&this.culledShadow;return b},cullMaterial:function(context){var mats=this.materials;if(!this.isLodMaterial()&&!this.validContext(mats[0],context)){return true}var isShadow=context=="shadowmap";if(!this.visibleMesh&&!isShadow){return this.setCulled(isShadow,true)}if(!this.visibleShadow&&isShadow){return this.setCulled(isShadow,true)}if(this.skip_context==context){return this.setCulled(isShadow,true)}if(this.force_context!=null&&this.force_context!=context){return this.setCulled(isShadow,true)}if(context=="voxel"&&this.raw!=null&&this.raw.mobile==true){return this.setCulled(isShadow,true)}return this.setCulled(isShadow,false)},cullMesh:function(context,camera,light){if(camera==null){return false}if(camera.data.raw.frustum_culling&&this.frustumCulling){var radiusScale=this.data.isSkinned?2:1;if(context=="voxel"){radiusScale*=100}var isShadow=context=="shadowmap";var frustumPlanes=isShadow?light.frustumPlanes:camera.frustumPlanes;if(isShadow&&light.data.raw.type!="sun"){light.transform.radius=light.data.raw.far_plane;if(!iron_object_CameraObject.sphereInFrustum(camera.frustumPlanes,light.transform)){return this.setCulled(isShadow,true)}}if(!this.data.geom.instanced){if(!iron_object_CameraObject.sphereInFrustum(frustumPlanes,this.transform,radiusScale)){return this.setCulled(isShadow,true)}}}this.culled=false;return this.culled},skipContext:function(context,mat){if(mat.raw.skip_context!=null&&mat.raw.skip_context==context){return true}return false},getContexts:function(context,materials,materialContexts,shaderContexts){var _g=0;while(_g<materials.length){var mat=materials[_g];++_g;var _g1=0;var _g11=mat.raw.contexts.length;while(_g1<_g11){var i=_g1++;if(HxOverrides.substr(mat.raw.contexts[i].name,0,context.length)==context){materialContexts.push(mat.contexts[i]);shaderContexts.push(mat.shader.getContext(context));break}}}},render:function(g,context,bindParams){if(this.data==null||!this.data.geom.ready){return}if(!this.visible){return}if(this.cullMesh(context,iron_Scene.active.camera,iron_RenderPath.active.light)){return}var meshContext=this.raw!=null&&"mesh"==context;if(this.tilesheet!=null){this.tilesheet.update()}if(this.cullMaterial(context)){return}var mats=this.materials;var lod=this;if(this.raw!=null&&this.raw.lods!=null&&this.raw.lods.length>0){this.computeScreenSize(iron_Scene.active.camera);this.initLods();if(context=="voxel"){lod=this.lods[this.lods.length-1]}else{var _g=0;var _g1=this.raw.lods.length;while(_g<_g1){var i=_g++;if(this.screenSize>this.raw.lods[i].screen_size){break}lod=this.lods[i];if(this.isLodMaterial()){mats=lod.materials}}}if(lod==null){return}}if(this.isLodMaterial()&&!this.validContext(mats[0],context)){return}var materialContexts=[];var shaderContexts=[];this.getContexts(context,mats,materialContexts,shaderContexts);iron_object_Uniforms.posUnpack=this.data.scalePos;iron_object_Uniforms.texUnpack=this.data.scaleTex;this.transform.update();var ldata=lod.data;var _g2=0;var _g11=ldata.geom.indexBuffers.length;while(_g2<_g11){var i1=_g2++;var mi=ldata.geom.materialIndices[i1];if(shaderContexts.length<=mi){continue}if(this.materials.length>mi&&this.skipContext(context,this.materials[mi])){continue}var scontext=shaderContexts[mi];var elems=scontext.raw.vertex_elements;if(scontext.pipeState!=iron_object_MeshObject.lastPipeline){g.setPipeline(scontext.pipeState);iron_object_MeshObject.lastPipeline=scontext.pipeState}iron_object_Uniforms.setContextConstants(g,scontext,bindParams);iron_object_Uniforms.setObjectConstants(g,scontext,this);if(materialContexts.length>mi){iron_object_Uniforms.setMaterialConstants(g,scontext,materialContexts[mi])}if(ldata.geom.instanced){g.setVertexBuffers([ldata.geom.get(elems),ldata.geom.instancedVB])}else{g.setVertexBuffer(ldata.geom.get(elems))}g.setIndexBuffer(ldata.geom.indexBuffers[i1]);if(ldata.geom.instanced){g.drawIndexedVerticesInstanced(ldata.geom.instanceCount,ldata.geom.start,ldata.geom.count)}else{g.drawIndexedVertices(ldata.geom.start,ldata.geom.count)}}},validContext:function(mat,context){return mat.getContext(context)!=null},computeCameraDistance:function(camX,camY,camZ){this.cameraDistance=iron_math_Vec4.distancef(camX,camY,camZ,this.transform.worldx(),this.transform.worldy(),this.transform.worldz())},computeScreenSize:function(camera){var tr=this.transform;var volume=tr.dim.x*tr.dim.y*tr.dim.z;this.screenSize=volume*(1/this.cameraDistance);this.screenSize=this.screenSize>1?1:this.screenSize},initLods:function(){if(this.lods==null){this.lods=[];var _g=0;var _g1=this.raw.lods;while(_g<_g1.length){var l=_g1[_g];++_g;if(l.object_ref==""){this.lods.push(null)}else{this.lods.push(iron_Scene.active.getChild(l.object_ref))}}}},__class__:iron_object_MeshObject});var iron_object_ObjectAnimation=function(object,oactions){this.bezierFrameIndex=-1;this.s0=0;this.object=object;this.oactions=oactions;this.isSkinned=false;iron_object_Animation.call(this)};$hxClasses["iron.object.ObjectAnimation"]=iron_object_ObjectAnimation;iron_object_ObjectAnimation.__name__=true;iron_object_ObjectAnimation.__super__=iron_object_Animation;iron_object_ObjectAnimation.prototype=$extend(iron_object_Animation.prototype,{getAction:function(action){var _g=0;var _g1=this.oactions;while(_g<_g1.length){var a=_g1[_g];++_g;if(a!=null&&a.objects[0].name==action){return a.objects[0]}}return null},play:function(action,onComplete,blendTime,speed,loop){if(loop==null){loop=true}if(speed==null){speed=1}if(blendTime==null){blendTime=0}if(action==null){action=""}iron_object_Animation.prototype.play.call(this,action,onComplete,blendTime,speed,loop);if(this.action==""&&this.oactions[0]!=null){this.action=this.oactions[0].objects[0].name}this.oaction=this.getAction(this.action);if(this.oaction!=null){this.isSampled=this.oaction.sampled!=null&&this.oaction.sampled}},update:function(delta){if(!this.object.visible||this.object.culled||this.oaction==null){return}iron_object_Animation.prototype.update.call(this,delta);if(this.paused){return}if(!this.isSkinned){this.updateObjectAnim()}},updateObjectAnim:function(){if(this.isSampled){this.updateTrack(this.oaction.anim);this.updateAnimSampled(this.oaction.anim,this.object.transform.world);this.object.transform.world.decompose(this.object.transform.loc,this.object.transform.rot,this.object.transform.scale);var _g=0;var _g1=this.object.children;while(_g<_g1.length){var c=_g1[_g];++_g;c.transform.buildMatrix()}}else{this.updateAnimNonSampled(this.oaction.anim,this.object.transform);this.object.transform.buildMatrix()}},interpolateLinear:function(t,t1,t2,v1,v2){var s=(t-t1)/(t2-t1);return(1-s)*v1+s*v2},interpolateBezier:function(t,t1,t2,v1,v2,c1,c2,p1,p2){if(this.frameIndex!=this.bezierFrameIndex){this.bezierFrameIndex=this.frameIndex;this.s0=(t-t1)/(t2-t1)}var a=(t2-3*c2+3*c1-t1)*(this.s0*this.s0*this.s0)+3*(c2-2*c1+t1)*(this.s0*this.s0)+3*(c1-t1)*this.s0+t1-t;var b=3*(t2-3*c2+3*c1-t1)*(this.s0*this.s0)+6*(c2-2*c1+t1)*this.s0+3*(c1-t1);var s=this.s0-a/b;this.s0=s;return(1-s)*(1-s)*(1-s)*v1+3*s*(1-s)*(1-s)*p1+3*(s*s)*(1-s)*p2+s*s*s*v2},isTrackEnd:function(track){if(this.speed>0){return this.frameIndex>=track.frames.length-2}else{return this.frameIndex<=0}},checkFrameIndexT:function(frameValues,t){if(this.speed>0){if(this.frameIndex<frameValues.length-2){return t>frameValues[this.frameIndex+1]*this.frameTime}else{return false}}else if(this.frameIndex>1){return t>frameValues[this.frameIndex-1]*this.frameTime}else{return false}},updateAnimNonSampled:function(anim,transform){if(anim==null){return}var total=anim.end*this.frameTime-anim.begin*this.frameTime;if(anim.has_delta){var t=transform;if(t.dloc==null){t.dloc=new iron_math_Vec4;t.drot=new iron_math_Quat;t.dscale=new iron_math_Vec4}t.dloc.set(0,0,0);t.dscale.set(0,0,0);t._deulerX=t._deulerY=t._deulerZ=0}var _g=0;var _g1=anim.tracks;while(_g<_g1.length){var track=_g1[_g];++_g;if(this.frameIndex==-1){this.rewind(track)}var sign=this.speed>0?1:-1;var t1=this.time+anim.begin*this.frameTime;while(this.checkFrameIndexT(track.frames,t1))this.frameIndex+=sign;if(this.frameIndex>=track.frames.length){continue}if(this.time>total){if(this.onComplete!=null){this.onComplete()}if(this.loop){this.rewind(track)}else{this.frameIndex-=sign;this.paused=true}return}var ti=this.frameIndex;var t11=track.frames[ti]*this.frameTime;var t2=track.frames[ti+sign]*this.frameTime;var v1=track.values[ti];var v2=track.values[ti+sign];var v=0;switch(track.curve){case"bezier":var c1=track.frames_control_plus[ti]*this.frameTime;var c2=track.frames_control_minus[ti+sign]*this.frameTime;var p1=track.values_control_plus[ti];var p2=track.values_control_minus[ti+sign];v=this.interpolateBezier(t1,t11,t2,v1,v2,c1,c2,p1,p2);break;case"linear":v=this.interpolateLinear(t1,t11,t2,v1,v2);break}switch(track.target){case"dxloc":transform.dloc.x=v;break;case"dxrot":transform._deulerX=v;break;case"dxscl":transform.dscale.x=v;break;case"dyloc":transform.dloc.y=v;break;case"dyrot":transform._deulerY=v;break;case"dyscl":transform.dscale.y=v;break;case"dzloc":transform.dloc.z=v;break;case"dzrot":transform._deulerZ=v;break;case"dzscl":transform.dscale.z=v;break;case"xloc":transform.loc.x=v;break;case"xrot":transform.setRotation(v,transform._eulerY,transform._eulerZ);break;case"xscl":transform.scale.x=v;break;case"yloc":transform.loc.y=v;break;case"yrot":transform.setRotation(transform._eulerX,v,transform._eulerZ);break;case"yscl":transform.scale.y=v;break;case"zloc":transform.loc.z=v;break;case"zrot":transform.setRotation(transform._eulerX,transform._eulerY,v);break;case"zscl":transform.scale.z=v;break}}},__class__:iron_object_ObjectAnimation});var iron_object_SpeakerObject=function(data){this.paused=false;this.channels=[];this.sound=null;var _gthis=this;iron_object_Object.call(this);this.data=data;iron_Scene.active.speakers.push(this);if(data.sound==""){return}iron_data_Data.getSound(data.sound,function(sound){_gthis.sound=sound;iron_App.notifyOnInit($bind(_gthis,_gthis.init))})};$hxClasses["iron.object.SpeakerObject"]=iron_object_SpeakerObject;iron_object_SpeakerObject.__name__=true;iron_object_SpeakerObject.__super__=iron_object_Object;iron_object_SpeakerObject.prototype=$extend(iron_object_Object.prototype,{init:function(){if(this.visible&&this.data.play_on_start){this.play()}},play:function(){if(this.sound==null||this.data.muted){return}if(this.paused){var _g=0;var _g1=this.channels;while(_g<_g1.length){var c=_g1[_g];++_g;c.play()}this.paused=false;return}var channel=iron_system_Audio.play(this.sound,this.data.loop,this.data.stream);this.channels.push(channel);if(this.data.attenuation>0&&this.channels.length==1){iron_App.notifyOnUpdate($bind(this,this.update))}},update:function(){if(this.paused){return}var _g=0;var _g1=this.channels;while(_g<_g1.length){var c=_g1[_g];++_g;if(c.get_finished()){HxOverrides.remove(this.channels,c)}}if(this.channels.length==0){iron_App.removeUpdate($bind(this,this.update));return}var cam=iron_Scene.active.camera;var loc1=cam.transform.world.getLoc();var loc2=this.transform.world.getLoc();var d=iron_math_Vec4.distance(loc1,loc2);d*=this.data.attenuation;var vol=1-Math.min(d/100,1);var _g2=0;var _g3=this.channels;while(_g2<_g3.length){var c1=_g3[_g2];++_g2;c1.set_volume(vol*this.data.volume)}},remove:function(){if(iron_Scene.active!=null){HxOverrides.remove(iron_Scene.active.speakers,this)}iron_object_Object.prototype.remove.call(this)},__class__:iron_object_SpeakerObject});var iron_object_Tilesheet=function(sceneName,tilesheet_ref,tilesheet_action_ref){this.onActionComplete=null;this.time=0;this.frame=0;this.paused=false;this.action=null;this.tileY=0;this.tileX=0;var _gthis=this;this.ready=false;iron_data_Data.getSceneRaw(sceneName,function(format){var _g=0;var _g1=format.tilesheet_datas;while(_g<_g1.length){var ts=_g1[_g];++_g;if(ts.name==tilesheet_ref){_gthis.raw=ts;_gthis.play(tilesheet_action_ref);_gthis.ready=true;break}}})};$hxClasses["iron.object.Tilesheet"]=iron_object_Tilesheet;iron_object_Tilesheet.__name__=true;iron_object_Tilesheet.prototype={play:function(action_ref,onActionComplete){this.onActionComplete=onActionComplete;var _g=0;var _g1=this.raw.actions;while(_g<_g1.length){var a=_g1[_g];++_g;if(a.name==action_ref){this.action=a;break}}this.setFrame(this.action.start);this.paused=false},remove:function(){},update:function(){if(!this.ready||this.paused||this.action.start>=this.action.end){return}this.time+=iron_system_Time.get_delta();if(this.time>=1/this.raw.framerate){this.setFrame(this.frame+1)}},setFrame:function(f){this.frame=f;this.time=0;var tx=this.frame%this.raw.tilesx;var ty=Std.int(this.frame/this.raw.tilesx);this.tileX=tx*(1/this.raw.tilesx);this.tileY=ty*(1/this.raw.tilesy);if(this.frame>=this.action.end&&this.action.start<this.action.end){if(this.onActionComplete!=null){this.onActionComplete()}if(this.action.loop){this.setFrame(this.action.start)}else{this.paused=true}}},__class__:iron_object_Tilesheet};var iron_object_Transform=function(object){this.dscale=null;this.drot=null;this.dloc=null;this.boneParent=null;this.appendMats=null;this.prependMats=null;this.scaleWorld=1;this.localOnly=false;this.object=object;this.reset()};$hxClasses["iron.object.Transform"]=iron_object_Transform;iron_object_Transform.__name__=true;iron_object_Transform.prototype={reset:function(){this.world=iron_math_Mat4.identity();this.worldUnpack=iron_math_Mat4.identity();this.local=iron_math_Mat4.identity();this.loc=new iron_math_Vec4;this.rot=new iron_math_Quat;this.scale=new iron_math_Vec4(1,1,1);this.dim=new iron_math_Vec4(2,2,2);this.radius=1;this.dirty=true},update:function(){if(this.dirty){this.buildMatrix()}},composeDelta:function(){this.dloc.addvecs(this.loc,this.dloc);this.dscale.addvecs(this.dscale,this.scale);this.drot.fromEuler(this._deulerX,this._deulerY,this._deulerZ);this.drot.multquats(this.rot,this.drot);this.local.compose(this.dloc,this.drot,this.dscale)},buildMatrix:function(){if(this.dloc==null){this.local.compose(this.loc,this.rot,this.scale)}else{this.composeDelta()}if(this.prependMats!=null){iron_object_Transform.temp.setIdentity();var _g=0;var _g1=this.prependMats;while(_g<_g1.length){var m=_g1[_g];++_g;iron_object_Transform.temp.multmat(m)}iron_object_Transform.temp.multmat(this.local);this.local.setFrom(iron_object_Transform.temp)}if(this.appendMats!=null){var _g2=0;var _g11=this.appendMats;while(_g2<_g11.length){var m1=_g11[_g2];++_g2;this.local.multmat(m1)}}if(this.boneParent!=null){this.local.multmats(this.boneParent,this.local)}if(this.object.parent!=null&&!this.localOnly){this.world.multmats3x4(this.local,this.object.parent.transform.world)}else{this.world.setFrom(this.local)}this.worldUnpack.setFrom(this.world);if(this.scaleWorld!=1){var _g3=this.worldUnpack;_g3.set__00(_g3.get__00()*this.scaleWorld);var _g4=this.worldUnpack;_g4.set__01(_g4.get__01()*this.scaleWorld);var _g5=this.worldUnpack;_g5.set__02(_g5.get__02()*this.scaleWorld);var _g6=this.worldUnpack;_g6.set__03(_g6.get__03()*this.scaleWorld);var _g7=this.worldUnpack;_g7.set__10(_g7.get__10()*this.scaleWorld);var _g8=this.worldUnpack;_g8.set__11(_g8.get__11()*this.scaleWorld);var _g9=this.worldUnpack;_g9.set__12(_g9.get__12()*this.scaleWorld);var _g10=this.worldUnpack;_g10.set__13(_g10.get__13()*this.scaleWorld);var _g12=this.worldUnpack;_g12.set__20(_g12.get__20()*this.scaleWorld);var _g13=this.worldUnpack;_g13.set__21(_g13.get__21()*this.scaleWorld);var _g14=this.worldUnpack;_g14.set__22(_g14.get__22()*this.scaleWorld);var _g15=this.worldUnpack;_g15.set__23(_g15.get__23()*this.scaleWorld)}if(this.object.constraints!=null){var _g16=0;var _g17=this.object.constraints;while(_g16<_g17.length){var c=_g17[_g16];++_g16;c.apply(this)}}this.computeDim();var _g18=0;var _g19=this.object.children;while(_g18<_g19.length){var n=_g19[_g18];++_g18;n.transform.buildMatrix()}this.dirty=false},decompose:function(){this.local.decompose(this.loc,this.rot,this.scale)},setRotation:function(x,y,z){this.rot.fromEuler(x,y,z);this._eulerX=x;this._eulerY=y;this._eulerZ=z;this.dirty=true},computeRadius:function(){this.radius=Math.sqrt(this.dim.x*this.dim.x+this.dim.y*this.dim.y+this.dim.z*this.dim.z)},computeDim:function(){if(this.object.raw==null){this.computeRadius();return}var d=this.object.raw.dimensions;if(d==null){this.dim.set(2*this.scale.x,2*this.scale.y,2*this.scale.z)}else{this.dim.set(d[0]*this.scale.x,d[1]*this.scale.y,d[2]*this.scale.z)}this.computeRadius()},applyParentInverse:function(){var pt=this.object.parent.transform;pt.buildMatrix();iron_object_Transform.temp.getInverse(pt.world);this.local.multmat(iron_object_Transform.temp);this.decompose();this.buildMatrix()},worldx:function(){return this.world.get__30()},worldy:function(){return this.world.get__31()},worldz:function(){return this.world.get__32()},__class__:iron_object_Transform};var kha_math_FastMatrix3=function(_00,_10,_20,_01,_11,_21,_02,_12,_22){this._00=_00;this._10=_10;this._20=_20;this._01=_01;this._11=_11;this._21=_21;this._02=_02;this._12=_12;this._22=_22};$hxClasses["kha.math.FastMatrix3"]=kha_math_FastMatrix3;kha_math_FastMatrix3.__name__=true;kha_math_FastMatrix3.prototype={__class__:kha_math_FastMatrix3};var iron_object_Uniforms=function(){};$hxClasses["iron.object.Uniforms"]=iron_object_Uniforms;iron_object_Uniforms.__name__=true;iron_object_Uniforms.setContextConstants=function(g,context,bindParams){if(context.raw.constants!=null){var _g=0;var _g1=context.raw.constants.length;while(_g<_g1){var i=_g++;var c=context.raw.constants[i];iron_object_Uniforms.setContextConstant(g,context.constants[i],c)}}if(bindParams!=null){var _g2=0;var _g11=Std.int(bindParams.length/2);while(_g2<_g11){var i1=_g2++;var pos=i1*2;var rtID=bindParams[pos];var samplerID=bindParams[pos+1];var attachDepth=false;var char=rtID.charAt(0);if(char=="_"){attachDepth=true;rtID=HxOverrides.substr(rtID,1,null)}var rt=attachDepth?iron_RenderPath.active.depthToRenderTarget.get(rtID):iron_RenderPath.active.renderTargets.get(rtID);iron_object_Uniforms.bindRenderTarget(g,rt,context,samplerID,attachDepth)}}if(context.raw.texture_units!=null){var _g3=0;var _g12=context.raw.texture_units.length;while(_g3<_g12){var j=_g3++;var tulink=context.raw.texture_units[j].link;if(tulink==null){continue}if(tulink=="_envmapRadiance"){var w=iron_Scene.active.world;if(w!=null){g.setTexture(context.textureUnits[j],w.probe.radiance);g.setTextureParameters(context.textureUnits[j],0,0,1,1,2)}}else if(tulink=="_envmap"){var w1=iron_Scene.active.world;if(w1!=null){g.setTexture(context.textureUnits[j],w1.envmap)}}else if(tulink=="_envmapBrdf"){g.setTexture(context.textureUnits[j],iron_Scene.active.embedded.get("brdf.png"))}else if(tulink=="_noise8"){g.setTexture(context.textureUnits[j],iron_Scene.active.embedded.get("noise8.png"));g.setTextureParameters(context.textureUnits[j],0,0,1,1,0)}else if(tulink=="_noise64"){g.setTexture(context.textureUnits[j],iron_Scene.active.embedded.get("noise64.png"));g.setTextureParameters(context.textureUnits[j],0,0,1,1,0)}else if(tulink=="_blueNoise64"){g.setTexture(context.textureUnits[j],iron_Scene.active.embedded.get("blue_noise64.png"));g.setTextureParameters(context.textureUnits[j],0,0,1,1,0)}else if(tulink=="_noise256"){g.setTexture(context.textureUnits[j],iron_Scene.active.embedded.get("noise256.png"));g.setTextureParameters(context.textureUnits[j],0,0,1,1,0)}else if(tulink=="_iesTexture"){g.setTexture(context.textureUnits[j],iron_Scene.active.embedded.get("iestexture.png"));g.setTextureParameters(context.textureUnits[j],0,0,1,1,0)}}}};iron_object_Uniforms.setObjectConstants=function(g,context,object){if(context.raw.constants!=null){var _g=0;var _g1=context.raw.constants.length;while(_g<_g1){var i=_g++;var c=context.raw.constants[i];iron_object_Uniforms.setObjectConstant(g,object,context.constants[i],c)}}if(iron_object_Uniforms.externalTextureLinks!=null){if(context.raw.texture_units!=null){var _g2=0;var _g11=context.raw.texture_units.length;while(_g2<_g11){var j=_g2++;var tulink=context.raw.texture_units[j].link;if(tulink==null){continue}var _g3=0;var _g12=iron_object_Uniforms.externalTextureLinks;while(_g3<_g12.length){var f=_g12[_g3];++_g3;var image=f(object,iron_object_Uniforms.currentMat(object),tulink);if(image!=null){g.setTexture(context.textureUnits[j],image);break}}}}}};iron_object_Uniforms.bindRenderTarget=function(g,rt,context,samplerID,attachDepth){if(rt!=null){var tus=context.raw.texture_units;var _g=0;var _g1=tus.length;while(_g<_g1){var j=_g++;if(samplerID==tus[j].name){var isImage=tus[j].is_image!=null&&tus[j].is_image;var paramsSet=false;if(rt.raw.depth>1){g.setTexture3DParameters(context.textureUnits[j],2,2,2,1,0,2);paramsSet=true}if(isImage){g.setImageTexture(context.textureUnits[j],rt.image);g.setTexture3DParameters(context.textureUnits[j],2,2,2,1,0,2);paramsSet=true}else if(rt.isCubeMap){if(attachDepth){g.setCubeMapDepth(context.textureUnits[j],rt.cubeMap)}else{g.setCubeMap(context.textureUnits[j],rt.cubeMap)}}else if(attachDepth){g.setTextureDepth(context.textureUnits[j],rt.image)}else{g.setTexture(context.textureUnits[j],rt.image)}if(!paramsSet&&rt.raw.mipmaps!=null&&rt.raw.mipmaps==true&&!isImage){g.setTextureParameters(context.textureUnits[j],2,2,1,1,2);paramsSet=true}if(!paramsSet){if(StringTools.startsWith(samplerID,"shadowMap")){if(rt.isCubeMap){g.setCubeMapCompareMode(context.textureUnits[j],true)}else{g.setTextureParameters(context.textureUnits[j],2,2,1,1,0);g.setTextureCompareMode(context.textureUnits[j],true)}paramsSet=true}else if(attachDepth){g.setTextureParameters(context.textureUnits[j],2,2,0,0,0);paramsSet=true}}if(!paramsSet){g.setTextureParameters(context.textureUnits[j],2,2,1,1,0);paramsSet=true}}}}};iron_object_Uniforms.setContextConstant=function(g,location,c){if(c.link==null){return true}var camera=iron_Scene.active.camera;var light=iron_RenderPath.active.light;if(c.type=="mat4"){var m=null;if(c.link=="_viewMatrix"){m=camera.V}else if(c.link=="_transposeInverseViewMatrix"){iron_object_Uniforms.helpMat.setFrom(camera.V);iron_object_Uniforms.helpMat.getInverse(iron_object_Uniforms.helpMat);iron_object_Uniforms.helpMat.transpose();m=iron_object_Uniforms.helpMat}else if(c.link=="_inverseViewMatrix"){iron_object_Uniforms.helpMat.getInverse(camera.V);m=iron_object_Uniforms.helpMat}else if(c.link=="_transposeViewMatrix"){iron_object_Uniforms.helpMat.setFrom(camera.V);iron_object_Uniforms.helpMat.transpose3x3();m=iron_object_Uniforms.helpMat}else if(c.link=="_projectionMatrix"){m=camera.P}else if(c.link=="_inverseProjectionMatrix"){iron_object_Uniforms.helpMat.getInverse(camera.P);m=iron_object_Uniforms.helpMat}else if(c.link=="_inverseViewProjectionMatrix"){iron_object_Uniforms.helpMat.setFrom(camera.V);iron_object_Uniforms.helpMat.multmat(camera.P);iron_object_Uniforms.helpMat.getInverse(iron_object_Uniforms.helpMat);m=iron_object_Uniforms.helpMat}else if(c.link=="_viewProjectionMatrix"){m=camera.VP}else if(c.link=="_prevViewProjectionMatrix"){iron_object_Uniforms.helpMat.setFrom(camera.prevV);iron_object_Uniforms.helpMat.multmat(camera.P);m=iron_object_Uniforms.helpMat}else if(c.link=="_lightViewProjectionMatrix"){if(light!=null){m=light.VP}}else if(c.link=="_biasLightViewProjectionMatrix"){if(light!=null){iron_object_Uniforms.helpMat.setFrom(light.VP);iron_object_Uniforms.helpMat.multmat(iron_object_Uniforms.biasMat);m=iron_object_Uniforms.helpMat}}else if(c.link=="_lightVolumeWorldViewProjectionMatrix"){if(light!=null){var tr=light.transform;var type=light.data.raw.type;if(type=="spot"){iron_object_Uniforms.helpVec.set(tr.worldx(),tr.worldy(),tr.worldz());var f2=2;iron_object_Uniforms.helpVec2.set(light.data.raw.far_plane,light.data.raw.far_plane*f2,light.data.raw.far_plane*f2);iron_object_Uniforms.helpMat.compose(iron_object_Uniforms.helpVec,iron_object_Uniforms.helpQuat,iron_object_Uniforms.helpVec2)}else if(type=="point"||type=="area"){iron_object_Uniforms.helpVec.set(tr.worldx(),tr.worldy(),tr.worldz());var f21=2;iron_object_Uniforms.helpVec2.set(light.data.raw.far_plane,light.data.raw.far_plane*f21,light.data.raw.far_plane*f21);iron_object_Uniforms.helpMat.compose(iron_object_Uniforms.helpVec,iron_object_Uniforms.helpQuat,iron_object_Uniforms.helpVec2)}iron_object_Uniforms.helpMat.multmat(camera.V);iron_object_Uniforms.helpMat.multmat(camera.P);m=iron_object_Uniforms.helpMat}}else if(c.link=="_skydomeMatrix"){var tr1=camera.transform;iron_object_Uniforms.helpVec.set(tr1.worldx(),tr1.worldy(),tr1.worldz()-3.5);var bounds=camera.data.raw.far_plane*.95;iron_object_Uniforms.helpVec2.set(bounds,bounds,bounds);iron_object_Uniforms.helpMat.compose(iron_object_Uniforms.helpVec,iron_object_Uniforms.helpQuat,iron_object_Uniforms.helpVec2);iron_object_Uniforms.helpMat.multmat(camera.V);iron_object_Uniforms.helpMat.multmat(camera.P);m=iron_object_Uniforms.helpMat}else if(c.link=="_lightViewMatrix"){if(light!=null){m=light.V}}else if(c.link=="_lightProjectionMatrix"){if(light!=null){m=light.P}}if(m!=null){g.setMatrix(location,m.self);return true}}else if(c.type=="vec4"){var v=null;iron_object_Uniforms.helpVec.set(0,0,0);if(v!=null){g.setFloat4(location,v.x,v.y,v.z,v.w);return true}}else if(c.type=="vec3"){var v1=null;iron_object_Uniforms.helpVec.set(0,0,0);if(c.link=="_lightPosition"){if(light!=null){iron_object_Uniforms.helpVec.set(light.transform.worldx(),light.transform.worldy(),light.transform.worldz());v1=iron_object_Uniforms.helpVec}}else if(c.link=="_lightDirection"){if(light!=null){iron_object_Uniforms.helpVec=light.look().normalize();v1=iron_object_Uniforms.helpVec}}else if(c.link=="_lightColor"){if(light!=null){var str=light.visible?light.data.raw.strength:0;iron_object_Uniforms.helpVec.set(light.data.raw.color[0]*str,light.data.raw.color[1]*str,light.data.raw.color[2]*str);v1=iron_object_Uniforms.helpVec}}else if(c.link=="_sunDirection"){var sun=iron_RenderPath.active.sun;if(sun!=null){iron_object_Uniforms.helpVec=sun.look().normalize();v1=iron_object_Uniforms.helpVec}}else if(c.link=="_sunColor"){var sun1=iron_RenderPath.active.sun;if(sun1!=null){var str1=sun1.visible?sun1.data.raw.strength:0;iron_object_Uniforms.helpVec.set(sun1.data.raw.color[0]*str1,sun1.data.raw.color[1]*str1,sun1.data.raw.color[2]*str1);v1=iron_object_Uniforms.helpVec}}else if(c.link=="_pointPosition"){var point=iron_RenderPath.active.point;if(point!=null){iron_object_Uniforms.helpVec.set(point.transform.worldx(),point.transform.worldy(),point.transform.worldz());v1=iron_object_Uniforms.helpVec}}else if(c.link=="_spotDirection"){var point1=iron_RenderPath.active.point;if(point1!=null){iron_object_Uniforms.helpVec=point1.look().normalize();v1=iron_object_Uniforms.helpVec}}else if(c.link=="_pointColor"){var point2=iron_RenderPath.active.point;if(point2!=null){var str2=point2.visible?point2.data.raw.strength:0;iron_object_Uniforms.helpVec.set(point2.data.raw.color[0]*str2,point2.data.raw.color[1]*str2,point2.data.raw.color[2]*str2);v1=iron_object_Uniforms.helpVec}}else if(c.link=="_cameraPosition"){iron_object_Uniforms.helpVec.set(camera.transform.worldx(),camera.transform.worldy(),camera.transform.worldz());v1=iron_object_Uniforms.helpVec}else if(c.link=="_cameraLook"){iron_object_Uniforms.helpVec=camera.lookWorld().normalize();v1=iron_object_Uniforms.helpVec}else if(c.link=="_cameraUp"){iron_object_Uniforms.helpVec=camera.upWorld().normalize();v1=iron_object_Uniforms.helpVec}else if(c.link=="_cameraRight"){iron_object_Uniforms.helpVec=camera.rightWorld().normalize();v1=iron_object_Uniforms.helpVec}else if(c.link=="_backgroundCol"){if(camera.data.raw.clear_color!=null){iron_object_Uniforms.helpVec.set(camera.data.raw.clear_color[0],camera.data.raw.clear_color[1],camera.data.raw.clear_color[2])}v1=iron_object_Uniforms.helpVec}else if(c.link=="_hosekSunDirection"){var w=iron_Scene.active.world;if(w!=null){iron_object_Uniforms.helpVec.set(w.raw.sun_direction[0],w.raw.sun_direction[1],w.raw.sun_direction[2]);v1=iron_object_Uniforms.helpVec}}if(v1!=null){g.setFloat3(location,v1.x,v1.y,v1.z);return true}}else if(c.type=="vec2"){var v2=null;iron_object_Uniforms.helpVec.set(0,0,0);if(c.link=="_vec2x"){v2=iron_object_Uniforms.helpVec;v2.x=1;v2.y=0}else if(c.link=="_vec2xInv"){v2=iron_object_Uniforms.helpVec;v2.x=1/iron_RenderPath.active.currentW;v2.y=0}else if(c.link=="_vec2x2"){v2=iron_object_Uniforms.helpVec;v2.x=2;v2.y=0}else if(c.link=="_vec2x2Inv"){v2=iron_object_Uniforms.helpVec;v2.x=2/iron_RenderPath.active.currentW;v2.y=0}else if(c.link=="_vec2y"){v2=iron_object_Uniforms.helpVec;v2.x=0;v2.y=1}else if(c.link=="_vec2yInv"){v2=iron_object_Uniforms.helpVec;v2.x=0;v2.y=1/iron_RenderPath.active.currentH}else if(c.link=="_vec2y2"){v2=iron_object_Uniforms.helpVec;v2.x=0;v2.y=2}else if(c.link=="_vec2y2Inv"){v2=iron_object_Uniforms.helpVec;v2.x=0;v2.y=2/iron_RenderPath.active.currentH}else if(c.link=="_vec2y3"){v2=iron_object_Uniforms.helpVec;v2.x=0;v2.y=3}else if(c.link=="_vec2y3Inv"){v2=iron_object_Uniforms.helpVec;v2.x=0;v2.y=3/iron_RenderPath.active.currentH}else if(c.link=="_windowSize"){v2=iron_object_Uniforms.helpVec;v2.x=iron_App.w();v2.y=iron_App.h()}else if(c.link=="_windowSizeInv"){v2=iron_object_Uniforms.helpVec;v2.x=1/iron_App.w();v2.y=1/iron_App.h()}else if(c.link=="_screenSize"){v2=iron_object_Uniforms.helpVec;v2.x=iron_RenderPath.active.currentW;v2.y=iron_RenderPath.active.currentH}else if(c.link=="_screenSizeInv"){v2=iron_object_Uniforms.helpVec;v2.x=1/iron_RenderPath.active.currentW;v2.y=1/iron_RenderPath.active.currentH}else if(c.link=="_aspectRatio"){v2=iron_object_Uniforms.helpVec;v2.x=iron_RenderPath.active.currentH/iron_RenderPath.active.currentW;v2.y=iron_RenderPath.active.currentW/iron_RenderPath.active.currentH;v2.x=v2.x>1?1:v2.x;v2.y=v2.y>1?1:v2.y}else if(c.link=="_cameraPlane"){v2=iron_object_Uniforms.helpVec;v2.x=camera.data.raw.near_plane;v2.y=camera.data.raw.far_plane}else if(c.link=="_cameraPlaneProj"){var near=camera.data.raw.near_plane;var far=camera.data.raw.far_plane;v2=iron_object_Uniforms.helpVec;v2.x=far/(far-near);v2.y=-far*near/(far-near)}else if(c.link=="_lightPlane"){if(light!=null){v2=iron_object_Uniforms.helpVec;v2.x=light.data.raw.near_plane;v2.y=light.data.raw.far_plane}}else if(c.link=="_lightPlaneProj"){if(light!=null){var near1=light.data.raw.near_plane;var far1=light.data.raw.far_plane;var a=far1+near1;var b=far1-near1;var f22=2;var c1=f22*far1*near1;v2=iron_object_Uniforms.helpVec;v2.x=a/b;v2.y=c1/b}}else if(c.link=="_spotData"){var point3=iron_RenderPath.active.point;if(point3!=null){v2=iron_object_Uniforms.helpVec;v2.x=point3.data.raw.spot_size;v2.y=v2.x-point3.data.raw.spot_blend}}else if(c.link=="_shadowMapSize"){if(light!=null&&light.data.raw.cast_shadow){v2=iron_object_Uniforms.helpVec;v2.x=v2.y=light.data.raw.shadowmap_size}}if(v2!=null){g.setFloat2(location,v2.x,v2.y);return true}}else if(c.type=="float"){var f=null;if(c.link=="_time"){f=iron_system_Time.time()}else if(c.link=="_deltaTime"){f=iron_system_Time.get_delta()}else if(c.link=="_lightRadius"){f=light==null?0:light.data.raw.far_plane}else if(c.link=="_lightShadowsBias"){f=light==null?0:light.data.raw.shadows_bias}else if(c.link=="_sunShadowsBias"){var sun2=iron_RenderPath.active.sun;f=sun2==null?0:sun2.data.raw.shadows_bias}else if(c.link=="_pointShadowsBias"){var point4=iron_RenderPath.active.point;f=point4==null?0:point4.data.raw.shadows_bias}else if(c.link=="_lightSize"){if(light!=null&&light.data.raw.light_size!=null){f=light.data.raw.light_size}}else if(c.link=="_envmapStrength"){f=iron_Scene.active.world==null?0:iron_Scene.active.world.probe.raw.strength}else if(c.link=="_aspectRatioF"){f=iron_RenderPath.active.currentW/iron_RenderPath.active.currentH}else if(c.link=="_aspectRatioWindowF"){f=iron_App.w()/iron_App.h()}else if(c.link=="_frameScale"){f=iron_RenderPath.active.frameTime/iron_system_Time.get_delta()}if(f!=null){g.setFloat(location,f);return true}}else if(c.type=="floats"){var fa=null;if(c.link=="_envmapIrradiance"){fa=iron_Scene.active.world==null?iron_data_WorldData.getEmptyIrradiance():iron_Scene.active.world.probe.irradiance}if(fa!=null){g.setFloats(location,fa);return true}}else if(c.type=="int"){var i=null;if(c.link=="_lightCastShadow"){if(light!=null&&light.data.raw.cast_shadow){i=light.data.raw.shadowmap_cube?2:1}else{i=0}}else if(c.link=="_envmapNumMipmaps"){var w1=iron_Scene.active.world;i=w1!=null?w1.probe.raw.radiance_mipmaps+1-2:1}if(i!=null){g.setInt(location,i);return true}}return false};iron_object_Uniforms.setObjectConstant=function(g,object,location,c){if(c.link==null){return}var camera=iron_Scene.active.camera;var light=iron_RenderPath.active.light;if(c.type=="mat4"){var m=null;if(c.link=="_worldMatrix"){m=object.transform.worldUnpack}else if(c.link=="_inverseWorldMatrix"){iron_object_Uniforms.helpMat.getInverse(object.transform.worldUnpack);m=iron_object_Uniforms.helpMat}else if(c.link=="_worldViewProjectionMatrix"){iron_object_Uniforms.helpMat.setFrom(object.transform.worldUnpack);iron_object_Uniforms.helpMat.multmat(camera.V);iron_object_Uniforms.helpMat.multmat(camera.P);m=iron_object_Uniforms.helpMat}else if(c.link=="_worldViewProjectionMatrixSphere"){iron_object_Uniforms.helpMat.setFrom(object.transform.worldUnpack);iron_object_Uniforms.helpMat.multmat(camera.V);iron_object_Uniforms.helpMat.set__00(1);iron_object_Uniforms.helpMat.set__10(0);iron_object_Uniforms.helpMat.set__20(0);iron_object_Uniforms.helpMat.set__01(0);iron_object_Uniforms.helpMat.set__11(1);iron_object_Uniforms.helpMat.set__21(0);iron_object_Uniforms.helpMat.set__02(0);iron_object_Uniforms.helpMat.set__12(0);iron_object_Uniforms.helpMat.set__22(1);iron_object_Uniforms.helpMat.multmat(camera.P);m=iron_object_Uniforms.helpMat}else if(c.link=="_worldViewProjectionMatrixCylinder"){iron_object_Uniforms.helpMat.setFrom(object.transform.worldUnpack);iron_object_Uniforms.helpMat.multmat(camera.V);iron_object_Uniforms.helpMat.set__00(1);iron_object_Uniforms.helpMat.set__20(0);iron_object_Uniforms.helpMat.set__01(0);iron_object_Uniforms.helpMat.set__21(0);iron_object_Uniforms.helpMat.set__02(0);iron_object_Uniforms.helpMat.set__22(1);iron_object_Uniforms.helpMat.multmat(camera.P);m=iron_object_Uniforms.helpMat}else if(c.link=="_worldViewMatrix"){iron_object_Uniforms.helpMat.setFrom(object.transform.worldUnpack);iron_object_Uniforms.helpMat.multmat(camera.V);m=iron_object_Uniforms.helpMat}else if(c.link=="_lightWorldViewProjectionMatrix"){if(light!=null){if(object==null){iron_object_Uniforms.helpMat.setIdentity()}else{iron_object_Uniforms.helpMat.setFrom(object.transform.worldUnpack)}iron_object_Uniforms.helpMat.multmat(light.VP);m=iron_object_Uniforms.helpMat}}else if(c.link=="_lightWorldViewProjectionMatrixSphere"){if(light!=null){iron_object_Uniforms.helpMat.setFrom(object.transform.worldUnpack);iron_object_Uniforms.helpMat.multmat(camera.V);iron_object_Uniforms.helpMat.set__00(1);iron_object_Uniforms.helpMat.set__10(0);iron_object_Uniforms.helpMat.set__20(0);iron_object_Uniforms.helpMat.set__01(0);iron_object_Uniforms.helpMat.set__11(1);iron_object_Uniforms.helpMat.set__21(0);iron_object_Uniforms.helpMat.set__02(0);iron_object_Uniforms.helpMat.set__12(0);iron_object_Uniforms.helpMat.set__22(1);iron_object_Uniforms.helpMat2.getInverse(camera.V);iron_object_Uniforms.helpMat.multmat(iron_object_Uniforms.helpMat2);iron_object_Uniforms.helpMat.multmat(light.VP);m=iron_object_Uniforms.helpMat}}else if(c.link=="_lightWorldViewProjectionMatrixCylinder"){if(light!=null){iron_object_Uniforms.helpMat.setFrom(object.transform.worldUnpack);iron_object_Uniforms.helpMat.multmat(camera.V);iron_object_Uniforms.helpMat.set__00(1);iron_object_Uniforms.helpMat.set__20(0);iron_object_Uniforms.helpMat.set__01(0);iron_object_Uniforms.helpMat.set__21(0);iron_object_Uniforms.helpMat.set__02(0);iron_object_Uniforms.helpMat.set__22(1);iron_object_Uniforms.helpMat2.getInverse(camera.V);iron_object_Uniforms.helpMat.multmat(iron_object_Uniforms.helpMat2);iron_object_Uniforms.helpMat.multmat(light.VP);m=iron_object_Uniforms.helpMat}}else if(c.link=="_biasLightWorldViewProjectionMatrix"){if(light!=null){if(object==null){iron_object_Uniforms.helpMat.setIdentity()}else{iron_object_Uniforms.helpMat.setFrom(object.transform.worldUnpack)}iron_object_Uniforms.helpMat.multmat(light.VP);iron_object_Uniforms.helpMat.multmat(iron_object_Uniforms.biasMat);m=iron_object_Uniforms.helpMat}}else if(StringTools.startsWith(c.link,"_biasLightWorldViewProjectionMatrixSpot")){var light1=iron_object_Uniforms.getSpot(HxOverrides.cca(c.link,c.link.length-1)-48);if(light1!=null){if(object==null){iron_object_Uniforms.helpMat.setIdentity()}else{iron_object_Uniforms.helpMat.setFrom(object.transform.worldUnpack)}iron_object_Uniforms.helpMat.multmat(light1.VP);iron_object_Uniforms.helpMat.multmat(iron_object_Uniforms.biasMat);m=iron_object_Uniforms.helpMat}}else if(StringTools.startsWith(c.link,"_biasLightViewProjectionMatrixSpot")){var light2=iron_object_Uniforms.getSpot(HxOverrides.cca(c.link,c.link.length-1)-48);if(light2!=null){iron_object_Uniforms.helpMat.setFrom(light2.VP);iron_object_Uniforms.helpMat.multmat(iron_object_Uniforms.biasMat);m=iron_object_Uniforms.helpMat}}else if(iron_object_Uniforms.externalMat4Links!=null){var _g=0;var _g1=iron_object_Uniforms.externalMat4Links;while(_g<_g1.length){var fn=_g1[_g];++_g;m=fn(object,iron_object_Uniforms.currentMat(object),c.link);if(m!=null){break}}}if(m==null){return}g.setMatrix(location,m.self)}else if(c.type=="mat3"){var m1=null;if(c.link=="_normalMatrix"){iron_object_Uniforms.helpMat.setFrom(object.transform.world);iron_object_Uniforms.helpMat.getInverse(iron_object_Uniforms.helpMat);iron_object_Uniforms.helpMat.transpose3x3();iron_object_Uniforms.helpMat3.setFrom4(iron_object_Uniforms.helpMat);m1=iron_object_Uniforms.helpMat3}if(c.link=="_viewMatrix3"){iron_object_Uniforms.helpMat3.setFrom4(camera.V);m1=iron_object_Uniforms.helpMat3}if(m1==null){return}g.setMatrix3(location,m1.self)}else if(c.type=="vec4"){var v=null;iron_object_Uniforms.helpVec.set(0,0,0);if(iron_object_Uniforms.externalVec4Links!=null){var _g2=0;var _g11=iron_object_Uniforms.externalVec4Links;while(_g2<_g11.length){var fn1=_g11[_g2];++_g2;v=fn1(object,iron_object_Uniforms.currentMat(object),c.link);if(v!=null){break}}}if(v==null){return}g.setFloat4(location,v.x,v.y,v.z,v.w)}else if(c.type=="vec3"){var v1=null;iron_object_Uniforms.helpVec.set(0,0,0);if(c.link=="_dim"){var d=object.transform.dim;var s=object.transform.scale;iron_object_Uniforms.helpVec.set(d.x/s.x,d.y/s.y,d.z/s.z);v1=iron_object_Uniforms.helpVec}else if(c.link=="_halfDim"){var d1=object.transform.dim;var s1=object.transform.scale;iron_object_Uniforms.helpVec.set(d1.x/s1.x/2,d1.y/s1.y/2,d1.z/s1.z/2);v1=iron_object_Uniforms.helpVec}else if(iron_object_Uniforms.externalVec3Links!=null){var _g3=0;var _g12=iron_object_Uniforms.externalVec3Links;while(_g3<_g12.length){var f=_g12[_g3];++_g3;v1=f(object,iron_object_Uniforms.currentMat(object),c.link);if(v1!=null){break}}}if(v1==null){return}g.setFloat3(location,v1.x,v1.y,v1.z)}else if(c.type=="vec2"){var vx=null;var vy=0;if(c.link=="_tilesheetOffset"){var ts=js_Boot.__cast(object,iron_object_MeshObject).tilesheet;vx=ts.tileX;vy=ts.tileY}else if(iron_object_Uniforms.externalVec2Links!=null){var _g4=0;var _g13=iron_object_Uniforms.externalVec2Links;while(_g4<_g13.length){var fn2=_g13[_g4];++_g4;var v2=fn2(object,iron_object_Uniforms.currentMat(object),c.link);if(v2!=null){vx=v2.x;vy=v2.y;break}}}if(vx==null){return}g.setFloat2(location,vx,vy)}else if(c.type=="float"){var f1=null;if(c.link=="_objectInfoIndex"){f1=object.uid}else if(c.link=="_objectInfoMaterialIndex"){f1=iron_object_Uniforms.currentMat(object).uid}else if(c.link=="_objectInfoRandom"){f1=object.urandom}else if(c.link=="_posUnpack"){f1=iron_object_Uniforms.posUnpack!=null?iron_object_Uniforms.posUnpack:1}else if(c.link=="_texUnpack"){f1=iron_object_Uniforms.texUnpack!=null?iron_object_Uniforms.texUnpack:1}else if(iron_object_Uniforms.externalFloatLinks!=null){var _g5=0;var _g14=iron_object_Uniforms.externalFloatLinks;while(_g5<_g14.length){var fn3=_g14[_g5];++_g5;var res=fn3(object,iron_object_Uniforms.currentMat(object),c.link);if(res!=null){f1=res;break}}}if(f1==null){return}g.setFloat(location,f1)}else if(c.type=="floats"){var fa=null;if(fa==null&&iron_object_Uniforms.externalFloatsLinks!=null){var _g6=0;var _g15=iron_object_Uniforms.externalFloatsLinks;while(_g6<_g15.length){var fn4=_g15[_g6];++_g6;fa=fn4(object,iron_object_Uniforms.currentMat(object),c.link);if(fa!=null){break}}}if(fa==null){return}g.setFloats(location,fa)}else if(c.type=="int"){var i=null;if(c.link=="_uid"){i=object.uid}else if(iron_object_Uniforms.externalIntLinks!=null){var _g7=0;var _g16=iron_object_Uniforms.externalIntLinks;while(_g7<_g16.length){var fn5=_g16[_g7];++_g7;var res1=fn5(object,iron_object_Uniforms.currentMat(object),c.link);if(res1!=null){i=res1;break}}}if(i==null){return}g.setInt(location,i)}};iron_object_Uniforms.setMaterialConstants=function(g,context,materialContext){if(materialContext.raw.bind_constants!=null){var _g=0;var _g1=materialContext.raw.bind_constants.length;while(_g<_g1){var i=_g++;var matc=materialContext.raw.bind_constants[i];var pos=-1;var _g2=0;var _g11=context.raw.constants.length;while(_g2<_g11){var i1=_g2++;if(context.raw.constants[i1].name==matc.name){pos=i1;break}}if(pos==-1){continue}var c=context.raw.constants[pos];iron_object_Uniforms.setMaterialConstant(g,context.constants[pos],c,matc)}}if(materialContext.textures!=null){var _g3=0;var _g12=materialContext.textures.length;while(_g3<_g12){var i2=_g3++;var mname=materialContext.raw.bind_textures[i2].name;var _g4=0;var _g13=context.textureUnits.length;while(_g4<_g13){var j=_g4++;var sname=context.raw.texture_units[j].name;if(mname==sname){g.setTexture(context.textureUnits[j],materialContext.textures[i2]);materialContext.setTextureParameters(g,i2,context,j);break}}}}};iron_object_Uniforms.getSpot=function(index){var i=0;var _g=0;var _g1=iron_Scene.active.lights;while(_g<_g1.length){var l=_g1[_g];++_g;if(l.data.raw.type!="spot"){continue}if(i==index){return l}++i}return null};iron_object_Uniforms.currentMat=function(object){if(object!=null&&object instanceof iron_object_MeshObject){return js_Boot.__cast(object,iron_object_MeshObject).materials[0]}return null};iron_object_Uniforms.setMaterialConstant=function(g,location,c,matc){switch(c.type){case"bool":g.setBool(location,matc.bool);break;case"float":g.setFloat(location,matc.float);break;case"int":g.setInt(location,matc.int);break;case"vec2":g.setFloat2(location,matc.vec2[0],matc.vec2[1]);break;case"vec3":g.setFloat3(location,matc.vec3[0],matc.vec3[1],matc.vec3[2]);break;case"vec4":g.setFloat4(location,matc.vec4[0],matc.vec4[1],matc.vec4[2],matc.vec4[3]);break}};var iron_system_ArmPack=function(){};$hxClasses["iron.system.ArmPack"]=iron_system_ArmPack;iron_system_ArmPack.__name__=true;iron_system_ArmPack.decode=function(b){var i=new haxe_io_BytesInput(b);i.set_bigEndian(false);return iron_system_ArmPack.read(i)};iron_system_ArmPack.read=function(i,key,parentKey){if(parentKey==null){parentKey=""}if(key==null){key=""}try{var b=i.readByte();switch(b){case 192:return null;case 194:return false;case 195:return true;case 196:return i.read(i.readByte());case 197:return i.read(i.readUInt16());case 198:return i.read(i.readInt32());case 202:return i.readFloat();case 204:return i.readByte();case 205:return i.readUInt16();case 206:return i.readInt32();case 208:return i.readInt8();case 209:return i.readInt16();case 210:return i.readInt32();case 217:return i.readString(i.readByte());case 218:return i.readString(i.readUInt16());case 219:return i.readString(i.readInt32());case 220:return iron_system_ArmPack.readArray(i,i.readUInt16(),key,parentKey);case 221:return iron_system_ArmPack.readArray(i,i.readInt32(),key,parentKey);case 222:return iron_system_ArmPack.readMap(i,i.readUInt16(),key,parentKey);case 223:return iron_system_ArmPack.readMap(i,i.readInt32(),key,parentKey);default:if(b<128){return b}else if(b<144){return iron_system_ArmPack.readMap(i,15&b,key,parentKey)}else if(b<160){return iron_system_ArmPack.readArray(i,15&b,key,parentKey)}else if(b<192){return i.readString(31&b)}else if(b>223){return-256|b}}}catch(e){var e1=e instanceof js__$Boot_HaxeError?e.val:e;if(e1 instanceof haxe_io_Eof){var e2=e1}else{throw e}}return null};iron_system_ArmPack.readArray=function(i,length,key,parentKey){if(parentKey==null){parentKey=""}if(key==null){key=""}var b=i.readByte();var _g=i;_g.set_position(_g.get_position()-1);if(b==202){var _g1=i;_g1.set_position(_g1.get_position()+1);var this1=new Float32Array(length);var a=this1;var _g2=0;var _g11=length;while(_g2<_g11){var x=_g2++;a[x]=i.readFloat()}return a}else if(b==210){var _g3=i;_g3.set_position(_g3.get_position()+1);var this2=new Uint32Array(length);var a1=this2;var _g4=0;var _g12=length;while(_g4<_g12){var x1=_g4++;a1[x1]=i.readInt32()}return a1}else if(b==209){var _g5=i;_g5.set_position(_g5.get_position()+1);var this3=new Int16Array(length);var a2=this3;var _g6=0;var _g13=length;while(_g6<_g13){var x2=_g6++;a2[x2]=i.readInt16()}return a2}else{var a3=[];var _g7=0;var _g14=length;while(_g7<_g14){var x3=_g7++;a3.push(iron_system_ArmPack.read(i,key,parentKey))}return a3}};iron_system_ArmPack.readMap=function(i,length,key,parentKey){if(parentKey==null){parentKey=""}if(key==null){key=""}var out={};var _g=0;var _g1=length;while(_g<_g1){var n=_g++;var k=Std.string(iron_system_ArmPack.read(i));var v=iron_system_ArmPack.read(i,k,key);Reflect.setField(out,k,v)}return out};var iron_system_Audio=function(){};$hxClasses["iron.system.Audio"]=iron_system_Audio;iron_system_Audio.__name__=true;iron_system_Audio.play=function(sound,loop,stream){if(stream==null){stream=false}if(loop==null){loop=false}return null};var iron_system_Input=function(){};$hxClasses["iron.system.Input"]=iron_system_Input;iron_system_Input.__name__=true;iron_system_Input.reset=function(){iron_system_Input.occupied=false;if(iron_system_Input.mouse!=null){iron_system_Input.mouse.reset()}if(iron_system_Input.pen!=null){iron_system_Input.pen.reset()}if(iron_system_Input.keyboard!=null){iron_system_Input.keyboard.reset()}var _g=0;var _g1=iron_system_Input.gamepads;while(_g<_g1.length){var gamepad=_g1[_g];++_g;gamepad.reset()}};iron_system_Input.endFrame=function(){if(iron_system_Input.mouse!=null){iron_system_Input.mouse.endFrame()}if(iron_system_Input.pen!=null){iron_system_Input.pen.endFrame()}if(iron_system_Input.keyboard!=null){iron_system_Input.keyboard.endFrame()}var _g=0;var _g1=iron_system_Input.gamepads;while(_g<_g1.length){var gamepad=_g1[_g];++_g;gamepad.endFrame()}if(iron_system_Input.virtualButtons!=null){var vb=iron_system_Input.virtualButtons.iterator();while(vb.hasNext()){var vb1=vb.next();vb1.started=vb1.released=false}}};iron_system_Input.getMouse=function(){if(!iron_system_Input.registered){iron_system_Input.register()}if(iron_system_Input.mouse==null){iron_system_Input.mouse=new iron_system_Mouse}return iron_system_Input.mouse};iron_system_Input.getKeyboard=function(){if(!iron_system_Input.registered){iron_system_Input.register()}if(iron_system_Input.keyboard==null){iron_system_Input.keyboard=new iron_system_Keyboard}return iron_system_Input.keyboard};iron_system_Input.register=function(){iron_system_Input.registered=true;iron_App.notifyOnEndFrame(iron_system_Input.endFrame);iron_App.notifyOnReset(iron_system_Input.reset)};var iron_system_VirtualButton=function(){this.down=false;this.released=false;this.started=false};$hxClasses["iron.system.VirtualButton"]=iron_system_VirtualButton;iron_system_VirtualButton.__name__=true;iron_system_VirtualButton.prototype={__class__:iron_system_VirtualButton};var iron_system_VirtualInput=function(){this.virtualButtons=null};$hxClasses["iron.system.VirtualInput"]=iron_system_VirtualInput;iron_system_VirtualInput.__name__=true;iron_system_VirtualInput.prototype={downVirtual:function(button){if(this.virtualButtons!=null){var vb=this.virtualButtons.get(button);if(vb!=null){vb.down=true;vb.started=true}}},upVirtual:function(button){if(this.virtualButtons!=null){var vb=this.virtualButtons.get(button);if(vb!=null){vb.down=false;vb.released=true}}},__class__:iron_system_VirtualInput};var iron_system_Mouse=function(){this.lastY=-1;this.lastX=-1;this.locked=false;this.wheelDelta=0;this.movementY=0;this.movementX=0;this.moved=false;this.y=0;this.x=0;this.buttonsReleased=[false,false,false];this.buttonsStarted=[false,false,false];this.buttonsDown=[false,false,false];iron_system_VirtualInput.call(this);kha_input_Mouse.get().notify($bind(this,this.downListener),$bind(this,this.upListener),$bind(this,this.moveListener),$bind(this,this.wheelListener))};$hxClasses["iron.system.Mouse"]=iron_system_Mouse;iron_system_Mouse.__name__=true;iron_system_Mouse.__super__=iron_system_VirtualInput;iron_system_Mouse.prototype=$extend(iron_system_VirtualInput.prototype,{endFrame:function(){var tmp=this.buttonsStarted[1]=this.buttonsStarted[2]=false;this.buttonsStarted[0]=tmp;var tmp1=this.buttonsReleased[1]=this.buttonsReleased[2]=false;this.buttonsReleased[0]=tmp1;this.moved=false;this.movementX=0;this.movementY=0;this.wheelDelta=0},reset:function(){var tmp=this.buttonsDown[1]=this.buttonsDown[2]=false;this.buttonsDown[0]=tmp;this.endFrame()},buttonIndex:function(button){if(button=="left"){return 0}else if(button=="right"){return 1}else{return 2}},released:function(button){if(button==null){button="left"}return this.buttonsReleased[this.buttonIndex(button)]},downListener:function(index,x,y){this.buttonsDown[index]=true;this.buttonsStarted[index]=true;this.x=x-iron_App.x();this.y=y-iron_App.y();if(index==0){this.lastX=x;this.lastY=y}this.downVirtual(iron_system_Mouse.buttons[index])},upListener:function(index,x,y){this.buttonsDown[index]=false;this.buttonsReleased[index]=true;this.x=x-iron_App.x();this.y=y-iron_App.y();this.upVirtual(iron_system_Mouse.buttons[index])},moveListener:function(x,y,movementX,movementY){if(this.lastX==-1&&this.lastY==-1){this.lastX=x;this.lastY=y}if(this.locked){this.movementX=movementX;this.movementY=movementY}else{this.movementX=x-this.lastX;this.movementY=y-this.lastY}this.lastX=x;this.lastY=y;this.x=x-iron_App.x();this.y=y-iron_App.y();this.moved=true},wheelListener:function(delta){this.wheelDelta=delta},__class__:iron_system_Mouse});var iron_system_Pen=function(){this.lastY=-1;this.lastX=-1;this.pressure=0;this.movementY=0;this.movementX=0;this.moved=false;this.y=0;this.x=0;this.buttonsReleased=[false];this.buttonsStarted=[false];this.buttonsDown=[false];iron_system_VirtualInput.call(this);kha_input_Pen.get().notify($bind(this,this.downListener),$bind(this,this.upListener),$bind(this,this.moveListener))};$hxClasses["iron.system.Pen"]=iron_system_Pen;iron_system_Pen.__name__=true;iron_system_Pen.__super__=iron_system_VirtualInput;iron_system_Pen.prototype=$extend(iron_system_VirtualInput.prototype,{endFrame:function(){this.buttonsStarted[0]=false;this.buttonsReleased[0]=false;this.moved=false;this.movementX=0;this.movementY=0},reset:function(){this.buttonsDown[0]=false;this.endFrame()},downListener:function(x,y,pressure){this.buttonsDown[0]=true;this.buttonsStarted[0]=true;this.x=x-iron_App.x();this.y=y-iron_App.y();this.pressure=pressure},upListener:function(x,y,pressure){this.buttonsDown[0]=false;this.buttonsReleased[0]=true;this.x=x-iron_App.x();this.y=y-iron_App.y();this.pressure=pressure},moveListener:function(x,y,pressure){if(this.lastX==-1&&this.lastY==-1){this.lastX=x;this.lastY=y}this.movementX=x-this.lastX;this.movementY=y-this.lastY;this.lastX=x;this.lastY=y;this.x=x-iron_App.x();this.y=y-iron_App.y();this.moved=true;this.pressure=pressure},__class__:iron_system_Pen});var iron_system_Keyboard=function(){this.keysFrame=[];this.keysReleased=new haxe_ds_StringMap;this.keysStarted=new haxe_ds_StringMap;this.keysDown=new haxe_ds_StringMap;iron_system_VirtualInput.call(this);this.reset();kha_input_Keyboard.get().notify($bind(this,this.downListener),$bind(this,this.upListener),$bind(this,this.pressListener))};$hxClasses["iron.system.Keyboard"]=iron_system_Keyboard;iron_system_Keyboard.__name__=true;iron_system_Keyboard.keyCode=function(key){if(key==32){return"space"}else if(key==8){return"backspace"}else if(key==9){return"tab"}else if(key==13){return"enter"}else if(key==16){return"shift"}else if(key==17){return"control"}else if(key==18){return"alt"}else if(key==27){return"escape"}else if(key==46){return"delete"}else if(key==38){return"up"}else if(key==40){return"down"}else if(key==37){return"left"}else if(key==39){return"right"}else if(key==1){return"back"}else if(key==188){return"comma"}else if(key==190){return"period"}else if(key==48){return"0"}else if(key==49){return"1"}else if(key==50){return"2"}else if(key==51){return"3"}else if(key==52){return"4"}else if(key==53){return"5"}else if(key==54){return"6"}else if(key==55){return"7"}else if(key==56){return"8"}else if(key==57){return"9"}else if(key==112){return"f1"}else if(key==113){return"f2"}else if(key==114){return"f3"}else if(key==115){return"f4"}else if(key==116){return"f5"}else if(key==117){return"f6"}else if(key==118){return"f7"}else if(key==119){return"f8"}else if(key==120){return"f9"}else if(key==121){return"f10"}else if(key==122){return"f11"}else if(key==123){return"f12"}else{return String.fromCodePoint(key).toLowerCase()}};iron_system_Keyboard.__super__=iron_system_VirtualInput;iron_system_Keyboard.prototype=$extend(iron_system_VirtualInput.prototype,{endFrame:function(){if(this.keysFrame.length>0){var _g=0;var _g1=this.keysFrame;while(_g<_g1.length){var s=_g1[_g];++_g;this.keysStarted.set(s,false);this.keysReleased.set(s,false)}this.keysFrame.splice(0,this.keysFrame.length)}},reset:function(){var _g=0;var _g1=iron_system_Keyboard.keys;while(_g<_g1.length){var s=_g1[_g];++_g;this.keysDown.set(s,false);this.keysStarted.set(s,false);this.keysReleased.set(s,false)}this.endFrame()},started:function(key){return this.keysStarted.get(key)},downListener:function(code){var s=iron_system_Keyboard.keyCode(code);this.keysFrame.push(s);this.keysStarted.set(s,true);this.keysDown.set(s,true);this.downVirtual(s)},upListener:function(code){var s=iron_system_Keyboard.keyCode(code);this.keysFrame.push(s);this.keysReleased.set(s,true);this.keysDown.set(s,false);this.upVirtual(s)},pressListener:function(char){},__class__:iron_system_Keyboard});var iron_system_GamepadStick=function(){this.movementY=0;this.movementX=0;this.moved=false;this.lastY=0;this.lastX=0;this.y=0;this.x=0};$hxClasses["iron.system.GamepadStick"]=iron_system_GamepadStick;iron_system_GamepadStick.__name__=true;iron_system_GamepadStick.prototype={__class__:iron_system_GamepadStick};var iron_system_Gamepad=function(i,virtual){if(virtual==null){virtual=false}this.num=0;this.connected=false;this.rightStick=new iron_system_GamepadStick;this.leftStick=new iron_system_GamepadStick;this.buttonsFrame=[];this.buttonsReleased=[];this.buttonsStarted=[];this.buttonsDown=[];iron_system_VirtualInput.call(this);var _g=0;var _g1=iron_system_Gamepad.buttons;while(_g<_g1.length){var s=_g1[_g];++_g;this.buttonsDown.push(0);this.buttonsStarted.push(false);this.buttonsReleased.push(false)}this.num=i;this.reset();if(virtual){this.connected=true}else{this.connect()}};$hxClasses["iron.system.Gamepad"]=iron_system_Gamepad;iron_system_Gamepad.__name__=true;iron_system_Gamepad.__super__=iron_system_VirtualInput;iron_system_Gamepad.prototype=$extend(iron_system_VirtualInput.prototype,{connect:function(){var gamepad=kha_input_Gamepad.get(this.num);if(gamepad==null){return}this.connected=true;gamepad.notify($bind(this,this.axisListener),$bind(this,this.buttonListener))},endFrame:function(){if(this.buttonsFrame.length>0){var _g=0;var _g1=this.buttonsFrame;while(_g<_g1.length){var i=_g1[_g];++_g;this.buttonsStarted[i]=false;this.buttonsReleased[i]=false}this.buttonsFrame.splice(0,this.buttonsFrame.length)}this.leftStick.moved=false;this.leftStick.movementX=0;this.leftStick.movementY=0;this.rightStick.moved=false;this.rightStick.movementX=0;this.rightStick.movementY=0},reset:function(){var _g=0;var _g1=this.buttonsDown.length;while(_g<_g1){var i=_g++;this.buttonsDown[i]=0;this.buttonsStarted[i]=false;this.buttonsReleased[i]=false}this.endFrame()},axisListener:function(axis,value){var stick=axis<=1?this.leftStick:this.rightStick;if(axis==0||axis==2){stick.lastX=stick.x;stick.x=value;stick.movementX=stick.x-stick.lastX}else if(axis==1||axis==3){stick.lastY=stick.y;stick.y=value;stick.movementY=stick.y-stick.lastY}stick.moved=true},buttonListener:function(button,value){this.buttonsFrame.push(button);this.buttonsDown[button]=value;if(value>0){this.buttonsStarted[button]=true}else{this.buttonsReleased[button]=true}if(value==0){this.upVirtual(iron_system_Gamepad.buttons[button])}else if(value==1){this.downVirtual(iron_system_Gamepad.buttons[button])}},__class__:iron_system_Gamepad});var iron_system_Time=function(){};$hxClasses["iron.system.Time"]=iron_system_Time;iron_system_Time.__name__=true;iron_system_Time.__properties__={get_delta:"get_delta"};iron_system_Time.get_delta=function(){return.016666666666666666*iron_system_Time.scale};iron_system_Time.time=function(){return kha_Scheduler.time()};iron_system_Time.realTime=function(){return kha_Scheduler.realTime()};iron_system_Time.update=function(){iron_system_Time.realDelta=iron_system_Time.realTime()-iron_system_Time.last;iron_system_Time.last=iron_system_Time.realTime()};var js__$Boot_HaxeError=function(val){Error.call(this);this.val=val;if(Error.captureStackTrace){Error.captureStackTrace(this,js__$Boot_HaxeError)}};$hxClasses["js._Boot.HaxeError"]=js__$Boot_HaxeError;js__$Boot_HaxeError.__name__=true;js__$Boot_HaxeError.wrap=function(val){if(val instanceof Error){return val}else{return new js__$Boot_HaxeError(val)}};js__$Boot_HaxeError.__super__=Error;js__$Boot_HaxeError.prototype=$extend(Error.prototype,{__class__:js__$Boot_HaxeError});var js_Boot=function(){};$hxClasses["js.Boot"]=js_Boot;js_Boot.__name__=true;js_Boot.isClass=function(o){return o.__name__};js_Boot.isEnum=function(e){return e.__ename__};js_Boot.getClass=function(o){if(o instanceof Array&&o.__enum__==null){return Array}else{var cl=o.__class__;if(cl!=null){return cl}var name=js_Boot.__nativeClassName(o);if(name!=null){return js_Boot.__resolveNativeClass(name)}return null}};js_Boot.__string_rec=function(o,s){if(o==null){return"null"}if(s.length>=5){return"<...>"}var t=typeof o;if(t=="function"&&(js_Boot.isClass(o)||js_Boot.isEnum(o))){t="object"}switch(t){case"function":return"<function>";case"object":if(o.__enum__){var e=$hxEnums[o.__enum__];var n=e.__constructs__[o._hx_index];var con=e[n];if(con.__params__){s+="\t";var tmp=n+"(";var _g=[];var _g1=0;var _g2=con.__params__;while(_g1<_g2.length){var p=_g2[_g1];++_g1;_g.push(js_Boot.__string_rec(o[p],s))}return tmp+_g.join(",")+")"}else{return n}}if(o instanceof Array){var l=o.length;var i;var str="[";s+="\t";var _g3=0;var _g11=l;while(_g3<_g11){var i1=_g3++;str+=(i1>0?",":"")+js_Boot.__string_rec(o[i1],s)}str+="]";return str}var tostr;try{tostr=o.toString}catch(e1){var e2=e1 instanceof js__$Boot_HaxeError?e1.val:e1;return"???"}if(tostr!=null&&tostr!=Object.toString&&typeof tostr=="function"){var s2=o.toString();if(s2!="[object Object]"){return s2}}var k=null;var str1="{\n";s+="\t";var hasp=o.hasOwnProperty!=null;for(var k in o){if(hasp&&!o.hasOwnProperty(k)){continue}if(k=="prototype"||k=="__class__"||k=="__super__"||k=="__interfaces__"||k=="__properties__"){continue}if(str1.length!=2){str1+=", \n"}str1+=s+k+" : "+js_Boot.__string_rec(o[k],s)}s=s.substring(1);str1+="\n"+s+"}";return str1;case"string":return o;default:return String(o)}};js_Boot.__interfLoop=function(cc,cl){if(cc==null){return false}if(cc==cl){return true}var intf=cc.__interfaces__;if(intf!=null){var _g=0;var _g1=intf.length;while(_g<_g1){var i=_g++;var i1=intf[i];if(i1==cl||js_Boot.__interfLoop(i1,cl)){return true}}}return js_Boot.__interfLoop(cc.__super__,cl)};js_Boot.__instanceof=function(o,cl){if(cl==null){return false}switch(cl){case Array:if(o instanceof Array){return o.__enum__==null}else{return false}break;case Bool:return typeof o=="boolean";case Dynamic:return true;case Float:return typeof o=="number";case Int:if(typeof o=="number"){return(o|0)===o}else{return false}break;case String:return typeof o=="string";default:if(o!=null){if(typeof cl=="function"){if(o instanceof cl){return true}if(js_Boot.__interfLoop(js_Boot.getClass(o),cl)){return true}}else if(typeof cl=="object"&&js_Boot.__isNativeObj(cl)){if(o instanceof cl){return true}}}else{return false}if(cl==Class?o.__name__!=null:false){return true}if(cl==Enum?o.__ename__!=null:false){return true}return $hxEnums[o.__enum__]==cl}};js_Boot.__cast=function(o,t){if(js_Boot.__instanceof(o,t)){return o}else{throw new js__$Boot_HaxeError("Cannot cast "+Std.string(o)+" to "+Std.string(t))}};js_Boot.__nativeClassName=function(o){var name=js_Boot.__toStr.call(o).slice(8,-1);if(name=="Object"||name=="Function"||name=="Math"||name=="JSON"){return null}return name};js_Boot.__isNativeObj=function(o){return js_Boot.__nativeClassName(o)!=null};js_Boot.__resolveNativeClass=function(name){return $global[name]};var js_Lib=function(){};$hxClasses["js.Lib"]=js_Lib;js_Lib.__name__=true;js_Lib.__properties__={get_undefined:"get_undefined"};js_Lib.get_undefined=function(){return undefined};var js_html__$ArrayBuffer_ArrayBufferCompat=function(){};$hxClasses["js.html._ArrayBuffer.ArrayBufferCompat"]=js_html__$ArrayBuffer_ArrayBufferCompat;js_html__$ArrayBuffer_ArrayBufferCompat.__name__=true;js_html__$ArrayBuffer_ArrayBufferCompat.sliceImpl=function(begin,end){var u=new Uint8Array(this,begin,end==null?null:end-begin);var resultArray=new Uint8Array(u.byteLength);resultArray.set(u);return resultArray.buffer};var kha__$Assets_ImageList=function(){this.names=[]};$hxClasses["kha._Assets.ImageList"]=kha__$Assets_ImageList;kha__$Assets_ImageList.__name__=true;kha__$Assets_ImageList.prototype={get:function(name){return Reflect.field(this,name)},__class__:kha__$Assets_ImageList};var kha__$Assets_SoundList=function(){this.names=[]};$hxClasses["kha._Assets.SoundList"]=kha__$Assets_SoundList;kha__$Assets_SoundList.__name__=true;kha__$Assets_SoundList.prototype={get:function(name){return Reflect.field(this,name)},__class__:kha__$Assets_SoundList};var kha__$Assets_BlobList=function(){this.names=[]};$hxClasses["kha._Assets.BlobList"]=kha__$Assets_BlobList;kha__$Assets_BlobList.__name__=true;kha__$Assets_BlobList.prototype={get:function(name){return Reflect.field(this,name)},__class__:kha__$Assets_BlobList};var kha__$Assets_FontList=function(){this.names=["font_default"];this.font_defaultDescription={name:"font_default",files:["font_default.ttf"],type:"font"};this.font_defaultName="font_default";this.font_default=null};$hxClasses["kha._Assets.FontList"]=kha__$Assets_FontList;kha__$Assets_FontList.__name__=true;kha__$Assets_FontList.prototype={get:function(name){return Reflect.field(this,name)},font_defaultLoad:function(done,failure){kha_Assets.loadFont("font_default",function(font){done()},kha_Assets.reporter(failure,{fileName:"kha/internal/AssetsBuilder.hx",lineNumber:144,className:"kha._Assets.FontList",methodName:"font_defaultLoad"}),{fileName:"kha/internal/AssetsBuilder.hx",lineNumber:144,className:"kha._Assets.FontList",methodName:"font_defaultLoad"})},font_defaultUnload:function(){this.font_default.unload();this.font_default=null},__class__:kha__$Assets_FontList};var kha__$Assets_VideoList=function(){this.names=[]};$hxClasses["kha._Assets.VideoList"]=kha__$Assets_VideoList;kha__$Assets_VideoList.__name__=true;kha__$Assets_VideoList.prototype={get:function(name){return Reflect.field(this,name)},__class__:kha__$Assets_VideoList};var kha_Assets=function(){};$hxClasses["kha.Assets"]=kha_Assets;kha_Assets.__name__=true;kha_Assets.loadImageFromPath=function(path,readable,done,failed,pos){var description={files:[path],readable:readable};kha_LoaderImpl.loadImageFromDescription(description,done,kha_Assets.reporter(failed,pos))};kha_Assets.loadBlobFromPath=function(path,done,failed,pos){var description={files:[path]};kha_LoaderImpl.loadBlobFromDescription(description,done,kha_Assets.reporter(failed,pos))};kha_Assets.loadFont=function(name,done,failed,pos){var description=Reflect.field(kha_Assets.fonts,name+"Description");kha_LoaderImpl.loadFontFromDescription(description,function(font){Reflect.setField(kha_Assets.fonts,name,font);done(font)},kha_Assets.reporter(failed,pos));return};kha_Assets.loadFontFromPath=function(path,done,failed,pos){var description={files:[path]};kha_LoaderImpl.loadFontFromDescription(description,done,kha_Assets.reporter(failed,pos));return};kha_Assets.reporter=function(custom,pos){if(custom!=null){return custom}else{var f=haxe_Log.trace;var infos=pos;return function(v){f(v,infos)}}};var kha_Canvas=function(){};$hxClasses["kha.Canvas"]=kha_Canvas;kha_Canvas.__name__=true;kha_Canvas.prototype={__class__:kha_Canvas,__properties__:{get_width:"get_width",get_height:"get_height",get_g4:"get_g4"}};var kha_Resource=function(){};$hxClasses["kha.Resource"]=kha_Resource;kha_Resource.__name__=true;var kha_Image=function(){};$hxClasses["kha.Image"]=kha_Image;kha_Image.__name__=true;kha_Image.__interfaces__=[kha_Resource,kha_Canvas];kha_Image.__properties__={get_nonPow2Supported:"get_nonPow2Supported"};kha_Image.create=function(width,height,format,usage){if(format==null){format=0}if(usage==null){usage=0}if(kha_SystemImpl.gl==null){return new kha_CanvasImage(width,height,format,false)}else{return new kha_WebGLImage(width,height,format,false,0,1)}};kha_Image.create3D=function(width,height,depth,format,usage){return null};kha_Image.createRenderTarget=function(width,height,format,depthStencil,antiAliasingSamples,contextId){if(contextId==null){contextId=0}if(antiAliasingSamples==null){antiAliasingSamples=1}if(depthStencil==null){depthStencil=0}if(format==null){format=0}if(kha_SystemImpl.gl==null){return new kha_CanvasImage(width,height,format,true)}else{return new kha_WebGLImage(width,height,format,true,depthStencil,antiAliasingSamples)}};kha_Image.fromImage=function(image,readable){if(kha_SystemImpl.gl==null){var img=new kha_CanvasImage(image.width,image.height,0,false);img.image=image;img.createTexture();return img}else{var img1=new kha_WebGLImage(image.width,image.height,0,false,0,1);img1.image=image;img1.createTexture();return img1}};kha_Image.fromBytes=function(bytes,width,height,format,usage){if(format==null){format=0}if(usage==null){usage=0}if(kha_SystemImpl.gl!=null){var img=new kha_WebGLImage(width,height,format,false,0,1);img.image=img.bytesToArray(bytes);img.createTexture();return img}return null};kha_Image.get_nonPow2Supported=function(){return kha_SystemImpl.gl!=null};kha_Image.prototype={unload:function(){},lock:function(level){if(level==null){level=0}return null},unlock:function(){},generateMipmaps:function(levels){},setMipmaps:function(mipmaps){},setDepthStencilFrom:function(image){},get_width:function(){return 0},get_height:function(){return 0},get_depth:function(){return 1},get_realWidth:function(){return 0},get_realHeight:function(){return 0},get_g2:function(){return null},get_g4:function(){return null},__class__:kha_Image,__properties__:{get_g4:"get_g4",get_g2:"get_g2",get_realHeight:"get_realHeight",get_realWidth:"get_realWidth",get_depth:"get_depth",get_height:"get_height",get_width:"get_width"}};var kha_CanvasImage=function(width,height,format,renderTarget){this.g2canvas=null;this.myWidth=width;this.myHeight=height;this.format=format;this.renderTarget=renderTarget;this.image=null;this.video=null;if(renderTarget){this.createTexture()}};$hxClasses["kha.CanvasImage"]=kha_CanvasImage;kha_CanvasImage.__name__=true;kha_CanvasImage.init=function(){var canvas=window.document.createElement("canvas");if(canvas!=null){kha_CanvasImage.context=canvas.getContext("2d");canvas.width=2048;canvas.height=2048;kha_CanvasImage.context.globalCompositeOperation="copy"}};kha_CanvasImage.__super__=kha_Image;kha_CanvasImage.prototype=$extend(kha_Image.prototype,{get_g2:function(){if(this.g2canvas==null){var canvas=window.document.createElement("canvas");this.image=canvas;var context=canvas.getContext("2d");canvas.width=this.get_width();canvas.height=this.get_height();this.g2canvas=new kha_js_CanvasGraphics(context)}return this.g2canvas},get_g4:function(){return null},get_width:function(){return this.myWidth},get_height:function(){return this.myHeight},get_realWidth:function(){return this.myWidth},get_realHeight:function(){return this.myHeight},createTexture:function(){if(kha_SystemImpl.gl==null){return}this.texture=kha_SystemImpl.gl.createTexture();kha_SystemImpl.gl.bindTexture(3553,this.texture);kha_SystemImpl.gl.texParameteri(3553,10240,9729);kha_SystemImpl.gl.texParameteri(3553,10241,9729);kha_SystemImpl.gl.texParameteri(3553,10242,33071);kha_SystemImpl.gl.texParameteri(3553,10243,33071);if(this.renderTarget){this.frameBuffer=kha_SystemImpl.gl.createFramebuffer();kha_SystemImpl.gl.bindFramebuffer(36160,this.frameBuffer);kha_SystemImpl.gl.texImage2D(3553,0,6408,this.get_realWidth(),this.get_realHeight(),0,6408,5121,null);kha_SystemImpl.gl.framebufferTexture2D(36160,36064,3553,this.texture,0);kha_SystemImpl.gl.bindFramebuffer(36160,null)}else if(this.video!=null){kha_SystemImpl.gl.texImage2D(3553,0,6408,6408,5121,this.video)}else{kha_SystemImpl.gl.texImage2D(3553,0,6408,6408,5121,this.image)}kha_SystemImpl.gl.bindTexture(3553,null)},lock:function(level){if(level==null){level=0}this.bytes=haxe_io_Bytes.alloc(this.format==0?4*this.get_width()*this.get_height():this.get_width()*this.get_height());return this.bytes},unlock:function(){if(kha_SystemImpl.gl!=null){this.texture=kha_SystemImpl.gl.createTexture();kha_SystemImpl.gl.bindTexture(3553,this.texture);kha_SystemImpl.gl.texParameteri(3553,10240,9729);kha_SystemImpl.gl.texParameteri(3553,10241,9729);kha_SystemImpl.gl.texParameteri(3553,10242,33071);kha_SystemImpl.gl.texParameteri(3553,10243,33071);kha_SystemImpl.gl.texImage2D(3553,0,6409,this.get_width(),this.get_height(),0,6409,5121,new Uint8Array(this.bytes.getData()));if(kha_SystemImpl.gl.getError()==1282){var rgbaBytes=haxe_io_Bytes.alloc(this.get_width()*this.get_height()*4);var _g=0;var _g1=this.get_height();while(_g<_g1){var y=_g++;var _g2=0;var _g11=this.get_width();while(_g2<_g11){var x=_g2++;var value=this.bytes.get(y*this.get_width()+x);rgbaBytes.set(y*this.get_width()*4+x*4,value);rgbaBytes.set(y*this.get_width()*4+x*4+1,value);rgbaBytes.set(y*this.get_width()*4+x*4+2,value);rgbaBytes.set(y*this.get_width()*4+x*4+3,255)}}kha_SystemImpl.gl.texImage2D(3553,0,6408,this.get_width(),this.get_height(),0,6408,5121,new Uint8Array(rgbaBytes.getData()))}kha_SystemImpl.gl.bindTexture(3553,null);this.bytes=null}},unload:function(){this.image=null;this.video=null;this.data=null},__class__:kha_CanvasImage});var kha__$Color_Color_$Impl_$=$hx_exports["kha"]["_Color"]["Color_Impl_"]={};$hxClasses["kha._Color.Color_Impl_"]=kha__$Color_Color_$Impl_$;kha__$Color_Color_$Impl_$.__name__=true;kha__$Color_Color_$Impl_$.fromBytes=function(r,g,b,a){if(a==null){a=255}return kha__$Color_Color_$Impl_$._new(a<<24|r<<16|g<<8|b)};kha__$Color_Color_$Impl_$.fromFloats=function(r,g,b,a){if(a==null){a=1}return kha__$Color_Color_$Impl_$._new(Std.int(a*255)<<24|Std.int(r*255)<<16|Std.int(g*255)<<8|Std.int(b*255))};kha__$Color_Color_$Impl_$._new=function(value){var this1=value;return this1};var kha_CompilerDefines=function(){};$hxClasses["kha.CompilerDefines"]=kha_CompilerDefines;kha_CompilerDefines.__name__=true;var kha_Display=function(){};$hxClasses["kha.Display"]=kha_Display;kha_Display.__name__=true;kha_Display.__properties__={get_primary:"get_primary"};kha_Display.get_primary=function(){return kha_Display.instance};kha_Display.prototype={get_frequency:function(){return 60},__class__:kha_Display,__properties__:{get_frequency:"get_frequency"}};var kha_DisplayMode=function(){};$hxClasses["kha.DisplayMode"]=kha_DisplayMode;kha_DisplayMode.__name__=true;var kha_Framebuffer=function($window,g1,g2,g4,g5){this.window=$window;this.graphics1=g1;this.graphics2=g2;this.graphics4=g4;this.graphics5=g5};$hxClasses["kha.Framebuffer"]=kha_Framebuffer;kha_Framebuffer.__name__=true;kha_Framebuffer.__interfaces__=[kha_Canvas];kha_Framebuffer.prototype={init:function(g1,g2,g4,g5){this.graphics1=g1;this.graphics2=g2;this.graphics4=g4;this.graphics5=g5},get_g2:function(){return this.graphics2},get_g4:function(){return this.graphics4},get_width:function(){return kha_System.windowWidth(this.window)},get_height:function(){return kha_System.windowHeight(this.window)},__class__:kha_Framebuffer,__properties__:{get_height:"get_height",get_width:"get_width",get_g4:"get_g4",get_g2:"get_g2"}};var kha_FramebufferOptions=function(frequency,verticalSync,colorBufferBits,depthBufferBits,stencilBufferBits,samplesPerPixel){if(samplesPerPixel==null){samplesPerPixel=1}if(stencilBufferBits==null){stencilBufferBits=8}if(depthBufferBits==null){depthBufferBits=16}if(colorBufferBits==null){colorBufferBits=32}if(verticalSync==null){verticalSync=true}if(frequency==null){frequency=60}this.samplesPerPixel=1;this.stencilBufferBits=8;this.depthBufferBits=16;this.colorBufferBits=32;this.verticalSync=true;this.frequency=60;this.frequency=frequency;this.verticalSync=verticalSync;this.colorBufferBits=colorBufferBits;this.depthBufferBits=depthBufferBits;this.stencilBufferBits=stencilBufferBits;this.samplesPerPixel=samplesPerPixel};$hxClasses["kha.FramebufferOptions"]=kha_FramebufferOptions;kha_FramebufferOptions.__name__=true;kha_FramebufferOptions.prototype={__class__:kha_FramebufferOptions};var kha_AlignedQuad=function(){};$hxClasses["kha.AlignedQuad"]=kha_AlignedQuad;kha_AlignedQuad.__name__=true;kha_AlignedQuad.prototype={__class__:kha_AlignedQuad};var kha_KravurImage=function(size,ascent,descent,lineGap,width,height,chars,pixels){this.mySize=size;this.width=width;this.height=height;this.chars=chars;this.baseline=ascent;var _g=0;while(_g<chars.length){var char=chars[_g];++_g;char.yoff+=this.baseline}this.texture=kha_Image.create(width,height,1);var bytes=this.texture.lock();var pos=0;var _g1=0;var _g2=height;while(_g1<_g2){var y=_g1++;var _g11=0;var _g21=width;while(_g11<_g21){var x=_g11++;bytes.set(pos,pixels.readU8(pos));++pos}}this.texture.unlock()};$hxClasses["kha.KravurImage"]=kha_KravurImage;kha_KravurImage.__name__=true;kha_KravurImage.prototype={getTexture:function(){return this.texture},getBakedQuad:function(q,char_index,xpos,ypos){if(char_index>=this.chars.length){return null}var ipw=1/this.width;var iph=1/this.height;var b=this.chars[char_index];if(b==null){return null}var round_x=Math.round(xpos+b.xoff);var round_y=Math.round(ypos+b.yoff);q.x0=round_x;q.y0=round_y;q.x1=round_x+b.x1-b.x0;q.y1=round_y+b.y1-b.y0;q.s0=b.x0*ipw;q.t0=b.y0*iph;q.s1=b.x1*ipw;q.t1=b.y1*iph;q.xadvance=b.xadvance;return q},getCharWidth:function(charIndex){if(this.chars.length==0){return 0}var offset=kha_KravurImage.charBlocks[0];if(charIndex<offset){return this.chars[0].xadvance}var _g=1;var _g1=Std.int(kha_KravurImage.charBlocks.length/2);while(_g<_g1){var i=_g++;var prevEnd=kha_KravurImage.charBlocks[i*2-1];var start=kha_KravurImage.charBlocks[i*2];if(charIndex>start-1){offset+=start-1-prevEnd}}if(charIndex-offset>=this.chars.length){return this.chars[0].xadvance}return this.chars[charIndex-offset].xadvance},getHeight:function(){return this.mySize},stringWidth:function(str){var width=0;var _g=0;var _g1=str.length;while(_g<_g1){var c=_g++;width+=this.getCharWidth(HxOverrides.cca(str,c))}return width},__class__:kha_KravurImage};var kha_Kravur=function(blob){this.images=new haxe_ds_IntMap;this.blob=blob};$hxClasses["kha.Kravur"]=kha_Kravur;kha_Kravur.__name__=true;kha_Kravur.__interfaces__=[kha_Resource];kha_Kravur.prototype={_get:function(fontSize){var glyphs=kha_graphics2_Graphics.fontGlyphs;if(glyphs!=this.oldGlyphs){this.oldGlyphs=glyphs;kha_KravurImage.charBlocks=[glyphs[0]];var nextChar=kha_KravurImage.charBlocks[0]+1;var _g=1;var _g1=glyphs.length;while(_g<_g1){var i=_g++;if(glyphs[i]!=nextChar){kha_KravurImage.charBlocks.push(glyphs[i-1]);kha_KravurImage.charBlocks.push(glyphs[i]);nextChar=glyphs[i]+1}else{++nextChar}}kha_KravurImage.charBlocks.push(glyphs[glyphs.length-1])}var imageIndex=fontSize*1e4+glyphs.length;if(!this.images.exists(imageIndex)){var width=64;var height=32;var this1=new Array(glyphs.length);var baked=this1;var _g2=0;var _g11=baked.length;while(_g2<_g11){var i1=_g2++;baked[i1]=new kha_graphics2_truetype_Stbtt_$bakedchar}var pixels=null;var status=-1;while(status<=0){if(height<width){height*=2}else{width*=2}pixels=kha_internal_BytesBlob.alloc(width*height);status=kha_graphics2_truetype_StbTruetype.stbtt_BakeFontBitmap(this.blob,0,fontSize,pixels,width,height,glyphs,baked)}var info=new kha_graphics2_truetype_Stbtt_$fontinfo;kha_graphics2_truetype_StbTruetype.stbtt_InitFont(info,this.blob,0);var metrics=kha_graphics2_truetype_StbTruetype.stbtt_GetFontVMetrics(info);var scale=kha_graphics2_truetype_StbTruetype.stbtt_ScaleForPixelHeight(info,fontSize);var ascent=Math.round(metrics.ascent*scale);var descent=Math.round(metrics.descent*scale);var lineGap=Math.round(metrics.lineGap*scale);var image=new kha_KravurImage(Std.int(fontSize),ascent,descent,lineGap,width,height,baked,pixels);this.images.set(imageIndex,image);return image}return this.images.get(imageIndex)},height:function(fontSize){return this._get(fontSize).getHeight()},width:function(fontSize,str){return this._get(fontSize).stringWidth(str)},unload:function(){this.blob=null;this.images=null},__class__:kha_Kravur};var kha_LoaderImpl=function(){};$hxClasses["kha.LoaderImpl"]=kha_LoaderImpl;kha_LoaderImpl.__name__=true;kha_LoaderImpl.loadImageFromDescription=function(desc,done,failed){var readable=Reflect.hasField(desc,"readable")&&desc.readable;if(StringTools.endsWith(desc.files[0],".hdr")){kha_LoaderImpl.loadBlobFromDescription(desc,function(blob){var hdrImage=kha_internal_HdrFormat.parse(blob.toBytes());var tmp=kha_Image.fromBytes(haxe_io_Bytes.ofData(hdrImage.data.buffer),hdrImage.width,hdrImage.height,2,readable?1:0);done(tmp)},failed)}else{var img=window.document.createElement("img");img.onerror=function(event){failed({url:desc.files[0],error:event})};img.onload=function(event1){var tmp1=kha_Image.fromImage(img,readable);done(tmp1)};img.src=desc.files[0];img.crossOrigin=""}};kha_LoaderImpl.loadRemote=function(desc,done,failed){var request=new XMLHttpRequest;request.open("GET",desc.files[0],true);request.responseType="arraybuffer";request.onreadystatechange=function(){if(request.readyState!=4){return}if(request.status>=200&&request.status<400||request.status==0&&request.statusText==""){var bytes=null;var arrayBuffer=request.response;if(arrayBuffer!=null){var byteArray=new Uint8Array(arrayBuffer);bytes=haxe_io_Bytes.ofData(byteArray)}else if(request.responseBody!=null){var data=VBArray(request.responseBody).toArray();bytes=haxe_io_Bytes.alloc(data.length);var _g=0;var _g1=data.length;while(_g<_g1){var i=_g++;bytes.set(i,data[i])}}else{failed({url:desc.files[0]});return}done(new kha_internal_BytesBlob(bytes))}else{failed({url:desc.files[0]})}};request.send(null)};kha_LoaderImpl.loadBlobFromDescription=function(desc,done,failed){kha_LoaderImpl.loadRemote(desc,done,failed)};kha_LoaderImpl.loadFontFromDescription=function(desc,done,failed){kha_LoaderImpl.loadBlobFromDescription(desc,function(blob){done(new kha_Kravur(blob))},failed)};var kha_TimeTask=function(){};$hxClasses["kha.TimeTask"]=kha_TimeTask;kha_TimeTask.__name__=true;kha_TimeTask.prototype={__class__:kha_TimeTask};var kha_FrameTask=function(task,priority,id){this.task=task;this.priority=priority;this.id=id;this.active=true;this.paused=false};$hxClasses["kha.FrameTask"]=kha_FrameTask;kha_FrameTask.__name__=true;kha_FrameTask.prototype={__class__:kha_FrameTask};var kha_Scheduler=function(){};$hxClasses["kha.Scheduler"]=kha_Scheduler;kha_Scheduler.__name__=true;kha_Scheduler.init=function(){kha_Scheduler.deltas=[];var _g=0;var _g1=kha_Scheduler.DIF_COUNT;while(_g<_g1){var i=_g++;kha_Scheduler.deltas[i]=0}kha_Scheduler.stopped=true;kha_Scheduler.frame_tasks_sorted=true;kha_Scheduler.current=kha_Scheduler.lastTime=kha_Scheduler.realTime();kha_Scheduler.currentFrameTaskId=0;kha_Scheduler.currentTimeTaskId=0;kha_Scheduler.currentGroupId=0;kha_Scheduler.timeTasks=[];kha_Scheduler.pausedTimeTasks=[];kha_Scheduler.outdatedTimeTasks=[];kha_Scheduler.timeTasksScratchpad=[];kha_Scheduler.frameTasks=[];kha_Scheduler.toDeleteFrame=[]};kha_Scheduler.start=function(restartTimers){if(restartTimers==null){restartTimers=false}kha_Scheduler.vsync=kha_Window.get(0).get_vSynced();var hz=kha_Display.get_primary().get_frequency();if(hz>=57&&hz<=63){hz=60}kha_Scheduler.onedifhz=1/hz;kha_Scheduler.stopped=false;kha_Scheduler.resetTime();kha_Scheduler.lastTime=kha_Scheduler.realTime()-kha_Scheduler.startTime;var _g=0;var _g1=kha_Scheduler.DIF_COUNT;while(_g<_g1){var i=_g++;kha_Scheduler.deltas[i]=0}if(restartTimers){var _g2=0;var _g3=kha_Scheduler.timeTasks;while(_g2<_g3.length){var timeTask=_g3[_g2];++_g2;timeTask.paused=false}var _g4=0;var _g5=kha_Scheduler.frameTasks;while(_g4<_g5.length){var frameTask=_g5[_g4];++_g4;frameTask.paused=false}}};kha_Scheduler.executeFrame=function(){var now=kha_Scheduler.realTime()-kha_Scheduler.startTime;var delta=now-kha_Scheduler.lastTime;var frameEnd=kha_Scheduler.current;if(delta>=0){if(kha_netsync_Session.the()==null){if(delta>kha_Scheduler.maxframetime){kha_Scheduler.startTime+=delta-kha_Scheduler.maxframetime;delta=kha_Scheduler.maxframetime;frameEnd+=delta}else if(kha_Scheduler.vsync){var realdif=kha_Scheduler.onedifhz;while(realdif<delta-kha_Scheduler.onedifhz)realdif+=kha_Scheduler.onedifhz;delta=realdif;var _g=0;var _g1=kha_Scheduler.DIF_COUNT-2;while(_g<_g1){var i=_g++;delta+=kha_Scheduler.deltas[i];kha_Scheduler.deltas[i]=kha_Scheduler.deltas[i+1]}delta+=kha_Scheduler.deltas[kha_Scheduler.DIF_COUNT-2];delta/=kha_Scheduler.DIF_COUNT;kha_Scheduler.deltas[kha_Scheduler.DIF_COUNT-2]=realdif;frameEnd+=delta}else{var _g2=0;var _g11=kha_Scheduler.DIF_COUNT-1;while(_g2<_g11){var i1=_g2++;kha_Scheduler.deltas[i1]=kha_Scheduler.deltas[i1+1]}kha_Scheduler.deltas[kha_Scheduler.DIF_COUNT-1]=delta;var next=0;var _g21=0;var _g3=kha_Scheduler.DIF_COUNT;while(_g21<_g3){var i2=_g21++;next+=kha_Scheduler.deltas[i2]}next/=kha_Scheduler.DIF_COUNT;frameEnd+=next}}else{frameEnd+=delta}kha_Scheduler.lastTime=frameEnd;if(!kha_Scheduler.stopped){kha_Scheduler.current=frameEnd}var _g4=0;var _g12=kha_Scheduler.pausedTimeTasks;while(_g4<_g12.length){var pausedTask=_g12[_g4];++_g4;pausedTask.next+=delta}if(kha_Scheduler.stopped){var _g22=0;var _g31=kha_Scheduler.timeTasks;while(_g22<_g31.length){var timeTask=_g31[_g22];++_g22;timeTask.next+=delta}}kha_Scheduler.executeTimeTasks(frameEnd);var _g23=0;var _g32=kha_Scheduler.outdatedTimeTasks;while(_g23<_g32.length){var task=_g32[_g23];++_g23;if(task.next<frameEnd-10){kha_Scheduler.timeTasksScratchpad.push(task)}}var _g41=0;var _g5=kha_Scheduler.timeTasksScratchpad;while(_g41<_g5.length){var task1=_g5[_g41];++_g41;HxOverrides.remove(kha_Scheduler.outdatedTimeTasks,task1)}while(kha_Scheduler.timeTasksScratchpad.length>0)HxOverrides.remove(kha_Scheduler.timeTasksScratchpad,kha_Scheduler.timeTasksScratchpad[0])}kha_Scheduler.sortFrameTasks();var _g6=0;var _g13=kha_Scheduler.frameTasks;while(_g6<_g13.length){var frameTask=_g13[_g6];++_g6;if(!kha_Scheduler.stopped&&!frameTask.paused&&frameTask.active){if(!frameTask.task()){frameTask.active=false}}}var _g24=0;var _g33=kha_Scheduler.frameTasks;while(_g24<_g33.length){var frameTask1=_g33[_g24];++_g24;if(!frameTask1.active){kha_Scheduler.toDeleteFrame.push(frameTask1)}}while(kha_Scheduler.toDeleteFrame.length>0)HxOverrides.remove(kha_Scheduler.frameTasks,kha_Scheduler.toDeleteFrame.pop())};kha_Scheduler.executeTimeTasks=function(until){while(kha_Scheduler.timeTasks.length>0){kha_Scheduler.activeTimeTask=kha_Scheduler.timeTasks[0];if(kha_Scheduler.activeTimeTask.next<=until){kha_Scheduler.activeTimeTask.next+=kha_Scheduler.activeTimeTask.period;HxOverrides.remove(kha_Scheduler.timeTasks,kha_Scheduler.activeTimeTask);if(kha_Scheduler.activeTimeTask.active&&kha_Scheduler.activeTimeTask.task()){if(kha_Scheduler.activeTimeTask.period>0&&(kha_Scheduler.activeTimeTask.duration==0||kha_Scheduler.activeTimeTask.duration>=kha_Scheduler.activeTimeTask.start+kha_Scheduler.activeTimeTask.next)){kha_Scheduler.insertSorted(kha_Scheduler.timeTasks,kha_Scheduler.activeTimeTask)}else{kha_Scheduler.archiveTimeTask(kha_Scheduler.activeTimeTask,until)}}else{kha_Scheduler.activeTimeTask.active=false;kha_Scheduler.archiveTimeTask(kha_Scheduler.activeTimeTask,until)}}else{break}}kha_Scheduler.activeTimeTask=null};kha_Scheduler.archiveTimeTask=function(timeTask,frameEnd){};kha_Scheduler.time=function(){return kha_Scheduler.current};kha_Scheduler.realTime=function(){return kha_System.get_time()};kha_Scheduler.resetTime=function(){var now=kha_System.get_time();var dif=now-kha_Scheduler.startTime;kha_Scheduler.startTime=now;var _g=0;var _g1=kha_Scheduler.timeTasks;while(_g<_g1.length){var timeTask=_g1[_g];++_g;timeTask.start-=dif;timeTask.next-=dif}var _g2=0;var _g3=kha_Scheduler.DIF_COUNT;while(_g2<_g3){var i=_g2++;kha_Scheduler.deltas[i]=0}kha_Scheduler.current=0;kha_Scheduler.lastTime=0};kha_Scheduler.addBreakableTimeTaskToGroup=function(groupId,task,start,period,duration){if(duration==null){duration=0}if(period==null){period=0}var t=new kha_TimeTask;t.active=true;t.task=task;t.id=++kha_Scheduler.currentTimeTaskId;t.groupId=groupId;t.start=kha_Scheduler.current+start;t.period=0;if(period!=0){t.period=period}t.duration=0;if(duration!=0){t.duration=t.start+duration}t.next=t.start;kha_Scheduler.insertSorted(kha_Scheduler.timeTasks,t);return t.id};kha_Scheduler.addTimeTaskToGroup=function(groupId,task,start,period,duration){if(duration==null){duration=0}if(period==null){period=0}return kha_Scheduler.addBreakableTimeTaskToGroup(groupId,function(){task();return true},start,period,duration)};kha_Scheduler.addTimeTask=function(task,start,period,duration){if(duration==null){duration=0}if(period==null){period=0}return kha_Scheduler.addTimeTaskToGroup(0,task,start,period,duration)};kha_Scheduler.insertSorted=function(list,task){var _g=0;var _g1=list.length;while(_g<_g1){var i=_g++;if(list[i].next>task.next){list.splice(i,0,task);return}}list.push(task)};kha_Scheduler.sortFrameTasks=function(){if(kha_Scheduler.frame_tasks_sorted){return}kha_Scheduler.frameTasks.sort(function(a,b){if(a.priority>b.priority){return 1}else if(a.priority<b.priority){return-1}else{return 0}});kha_Scheduler.frame_tasks_sorted=true};var kha_ScreenRotation=$hxEnums["kha.ScreenRotation"]={__ename__:true,__constructs__:["RotationNone","Rotation90","Rotation180","Rotation270"],RotationNone:{_hx_index:0,__enum__:"kha.ScreenRotation",toString:$estr},Rotation90:{_hx_index:1,__enum__:"kha.ScreenRotation",toString:$estr},Rotation180:{_hx_index:2,__enum__:"kha.ScreenRotation",toString:$estr},Rotation270:{_hx_index:3,__enum__:"kha.ScreenRotation",toString:$estr}};var kha_Shaders=function(){};$hxClasses["kha.Shaders"]=kha_Shaders;kha_Shaders.__name__=true;kha_Shaders.init=function(){var blobs=[];var data=Reflect.field(kha_Shaders,"Material_shadowmap_fragData"+0);var bytes=haxe_Unserializer.run(data);blobs.push(kha_internal_BytesBlob.fromBytes(bytes));kha_Shaders.Material_shadowmap_frag=new kha_graphics4_FragmentShader(blobs,["Material_shadowmap-webgl2.frag.essl"]);var blobs1=[];var data1=Reflect.field(kha_Shaders,"Material_mesh_vertData"+0);var bytes1=haxe_Unserializer.run(data1);blobs1.push(kha_internal_BytesBlob.fromBytes(bytes1));kha_Shaders.Material_mesh_vert=new kha_graphics4_VertexShader(blobs1,["Material_mesh-webgl2.vert.essl"]);var blobs2=[];var data2=Reflect.field(kha_Shaders,"Material_mesh_fragData"+0);var bytes2=haxe_Unserializer.run(data2);blobs2.push(kha_internal_BytesBlob.fromBytes(bytes2));kha_Shaders.Material_mesh_frag=new kha_graphics4_FragmentShader(blobs2,["Material_mesh-webgl2.frag.essl"]);var blobs3=[];var data3=Reflect.field(kha_Shaders,"Material_shadowmap_vertData"+0);var bytes3=haxe_Unserializer.run(data3);blobs3.push(kha_internal_BytesBlob.fromBytes(bytes3));kha_Shaders.Material_shadowmap_vert=new kha_graphics4_VertexShader(blobs3,["Material_shadowmap-webgl2.vert.essl"]);var blobs4=[];var data4=Reflect.field(kha_Shaders,"painter_image_vertData"+0);var bytes4=haxe_Unserializer.run(data4);blobs4.push(kha_internal_BytesBlob.fromBytes(bytes4));kha_Shaders.painter_image_vert=new kha_graphics4_VertexShader(blobs4,["painter-image-webgl2.vert.essl"]);var blobs5=[];var data5=Reflect.field(kha_Shaders,"painter_colored_vertData"+0);var bytes5=haxe_Unserializer.run(data5);blobs5.push(kha_internal_BytesBlob.fromBytes(bytes5));kha_Shaders.painter_colored_vert=new kha_graphics4_VertexShader(blobs5,["painter-colored-webgl2.vert.essl"]);var blobs6=[];var data6=Reflect.field(kha_Shaders,"painter_colored_fragData"+0);var bytes6=haxe_Unserializer.run(data6);blobs6.push(kha_internal_BytesBlob.fromBytes(bytes6));kha_Shaders.painter_colored_frag=new kha_graphics4_FragmentShader(blobs6,["painter-colored-webgl2.frag.essl"]);var blobs7=[];var data7=Reflect.field(kha_Shaders,"painter_image_fragData"+0);var bytes7=haxe_Unserializer.run(data7);blobs7.push(kha_internal_BytesBlob.fromBytes(bytes7));kha_Shaders.painter_image_frag=new kha_graphics4_FragmentShader(blobs7,["painter-image-webgl2.frag.essl"]);var blobs8=[];var data8=Reflect.field(kha_Shaders,"painter_text_fragData"+0);var bytes8=haxe_Unserializer.run(data8);blobs8.push(kha_internal_BytesBlob.fromBytes(bytes8));kha_Shaders.painter_text_frag=new kha_graphics4_FragmentShader(blobs8,["painter-text-webgl2.frag.essl"]);var blobs9=[];var data9=Reflect.field(kha_Shaders,"painter_text_vertData"+0);var bytes9=haxe_Unserializer.run(data9);blobs9.push(kha_internal_BytesBlob.fromBytes(bytes9));kha_Shaders.painter_text_vert=new kha_graphics4_VertexShader(blobs9,["painter-text-webgl2.vert.essl"]);var blobs10=[];var data10=Reflect.field(kha_Shaders,"painter_video_fragData"+0);var bytes10=haxe_Unserializer.run(data10);blobs10.push(kha_internal_BytesBlob.fromBytes(bytes10));kha_Shaders.painter_video_frag=new kha_graphics4_FragmentShader(blobs10,["painter-video-webgl2.frag.essl"]);var blobs11=[];var data11=Reflect.field(kha_Shaders,"painter_video_vertData"+0);var bytes11=haxe_Unserializer.run(data11);blobs11.push(kha_internal_BytesBlob.fromBytes(bytes11));kha_Shaders.painter_video_vert=new kha_graphics4_VertexShader(blobs11,["painter-video-webgl2.vert.essl"])};var kha_Sound=function(){};$hxClasses["kha.Sound"]=kha_Sound;kha_Sound.__name__=true;kha_Sound.__interfaces__=[kha_Resource];kha_Sound.prototype={__class__:kha_Sound};var kha_SystemOptions=function(title,width,height,$window,framebuffer){if(height==null){height=-1}if(width==null){width=-1}if(title==null){title="Kha"}this.framebuffer=null;this.window=null;this.height=-1;this.width=-1;this.title="Kha";this.title=title;this.window=$window==null?new kha_WindowOptions(null,null,null,null,null,null,null,null,null):$window;if(width>0){this.window.width=width;this.width=width}else{this.width=this.window.width}if(height>0){this.window.height=height;this.height=height}else{this.height=this.window.height}if(this.window.title==null){this.window.title=title}this.framebuffer=framebuffer==null?new kha_FramebufferOptions(null,null,null,null,null,null):framebuffer};$hxClasses["kha.SystemOptions"]=kha_SystemOptions;kha_SystemOptions.__name__=true;kha_SystemOptions.prototype={__class__:kha_SystemOptions};var kha_System=function(){};$hxClasses["kha.System"]=kha_System;kha_System.__name__=true;kha_System.__properties__={get_time:"get_time"};kha_System.start=function(options,callback){kha_System.theTitle=options.title;kha_SystemImpl.init(options,callback)};kha_System.notifyOnFrames=function(listener){kha_System.renderListeners.push(listener)};kha_System.notifyOnCutCopyPaste=function(cutListener,copyListener,pasteListener){kha_System.cutListener=cutListener;kha_System.copyListener=copyListener;kha_System.pasteListener=pasteListener};kha_System.render=function(framebuffers){var _g=0;var _g1=kha_System.renderListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener(framebuffers)}};kha_System.foreground=function(){var _g=0;var _g1=kha_System.foregroundListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener()}};kha_System.background=function(){var _g=0;var _g1=kha_System.backgroundListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener()}};kha_System.shutdown=function(){var _g=0;var _g1=kha_System.shutdownListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener()}};kha_System.get_time=function(){return kha_SystemImpl.getTime()};kha_System.windowWidth=function($window){if($window==null){$window=0}return kha_Window.get($window).get_width()};kha_System.windowHeight=function($window){if($window==null){$window=0}return kha_Window.get_all()[$window].get_height()};var kha_GamepadStates=function(){this.axes=[];this.buttons=[]};$hxClasses["kha.GamepadStates"]=kha_GamepadStates;kha_GamepadStates.__name__=true;kha_GamepadStates.prototype={__class__:kha_GamepadStates};var kha_SystemImpl=function(){};$hxClasses["kha.SystemImpl"]=kha_SystemImpl;kha_SystemImpl.__name__=true;kha_SystemImpl.init=function(options,callback){kha_SystemImpl.options=options;kha_SystemImpl.mobile=kha_SystemImpl.isMobile();kha_SystemImpl.ios=kha_SystemImpl.isIOS();kha_SystemImpl.chrome=kha_SystemImpl.isChrome();kha_SystemImpl.firefox=kha_SystemImpl.isFirefox();kha_SystemImpl.ie=kha_SystemImpl.isIE();kha_SystemImpl.initSecondStep(callback)};kha_SystemImpl.initSecondStep=function(callback){kha_SystemImpl.init2(kha_SystemImpl.options.window.width,kha_SystemImpl.options.window.height);callback(kha_SystemImpl.window)};kha_SystemImpl.isMobile=function(){var agent=window.navigator.userAgent;if(agent.indexOf("Android")>=0||agent.indexOf("webOS")>=0||agent.indexOf("BlackBerry")>=0||agent.indexOf("Windows Phone")>=0){return true}if(kha_SystemImpl.isIOS()){return true}return false};kha_SystemImpl.isIOS=function(){var agent=window.navigator.userAgent;if(agent.indexOf("iPhone")>=0||agent.indexOf("iPad")>=0||agent.indexOf("iPod")>=0){return true}return false};kha_SystemImpl.isChrome=function(){var agent=window.navigator.userAgent;if(agent.indexOf("Chrome")>=0){return true}return false};kha_SystemImpl.isFirefox=function(){var agent=window.navigator.userAgent;if(agent.indexOf("Firefox")>=0){return true}return false};kha_SystemImpl.isIE=function(){var agent=window.navigator.userAgent;if(agent.indexOf("MSIE ")>=0||agent.indexOf("Trident/")>=0){return true}return false};kha_SystemImpl.setCanvas=function(canvas){kha_SystemImpl.khanvas=canvas};kha_SystemImpl.getTime=function(){var performance=window.performance?window.performance:window.Date;return performance.now()/1e3};kha_SystemImpl.init2=function(defaultWidth,defaultHeight,backbufferFormat){kha_SystemImpl.keyboard=new kha_input_Keyboard;kha_SystemImpl.mouse=new kha_input_MouseImpl;kha_SystemImpl.surface=new kha_input_Surface;kha_SystemImpl.gamepads=[];kha_SystemImpl.gamepadStates=[];kha_SystemImpl.gamepads[0]=new kha_input_Gamepad(0);kha_SystemImpl.gamepadStates[0]=new kha_GamepadStates;kha_SystemImpl.gamepads[1]=new kha_input_Gamepad(1);kha_SystemImpl.gamepadStates[1]=new kha_GamepadStates;kha_SystemImpl.gamepads[2]=new kha_input_Gamepad(2);kha_SystemImpl.gamepadStates[2]=new kha_GamepadStates;kha_SystemImpl.gamepads[3]=new kha_input_Gamepad(3);kha_SystemImpl.gamepadStates[3]=new kha_GamepadStates;window.addEventListener("gamepadconnected",function(e){kha_input_Gamepad.sendConnectEvent(e.gamepad.index)});window.addEventListener("gamepaddisconnected",function(e1){kha_input_Gamepad.sendDisconnectEvent(e1.gamepad.index)});if(kha_SystemImpl.ie){kha_SystemImpl.pressedKeys=[];var _g=0;while(_g<256){var i=_g++;kha_SystemImpl.pressedKeys.push(false)}var _g1=0;while(_g1<256){var i1=_g1++;kha_SystemImpl.pressedKeys.push(null)}}var onCopy=function(e2){if(kha_System.copyListener!=null){var data=kha_System.copyListener();if(data!=null){e2.clipboardData.setData("text/plain",data)}e2.preventDefault()}};var onCut=function(e3){if(kha_System.cutListener!=null){var data1=kha_System.cutListener();if(data1!=null){e3.clipboardData.setData("text/plain",data1)}e3.preventDefault()}};var onPaste=function(e4){if(kha_System.pasteListener!=null){var onPaste1=e4.clipboardData.getData("text/plain");kha_System.pasteListener(onPaste1);e4.preventDefault()}};var document=window.document;document.addEventListener("copy",onCopy);document.addEventListener("cut",onCut);document.addEventListener("paste",onPaste);if(kha_SystemImpl.firefox){var canvas=kha_SystemImpl.getCanvasElement();var onPreTextEvents=function(e5){if(!(e5.ctrlKey||e5.metaKey)){return}var isEvent=e5.keyCode==67||e5.keyCode==88||e5.keyCode==86;if(!isEvent){return}var input=document.createElement("textarea");var onEvent=function(e6){document.body.removeChild(input);canvas.focus()};if(e5.keyCode==67){input.oncopy=onEvent}else if(e5.keyCode==88){input.oncut=onEvent}else if(e5.keyCode==86){input.onpaste=onEvent}document.body.appendChild(input);input.select()};canvas.addEventListener("keydown",onPreTextEvents)}kha_CanvasImage.init();kha_Scheduler.init();kha_SystemImpl.loadFinished(defaultWidth,defaultHeight)};kha_SystemImpl.getMouse=function(num){if(num!=0){return null}return kha_SystemImpl.mouse};kha_SystemImpl.getKeyboard=function(num){if(num!=0){return null}return kha_SystemImpl.keyboard};kha_SystemImpl.checkGamepad=function(pad){var _g=0;var _g1=pad.axes.length;while(_g<_g1){var i=_g++;if(pad.axes[i]!=null){var axis=pad.axes[i];if(i%2==1){axis=-axis}if(kha_SystemImpl.gamepadStates[pad.index].axes[i]!=axis){kha_SystemImpl.gamepadStates[pad.index].axes[i]=axis;kha_SystemImpl.gamepads[pad.index].sendAxisEvent(i,axis)}}}var _g2=0;var _g3=pad.buttons.length;while(_g2<_g3){var i1=_g2++;if(pad.buttons[i1]!=null){if(kha_SystemImpl.gamepadStates[pad.index].buttons[i1]!=pad.buttons[i1].value){kha_SystemImpl.gamepadStates[pad.index].buttons[i1]=pad.buttons[i1].value;kha_SystemImpl.gamepads[pad.index].sendButtonEvent(i1,pad.buttons[i1].value)}}}if(pad.axes.length<=4&&pad.buttons.length>7){kha_SystemImpl.gamepadStates[pad.index].axes[4]=pad.buttons[6].value;kha_SystemImpl.gamepads[pad.index].sendAxisEvent(4,pad.buttons[6].value);kha_SystemImpl.gamepadStates[pad.index].axes[5]=pad.buttons[7].value;kha_SystemImpl.gamepads[pad.index].sendAxisEvent(5,pad.buttons[7].value)}};kha_SystemImpl.getCanvasElement=function(){if(kha_SystemImpl.khanvas!=null){return kha_SystemImpl.khanvas}return window.document.getElementById(kha_CompilerDefines.canvas_id)};kha_SystemImpl.loadFinished=function(defaultWidth,defaultHeight){var canvas=kha_SystemImpl.getCanvasElement();canvas.style.cursor="default";var gl=false;try{kha_SystemImpl.gl=canvas.getContext("webgl2",{alpha:false,antialias:kha_SystemImpl.options.framebuffer.samplesPerPixel>1,stencil:true});kha_SystemImpl.gl.pixelStorei(37441,1);kha_SystemImpl.halfFloat={HALF_FLOAT_OES:5131};kha_SystemImpl.depthTexture={UNSIGNED_INT_24_8_WEBGL:34042};kha_SystemImpl.drawBuffers={COLOR_ATTACHMENT0_WEBGL:36064};kha_SystemImpl.elementIndexUint=true;kha_SystemImpl.gl.getExtension("EXT_color_buffer_float");kha_SystemImpl.gl.getExtension("OES_texture_float_linear");kha_SystemImpl.gl.getExtension("OES_texture_half_float_linear");kha_SystemImpl.anisotropicFilter=kha_SystemImpl.gl.getExtension("EXT_texture_filter_anisotropic");if(kha_SystemImpl.anisotropicFilter==null){kha_SystemImpl.anisotropicFilter=kha_SystemImpl.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")}gl=true;kha_SystemImpl.gl2=true;kha_Shaders.init()}catch(e){var e1=e instanceof js__$Boot_HaxeError?e.val:e;haxe_Log.trace("Could not initialize WebGL 2, falling back to WebGL.",{fileName:"kha/SystemImpl.hx",lineNumber:354,className:"kha.SystemImpl",methodName:"loadFinished"})}if(!kha_SystemImpl.gl2){try{kha_SystemImpl.gl=canvas.getContext("experimental-webgl",{alpha:false,antialias:kha_SystemImpl.options.framebuffer.samplesPerPixel>1,stencil:true});kha_SystemImpl.gl.pixelStorei(37441,1);kha_SystemImpl.gl.getExtension("OES_texture_float");kha_SystemImpl.gl.getExtension("OES_texture_float_linear");kha_SystemImpl.halfFloat=kha_SystemImpl.gl.getExtension("OES_texture_half_float");kha_SystemImpl.gl.getExtension("OES_texture_half_float_linear");kha_SystemImpl.depthTexture=kha_SystemImpl.gl.getExtension("WEBGL_depth_texture");kha_SystemImpl.gl.getExtension("EXT_shader_texture_lod");kha_SystemImpl.gl.getExtension("OES_standard_derivatives");kha_SystemImpl.anisotropicFilter=kha_SystemImpl.gl.getExtension("EXT_texture_filter_anisotropic");if(kha_SystemImpl.anisotropicFilter==null){kha_SystemImpl.anisotropicFilter=kha_SystemImpl.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")}kha_SystemImpl.drawBuffers=kha_SystemImpl.gl.getExtension("WEBGL_draw_buffers");kha_SystemImpl.elementIndexUint=kha_SystemImpl.gl.getExtension("OES_element_index_uint");gl=true;kha_Shaders.init()}catch(e2){var e3=e2 instanceof js__$Boot_HaxeError?e2.val:e2;haxe_Log.trace("Could not initialize WebGL, falling back to <canvas>.",{fileName:"kha/SystemImpl.hx",lineNumber:376,className:"kha.SystemImpl",methodName:"loadFinished"})}}kha_SystemImpl.setCanvas(canvas);kha_SystemImpl.window=new kha_Window(defaultWidth,defaultHeight,canvas);if(gl){var g4=new kha_js_graphics4_Graphics;kha_SystemImpl.frame=new kha_Framebuffer(0,null,null,g4);kha_SystemImpl.frame.init(new kha_graphics2_Graphics1(kha_SystemImpl.frame),new kha_js_graphics4_Graphics2(kha_SystemImpl.frame),g4)}else{kha_js_Font.Kravur=kha_Kravur;kha_Kravur=kha_js_Font;var g2=new kha_js_CanvasGraphics(canvas.getContext("2d"));kha_SystemImpl.frame=new kha_Framebuffer(0,null,g2,null);kha_SystemImpl.frame.init(new kha_graphics2_Graphics1(kha_SystemImpl.frame),g2,null)}if(!kha_SystemImpl.mobile&&kha_audio2_Audio._init()){kha_SystemImpl._hasWebAudio=true;kha_audio2_Audio1._init()}else if(kha_SystemImpl.mobile){kha_SystemImpl._hasWebAudio=false;kha_js_MobileWebAudio._init();kha_audio2_Audio1=kha_js_MobileWebAudio}else{kha_SystemImpl._hasWebAudio=false;kha_audio2_Audio1=kha_js_AudioElementAudio}kha_vr_VrInterface.instance=new kha_js_vr_VrInterface;kha_Scheduler.start();var $window=window;var requestAnimationFrame=$window.requestAnimationFrame;if(requestAnimationFrame==null){requestAnimationFrame=$window.mozRequestAnimationFrame}if(requestAnimationFrame==null){requestAnimationFrame=$window.webkitRequestAnimationFrame}if(requestAnimationFrame==null){requestAnimationFrame=$window.msRequestAnimationFrame}var animate=null;animate=function(timestamp){var window1=window;if(requestAnimationFrame==null){window1.setTimeout(animate,16.666666666666668)}else{requestAnimationFrame(animate)}var sysGamepads=kha_SystemImpl.getGamepads();if(sysGamepads!=null){var _g=0;var _g1=sysGamepads.length;while(_g<_g1){var i=_g++;var pad=sysGamepads[i];if(pad!=null){kha_SystemImpl.checkGamepad(pad)}}}kha_Scheduler.executeFrame();if($bind(canvas,canvas.getContext)){var displayWidth=canvas.clientWidth;var displayHeight=canvas.clientHeight;if(canvas.width!=displayWidth||canvas.height!=displayHeight){canvas.width=displayWidth;canvas.height=displayHeight}kha_System.render([kha_SystemImpl.frame]);if(kha_SystemImpl.gl!=null){kha_SystemImpl.gl.clearColor(1,1,1,1);kha_SystemImpl.gl.colorMask(false,false,false,true);kha_SystemImpl.gl.clear(16384);kha_SystemImpl.gl.colorMask(true,true,true,true)}}};if(requestAnimationFrame==null){$window.setTimeout(animate,16.666666666666668)}else{requestAnimationFrame(animate)}canvas.focus();canvas.oncontextmenu=function(event){event.stopPropagation();event.preventDefault()};canvas.onmousedown=kha_SystemImpl.mouseDown;canvas.onmousemove=kha_SystemImpl.mouseMove;if(kha_SystemImpl.keyboard!=null){canvas.onkeydown=kha_SystemImpl.keyDown;canvas.onkeyup=kha_SystemImpl.keyUp;canvas.onkeypress=kha_SystemImpl.keyPress}canvas.onblur=kha_SystemImpl.onBlur;canvas.onfocus=kha_SystemImpl.onFocus;canvas.onmousewheel=canvas.onwheel=kha_SystemImpl.mouseWheel;canvas.onmouseleave=kha_SystemImpl.mouseLeave;canvas.addEventListener("wheel mousewheel",kha_SystemImpl.mouseWheel,false);canvas.addEventListener("touchstart",kha_SystemImpl.touchDown,false);canvas.addEventListener("touchend",kha_SystemImpl.touchUp,false);canvas.addEventListener("touchmove",kha_SystemImpl.touchMove,false);canvas.addEventListener("touchcancel",kha_SystemImpl.touchCancel,false);window.addEventListener("unload",function(){kha_System.shutdown()})};kha_SystemImpl.setMouseXY=function(event){var rect=kha_SystemImpl.khanvas.getBoundingClientRect();var borderWidth=kha_SystemImpl.khanvas.clientLeft;var borderHeight=kha_SystemImpl.khanvas.clientTop;kha_SystemImpl.mouseX=Std.int((event.clientX-rect.left-borderWidth)*kha_SystemImpl.khanvas.width/(rect.width-2*borderWidth));kha_SystemImpl.mouseY=Std.int((event.clientY-rect.top-borderHeight)*kha_SystemImpl.khanvas.height/(rect.height-2*borderHeight))};kha_SystemImpl.unlockiOSSound=function(){if(!kha_SystemImpl.ios||kha_SystemImpl.iosSoundEnabled){return}var buffer=kha_js_MobileWebAudio._context.createBuffer(1,1,22050);var source=kha_js_MobileWebAudio._context.createBufferSource();source.buffer=buffer;source.connect(kha_js_MobileWebAudio._context.destination);source.start();source.stop();kha_SystemImpl.iosSoundEnabled=true};kha_SystemImpl.unlockSound=function(){if(!kha_SystemImpl.soundEnabled){var context=kha_audio2_Audio._context;if(context==null){context=kha_audio2_Audio1._context}if(context!=null){context.resume().then(function(c){kha_SystemImpl.soundEnabled=true})["catch"](function(err){haxe_Log.trace(err,{fileName:"kha/SystemImpl.hx",lineNumber:615,className:"kha.SystemImpl",methodName:"unlockSound"})})}}kha_SystemImpl.unlockiOSSound()};kha_SystemImpl.mouseLeave=function(){kha_SystemImpl.mouse.sendLeaveEvent(0)};kha_SystemImpl.mouseWheel=function(event){kha_SystemImpl.insideInputEvent=true;event.preventDefault();if(event.deltaMode==0){if(event.deltaY<0){kha_SystemImpl.mouse.sendWheelEvent(0,-1)}else if(event.deltaY>0){kha_SystemImpl.mouse.sendWheelEvent(0,1)}kha_SystemImpl.insideInputEvent=false;return false}if(event.deltaMode==1){kha_SystemImpl.minimumScroll=Std.int(Math.min(kha_SystemImpl.minimumScroll,Math.abs(event.deltaY)));kha_SystemImpl.mouse.sendWheelEvent(0,Std.int(event.deltaY/kha_SystemImpl.minimumScroll));kha_SystemImpl.insideInputEvent=false;return false}kha_SystemImpl.insideInputEvent=false;return false};kha_SystemImpl.mouseDown=function(event){kha_SystemImpl.insideInputEvent=true;kha_SystemImpl.unlockSound();kha_SystemImpl.setMouseXY(event);if(event.which==1){if(event.ctrlKey){kha_SystemImpl.leftMouseCtrlDown=true;kha_SystemImpl.mouse.sendDownEvent(0,1,kha_SystemImpl.mouseX,kha_SystemImpl.mouseY)}else{kha_SystemImpl.leftMouseCtrlDown=false;kha_SystemImpl.mouse.sendDownEvent(0,0,kha_SystemImpl.mouseX,kha_SystemImpl.mouseY)}if(kha_SystemImpl.khanvas.setCapture!=null){kha_SystemImpl.khanvas.setCapture()}else{kha_SystemImpl.khanvas.ownerDocument.addEventListener("mousemove",kha_SystemImpl.documentMouseMove,true)}kha_SystemImpl.khanvas.ownerDocument.addEventListener("mouseup",kha_SystemImpl.mouseLeftUp)}else if(event.which==2){kha_SystemImpl.mouse.sendDownEvent(0,2,kha_SystemImpl.mouseX,kha_SystemImpl.mouseY);kha_SystemImpl.khanvas.ownerDocument.addEventListener("mouseup",kha_SystemImpl.mouseMiddleUp)}else if(event.which==3){kha_SystemImpl.mouse.sendDownEvent(0,1,kha_SystemImpl.mouseX,kha_SystemImpl.mouseY);kha_SystemImpl.khanvas.ownerDocument.addEventListener("mouseup",kha_SystemImpl.mouseRightUp)}kha_SystemImpl.insideInputEvent=false};kha_SystemImpl.mouseLeftUp=function(event){kha_SystemImpl.unlockSound();if(event.which!=1){return}kha_SystemImpl.insideInputEvent=true;kha_SystemImpl.khanvas.ownerDocument.removeEventListener("mouseup",kha_SystemImpl.mouseLeftUp);if(kha_SystemImpl.khanvas.releaseCapture!=null){kha_SystemImpl.khanvas.ownerDocument.releaseCapture()}else{kha_SystemImpl.khanvas.ownerDocument.removeEventListener("mousemove",kha_SystemImpl.documentMouseMove,true)}if(kha_SystemImpl.leftMouseCtrlDown){kha_SystemImpl.mouse.sendUpEvent(0,1,kha_SystemImpl.mouseX,kha_SystemImpl.mouseY)}else{kha_SystemImpl.mouse.sendUpEvent(0,0,kha_SystemImpl.mouseX,kha_SystemImpl.mouseY)}kha_SystemImpl.leftMouseCtrlDown=false;kha_SystemImpl.insideInputEvent=false};kha_SystemImpl.mouseMiddleUp=function(event){kha_SystemImpl.unlockSound();if(event.which!=2){return}kha_SystemImpl.insideInputEvent=true;kha_SystemImpl.khanvas.ownerDocument.removeEventListener("mouseup",kha_SystemImpl.mouseMiddleUp);kha_SystemImpl.mouse.sendUpEvent(0,2,kha_SystemImpl.mouseX,kha_SystemImpl.mouseY);kha_SystemImpl.insideInputEvent=false};kha_SystemImpl.mouseRightUp=function(event){kha_SystemImpl.unlockSound();if(event.which!=3){return}kha_SystemImpl.insideInputEvent=true;kha_SystemImpl.khanvas.ownerDocument.removeEventListener("mouseup",kha_SystemImpl.mouseRightUp);kha_SystemImpl.mouse.sendUpEvent(0,1,kha_SystemImpl.mouseX,kha_SystemImpl.mouseY);kha_SystemImpl.insideInputEvent=false};kha_SystemImpl.documentMouseMove=function(event){event.stopPropagation();kha_SystemImpl.mouseMove(event)};kha_SystemImpl.mouseMove=function(event){kha_SystemImpl.insideInputEvent=true;var lastMouseX=kha_SystemImpl.mouseX;var lastMouseY=kha_SystemImpl.mouseY;kha_SystemImpl.setMouseXY(event);var movementX=event.movementX;var movementY=event.movementY;if(event.movementX==null){movementX=event.mozMovementX!=null?event.mozMovementX:event.webkitMovementX!=null?event.webkitMovementX:kha_SystemImpl.mouseX-lastMouseX;movementY=event.mozMovementY!=null?event.mozMovementY:event.webkitMovementY!=null?event.webkitMovementY:kha_SystemImpl.mouseY-lastMouseY}if(kha_SystemImpl.firefox){movementX=Std.int(movementX*window.devicePixelRatio);movementY=Std.int(movementY*window.devicePixelRatio)}kha_SystemImpl.mouse.sendMoveEvent(0,kha_SystemImpl.mouseX,kha_SystemImpl.mouseY,movementX,movementY);kha_SystemImpl.insideInputEvent=false};kha_SystemImpl.setTouchXY=function(touch){var rect=kha_SystemImpl.khanvas.getBoundingClientRect();var borderWidth=kha_SystemImpl.khanvas.clientLeft;var borderHeight=kha_SystemImpl.khanvas.clientTop;kha_SystemImpl.touchX=Std.int((touch.clientX-rect.left-borderWidth)*kha_SystemImpl.khanvas.width/(rect.width-2*borderWidth));kha_SystemImpl.touchY=Std.int((touch.clientY-rect.top-borderHeight)*kha_SystemImpl.khanvas.height/(rect.height-2*borderHeight))};kha_SystemImpl.touchDown=function(event){kha_SystemImpl.insideInputEvent=true;kha_SystemImpl.unlockSound();event.stopPropagation();event.preventDefault();var _g=0;var _g1=event.changedTouches;while(_g<_g1.length){var touch=_g1[_g];++_g;var id=touch.identifier;if(kha_SystemImpl.ios){id=kha_SystemImpl.iosTouchs.indexOf(-1);if(id==-1){id=kha_SystemImpl.iosTouchs.length}kha_SystemImpl.iosTouchs[id]=touch.identifier}kha_SystemImpl.setTouchXY(touch);kha_SystemImpl.mouse.sendDownEvent(0,0,kha_SystemImpl.touchX,kha_SystemImpl.touchY);kha_SystemImpl.surface.sendTouchStartEvent(id,kha_SystemImpl.touchX,kha_SystemImpl.touchY)}kha_SystemImpl.insideInputEvent=false};kha_SystemImpl.touchUp=function(event){kha_SystemImpl.insideInputEvent=true;kha_SystemImpl.unlockSound();var _g=0;var _g1=event.changedTouches;while(_g<_g1.length){var touch=_g1[_g];++_g;var id=touch.identifier;if(kha_SystemImpl.ios){id=kha_SystemImpl.iosTouchs.indexOf(id);kha_SystemImpl.iosTouchs[id]=-1}kha_SystemImpl.setTouchXY(touch);kha_SystemImpl.mouse.sendUpEvent(0,0,kha_SystemImpl.touchX,kha_SystemImpl.touchY);kha_SystemImpl.surface.sendTouchEndEvent(id,kha_SystemImpl.touchX,kha_SystemImpl.touchY)}kha_SystemImpl.insideInputEvent=false};kha_SystemImpl.touchMove=function(event){kha_SystemImpl.insideInputEvent=true;kha_SystemImpl.unlockSound();var index=0;var _g=0;var _g1=event.changedTouches;while(_g<_g1.length){var touch=_g1[_g];++_g;kha_SystemImpl.setTouchXY(touch);if(index==0){var movementX=kha_SystemImpl.touchX-kha_SystemImpl.lastFirstTouchX;var movementY=kha_SystemImpl.touchY-kha_SystemImpl.lastFirstTouchY;kha_SystemImpl.lastFirstTouchX=kha_SystemImpl.touchX;kha_SystemImpl.lastFirstTouchY=kha_SystemImpl.touchY;kha_SystemImpl.mouse.sendMoveEvent(0,kha_SystemImpl.touchX,kha_SystemImpl.touchY,movementX,movementY)}var id=touch.identifier;if(kha_SystemImpl.ios){id=kha_SystemImpl.iosTouchs.indexOf(id)}kha_SystemImpl.surface.sendMoveEvent(id,kha_SystemImpl.touchX,kha_SystemImpl.touchY);++index}kha_SystemImpl.insideInputEvent=false};kha_SystemImpl.touchCancel=function(event){kha_SystemImpl.insideInputEvent=true;kha_SystemImpl.unlockSound();var _g=0;var _g1=event.changedTouches;while(_g<_g1.length){var touch=_g1[_g];++_g;var id=touch.identifier;if(kha_SystemImpl.ios){id=kha_SystemImpl.iosTouchs.indexOf(id)}kha_SystemImpl.setTouchXY(touch);kha_SystemImpl.mouse.sendUpEvent(0,0,kha_SystemImpl.touchX,kha_SystemImpl.touchY);kha_SystemImpl.surface.sendTouchEndEvent(id,kha_SystemImpl.touchX,kha_SystemImpl.touchY)}kha_SystemImpl.iosTouchs=[];kha_SystemImpl.insideInputEvent=false};kha_SystemImpl.onBlur=function(){kha_System.background()};kha_SystemImpl.onFocus=function(){kha_System.foreground()};kha_SystemImpl.keyDown=function(event){if((event.keyCode<112||event.keyCode>123)&&(event.key!=null&&event.key.length!=1)){event.preventDefault()}event.stopPropagation();if(kha_SystemImpl.ie){if(kha_SystemImpl.pressedKeys[event.keyCode]){event.preventDefault();return}kha_SystemImpl.pressedKeys[event.keyCode]=true}else if(event.repeat){event.preventDefault();return}kha_SystemImpl.keyboard.sendDownEvent(event.keyCode)};kha_SystemImpl.keyUp=function(event){event.preventDefault();event.stopPropagation();if(kha_SystemImpl.ie){kha_SystemImpl.pressedKeys[event.keyCode]=false}kha_SystemImpl.keyboard.sendUpEvent(event.keyCode)};kha_SystemImpl.keyPress=function(event){if(event.which==0){return}event.preventDefault();event.stopPropagation();var code=event.which;kha_SystemImpl.keyboard.sendPressEvent(String.fromCodePoint(code))};kha_SystemImpl.getGamepads=function(){if(kha_SystemImpl.chrome&&kha_vr_VrInterface.instance.IsVrEnabled()){return null}if(navigator.getGamepads){return window.navigator.getGamepads()}else{return null}};kha_SystemImpl.getPen=function(num){return null};var kha_Video=function(){};$hxClasses["kha.Video"]=kha_Video;kha_Video.__name__=true;kha_Video.__interfaces__=[kha_Resource];kha_Video.prototype={__class__:kha_Video};var kha_WebGLImage=function(width,height,format,renderTarget,depthStencilFormat,samples){this.depthTexture=null;this.texture=null;this.renderBuffer=null;this.frameBuffer=null;this.myWidth=width;this.myHeight=height;this.format=format;this.renderTarget=renderTarget;this.samples=samples;this.image=null;this.video=null;this.depthStencilFormat=depthStencilFormat;kha_WebGLImage.init();if(renderTarget){this.createTexture()}};$hxClasses["kha.WebGLImage"]=kha_WebGLImage;kha_WebGLImage.__name__=true;kha_WebGLImage.init=function(){if(kha_WebGLImage.context==null){kha_WebGLImage.canvas=window.document.createElement("canvas");if(kha_WebGLImage.canvas!=null){kha_WebGLImage.context=kha_WebGLImage.canvas.getContext("2d");kha_WebGLImage.canvas.width=4096;kha_WebGLImage.canvas.height=4096;kha_WebGLImage.context.globalCompositeOperation="copy"}}};kha_WebGLImage.formatByteSize=function(format){switch(format){case 0:return 4;case 1:return 1;case 2:return 16;case 3:return 2;case 4:return 8;case 5:return 4;case 6:return 2;default:return 4}};kha_WebGLImage.__super__=kha_Image;kha_WebGLImage.prototype=$extend(kha_Image.prototype,{get_g2:function(){if(this.graphics2==null){this.graphics2=new kha_js_graphics4_Graphics2(this)}return this.graphics2},get_g4:function(){if(this.graphics4==null){this.graphics4=new kha_js_graphics4_Graphics(this)}return this.graphics4},get_width:function(){return this.myWidth},get_height:function(){return this.myHeight},get_realWidth:function(){return this.myWidth},get_realHeight:function(){return this.myHeight},createTexture:function(){if(kha_SystemImpl.gl==null){return}this.texture=kha_SystemImpl.gl.createTexture();kha_SystemImpl.gl.bindTexture(3553,this.texture);kha_SystemImpl.gl.texParameteri(3553,10240,9729);kha_SystemImpl.gl.texParameteri(3553,10241,9729);kha_SystemImpl.gl.texParameteri(3553,10242,33071);kha_SystemImpl.gl.texParameteri(3553,10243,33071);if(this.renderTarget){this.frameBuffer=kha_SystemImpl.gl.createFramebuffer();kha_SystemImpl.gl.bindFramebuffer(36160,this.frameBuffer);switch(this.format){case 0:kha_SystemImpl.gl.texImage2D(3553,0,6408,this.get_realWidth(),this.get_realHeight(),0,6408,5121,null);break;case 2:kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?34836:6408,this.get_realWidth(),this.get_realHeight(),0,6408,5126,null);break;case 3:kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?33189:6402,this.get_realWidth(),this.get_realHeight(),0,6402,5123,null);break;case 4:kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?34842:6408,this.get_realWidth(),this.get_realHeight(),0,6408,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);break;case 5:kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?33326:6406,this.get_realWidth(),this.get_realHeight(),0,kha_SystemImpl.gl2?6403:6406,5126,null);break;case 6:kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?33325:6406,this.get_realWidth(),this.get_realHeight(),0,kha_SystemImpl.gl2?6403:6406,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);break;default:kha_SystemImpl.gl.texImage2D(3553,0,6408,this.get_realWidth(),this.get_realHeight(),0,6408,5121,null)}if(this.format==3){kha_SystemImpl.gl.texParameteri(3553,10240,9728);kha_SystemImpl.gl.texParameteri(3553,10241,9728);kha_SystemImpl.gl.framebufferTexture2D(36160,36096,3553,this.texture,0);if(!kha_SystemImpl.gl2){var colortex=kha_SystemImpl.gl.createTexture();kha_SystemImpl.gl.bindTexture(3553,colortex);kha_SystemImpl.gl.texImage2D(3553,0,6408,this.get_realWidth(),this.get_realHeight(),0,6408,5121,null);kha_SystemImpl.gl.framebufferTexture2D(36160,36064,3553,colortex,0);kha_SystemImpl.gl.bindTexture(3553,this.texture)}}else{kha_SystemImpl.gl.framebufferTexture2D(36160,36064,3553,this.texture,0)}this.initDepthStencilBuffer(this.depthStencilFormat);if(kha_SystemImpl.gl.checkFramebufferStatus(36160)!=36053){haxe_Log.trace("WebGL error: Framebuffer incomplete",{fileName:"kha/WebGLImage.hx",lineNumber:225,className:"kha.WebGLImage",methodName:"createTexture"})}kha_SystemImpl.gl.bindRenderbuffer(36161,null);kha_SystemImpl.gl.bindFramebuffer(36160,null)}else if(this.video!=null){kha_SystemImpl.gl.texImage2D(3553,0,6408,6408,5121,this.video)}else{switch(this.format){case 0:if(this.image instanceof Uint8Array){kha_SystemImpl.gl.texImage2D(3553,0,6408,this.myWidth,this.myHeight,0,6408,5121,this.image)}else{kha_SystemImpl.gl.texImage2D(3553,0,6408,6408,5121,this.image)}break;case 1:kha_SystemImpl.gl.texImage2D(3553,0,6409,this.myWidth,this.myHeight,0,6409,5121,this.image);break;case 2:kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?34836:6408,this.myWidth,this.myHeight,0,6408,5126,this.image);break;case 4:kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?34842:6408,this.myWidth,this.myHeight,0,6408,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,this.image);break;case 5:kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?33326:6406,this.myWidth,this.myHeight,0,kha_SystemImpl.gl2?6403:6406,5126,this.image);break;case 6:kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?33325:6406,this.myWidth,this.myHeight,0,kha_SystemImpl.gl2?6403:6406,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,this.image);break;default:kha_SystemImpl.gl.texImage2D(3553,0,6408,6408,5121,this.image)}}kha_SystemImpl.gl.bindTexture(3553,null)},initDepthStencilBuffer:function(depthStencilFormat){switch(depthStencilFormat){case 0:break;case 1:case 5:if(kha_SystemImpl.depthTexture==null){this.renderBuffer=kha_SystemImpl.gl.createRenderbuffer();kha_SystemImpl.gl.bindRenderbuffer(36161,this.renderBuffer);kha_SystemImpl.gl.renderbufferStorage(36161,33189,this.get_realWidth(),this.get_realHeight());kha_SystemImpl.gl.framebufferRenderbuffer(36160,36096,36161,this.renderBuffer)}else{this.depthTexture=kha_SystemImpl.gl.createTexture();kha_SystemImpl.gl.bindTexture(3553,this.depthTexture);if(depthStencilFormat==1){kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?33190:6402,this.get_realWidth(),this.get_realHeight(),0,6402,5125,null)}else{kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?33189:6402,this.get_realWidth(),this.get_realHeight(),0,6402,5123,null)}kha_SystemImpl.gl.texParameteri(3553,10240,9728);kha_SystemImpl.gl.texParameteri(3553,10241,9728);kha_SystemImpl.gl.texParameteri(3553,10242,33071);kha_SystemImpl.gl.texParameteri(3553,10243,33071);kha_SystemImpl.gl.bindFramebuffer(36160,this.frameBuffer);kha_SystemImpl.gl.framebufferTexture2D(36160,36096,3553,this.depthTexture,0)}break;case 2:case 3:case 4:if(kha_SystemImpl.depthTexture==null){this.renderBuffer=kha_SystemImpl.gl.createRenderbuffer();kha_SystemImpl.gl.bindRenderbuffer(36161,this.renderBuffer);kha_SystemImpl.gl.renderbufferStorage(36161,34041,this.get_realWidth(),this.get_realHeight());kha_SystemImpl.gl.framebufferRenderbuffer(36160,33306,36161,this.renderBuffer)}else{this.depthTexture=kha_SystemImpl.gl.createTexture();kha_SystemImpl.gl.bindTexture(3553,this.depthTexture);kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?35056:34041,this.get_realWidth(),this.get_realHeight(),0,34041,kha_SystemImpl.depthTexture.UNSIGNED_INT_24_8_WEBGL,null);kha_SystemImpl.gl.texParameteri(3553,10240,9728);kha_SystemImpl.gl.texParameteri(3553,10241,9728);kha_SystemImpl.gl.texParameteri(3553,10242,33071);kha_SystemImpl.gl.texParameteri(3553,10243,33071);kha_SystemImpl.gl.bindFramebuffer(36160,this.frameBuffer);kha_SystemImpl.gl.framebufferTexture2D(36160,33306,3553,this.depthTexture,0)}break}},set:function(stage){kha_SystemImpl.gl.activeTexture(33984+stage);kha_SystemImpl.gl.bindTexture(3553,this.texture);if(this.video!=null){kha_SystemImpl.gl.texImage2D(3553,0,6408,6408,5121,this.video)}},setDepth:function(stage){kha_SystemImpl.gl.activeTexture(33984+stage);kha_SystemImpl.gl.bindTexture(3553,this.depthTexture)},setDepthStencilFrom:function(image){this.depthTexture=js_Boot.__cast(image,kha_WebGLImage).depthTexture;kha_SystemImpl.gl.bindFramebuffer(36160,this.frameBuffer);kha_SystemImpl.gl.framebufferTexture2D(36160,36096,3553,this.depthTexture,0)},bytesToArray:function(bytes){switch(this.format){case 0:case 1:return new Uint8Array(bytes.getData());case 2:case 4:case 5:case 6:return new Float32Array(bytes.getData());default:return new Uint8Array(bytes.getData())}},lock:function(level){if(level==null){level=0}this.bytes=haxe_io_Bytes.alloc(kha_WebGLImage.formatByteSize(this.format)*this.get_width()*this.get_height());return this.bytes},unlock:function(){if(kha_SystemImpl.gl!=null){this.texture=kha_SystemImpl.gl.createTexture();kha_SystemImpl.gl.bindTexture(3553,this.texture);kha_SystemImpl.gl.texParameteri(3553,10240,9729);kha_SystemImpl.gl.texParameteri(3553,10241,9729);kha_SystemImpl.gl.texParameteri(3553,10242,33071);kha_SystemImpl.gl.texParameteri(3553,10243,33071);switch(this.format){case 0:kha_SystemImpl.gl.texImage2D(3553,0,6408,this.get_width(),this.get_height(),0,6408,5121,this.bytesToArray(this.bytes));break;case 1:kha_SystemImpl.gl.texImage2D(3553,0,6409,this.get_width(),this.get_height(),0,6409,5121,this.bytesToArray(this.bytes));if(kha_SystemImpl.gl.getError()==1282){var rgbaBytes=haxe_io_Bytes.alloc(this.get_width()*this.get_height()*4);var _g=0;var _g1=this.get_height();while(_g<_g1){var y=_g++;var _g2=0;var _g11=this.get_width();while(_g2<_g11){var x=_g2++;var value=this.bytes.get(y*this.get_width()+x);rgbaBytes.set(y*this.get_width()*4+x*4,value);rgbaBytes.set(y*this.get_width()*4+x*4+1,value);rgbaBytes.set(y*this.get_width()*4+x*4+2,value);rgbaBytes.set(y*this.get_width()*4+x*4+3,255)}}kha_SystemImpl.gl.texImage2D(3553,0,6408,this.get_width(),this.get_height(),0,6408,5121,this.bytesToArray(rgbaBytes))}break;case 2:kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?34836:6408,this.get_width(),this.get_height(),0,6408,5126,this.bytesToArray(this.bytes));break;case 4:kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?34842:6408,this.get_width(),this.get_height(),0,6408,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,this.bytesToArray(this.bytes));break;case 5:kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?33326:6406,this.get_width(),this.get_height(),0,kha_SystemImpl.gl2?6403:6406,5126,this.bytesToArray(this.bytes));break;case 6:kha_SystemImpl.gl.texImage2D(3553,0,kha_SystemImpl.gl2?33325:6406,this.get_width(),this.get_height(),0,kha_SystemImpl.gl2?6403:6406,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,this.bytesToArray(this.bytes));break;default:kha_SystemImpl.gl.texImage2D(3553,0,6408,this.get_width(),this.get_height(),0,6408,5121,this.bytesToArray(this.bytes))}kha_SystemImpl.gl.bindTexture(3553,null);this.bytes=null}},unload:function(){if(this.texture!=null){kha_SystemImpl.gl.deleteTexture(this.texture)}if(this.depthTexture!=null){kha_SystemImpl.gl.deleteTexture(this.depthTexture)}if(this.frameBuffer!=null){kha_SystemImpl.gl.deleteFramebuffer(this.frameBuffer)}if(this.renderBuffer!=null){kha_SystemImpl.gl.deleteRenderbuffer(this.renderBuffer)}},generateMipmaps:function(levels){kha_SystemImpl.gl.bindTexture(3553,this.texture);kha_SystemImpl.gl.generateMipmap(3553)},setMipmaps:function(mipmaps){kha_SystemImpl.gl.bindTexture(3553,this.texture);if(this.format==2){var _g=0;var _g1=mipmaps.length;while(_g<_g1){var i=_g++;kha_SystemImpl.gl.texImage2D(3553,i+1,kha_SystemImpl.gl2?34836:6408,mipmaps[i].get_width(),mipmaps[i].get_height(),0,6408,5126,js_Boot.__cast(mipmaps[i],kha_WebGLImage).image)}}else if(this.format==4){var _g2=0;var _g11=mipmaps.length;while(_g2<_g11){var i1=_g2++;kha_SystemImpl.gl.texImage2D(3553,i1+1,kha_SystemImpl.gl2?34842:6408,mipmaps[i1].get_width(),mipmaps[i1].get_height(),0,6408,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,js_Boot.__cast(mipmaps[i1],kha_WebGLImage).image)}}else{var _g3=0;var _g12=mipmaps.length;while(_g3<_g12){var i2=_g3++;kha_SystemImpl.gl.texImage2D(3553,i2+1,6408,6408,5121,js_Boot.__cast(mipmaps[i2],kha_WebGLImage).image)}}},__class__:kha_WebGLImage});var kha_Window=function(defaultWidth,defaultHeight,canvas){this.canvas=canvas;this.defaultWidth=defaultWidth;this.defaultHeight=defaultHeight;kha_Window.windows.push(this)};$hxClasses["kha.Window"]=kha_Window;kha_Window.__name__=true;kha_Window.__properties__={get_all:"get_all"};kha_Window.get=function(index){return kha_Window.windows[index]};kha_Window.get_all=function(){return kha_Window.windows};kha_Window.prototype={get_width:function(){if(this.canvas.clientWidth==0){return this.defaultWidth}else{return this.canvas.clientWidth}},get_height:function(){if(this.canvas.clientHeight==0){return this.defaultHeight}else{return this.canvas.clientHeight}},get_vSynced:function(){return true},__class__:kha_Window,__properties__:{get_vSynced:"get_vSynced",get_height:"get_height",get_width:"get_width"}};var kha_WindowOptions=function(title,x,y,width,height,display,visible,windowFeatures,mode){if(mode==null){mode=0}if(visible==null){visible=true}if(height==null){height=600}if(width==null){width=800}if(y==null){y=-1}if(x==null){x=-1}this.mode=0;this.windowFeatures=1|4|2;this.visible=true;this.display=null;this.height=600;this.width=800;this.y=-1;this.x=-1;this.title=null;this.title=title;this.x=x;this.y=y;this.width=width;this.height=height;this.display=display==null?kha_Display.get_primary():display;this.visible=visible;this.windowFeatures=windowFeatures==null?1|4|2:windowFeatures;this.mode=mode};$hxClasses["kha.WindowOptions"]=kha_WindowOptions;kha_WindowOptions.__name__=true;kha_WindowOptions.prototype={__class__:kha_WindowOptions};var kha_audio1_AudioChannel=function(){};$hxClasses["kha.audio1.AudioChannel"]=kha_audio1_AudioChannel;kha_audio1_AudioChannel.__name__=true;kha_audio1_AudioChannel.prototype={__class__:kha_audio1_AudioChannel,__properties__:{get_finished:"get_finished",set_volume:"set_volume"}};var kha_audio2_Audio=function(){};$hxClasses["kha.audio2.Audio"]=kha_audio2_Audio;kha_audio2_Audio.__name__=true;kha_audio2_Audio.initContext=function(){try{kha_audio2_Audio._context=new AudioContext;return}catch(e){var e1=e instanceof js__$Boot_HaxeError?e.val:e}try{this._context=new webkitAudioContext;return}catch(e2){var e3=e2 instanceof js__$Boot_HaxeError?e2.val:e2}};kha_audio2_Audio._init=function(){kha_audio2_Audio.initContext();if(kha_audio2_Audio._context==null){return false}var bufferSize=2048;kha_audio2_Audio.buffer=new kha_audio2_Buffer(bufferSize*4,2,Std.int(kha_audio2_Audio._context.sampleRate));kha_audio2_Audio.processingNode=kha_audio2_Audio._context.createScriptProcessor(bufferSize,0,2);kha_audio2_Audio.processingNode.onaudioprocess=function(e){var output1=e.outputBuffer.getChannelData(0);var output2=e.outputBuffer.getChannelData(1);if(kha_audio2_Audio.audioCallback!=null){kha_audio2_Audio.audioCallback(e.outputBuffer.length*2,kha_audio2_Audio.buffer);var _g=0;var _g1=e.outputBuffer.length;while(_g<_g1){var i=_g++;output1[i]=kha_audio2_Audio.buffer.data[kha_audio2_Audio.buffer.readLocation];kha_audio2_Audio.buffer.readLocation+=1;output2[i]=kha_audio2_Audio.buffer.data[kha_audio2_Audio.buffer.readLocation];kha_audio2_Audio.buffer.readLocation+=1;if(kha_audio2_Audio.buffer.readLocation>=kha_audio2_Audio.buffer.size){kha_audio2_Audio.buffer.readLocation=0}}}else{var _g2=0;var _g11=e.outputBuffer.length;while(_g2<_g11){var i1=_g2++;output1[i1]=0;output2[i1]=0}}};kha_audio2_Audio.processingNode.connect(kha_audio2_Audio._context.destination);return true};var kha_audio2_Audio1=function(){};$hxClasses["kha.audio2.Audio1"]=kha_audio2_Audio1;kha_audio2_Audio1.__name__=true;kha_audio2_Audio1._init=function(){var this1=new Array(16);kha_audio2_Audio1.soundChannels=this1;var this2=new Array(16);kha_audio2_Audio1.streamChannels=this2;var this3=new Array(16);kha_audio2_Audio1.internalSoundChannels=this3;var this4=new Array(16);kha_audio2_Audio1.internalStreamChannels=this4;var this5=new Float32Array(512);kha_audio2_Audio1.sampleCache1=this5;var this6=new Float32Array(512);kha_audio2_Audio1.sampleCache2=this6;kha_audio2_Audio.audioCallback=kha_audio2_Audio1.mix};kha_audio2_Audio1.max=function(a,b){if(a>b){return a}else{return b}};kha_audio2_Audio1.min=function(a,b){if(a<b){return a}else{return b}};kha_audio2_Audio1.mix=function(samples,buffer){if(kha_audio2_Audio1.sampleCache1.length<samples){var this1=new Float32Array(samples);kha_audio2_Audio1.sampleCache1=this1;var this2=new Float32Array(samples);kha_audio2_Audio1.sampleCache2=this2}var _g=0;var _g1=samples;while(_g<_g1){var i=_g++;kha_audio2_Audio1.sampleCache2[i]=0}kha_audio2_Audio1.internalSoundChannels[0]=kha_audio2_Audio1.soundChannels[0];kha_audio2_Audio1.internalSoundChannels[1]=kha_audio2_Audio1.soundChannels[1];kha_audio2_Audio1.internalSoundChannels[2]=kha_audio2_Audio1.soundChannels[2];kha_audio2_Audio1.internalSoundChannels[3]=kha_audio2_Audio1.soundChannels[3];kha_audio2_Audio1.internalSoundChannels[4]=kha_audio2_Audio1.soundChannels[4];kha_audio2_Audio1.internalSoundChannels[5]=kha_audio2_Audio1.soundChannels[5];kha_audio2_Audio1.internalSoundChannels[6]=kha_audio2_Audio1.soundChannels[6];kha_audio2_Audio1.internalSoundChannels[7]=kha_audio2_Audio1.soundChannels[7];kha_audio2_Audio1.internalSoundChannels[8]=kha_audio2_Audio1.soundChannels[8];kha_audio2_Audio1.internalSoundChannels[9]=kha_audio2_Audio1.soundChannels[9];kha_audio2_Audio1.internalSoundChannels[10]=kha_audio2_Audio1.soundChannels[10];kha_audio2_Audio1.internalSoundChannels[11]=kha_audio2_Audio1.soundChannels[11];kha_audio2_Audio1.internalSoundChannels[12]=kha_audio2_Audio1.soundChannels[12];kha_audio2_Audio1.internalSoundChannels[13]=kha_audio2_Audio1.soundChannels[13];kha_audio2_Audio1.internalSoundChannels[14]=kha_audio2_Audio1.soundChannels[14];kha_audio2_Audio1.internalSoundChannels[15]=kha_audio2_Audio1.soundChannels[15];kha_audio2_Audio1.internalStreamChannels[0]=kha_audio2_Audio1.streamChannels[0];kha_audio2_Audio1.internalStreamChannels[1]=kha_audio2_Audio1.streamChannels[1];kha_audio2_Audio1.internalStreamChannels[2]=kha_audio2_Audio1.streamChannels[2];kha_audio2_Audio1.internalStreamChannels[3]=kha_audio2_Audio1.streamChannels[3];kha_audio2_Audio1.internalStreamChannels[4]=kha_audio2_Audio1.streamChannels[4];kha_audio2_Audio1.internalStreamChannels[5]=kha_audio2_Audio1.streamChannels[5];kha_audio2_Audio1.internalStreamChannels[6]=kha_audio2_Audio1.streamChannels[6];kha_audio2_Audio1.internalStreamChannels[7]=kha_audio2_Audio1.streamChannels[7];kha_audio2_Audio1.internalStreamChannels[8]=kha_audio2_Audio1.streamChannels[8];kha_audio2_Audio1.internalStreamChannels[9]=kha_audio2_Audio1.streamChannels[9];kha_audio2_Audio1.internalStreamChannels[10]=kha_audio2_Audio1.streamChannels[10];kha_audio2_Audio1.internalStreamChannels[11]=kha_audio2_Audio1.streamChannels[11];kha_audio2_Audio1.internalStreamChannels[12]=kha_audio2_Audio1.streamChannels[12];kha_audio2_Audio1.internalStreamChannels[13]=kha_audio2_Audio1.streamChannels[13];kha_audio2_Audio1.internalStreamChannels[14]=kha_audio2_Audio1.streamChannels[14];kha_audio2_Audio1.internalStreamChannels[15]=kha_audio2_Audio1.streamChannels[15];var _g2=0;var _g3=kha_audio2_Audio1.internalSoundChannels;while(_g2<_g3.length){var channel=_g3[_g2];++_g2;if(channel==null||channel.get_finished()){continue}channel.nextSamples(kha_audio2_Audio1.sampleCache1,samples,buffer.samplesPerSecond);var _g21=0;var _g31=samples;while(_g21<_g31){var i1=_g21++;kha_audio2_Audio1.sampleCache2[i1]+=kha_audio2_Audio1.sampleCache1[i1]*channel.get_volume()}}var _g4=0;var _g5=kha_audio2_Audio1.internalStreamChannels;while(_g4<_g5.length){var channel1=_g5[_g4];++_g4;if(channel1==null||channel1.get_finished()){continue}channel1.nextSamples(kha_audio2_Audio1.sampleCache1,samples,buffer.samplesPerSecond);var _g41=0;var _g51=samples;while(_g41<_g51){var i2=_g41++;kha_audio2_Audio1.sampleCache2[i2]+=kha_audio2_Audio1.sampleCache1[i2]*channel1.get_volume()}}var _g6=0;var _g7=samples;while(_g6<_g7){var i3=_g6++;buffer.data[buffer.writeLocation]=kha_audio2_Audio1.max(kha_audio2_Audio1.min(kha_audio2_Audio1.sampleCache2[i3],1),-1);buffer.writeLocation+=1;if(buffer.writeLocation>=buffer.size){buffer.writeLocation=0}}};kha_audio2_Audio1._playAgain=function(channel){var _g=0;while(_g<16){var i=_g++;if(kha_audio2_Audio1.soundChannels[i]==null||kha_audio2_Audio1.soundChannels[i].get_finished()||kha_audio2_Audio1.soundChannels[i]==channel){kha_audio2_Audio1.soundChannels[i]=channel;break}}};var kha_audio2_AudioChannel=function(looping){this.paused=false;this.looping=looping;this.myVolume=1;this.myPosition=0};$hxClasses["kha.audio2.AudioChannel"]=kha_audio2_AudioChannel;kha_audio2_AudioChannel.__name__=true;kha_audio2_AudioChannel.__interfaces__=[kha_audio1_AudioChannel];kha_audio2_AudioChannel.prototype={nextSamples:function(samples,length,sampleRate){if(this.paused){var _g=0;var _g1=length;while(_g<_g1){var i=_g++;samples[i]=0}return}var w_ptr=0;var chk_ptr=0;while(w_ptr<length){var addressable_data=this.data.length-this.myPosition;var next_chunk=addressable_data<length-w_ptr?addressable_data:length-w_ptr;while(chk_ptr<next_chunk){samples[w_ptr]=this.data[this.myPosition];++this.myPosition;++chk_ptr;++w_ptr}if(!this.looping){break}else{chk_ptr=0;if(this.myPosition>=this.data.length){this.myPosition=0}}}while(w_ptr<length){samples[w_ptr]=0;++w_ptr}},play:function(){this.paused=false;if(this.get_finished()){this.myPosition=0;kha_audio2_Audio1._playAgain(this)}},get_volume:function(){return this.myVolume},set_volume:function(value){return this.myVolume=value},get_finished:function(){return this.myPosition>=this.data.length},__class__:kha_audio2_AudioChannel,__properties__:{get_finished:"get_finished",set_volume:"set_volume",get_volume:"get_volume"}};var kha_audio2_Buffer=function(size,channels,samplesPerSecond){this.size=size;var this1=new Float32Array(size);this.data=this1;this.channels=channels;this.samplesPerSecond=samplesPerSecond;this.readLocation=0;this.writeLocation=0};$hxClasses["kha.audio2.Buffer"]=kha_audio2_Buffer;kha_audio2_Buffer.__name__=true;kha_audio2_Buffer.prototype={__class__:kha_audio2_Buffer};var kha_audio2_StreamChannel=function(data,loop){this.paused=false;this.atend=false;this.myVolume=1;this.loop=loop};$hxClasses["kha.audio2.StreamChannel"]=kha_audio2_StreamChannel;kha_audio2_StreamChannel.__name__=true;kha_audio2_StreamChannel.__interfaces__=[kha_audio1_AudioChannel];kha_audio2_StreamChannel.prototype={nextSamples:function(samples,length,sampleRate){if(this.paused){var _g=0;var _g1=length;while(_g<_g1){var i=_g++;samples[i]=0}return}},play:function(){this.paused=false},get_volume:function(){return this.myVolume},set_volume:function(value){return this.myVolume=value},get_finished:function(){return this.atend},__class__:kha_audio2_StreamChannel,__properties__:{get_finished:"get_finished",set_volume:"set_volume",get_volume:"get_volume"}};var kha_audio2_ogg_vorbis_data_Header=function(){};$hxClasses["kha.audio2.ogg.vorbis.data.Header"]=kha_audio2_ogg_vorbis_data_Header;kha_audio2_ogg_vorbis_data_Header.__name__=true;var kha_graphics1_Graphics=function(){};$hxClasses["kha.graphics1.Graphics"]=kha_graphics1_Graphics;kha_graphics1_Graphics.__name__=true;var kha_graphics2_Graphics=function(){this.transformations=[];this.transformations.push(new kha_math_FastMatrix3(1,0,0,0,1,0,0,0,1));this.opacities=[];this.opacities.push(1);this.myFontSize=12;this.pipe=null};$hxClasses["kha.graphics2.Graphics"]=kha_graphics2_Graphics;kha_graphics2_Graphics.__name__=true;kha_graphics2_Graphics.prototype={begin:function(clear,clearColor){if(clear==null){clear=true}},end:function(){},drawImage:function(img,x,y){this.drawSubImage(img,x,y,0,0,img.get_width(),img.get_height())},drawSubImage:function(img,x,y,sx,sy,sw,sh){this.drawScaledSubImage(img,sx,sy,sw,sh,x,y,sw,sh)},drawScaledImage:function(img,dx,dy,dw,dh){this.drawScaledSubImage(img,0,0,img.get_width(),img.get_height(),dx,dy,dw,dh)},drawScaledSubImage:function(image,sx,sy,sw,sh,dx,dy,dw,dh){},drawRect:function(x,y,width,height,strength){if(strength==null){strength=1}},fillRect:function(x,y,width,height){},drawString:function(text,x,y){},drawLine:function(x1,y1,x2,y2,strength){if(strength==null){strength=1}},fillTriangle:function(x1,y1,x2,y2,x3,y3){},set_imageScaleQuality:function(value){return kha_graphics2_ImageScaleQuality.High},get_color:function(){return-16777216},set_color:function(color){return-16777216},get_font:function(){return null},set_font:function(font){return null},get_fontSize:function(){return this.myFontSize},set_fontSize:function(value){return this.myFontSize=value},pushTransformation:function(transformation){var trans=new kha_math_FastMatrix3(1,0,0,0,1,0,0,0,1);trans._00=transformation._00;trans._10=transformation._10;trans._20=transformation._20;trans._01=transformation._01;trans._11=transformation._11;trans._21=transformation._21;trans._02=transformation._02;trans._12=transformation._12;trans._22=transformation._22;this.setTransformation(trans);this.transformations.push(trans)},popTransformation:function(){var ret=this.transformations.pop();this.setTransformation(this.get_transformation());return ret},get_transformation:function(){return this.transformations[this.transformations.length-1]},rotation:function(angle,centerx,centery){var _this=new kha_math_FastMatrix3(1,0,centerx,0,1,centery,0,0,1);var m=new kha_math_FastMatrix3(Math.cos(angle),-Math.sin(angle),0,Math.sin(angle),Math.cos(angle),0,0,0,1);var _this1=new kha_math_FastMatrix3(_this._00*m._00+_this._10*m._01+_this._20*m._02,_this._00*m._10+_this._10*m._11+_this._20*m._12,_this._00*m._20+_this._10*m._21+_this._20*m._22,_this._01*m._00+_this._11*m._01+_this._21*m._02,_this._01*m._10+_this._11*m._11+_this._21*m._12,_this._01*m._20+_this._11*m._21+_this._21*m._22,_this._02*m._00+_this._12*m._01+_this._22*m._02,_this._02*m._10+_this._12*m._11+_this._22*m._12,_this._02*m._20+_this._12*m._21+_this._22*m._22);var m1=new kha_math_FastMatrix3(1,0,-centerx,0,1,-centery,0,0,1);var _this2=new kha_math_FastMatrix3(_this1._00*m1._00+_this1._10*m1._01+_this1._20*m1._02,_this1._00*m1._10+_this1._10*m1._11+_this1._20*m1._12,_this1._00*m1._20+_this1._10*m1._21+_this1._20*m1._22,_this1._01*m1._00+_this1._11*m1._01+_this1._21*m1._02,_this1._01*m1._10+_this1._11*m1._11+_this1._21*m1._12,_this1._01*m1._20+_this1._11*m1._21+_this1._21*m1._22,_this1._02*m1._00+_this1._12*m1._01+_this1._22*m1._02,_this1._02*m1._10+_this1._12*m1._11+_this1._22*m1._12,_this1._02*m1._20+_this1._12*m1._21+_this1._22*m1._22);var m2=this.get_transformation();return new kha_math_FastMatrix3(_this2._00*m2._00+_this2._10*m2._01+_this2._20*m2._02,_this2._00*m2._10+_this2._10*m2._11+_this2._20*m2._12,_this2._00*m2._20+_this2._10*m2._21+_this2._20*m2._22,_this2._01*m2._00+_this2._11*m2._01+_this2._21*m2._02,_this2._01*m2._10+_this2._11*m2._11+_this2._21*m2._12,_this2._01*m2._20+_this2._11*m2._21+_this2._21*m2._22,_this2._02*m2._00+_this2._12*m2._01+_this2._22*m2._02,_this2._02*m2._10+_this2._12*m2._11+_this2._22*m2._12,_this2._02*m2._20+_this2._12*m2._21+_this2._22*m2._22)},pushRotation:function(angle,centerx,centery){this.pushTransformation(this.rotation(angle,centerx,centery))},get_opacity:function(){return this.opacities[this.opacities.length-1]},setTransformation:function(transformation){},__class__:kha_graphics2_Graphics,__properties__:{get_opacity:"get_opacity",get_transformation:"get_transformation",set_fontSize:"set_fontSize",get_fontSize:"get_fontSize",set_font:"set_font",get_font:"get_font",set_color:"set_color",get_color:"get_color",set_imageScaleQuality:"set_imageScaleQuality"}};var kha_graphics2_Graphics1=function(canvas){this.canvas=canvas};$hxClasses["kha.graphics2.Graphics1"]=kha_graphics2_Graphics1;kha_graphics2_Graphics1.__name__=true;kha_graphics2_Graphics1.__interfaces__=[kha_graphics1_Graphics];kha_graphics2_Graphics1.prototype={__class__:kha_graphics2_Graphics1};var kha_graphics2_GraphicsExtension=function(){};$hxClasses["kha.graphics2.GraphicsExtension"]=kha_graphics2_GraphicsExtension;kha_graphics2_GraphicsExtension.__name__=true;kha_graphics2_GraphicsExtension.fillCircle=function(g2,cx,cy,radius,segments){if(segments==null){segments=0}if(kha_SystemImpl.gl==null){var g=g2;g.fillCircle(cx,cy,radius);return}if(segments<=0){segments=Math.floor(10*Math.sqrt(radius))}var theta=2*Math.PI/segments;var c=Math.cos(theta);var s=Math.sin(theta);var x=radius;var y=0;var _g=0;var _g1=segments;while(_g<_g1){var n=_g++;var px=x+cx;var py=y+cy;var t=x;x=c*x-s*y;y=c*y+s*t;g2.fillTriangle(px,py,x+cx,y+cy,cx,cy)}};var kha_graphics2_ImageScaleQuality=$hxEnums["kha.graphics2.ImageScaleQuality"]={__ename__:true,__constructs__:["Low","High"],Low:{_hx_index:0,__enum__:"kha.graphics2.ImageScaleQuality",toString:$estr},High:{_hx_index:1,__enum__:"kha.graphics2.ImageScaleQuality",toString:$estr}};var kha_graphics2_truetype_VectorOfIntPointer=function(){};$hxClasses["kha.graphics2.truetype.VectorOfIntPointer"]=kha_graphics2_truetype_VectorOfIntPointer;kha_graphics2_truetype_VectorOfIntPointer.__name__=true;kha_graphics2_truetype_VectorOfIntPointer.prototype={__class__:kha_graphics2_truetype_VectorOfIntPointer};var kha_graphics2_truetype_Stbtt_$temp_$rect=function(){};$hxClasses["kha.graphics2.truetype.Stbtt_temp_rect"]=kha_graphics2_truetype_Stbtt_$temp_$rect;kha_graphics2_truetype_Stbtt_$temp_$rect.__name__=true;kha_graphics2_truetype_Stbtt_$temp_$rect.prototype={__class__:kha_graphics2_truetype_Stbtt_$temp_$rect};var kha_graphics2_truetype_Stbtt_$temp_$glyph_$h_$metrics=function(){};$hxClasses["kha.graphics2.truetype.Stbtt_temp_glyph_h_metrics"]=kha_graphics2_truetype_Stbtt_$temp_$glyph_$h_$metrics;kha_graphics2_truetype_Stbtt_$temp_$glyph_$h_$metrics.__name__=true;kha_graphics2_truetype_Stbtt_$temp_$glyph_$h_$metrics.prototype={__class__:kha_graphics2_truetype_Stbtt_$temp_$glyph_$h_$metrics};var kha_graphics2_truetype_Stbtt_$temp_$font_$v_$metrics=function(){};$hxClasses["kha.graphics2.truetype.Stbtt_temp_font_v_metrics"]=kha_graphics2_truetype_Stbtt_$temp_$font_$v_$metrics;kha_graphics2_truetype_Stbtt_$temp_$font_$v_$metrics.__name__=true;kha_graphics2_truetype_Stbtt_$temp_$font_$v_$metrics.prototype={__class__:kha_graphics2_truetype_Stbtt_$temp_$font_$v_$metrics};var kha_graphics2_truetype_Stbtt_$bakedchar=function(){};$hxClasses["kha.graphics2.truetype.Stbtt_bakedchar"]=kha_graphics2_truetype_Stbtt_$bakedchar;kha_graphics2_truetype_Stbtt_$bakedchar.__name__=true;kha_graphics2_truetype_Stbtt_$bakedchar.prototype={__class__:kha_graphics2_truetype_Stbtt_$bakedchar};var kha_graphics2_truetype_Stbtt_$fontinfo=function(){};$hxClasses["kha.graphics2.truetype.Stbtt_fontinfo"]=kha_graphics2_truetype_Stbtt_$fontinfo;kha_graphics2_truetype_Stbtt_$fontinfo.__name__=true;kha_graphics2_truetype_Stbtt_$fontinfo.prototype={__class__:kha_graphics2_truetype_Stbtt_$fontinfo};var kha_graphics2_truetype_Stbtt_$vertex=function(){};$hxClasses["kha.graphics2.truetype.Stbtt_vertex"]=kha_graphics2_truetype_Stbtt_$vertex;kha_graphics2_truetype_Stbtt_$vertex.__name__=true;kha_graphics2_truetype_Stbtt_$vertex.prototype={__class__:kha_graphics2_truetype_Stbtt_$vertex};var kha_graphics2_truetype_Stbtt_$_$bitmap=function(){};$hxClasses["kha.graphics2.truetype.Stbtt__bitmap"]=kha_graphics2_truetype_Stbtt_$_$bitmap;kha_graphics2_truetype_Stbtt_$_$bitmap.__name__=true;kha_graphics2_truetype_Stbtt_$_$bitmap.prototype={__class__:kha_graphics2_truetype_Stbtt_$_$bitmap};var kha_graphics2_truetype_Stbtt_$_$edge=function(){};$hxClasses["kha.graphics2.truetype.Stbtt__edge"]=kha_graphics2_truetype_Stbtt_$_$edge;kha_graphics2_truetype_Stbtt_$_$edge.__name__=true;kha_graphics2_truetype_Stbtt_$_$edge.prototype={__class__:kha_graphics2_truetype_Stbtt_$_$edge};var kha_graphics2_truetype_Stbtt_$_$active_$edge=function(){};$hxClasses["kha.graphics2.truetype.Stbtt__active_edge"]=kha_graphics2_truetype_Stbtt_$_$active_$edge;kha_graphics2_truetype_Stbtt_$_$active_$edge.__name__=true;kha_graphics2_truetype_Stbtt_$_$active_$edge.prototype={__class__:kha_graphics2_truetype_Stbtt_$_$active_$edge};var kha_graphics2_truetype_Stbtt_$_$point=function(){};$hxClasses["kha.graphics2.truetype.Stbtt__point"]=kha_graphics2_truetype_Stbtt_$_$point;kha_graphics2_truetype_Stbtt_$_$point.__name__=true;kha_graphics2_truetype_Stbtt_$_$point.prototype={__class__:kha_graphics2_truetype_Stbtt_$_$point};var kha_graphics2_truetype_StbTruetype=function(){};$hxClasses["kha.graphics2.truetype.StbTruetype"]=kha_graphics2_truetype_StbTruetype;kha_graphics2_truetype_StbTruetype.__name__=true;kha_graphics2_truetype_StbTruetype.STBTT_assert=function(value){if(!value){throw new js__$Boot_HaxeError("Error")}};kha_graphics2_truetype_StbTruetype.ttBYTE=function(p,pos){if(pos==null){pos=0}return p.readU8(pos)};kha_graphics2_truetype_StbTruetype.ttCHAR=function(p,pos){if(pos==null){pos=0}var n=p.readU8(pos);if(n>=128){return n-256}return n};kha_graphics2_truetype_StbTruetype.ttUSHORT=function(p,pos){if(pos==null){pos=0}var ch1=p.readU8(pos);var ch2=p.readU8(pos+1);return ch2|ch1<<8};kha_graphics2_truetype_StbTruetype.ttSHORT=function(p,pos){if(pos==null){pos=0}var ch1=p.readU8(pos);var ch2=p.readU8(pos+1);var n=ch2|ch1<<8;if((n&32768)!=0){return n-65536}return n};kha_graphics2_truetype_StbTruetype.ttULONG=function(p,pos){if(pos==null){pos=0}return kha_graphics2_truetype_StbTruetype.ttLONG(p,pos)};kha_graphics2_truetype_StbTruetype.ttLONG=function(p,pos){if(pos==null){pos=0}var ch1=p.readU8(pos);var ch2=p.readU8(pos+1);var ch3=p.readU8(pos+2);var ch4=p.readU8(pos+3);return ch4|ch3<<8|ch2<<16|ch1<<24};kha_graphics2_truetype_StbTruetype.stbtt_tag4=function(p,pos,c0,c1,c2,c3){if(p.readU8(pos)==c0&&p.readU8(pos+1)==c1&&p.readU8(pos+2)==c2){return p.readU8(pos+3)==c3}else{return false}};kha_graphics2_truetype_StbTruetype.stbtt_tag=function(p,pos,str){return kha_graphics2_truetype_StbTruetype.stbtt_tag4(p,pos,HxOverrides.cca(str,0),HxOverrides.cca(str,1),HxOverrides.cca(str,2),HxOverrides.cca(str,3))};kha_graphics2_truetype_StbTruetype.stbtt__find_table=function(data,fontstart,tag){var num_tables=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,fontstart+4);var tabledir=fontstart+12;var _g=0;var _g1=num_tables;while(_g<_g1){var i=_g++;var loc=tabledir+16*i;if(kha_graphics2_truetype_StbTruetype.stbtt_tag(data,loc,tag)){return kha_graphics2_truetype_StbTruetype.ttULONG(data,loc+8)}}return 0};kha_graphics2_truetype_StbTruetype.stbtt_InitFont=function(info,data,fontstart){info.data=data;info.fontstart=fontstart;var cmap=kha_graphics2_truetype_StbTruetype.stbtt__find_table(data,fontstart,"cmap");info.loca=kha_graphics2_truetype_StbTruetype.stbtt__find_table(data,fontstart,"loca");info.head=kha_graphics2_truetype_StbTruetype.stbtt__find_table(data,fontstart,"head");info.glyf=kha_graphics2_truetype_StbTruetype.stbtt__find_table(data,fontstart,"glyf");info.hhea=kha_graphics2_truetype_StbTruetype.stbtt__find_table(data,fontstart,"hhea");info.hmtx=kha_graphics2_truetype_StbTruetype.stbtt__find_table(data,fontstart,"hmtx");info.kern=kha_graphics2_truetype_StbTruetype.stbtt__find_table(data,fontstart,"kern");if(cmap==0||info.loca==0||info.head==0||info.glyf==0||info.hhea==0||info.hmtx==0){return false}var t=kha_graphics2_truetype_StbTruetype.stbtt__find_table(data,fontstart,"maxp");if(t!=0){info.numGlyphs=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,t+4)}else{info.numGlyphs=65535}var numTables=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,cmap+2);info.index_map=0;var _g=0;var _g1=numTables;while(_g<_g1){var i=_g++;var encoding_record=cmap+4+8*i;switch(kha_graphics2_truetype_StbTruetype.ttUSHORT(data,encoding_record)){case 0:info.index_map=cmap+kha_graphics2_truetype_StbTruetype.ttULONG(data,encoding_record+4);break;case 3:switch(kha_graphics2_truetype_StbTruetype.ttUSHORT(data,encoding_record+2)){case 1:case 10:info.index_map=cmap+kha_graphics2_truetype_StbTruetype.ttULONG(data,encoding_record+4);break}break}}if(info.index_map==0){return false}info.indexToLocFormat=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,info.head+50);return true};kha_graphics2_truetype_StbTruetype.stbtt_FindGlyphIndex=function(info,unicode_codepoint){var data=info.data;var index_map=info.index_map;var format=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,index_map);if(format==0){var bytes=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,index_map+2);if(unicode_codepoint<bytes-6){return kha_graphics2_truetype_StbTruetype.ttBYTE(data,index_map+6+unicode_codepoint)}return 0}else if(format==6){var first=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,index_map+6);var count=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,index_map+8);if(unicode_codepoint>=first&&unicode_codepoint<first+count){return kha_graphics2_truetype_StbTruetype.ttUSHORT(data,index_map+10+(unicode_codepoint-first)*2)}return 0}else if(format==2){kha_graphics2_truetype_StbTruetype.STBTT_assert(false);return 0}else if(format==4){var segcount=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,index_map+6)>>1;var searchRange=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,index_map+8)>>1;var entrySelector=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,index_map+10);var rangeShift=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,index_map+12)>>1;var endCount=index_map+14;var search=endCount;if(unicode_codepoint>65535){return 0}if(unicode_codepoint>=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,search+rangeShift*2)){search+=rangeShift*2}search-=2;while(entrySelector!=0){searchRange>>=1;var end=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,search+searchRange*2);if(unicode_codepoint>end){search+=searchRange*2}--entrySelector}search+=2;var item=search-endCount>>1;kha_graphics2_truetype_StbTruetype.STBTT_assert(unicode_codepoint<=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,endCount+2*item));var start=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,index_map+14+segcount*2+2+2*item);if(unicode_codepoint<start){return 0}var offset=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,index_map+14+segcount*6+2+2*item);if(offset==0){return unicode_codepoint+kha_graphics2_truetype_StbTruetype.ttSHORT(data,index_map+14+segcount*4+2+2*item)}return kha_graphics2_truetype_StbTruetype.ttUSHORT(data,offset+(unicode_codepoint-start)*2+index_map+14+segcount*6+2+2*item)}else if(format==12||format==13){var ngroups=kha_graphics2_truetype_StbTruetype.ttULONG(data,index_map+12);var low=0;var high=ngroups;while(low<high){var mid=low+(high-low>>1);var start_char=kha_graphics2_truetype_StbTruetype.ttULONG(data,index_map+16+mid*12);var end_char=kha_graphics2_truetype_StbTruetype.ttULONG(data,index_map+16+mid*12+4);if(unicode_codepoint<start_char){high=mid}else if(unicode_codepoint>end_char){low=mid+1}else{var start_glyph=kha_graphics2_truetype_StbTruetype.ttULONG(data,index_map+16+mid*12+8);if(format==12){return start_glyph+unicode_codepoint-start_char}else{return start_glyph}}}return 0}kha_graphics2_truetype_StbTruetype.STBTT_assert(false);return 0};kha_graphics2_truetype_StbTruetype.stbtt_setvertex=function(v,type,x,y,cx,cy){v.type=type;v.x=x;v.y=y;v.cx=cx;v.cy=cy};kha_graphics2_truetype_StbTruetype.stbtt__GetGlyfOffset=function(info,glyph_index){var g1;var g2;if(glyph_index>=info.numGlyphs){return-1}if(info.indexToLocFormat>=2){return-1}if(info.indexToLocFormat==0){g1=info.glyf+kha_graphics2_truetype_StbTruetype.ttUSHORT(info.data,info.loca+glyph_index*2)*2;g2=info.glyf+kha_graphics2_truetype_StbTruetype.ttUSHORT(info.data,info.loca+glyph_index*2+2)*2}else{g1=info.glyf+kha_graphics2_truetype_StbTruetype.ttULONG(info.data,info.loca+glyph_index*4);g2=info.glyf+kha_graphics2_truetype_StbTruetype.ttULONG(info.data,info.loca+glyph_index*4+4)}if(g1==g2){return-1}else{return g1}};kha_graphics2_truetype_StbTruetype.stbtt_GetGlyphBox=function(info,glyph_index,rect){var g=kha_graphics2_truetype_StbTruetype.stbtt__GetGlyfOffset(info,glyph_index);if(g<0){return false}rect.x0=kha_graphics2_truetype_StbTruetype.ttSHORT(info.data,g+2);rect.y0=kha_graphics2_truetype_StbTruetype.ttSHORT(info.data,g+4);rect.x1=kha_graphics2_truetype_StbTruetype.ttSHORT(info.data,g+6);rect.y1=kha_graphics2_truetype_StbTruetype.ttSHORT(info.data,g+8);return true};kha_graphics2_truetype_StbTruetype.stbtt__close_shape=function(vertices,num_vertices,was_off,start_off,sx,sy,scx,scy,cx,cy){if(start_off){if(was_off){kha_graphics2_truetype_StbTruetype.stbtt_setvertex(vertices[num_vertices++],3,cx+scx>>1,cy+scy>>1,cx,cy)}kha_graphics2_truetype_StbTruetype.stbtt_setvertex(vertices[num_vertices++],3,sx,sy,scx,scy)}else if(was_off){kha_graphics2_truetype_StbTruetype.stbtt_setvertex(vertices[num_vertices++],3,sx,sy,cx,cy)}else{kha_graphics2_truetype_StbTruetype.stbtt_setvertex(vertices[num_vertices++],2,sx,sy,0,0)}return num_vertices};kha_graphics2_truetype_StbTruetype.copyVertices=function(from,to,offset,count){var _g=0;var _g1=count;while(_g<_g1){var i=_g++;to[offset+i]=from[i]}};kha_graphics2_truetype_StbTruetype.stbtt_GetGlyphShape=function(info,glyph_index){var endPtsOfContours;var data=info.data;var vertices=null;var num_vertices=0;var g=kha_graphics2_truetype_StbTruetype.stbtt__GetGlyfOffset(info,glyph_index);if(g<0){return null}var numberOfContours=kha_graphics2_truetype_StbTruetype.ttSHORT(data,g);if(numberOfContours>0){var flags=0;var j=0;var next_move=0;var off=0;var was_off=false;var start_off=false;var pointsIndex=0;endPtsOfContours=data.sub(g+10,data.get_length()-(g+10));var ins=kha_graphics2_truetype_StbTruetype.ttUSHORT(data,g+10+numberOfContours*2);var points=data.sub(g+10+numberOfContours*2+2+ins,data.get_length()-(g+10+numberOfContours*2+2+ins));var n=1+kha_graphics2_truetype_StbTruetype.ttUSHORT(endPtsOfContours,numberOfContours*2-2);var m=n+2*numberOfContours;var this1=new Array(m);vertices=this1;if(vertices==null){return null}else{var _g=0;var _g1=vertices.length;while(_g<_g1){var i=_g++;vertices[i]=new kha_graphics2_truetype_Stbtt_$vertex}}next_move=0;var flagcount=0;off=m-n;var _g2=0;var _g11=n;while(_g2<_g11){var i1=_g2++;if(flagcount==0){flags=points.readU8(pointsIndex++);if((flags&8)!=0){flagcount=points.readU8(pointsIndex++)}}else{--flagcount}vertices[off+i1].type=flags}var x=0;var _g21=0;var _g3=n;while(_g21<_g3){var i2=_g21++;flags=vertices[off+i2].type;if((flags&2)!=0){var dx=points.readU8(pointsIndex++);x+=(flags&16)!=0?dx:-dx}else if((flags&16)==0){var value;var ch1=points.readU8(pointsIndex);var ch2=points.readU8(pointsIndex+1);var n1=ch2|ch1<<8;if((n1&32768)!=0){value=n1-65536}else{value=n1}x+=value;pointsIndex+=2}vertices[off+i2].x=x}var y=0;var _g4=0;var _g5=n;while(_g4<_g5){var i3=_g4++;flags=vertices[off+i3].type;if((flags&4)!=0){var dy=points.readU8(pointsIndex++);y+=(flags&32)!=0?dy:-dy}else if((flags&32)==0){var value1;var ch11=points.readU8(pointsIndex);var ch21=points.readU8(pointsIndex+1);var n2=ch21|ch11<<8;if((n2&32768)!=0){value1=n2-65536}else{value1=n2}y+=value1;pointsIndex+=2}vertices[off+i3].y=y}num_vertices=0;var scy=0;var scx=scy;var cy=scx;var cx=cy;var sy=cx;var sx=sy;var i4=0;while(i4<n){flags=vertices[off+i4].type;x=vertices[off+i4].x;y=vertices[off+i4].y;if(next_move==i4){if(i4!=0){num_vertices=kha_graphics2_truetype_StbTruetype.stbtt__close_shape(vertices,num_vertices,was_off,start_off,sx,sy,scx,scy,cx,cy)}start_off=(flags&1)==0;if(start_off){scx=x;scy=y;if((vertices[off+i4+1].type&1)==0){sx=x+vertices[off+i4+1].x>>1;sy=y+vertices[off+i4+1].y>>1}else{sx=vertices[off+i4+1].x;sy=vertices[off+i4+1].y;++i4}}else{sx=x;sy=y}kha_graphics2_truetype_StbTruetype.stbtt_setvertex(vertices[num_vertices++],1,sx,sy,0,0);was_off=false;next_move=1+kha_graphics2_truetype_StbTruetype.ttUSHORT(endPtsOfContours,j*2);++j}else if((flags&1)==0){if(was_off){kha_graphics2_truetype_StbTruetype.stbtt_setvertex(vertices[num_vertices++],3,cx+x>>1,cy+y>>1,cx,cy)}cx=x;cy=y;was_off=true}else{if(was_off){kha_graphics2_truetype_StbTruetype.stbtt_setvertex(vertices[num_vertices++],3,x,y,cx,cy)}else{kha_graphics2_truetype_StbTruetype.stbtt_setvertex(vertices[num_vertices++],2,x,y,0,0)}was_off=false}++i4}num_vertices=kha_graphics2_truetype_StbTruetype.stbtt__close_shape(vertices,num_vertices,was_off,start_off,sx,sy,scx,scy,cx,cy)}else if(numberOfContours==-1){var more=1;var comp=data.sub(g+10,data.get_length()-(g+10));var compIndex=0;num_vertices=0;vertices=null;while(more!=0){var comp_num_verts=0;var i5;var comp_verts=null;var tmp=null;var mtx0=1;var mtx1=0;var mtx2=0;var mtx3=1;var mtx4=0;var mtx5=0;var flags1=kha_graphics2_truetype_StbTruetype.ttSHORT(comp,compIndex);compIndex+=2;var gidx=kha_graphics2_truetype_StbTruetype.ttSHORT(comp,compIndex);compIndex+=2;if((flags1&2)!=0){if((flags1&1)!=0){mtx4=kha_graphics2_truetype_StbTruetype.ttSHORT(comp,compIndex);compIndex+=2;mtx5=kha_graphics2_truetype_StbTruetype.ttSHORT(comp,compIndex);compIndex+=2}else{mtx4=kha_graphics2_truetype_StbTruetype.ttCHAR(comp,compIndex);++compIndex;mtx5=kha_graphics2_truetype_StbTruetype.ttCHAR(comp,compIndex);++compIndex}}else{kha_graphics2_truetype_StbTruetype.STBTT_assert(false)}if((flags1&8)!=0){mtx3=kha_graphics2_truetype_StbTruetype.ttSHORT(comp,compIndex)/16384;mtx0=mtx3;compIndex+=2;mtx2=0;mtx1=mtx2}else if((flags1&64)!=0){mtx0=kha_graphics2_truetype_StbTruetype.ttSHORT(comp,compIndex)/16384;compIndex+=2;mtx2=0;mtx1=mtx2;mtx3=kha_graphics2_truetype_StbTruetype.ttSHORT(comp,compIndex)/16384;compIndex+=2}else if((flags1&128)!=0){mtx0=kha_graphics2_truetype_StbTruetype.ttSHORT(comp,compIndex)/16384;compIndex+=2;mtx1=kha_graphics2_truetype_StbTruetype.ttSHORT(comp,compIndex)/16384;compIndex+=2;mtx2=kha_graphics2_truetype_StbTruetype.ttSHORT(comp,compIndex)/16384;compIndex+=2;mtx3=kha_graphics2_truetype_StbTruetype.ttSHORT(comp,compIndex)/16384;compIndex+=2}var m1=Math.sqrt(mtx0*mtx0+mtx1*mtx1);var n3=Math.sqrt(mtx2*mtx2+mtx3*mtx3);comp_verts=kha_graphics2_truetype_StbTruetype.stbtt_GetGlyphShape(info,gidx);comp_num_verts=comp_verts==null?0:comp_verts.length;if(comp_num_verts>0){var _g6=0;var _g12=comp_num_verts;while(_g6<_g12){var i6=_g6++;var v=comp_verts[i6];var x1=v.x;var y1=v.y;v.x=Std.int(m1*(mtx0*x1+mtx2*y1+mtx4));v.y=Std.int(n3*(mtx1*x1+mtx3*y1+mtx5));x1=v.cx;y1=v.cy;v.cx=Std.int(m1*(mtx0*x1+mtx2*y1+mtx4));v.cy=Std.int(n3*(mtx1*x1+mtx3*y1+mtx5))}var this2=new Array(num_vertices+comp_num_verts);tmp=this2;if(tmp==null){return null}if(num_vertices>0){kha_graphics2_truetype_StbTruetype.copyVertices(vertices,tmp,0,num_vertices)}kha_graphics2_truetype_StbTruetype.copyVertices(comp_verts,tmp,num_vertices,comp_num_verts);vertices=tmp;num_vertices+=comp_num_verts}more=flags1&32}}else if(numberOfContours<0){kha_graphics2_truetype_StbTruetype.STBTT_assert(false)}if(vertices==null){return null}kha_graphics2_truetype_StbTruetype.STBTT_assert(vertices.length>=num_vertices);if(num_vertices<vertices.length){var this3=new Array(num_vertices);var tmp1=this3;kha_graphics2_truetype_StbTruetype.copyVertices(vertices,tmp1,0,num_vertices);return tmp1}else{return vertices}};kha_graphics2_truetype_StbTruetype.stbtt_GetGlyphHMetrics=function(info,glyph_index){var numOfLongHorMetrics=kha_graphics2_truetype_StbTruetype.ttUSHORT(info.data,info.hhea+34);var metrics=new kha_graphics2_truetype_Stbtt_$temp_$glyph_$h_$metrics;if(glyph_index<numOfLongHorMetrics){metrics.advanceWidth=kha_graphics2_truetype_StbTruetype.ttSHORT(info.data,info.hmtx+4*glyph_index);metrics.leftSideBearing=kha_graphics2_truetype_StbTruetype.ttSHORT(info.data,info.hmtx+4*glyph_index+2)}else{metrics.advanceWidth=kha_graphics2_truetype_StbTruetype.ttSHORT(info.data,info.hmtx+4*(numOfLongHorMetrics-1));metrics.leftSideBearing=kha_graphics2_truetype_StbTruetype.ttSHORT(info.data,info.hmtx+4*numOfLongHorMetrics+2*(glyph_index-numOfLongHorMetrics))}return metrics};kha_graphics2_truetype_StbTruetype.stbtt_GetFontVMetrics=function(info){var metrics=new kha_graphics2_truetype_Stbtt_$temp_$font_$v_$metrics;metrics.ascent=kha_graphics2_truetype_StbTruetype.ttSHORT(info.data,info.hhea+4);metrics.descent=kha_graphics2_truetype_StbTruetype.ttSHORT(info.data,info.hhea+6);metrics.lineGap=kha_graphics2_truetype_StbTruetype.ttSHORT(info.data,info.hhea+8);return metrics};kha_graphics2_truetype_StbTruetype.stbtt_ScaleForPixelHeight=function(info,height){var fheight=kha_graphics2_truetype_StbTruetype.ttSHORT(info.data,info.hhea+4)-kha_graphics2_truetype_StbTruetype.ttSHORT(info.data,info.hhea+6);return height/fheight};kha_graphics2_truetype_StbTruetype.stbtt_GetGlyphBitmapBoxSubpixel=function(font,glyph,scale_x,scale_y,shift_x,shift_y){var rect=new kha_graphics2_truetype_Stbtt_$temp_$rect;if(!kha_graphics2_truetype_StbTruetype.stbtt_GetGlyphBox(font,glyph,rect)){rect.x0=0;rect.y0=0;rect.x1=0;rect.y1=0}else{var x0=rect.x0;var x1=rect.x1;var y0=rect.y0;var y1=rect.y1;rect.x0=Math.floor(x0*scale_x+shift_x);rect.y0=Math.floor(-y1*scale_y+shift_y);rect.x1=Math.ceil(x1*scale_x+shift_x);rect.y1=Math.ceil(-y0*scale_y+shift_y)}return rect};kha_graphics2_truetype_StbTruetype.stbtt_GetGlyphBitmapBox=function(font,glyph,scale_x,scale_y){return kha_graphics2_truetype_StbTruetype.stbtt_GetGlyphBitmapBoxSubpixel(font,glyph,scale_x,scale_y,0,0)};kha_graphics2_truetype_StbTruetype.stbtt__new_active=function(e,eIndex,off_x,start_point){var z=new kha_graphics2_truetype_Stbtt_$_$active_$edge;var dxdy=(e[eIndex].x1-e[eIndex].x0)/(e[eIndex].y1-e[eIndex].y0);if(z==null){return z}z.fdx=dxdy;z.fdy=dxdy!=0?1/dxdy:0;z.fx=e[eIndex].x0+dxdy*(start_point-e[eIndex].y0);z.fx-=off_x;z.direction=e[eIndex].invert?1:-1;z.sy=e[eIndex].y0;z.ey=e[eIndex].y1;z.next=null;return z};kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge=function(scanline,scanlineIndex,x,e,x0,y0,x1,y1){if(y0==y1){return}kha_graphics2_truetype_StbTruetype.STBTT_assert(y0<y1);kha_graphics2_truetype_StbTruetype.STBTT_assert(e.sy<=e.ey);if(y0>e.ey){return}if(y1<e.sy){return}if(y0<e.sy){x0+=(x1-x0)*(e.sy-y0)/(y1-y0);y0=e.sy}if(y1>e.ey){x1+=(x1-x0)*(e.ey-y1)/(y1-y0);y1=e.ey}if(x0==x){kha_graphics2_truetype_StbTruetype.STBTT_assert(x1<=x+1)}else if(x0==x+1){kha_graphics2_truetype_StbTruetype.STBTT_assert(x1>=x)}else if(x0<=x){kha_graphics2_truetype_StbTruetype.STBTT_assert(x1<=x)}else if(x0>=x+1){kha_graphics2_truetype_StbTruetype.STBTT_assert(x1>=x+1)}else{kha_graphics2_truetype_StbTruetype.STBTT_assert(x1>=x&&x1<=x+1)}if(x0<=x&&x1<=x){var _g=scanlineIndex+x;var _g1=scanline;_g1[_g]=_g1[_g]+e.direction*(y1-y0)}else if(!(x0>=x+1&&x1>=x+1)){kha_graphics2_truetype_StbTruetype.STBTT_assert(x0>=x&&x0<=x+1&&x1>=x&&x1<=x+1);var _g2=scanlineIndex+x;var _g11=scanline;_g11[_g2]=_g11[_g2]+e.direction*(y1-y0)*(1-(x0-x+(x1-x))/2)}};kha_graphics2_truetype_StbTruetype.stbtt__fill_active_edges_new=function(scanline,scanline_fill,scanline_fillIndex,len,e,y_top){var y_bottom=y_top+1;while(e!=null){kha_graphics2_truetype_StbTruetype.STBTT_assert(e.ey>=y_top);if(e.fdx==0){var x0=e.fx;if(x0<len){if(x0>=0){kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,Std.int(x0),e,x0,y_top,x0,y_bottom);kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline_fill,scanline_fillIndex-1,Std.int(x0+1),e,x0,y_top,x0,y_bottom)}else{kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline_fill,scanline_fillIndex-1,0,e,x0,y_top,x0,y_bottom)}}}else{var x01=e.fx;var dx=e.fdx;var xb=x01+dx;var x_top;var x_bottom;var sy0;var sy1;var dy=e.fdy;kha_graphics2_truetype_StbTruetype.STBTT_assert(e.sy<=y_bottom&&e.ey>=y_top);if(e.sy>y_top){x_top=x01+dx*(e.sy-y_top);sy0=e.sy}else{x_top=x01;sy0=y_top}if(e.ey<y_bottom){x_bottom=x01+dx*(e.ey-y_top);sy1=e.ey}else{x_bottom=xb;sy1=y_bottom}if(x_top>=0&&x_bottom>=0&&x_top<len&&x_bottom<len){if(Std.int(x_top)==Std.int(x_bottom)){var x=Std.int(x_top);var height=sy1-sy0;kha_graphics2_truetype_StbTruetype.STBTT_assert(x>=0&&x<len);var _g=x;var _g1=scanline;_g1[_g]=_g1[_g]+e.direction*(1-(x_top-x+(x_bottom-x))/2)*height;var _g2=scanline_fillIndex+x;var _g11=scanline_fill;_g11[_g2]=_g11[_g2]+e.direction*height}else{var x1;if(x_top>x_bottom){sy0=y_bottom-(sy0-y_top);sy1=y_bottom-(sy1-y_top);var t=sy0;sy0=sy1;sy1=t;t=x_bottom;x_bottom=x_top;x_top=t;dx=-dx;dy=-dy;t=x01;x01=xb;xb=t}var x11=Std.int(x_top);var x2=Std.int(x_bottom);var y_crossing=(x11+1-x01)*dy+y_top;var sign=e.direction;var area=sign*(y_crossing-sy0);var _g3=x11;var _g12=scanline;_g12[_g3]=_g12[_g3]+area*(1-(x_top-x11+(x11+1-x11))/2);var step=sign*dy;var _g4=x11+1;var _g13=x2;while(_g4<_g13){var x3=_g4++;var _g5=x3;var _g14=scanline;_g14[_g5]=_g14[_g5]+(area+step/2);area+=step}y_crossing+=dy*(x2-(x11+1));kha_graphics2_truetype_StbTruetype.STBTT_assert(Math.abs(area)<=1.01);var _g21=x2;var _g31=scanline;_g31[_g21]=_g31[_g21]+(area+sign*(1-(x2-x2+(x_bottom-x2))/2)*(sy1-y_crossing));var _g22=scanline_fillIndex+x2;var _g32=scanline_fill;_g32[_g22]=_g32[_g22]+sign*(sy1-sy0)}}else{var _g6=0;var _g15=len;while(_g6<_g15){var x4=_g6++;var y0=y_top;var x12=x4;var x21=x4+1;var x31=xb;var y3=y_bottom;var y1=(x4-x01)/dx+y_top;var y2=(x4+1-x01)/dx+y_top;if(x01<x12&&x31>x21){kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x01,y0,x12,y1);kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x12,y1,x21,y2);kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x21,y2,x31,y3)}else if(x31<x12&&x01>x21){kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x01,y0,x21,y2);kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x21,y2,x12,y1);kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x12,y1,x31,y3)}else if(x01<x12&&x31>x12){kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x01,y0,x12,y1);kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x12,y1,x31,y3)}else if(x31<x12&&x01>x12){kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x01,y0,x12,y1);kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x12,y1,x31,y3)}else if(x01<x21&&x31>x21){kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x01,y0,x21,y2);kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x21,y2,x31,y3)}else if(x31<x21&&x01>x21){kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x01,y0,x21,y2);kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x21,y2,x31,y3)}else{kha_graphics2_truetype_StbTruetype.stbtt__handle_clipped_edge(scanline,0,x4,e,x01,y0,x31,y3)}}}}e=e.next}};kha_graphics2_truetype_StbTruetype.stbtt__rasterize_sorted_edges=function(result,e,n,vsubsample,off_x,off_y){var active=null;var j=0;var scanline;var scanline2Index=0;var eIndex=0;if(result.w>64){var this1=new Array(result.w*2+1);scanline=this1}else{var this2=new Array(129);scanline=this2}var scanline2=scanline;scanline2Index=result.w;var y=off_y;e[eIndex+n].y0=off_y+result.h+1;while(j<result.h){var scan_y_top=y+0;var scan_y_bottom=y+1;var step_value=active;var step_parent=null;var _g=0;var _g1=result.w;while(_g<_g1){var i=_g++;scanline[i]=0}var _g2=0;var _g3=result.w+1;while(_g2<_g3){var i1=_g2++;scanline2[scanline2Index+i1]=0}while(step_value!=null){var z=step_value;if(z.ey<=scan_y_top){if(step_parent==null){active=z.next;step_value=z.next}else{step_parent.next=z.next;step_value=z.next}kha_graphics2_truetype_StbTruetype.STBTT_assert(z.direction!=0);z.direction=0}else{step_parent=step_value;step_value=step_value.next}}while(e[eIndex].y0<=scan_y_bottom){if(e[eIndex].y0!=e[eIndex].y1){var z1=kha_graphics2_truetype_StbTruetype.stbtt__new_active(e,eIndex,off_x,scan_y_top);kha_graphics2_truetype_StbTruetype.STBTT_assert(z1.ey>=scan_y_top);z1.next=active;active=z1}++eIndex}if(active!=null){kha_graphics2_truetype_StbTruetype.stbtt__fill_active_edges_new(scanline,scanline2,scanline2Index+1,result.w,active,scan_y_top)}var sum=0;var _g4=0;var _g5=result.w;while(_g4<_g5){var i2=_g4++;sum+=scanline2[scanline2Index+i2];var k=scanline[i2]+sum;k=Math.abs(k)*255+.5;var m=Std.int(k);if(m>255){m=255}result.pixels.writeU8(result.pixels_offset+j*result.stride+i2,m)}step_parent=null;step_value=active;while(step_value!=null){var z2=step_value;z2.fx+=z2.fdx;step_parent=step_value;step_value=step_value.next}++y;++j}};kha_graphics2_truetype_StbTruetype.STBTT__COMPARE=function(a,b){return a.y0<b.y0};kha_graphics2_truetype_StbTruetype.stbtt__sort_edges_ins_sort=function(p,n){var i;var j;var _g=1;var _g1=n;while(_g<_g1){var i1=_g++;var t=p[i1];var a=t;j=i1;while(j>0){var b=p[j-1];var c=kha_graphics2_truetype_StbTruetype.STBTT__COMPARE(a,b);if(!c){break}p[j]=p[j-1];--j}if(i1!=j){p[j]=t}}};kha_graphics2_truetype_StbTruetype.stbtt__sort_edges_quicksort=function(p,pIndex,n){while(n>12){var t;var c;var m=n>>1;var c01=kha_graphics2_truetype_StbTruetype.STBTT__COMPARE(p[pIndex],p[pIndex+m]);var c12=kha_graphics2_truetype_StbTruetype.STBTT__COMPARE(p[pIndex+m],p[pIndex+n-1]);if(c01!=c12){c=kha_graphics2_truetype_StbTruetype.STBTT__COMPARE(p[pIndex],p[pIndex+n-1]);var z=c==c12?0:n-1;t=p[pIndex+z];p[pIndex+z]=p[pIndex+m];p[pIndex+m]=t}t=p[pIndex];p[pIndex]=p[pIndex+m];p[pIndex+m]=t;var i=1;var j=n-1;while(true){while(kha_graphics2_truetype_StbTruetype.STBTT__COMPARE(p[pIndex+i],p[pIndex]))++i;while(kha_graphics2_truetype_StbTruetype.STBTT__COMPARE(p[pIndex],p[pIndex+j]))--j;if(i>=j){break}t=p[pIndex+i];p[pIndex+i]=p[pIndex+j];p[pIndex+j]=t;++i;--j}if(j<n-i){kha_graphics2_truetype_StbTruetype.stbtt__sort_edges_quicksort(p,pIndex,j);pIndex+=i;n-=i}else{kha_graphics2_truetype_StbTruetype.stbtt__sort_edges_quicksort(p,pIndex+i,n-i);n=j}}};kha_graphics2_truetype_StbTruetype.stbtt__sort_edges=function(p,n){kha_graphics2_truetype_StbTruetype.stbtt__sort_edges_quicksort(p,0,n);kha_graphics2_truetype_StbTruetype.stbtt__sort_edges_ins_sort(p,n)};kha_graphics2_truetype_StbTruetype.stbtt__rasterize=function(result,pts,wcount,windings,scale_x,scale_y,shift_x,shift_y,off_x,off_y,invert){var y_scale_inv=invert?-scale_y:scale_y;var i;var j;var k;var vsubsample=1;var ptsIndex=0;var n=0;var _g=0;var _g1=windings;while(_g<_g1){var i1=_g++;n+=wcount[i1]}var this1=new Array(n+1);var e=this1;if(e==null){return}else{var _g2=0;var _g3=e.length;while(_g2<_g3){var i2=_g2++;e[i2]=new kha_graphics2_truetype_Stbtt_$_$edge}}n=0;var m=0;var _g21=0;var _g31=windings;while(_g21<_g31){var i3=_g21++;var p=pts;var pIndex=ptsIndex+m;m+=wcount[i3];j=wcount[i3]-1;var _g22=0;var _g32=wcount[i3];while(_g22<_g32){var k1=_g22++;var a=k1;var b=j;if(p[pIndex+j].y==p[pIndex+k1].y){j=k1;continue}e[n].invert=false;if(invert?p[pIndex+j].y>p[pIndex+k1].y:p[pIndex+j].y<p[pIndex+k1].y){e[n].invert=true;a=j;b=k1}e[n].x0=p[pIndex+a].x*scale_x+shift_x;e[n].y0=(p[pIndex+a].y*y_scale_inv+shift_y)*vsubsample;e[n].x1=p[pIndex+b].x*scale_x+shift_x;e[n].y1=(p[pIndex+b].y*y_scale_inv+shift_y)*vsubsample;++n;j=k1}}kha_graphics2_truetype_StbTruetype.stbtt__sort_edges(e,n);kha_graphics2_truetype_StbTruetype.stbtt__rasterize_sorted_edges(result,e,n,vsubsample,off_x,off_y)};kha_graphics2_truetype_StbTruetype.stbtt__add_point=function(points,n,x,y){if(points==null){return}points[n].x=x;points[n].y=y};kha_graphics2_truetype_StbTruetype.stbtt__tesselate_curve=function(points,num_points,x0,y0,x1,y1,x2,y2,objspace_flatness_squared,n){var mx=(x0+2*x1+x2)/4;var my=(y0+2*y1+y2)/4;var dx=(x0+x2)/2-mx;var dy=(y0+y2)/2-my;if(n>16){return 1}if(dx*dx+dy*dy>objspace_flatness_squared){kha_graphics2_truetype_StbTruetype.stbtt__tesselate_curve(points,num_points,x0,y0,(x0+x1)/2,(y0+y1)/2,mx,my,objspace_flatness_squared,n+1);kha_graphics2_truetype_StbTruetype.stbtt__tesselate_curve(points,num_points,mx,my,(x1+x2)/2,(y1+y2)/2,x2,y2,objspace_flatness_squared,n+1)}else{kha_graphics2_truetype_StbTruetype.stbtt__add_point(points,num_points.value,x2,y2);num_points.value+=1}return 1};kha_graphics2_truetype_StbTruetype.stbtt_FlattenCurves=function(vertices,num_verts,objspace_flatness,contour_lengths,num_contours){var points=null;var num_points=0;var objspace_flatness_squared=objspace_flatness*objspace_flatness;var i;var n=0;var start=0;var pass;var _g=0;var _g1=num_verts;while(_g<_g1){var i1=_g++;if(vertices[i1].type==1){++n}}num_contours.value=n;if(n==0){return null}var this1=new Array(n);contour_lengths.value=this1;if(contour_lengths.value==null){num_contours.value=0;return null}var _g2=0;while(_g2<2){var pass1=_g2++;var x=0;var y=0;if(pass1==1){var this2=new Array(num_points);points=this2;if(points==null){contour_lengths.value=null;num_contours.value=0;return null}else{var _g21=0;var _g3=points.length;while(_g21<_g3){var i2=_g21++;points[i2]=new kha_graphics2_truetype_Stbtt_$_$point}}}num_points=0;n=-1;var _g22=0;var _g31=num_verts;while(_g22<_g31){var i3=_g22++;switch(vertices[i3].type){case 1:if(n>=0){contour_lengths.value[n]=num_points-start}++n;start=num_points;x=vertices[i3].x;y=vertices[i3].y;kha_graphics2_truetype_StbTruetype.stbtt__add_point(points,num_points++,x,y);break;case 2:x=vertices[i3].x;y=vertices[i3].y;kha_graphics2_truetype_StbTruetype.stbtt__add_point(points,num_points++,x,y);break;case 3:var num_points_reference={value:num_points};kha_graphics2_truetype_StbTruetype.stbtt__tesselate_curve(points,num_points_reference,x,y,vertices[i3].cx,vertices[i3].cy,vertices[i3].x,vertices[i3].y,objspace_flatness_squared,0);num_points=num_points_reference.value;x=vertices[i3].x;y=vertices[i3].y;break}}contour_lengths.value[n]=num_points-start}return points};kha_graphics2_truetype_StbTruetype.stbtt_Rasterize=function(result,flatness_in_pixels,vertices,num_verts,scale_x,scale_y,shift_x,shift_y,x_off,y_off,invert){var scale=scale_x>scale_y?scale_y:scale_x;var winding_count=0;var winding_lengths=null;var winding_count_reference={value:winding_count};var winding_lengths_reference=new kha_graphics2_truetype_VectorOfIntPointer;var windings=kha_graphics2_truetype_StbTruetype.stbtt_FlattenCurves(vertices,num_verts,flatness_in_pixels/scale,winding_lengths_reference,winding_count_reference);winding_count=winding_count_reference.value;winding_lengths=winding_lengths_reference.value;if(windings!=null){kha_graphics2_truetype_StbTruetype.stbtt__rasterize(result,windings,winding_lengths,winding_count,scale_x,scale_y,shift_x,shift_y,x_off,y_off,invert)}};kha_graphics2_truetype_StbTruetype.stbtt_MakeGlyphBitmapSubpixel=function(info,output,output_offset,out_w,out_h,out_stride,scale_x,scale_y,shift_x,shift_y,glyph){var ix0=0;var iy0=0;var vertices=kha_graphics2_truetype_StbTruetype.stbtt_GetGlyphShape(info,glyph);var num_verts=vertices==null?0:vertices.length;var gbm=new kha_graphics2_truetype_Stbtt_$_$bitmap;var rect=kha_graphics2_truetype_StbTruetype.stbtt_GetGlyphBitmapBoxSubpixel(info,glyph,scale_x,scale_y,shift_x,shift_y);ix0=rect.x0;iy0=rect.y0;gbm.pixels=output;gbm.pixels_offset=output_offset;gbm.w=out_w;gbm.h=out_h;gbm.stride=out_stride;if(gbm.w!=0&&gbm.h!=0){kha_graphics2_truetype_StbTruetype.stbtt_Rasterize(gbm,.35,vertices,num_verts,scale_x,scale_y,shift_x,shift_y,ix0,iy0,true)}};kha_graphics2_truetype_StbTruetype.stbtt_MakeGlyphBitmap=function(info,output,output_offset,out_w,out_h,out_stride,scale_x,scale_y,glyph){kha_graphics2_truetype_StbTruetype.stbtt_MakeGlyphBitmapSubpixel(info,output,output_offset,out_w,out_h,out_stride,scale_x,scale_y,0,0,glyph)};kha_graphics2_truetype_StbTruetype.stbtt_BakeFontBitmap=function(data,offset,pixel_height,pixels,pw,ph,chars,chardata){var f=new kha_graphics2_truetype_Stbtt_$fontinfo;if(!kha_graphics2_truetype_StbTruetype.stbtt_InitFont(f,data,offset)){return-1}var _g=0;var _g1=pw*ph;while(_g<_g1){var i=_g++;pixels.writeU8(i,0)}var y=1;var x=y;var bottom_y=1;var scale=kha_graphics2_truetype_StbTruetype.stbtt_ScaleForPixelHeight(f,pixel_height);var i1=0;var _g2=0;while(_g2<chars.length){var index=chars[_g2];++_g2;var g=kha_graphics2_truetype_StbTruetype.stbtt_FindGlyphIndex(f,index);var metrics=kha_graphics2_truetype_StbTruetype.stbtt_GetGlyphHMetrics(f,g);var advance=metrics.advanceWidth;var lsb=metrics.leftSideBearing;var rect=kha_graphics2_truetype_StbTruetype.stbtt_GetGlyphBitmapBox(f,g,scale,scale);var x0=rect.x0;var y0=rect.y0;var x1=rect.x1;var y1=rect.y1;var gw=x1-x0;var gh=y1-y0;if(x+gw+1>=pw){y=bottom_y;x=1}if(y+gh+1>=ph){return-i1}kha_graphics2_truetype_StbTruetype.STBTT_assert(x+gw<pw);kha_graphics2_truetype_StbTruetype.STBTT_assert(y+gh<ph);kha_graphics2_truetype_StbTruetype.stbtt_MakeGlyphBitmap(f,pixels,x+y*pw,gw,gh,pw,scale,scale,g);chardata[i1].x0=x;chardata[i1].y0=y;chardata[i1].x1=x+gw;chardata[i1].y1=y+gh;chardata[i1].xadvance=scale*advance;chardata[i1].xoff=x0;chardata[i1].yoff=y0;x=x+gw+1;if(y+gh+1>bottom_y){bottom_y=y+gh+1}++i1}return bottom_y};var kha_graphics4_ConstantLocation=function(){};$hxClasses["kha.graphics4.ConstantLocation"]=kha_graphics4_ConstantLocation;kha_graphics4_ConstantLocation.__name__=true;var kha_graphics4_CubeMap=function(size,format,renderTarget,depthStencilFormat){this.isDepthAttachment=false;this.depthTexture=null;this.texture=null;this.frameBuffer=null;this.myWidth=size;this.myHeight=size;this.format=format;this.renderTarget=renderTarget;this.depthStencilFormat=depthStencilFormat;if(renderTarget){this.createTexture()}};$hxClasses["kha.graphics4.CubeMap"]=kha_graphics4_CubeMap;kha_graphics4_CubeMap.__name__=true;kha_graphics4_CubeMap.__interfaces__=[kha_Resource,kha_Canvas];kha_graphics4_CubeMap.createRenderTarget=function(size,format,depthStencil,contextId){if(contextId==null){contextId=0}if(format==null){format=0}if(depthStencil==null){depthStencil=0}return new kha_graphics4_CubeMap(size,format,true,depthStencil)};kha_graphics4_CubeMap.prototype={createTexture:function(){if(kha_SystemImpl.gl==null){return}this.texture=kha_SystemImpl.gl.createTexture();kha_SystemImpl.gl.bindTexture(34067,this.texture);kha_SystemImpl.gl.texParameteri(34067,10240,9729);kha_SystemImpl.gl.texParameteri(34067,10241,9729);kha_SystemImpl.gl.texParameteri(34067,10242,33071);kha_SystemImpl.gl.texParameteri(34067,10243,33071);if(this.renderTarget){this.frameBuffer=kha_SystemImpl.gl.createFramebuffer();kha_SystemImpl.gl.bindFramebuffer(36160,this.frameBuffer);switch(this.format){case 0:kha_SystemImpl.gl.texImage2D(34069,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.texImage2D(34070,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.texImage2D(34071,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.texImage2D(34072,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.texImage2D(34073,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.texImage2D(34074,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);break;case 2:kha_SystemImpl.gl.texImage2D(34069,0,kha_SystemImpl.gl2?34836:6408,this.myWidth,this.myHeight,0,6408,5126,null);kha_SystemImpl.gl.texImage2D(34070,0,kha_SystemImpl.gl2?34836:6408,this.myWidth,this.myHeight,0,6408,5126,null);kha_SystemImpl.gl.texImage2D(34071,0,kha_SystemImpl.gl2?34836:6408,this.myWidth,this.myHeight,0,6408,5126,null);kha_SystemImpl.gl.texImage2D(34072,0,kha_SystemImpl.gl2?34836:6408,this.myWidth,this.myHeight,0,6408,5126,null);kha_SystemImpl.gl.texImage2D(34073,0,kha_SystemImpl.gl2?34836:6408,this.myWidth,this.myHeight,0,6408,5126,null);kha_SystemImpl.gl.texImage2D(34074,0,kha_SystemImpl.gl2?34836:6408,this.myWidth,this.myHeight,0,6408,5126,null);break;case 3:kha_SystemImpl.gl.texImage2D(34069,0,kha_SystemImpl.gl2?33189:6402,this.myWidth,this.myHeight,0,6402,5123,null);kha_SystemImpl.gl.texImage2D(34070,0,kha_SystemImpl.gl2?33189:6402,this.myWidth,this.myHeight,0,6402,5123,null);kha_SystemImpl.gl.texImage2D(34071,0,kha_SystemImpl.gl2?33189:6402,this.myWidth,this.myHeight,0,6402,5123,null);kha_SystemImpl.gl.texImage2D(34072,0,kha_SystemImpl.gl2?33189:6402,this.myWidth,this.myHeight,0,6402,5123,null);kha_SystemImpl.gl.texImage2D(34073,0,kha_SystemImpl.gl2?33189:6402,this.myWidth,this.myHeight,0,6402,5123,null);kha_SystemImpl.gl.texImage2D(34074,0,kha_SystemImpl.gl2?33189:6402,this.myWidth,this.myHeight,0,6402,5123,null);break;case 4:kha_SystemImpl.gl.texImage2D(34069,0,kha_SystemImpl.gl2?34842:6408,this.myWidth,this.myHeight,0,6408,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);kha_SystemImpl.gl.texImage2D(34070,0,kha_SystemImpl.gl2?34842:6408,this.myWidth,this.myHeight,0,6408,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);kha_SystemImpl.gl.texImage2D(34071,0,kha_SystemImpl.gl2?34842:6408,this.myWidth,this.myHeight,0,6408,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);kha_SystemImpl.gl.texImage2D(34072,0,kha_SystemImpl.gl2?34842:6408,this.myWidth,this.myHeight,0,6408,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);kha_SystemImpl.gl.texImage2D(34073,0,kha_SystemImpl.gl2?34842:6408,this.myWidth,this.myHeight,0,6408,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);kha_SystemImpl.gl.texImage2D(34074,0,kha_SystemImpl.gl2?34842:6408,this.myWidth,this.myHeight,0,6408,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);break;case 5:kha_SystemImpl.gl.texImage2D(34069,0,kha_SystemImpl.gl2?33326:6406,this.myWidth,this.myHeight,0,6406,5126,null);kha_SystemImpl.gl.texImage2D(34070,0,kha_SystemImpl.gl2?33326:6406,this.myWidth,this.myHeight,0,6406,5126,null);kha_SystemImpl.gl.texImage2D(34071,0,kha_SystemImpl.gl2?33326:6406,this.myWidth,this.myHeight,0,6406,5126,null);kha_SystemImpl.gl.texImage2D(34072,0,kha_SystemImpl.gl2?33326:6406,this.myWidth,this.myHeight,0,6406,5126,null);kha_SystemImpl.gl.texImage2D(34073,0,kha_SystemImpl.gl2?33326:6406,this.myWidth,this.myHeight,0,6406,5126,null);kha_SystemImpl.gl.texImage2D(34074,0,kha_SystemImpl.gl2?33326:6406,this.myWidth,this.myHeight,0,6406,5126,null);break;case 6:kha_SystemImpl.gl.texImage2D(34069,0,kha_SystemImpl.gl2?33325:6406,this.myWidth,this.myHeight,0,6406,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);kha_SystemImpl.gl.texImage2D(34070,0,kha_SystemImpl.gl2?33325:6406,this.myWidth,this.myHeight,0,6406,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);kha_SystemImpl.gl.texImage2D(34071,0,kha_SystemImpl.gl2?33325:6406,this.myWidth,this.myHeight,0,6406,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);kha_SystemImpl.gl.texImage2D(34072,0,kha_SystemImpl.gl2?33325:6406,this.myWidth,this.myHeight,0,6406,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);kha_SystemImpl.gl.texImage2D(34073,0,kha_SystemImpl.gl2?33325:6406,this.myWidth,this.myHeight,0,6406,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);kha_SystemImpl.gl.texImage2D(34074,0,kha_SystemImpl.gl2?33325:6406,this.myWidth,this.myHeight,0,6406,kha_SystemImpl.halfFloat.HALF_FLOAT_OES,null);break;default:kha_SystemImpl.gl.texImage2D(34069,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.texImage2D(34070,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.texImage2D(34071,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.texImage2D(34072,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.texImage2D(34073,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.texImage2D(34074,0,6408,this.myWidth,this.myHeight,0,6408,5121,null)}if(this.format==3){kha_SystemImpl.gl.texParameteri(34067,10240,9728);kha_SystemImpl.gl.texParameteri(34067,10241,9728);this.isDepthAttachment=true;if(!kha_SystemImpl.gl2){var colortex=kha_SystemImpl.gl.createTexture();kha_SystemImpl.gl.bindTexture(34067,colortex);kha_SystemImpl.gl.texImage2D(34069,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.framebufferTexture2D(36160,36064,34069,colortex,0);kha_SystemImpl.gl.texImage2D(34070,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.framebufferTexture2D(36160,36064,34070,colortex,0);kha_SystemImpl.gl.texImage2D(34071,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.framebufferTexture2D(36160,36064,34071,colortex,0);kha_SystemImpl.gl.texImage2D(34072,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.framebufferTexture2D(36160,36064,34072,colortex,0);kha_SystemImpl.gl.texImage2D(34073,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.framebufferTexture2D(36160,36064,34073,colortex,0);kha_SystemImpl.gl.texImage2D(34074,0,6408,this.myWidth,this.myHeight,0,6408,5121,null);kha_SystemImpl.gl.framebufferTexture2D(36160,36064,34074,colortex,0);kha_SystemImpl.gl.bindTexture(34067,this.texture)}}this.initDepthStencilBuffer(this.depthStencilFormat);kha_SystemImpl.gl.bindFramebuffer(36160,null)}kha_SystemImpl.gl.bindTexture(34067,null)},initDepthStencilBuffer:function(depthStencilFormat){switch(depthStencilFormat){case 0:break;case 1:case 5:this.depthTexture=kha_SystemImpl.gl.createTexture();kha_SystemImpl.gl.bindTexture(34067,this.depthTexture);if(depthStencilFormat==1){kha_SystemImpl.gl.texImage2D(34067,0,kha_SystemImpl.gl2?33190:6402,this.myWidth,this.myHeight,0,6402,5125,null)}else{kha_SystemImpl.gl.texImage2D(34067,0,kha_SystemImpl.gl2?33189:6402,this.myWidth,this.myHeight,0,6402,5123,null)}kha_SystemImpl.gl.texParameteri(34067,10240,9728);kha_SystemImpl.gl.texParameteri(34067,10241,9728);kha_SystemImpl.gl.texParameteri(34067,10242,33071);kha_SystemImpl.gl.texParameteri(34067,10243,33071);kha_SystemImpl.gl.bindFramebuffer(36160,this.frameBuffer);kha_SystemImpl.gl.framebufferTexture2D(36160,36096,34067,this.depthTexture,0);break;case 2:case 3:case 4:this.depthTexture=kha_SystemImpl.gl.createTexture();kha_SystemImpl.gl.bindTexture(34067,this.depthTexture);kha_SystemImpl.gl.texImage2D(34067,0,kha_SystemImpl.gl2?35056:34041,this.myWidth,this.myHeight,0,34041,kha_SystemImpl.depthTexture.UNSIGNED_INT_24_8_WEBGL,null);kha_SystemImpl.gl.texParameteri(34067,10240,9728);kha_SystemImpl.gl.texParameteri(34067,10241,9728);kha_SystemImpl.gl.texParameteri(34067,10242,33071);kha_SystemImpl.gl.texParameteri(34067,10243,33071);kha_SystemImpl.gl.bindFramebuffer(36160,this.frameBuffer);kha_SystemImpl.gl.framebufferTexture2D(36160,33306,34067,this.depthTexture,0);break}},set:function(stage){kha_SystemImpl.gl.activeTexture(33984+stage);kha_SystemImpl.gl.bindTexture(34067,this.texture)},setDepth:function(stage){kha_SystemImpl.gl.activeTexture(33984+stage);kha_SystemImpl.gl.bindTexture(34067,this.depthTexture)},get_width:function(){return this.myWidth},get_height:function(){return this.myHeight},get_g4:function(){if(this.graphics4==null){this.graphics4=new kha_js_graphics4_Graphics(this)}return this.graphics4},__class__:kha_graphics4_CubeMap,__properties__:{get_g4:"get_g4",get_height:"get_height",get_width:"get_width"}};var kha_graphics4_FragmentShader=function(sources,files){this.sources=[];var _g=0;while(_g<sources.length){var source=sources[_g];++_g;this.sources.push(source.toString())}this.type=35632;this.shader=null;this.files=files};$hxClasses["kha.graphics4.FragmentShader"]=kha_graphics4_FragmentShader;kha_graphics4_FragmentShader.__name__=true;kha_graphics4_FragmentShader.fromSource=function(source){var shader=new kha_graphics4_FragmentShader([],["runtime-string"]);shader.sources.push(source);return shader};kha_graphics4_FragmentShader.prototype={__class__:kha_graphics4_FragmentShader};var kha_graphics4_GeometryShader=function(){};$hxClasses["kha.graphics4.GeometryShader"]=kha_graphics4_GeometryShader;kha_graphics4_GeometryShader.__name__=true;var kha_graphics4_Graphics=function(){};$hxClasses["kha.graphics4.Graphics"]=kha_graphics4_Graphics;kha_graphics4_Graphics.__name__=true;kha_graphics4_Graphics.prototype={__class__:kha_graphics4_Graphics};var kha_graphics4_ImageShaderPainter=function(g4){this.myPipeline=null;this.bilinearMipmaps=false;this.bilinear=false;this.g=g4;kha_graphics4_ImageShaderPainter.bufferIndex=0;kha_graphics4_ImageShaderPainter.initShaders();this.initBuffers();this.projectionLocation=kha_graphics4_ImageShaderPainter.shaderPipeline.getConstantLocation("projectionMatrix");this.textureLocation=kha_graphics4_ImageShaderPainter.shaderPipeline.getTextureUnit("tex")};$hxClasses["kha.graphics4.ImageShaderPainter"]=kha_graphics4_ImageShaderPainter;kha_graphics4_ImageShaderPainter.__name__=true;kha_graphics4_ImageShaderPainter.initShaders=function(){if(kha_graphics4_ImageShaderPainter.structure==null){kha_graphics4_ImageShaderPainter.structure=kha_graphics4_Graphics2.createImageVertexStructure()}if(kha_graphics4_ImageShaderPainter.shaderPipeline==null){kha_graphics4_ImageShaderPainter.shaderPipeline=kha_graphics4_Graphics2.createImagePipeline(kha_graphics4_ImageShaderPainter.structure);kha_graphics4_ImageShaderPainter.shaderPipeline.compile()}};kha_graphics4_ImageShaderPainter.prototype={get_pipeline:function(){return this.myPipeline},setProjection:function(projectionMatrix){this.projectionMatrix=projectionMatrix},initBuffers:function(){if(kha_graphics4_ImageShaderPainter.rectVertexBuffer==null){kha_graphics4_ImageShaderPainter.rectVertexBuffer=new kha_graphics4_VertexBuffer(6e3,kha_graphics4_ImageShaderPainter.structure,1);kha_graphics4_ImageShaderPainter.rectVertices=kha_graphics4_ImageShaderPainter.rectVertexBuffer.lock();kha_graphics4_ImageShaderPainter.indexBuffer=new kha_graphics4_IndexBuffer(9e3,0);var indices=kha_graphics4_ImageShaderPainter.indexBuffer.lock();var _g=0;while(_g<1500){var i=_g++;indices[i*3*2]=i*4;indices[i*3*2+1]=i*4+1;indices[i*3*2+2]=i*4+2;indices[i*3*2+3]=i*4;indices[i*3*2+4]=i*4+2;indices[i*3*2+5]=i*4+3}kha_graphics4_ImageShaderPainter.indexBuffer.unlock()}},setRectVertices:function(bottomleftx,bottomlefty,topleftx,toplefty,toprightx,toprighty,bottomrightx,bottomrighty){var baseIndex=kha_graphics4_ImageShaderPainter.bufferIndex*9*4;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex]=bottomleftx;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+1]=bottomlefty;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+2]=-5;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+9]=topleftx;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+10]=toplefty;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+11]=-5;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+18]=toprightx;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+19]=toprighty;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+20]=-5;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+27]=bottomrightx;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+28]=bottomrighty;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+29]=-5},setRectTexCoords:function(left,top,right,bottom){var baseIndex=kha_graphics4_ImageShaderPainter.bufferIndex*9*4;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+3]=left;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+4]=bottom;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+12]=left;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+13]=top;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+21]=right;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+22]=top;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+30]=right;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+31]=bottom},setRectColor:function(r,g,b,a){var baseIndex=kha_graphics4_ImageShaderPainter.bufferIndex*9*4;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+5]=r;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+6]=g;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+7]=b;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+8]=a;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+14]=r;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+15]=g;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+16]=b;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+17]=a;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+23]=r;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+24]=g;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+25]=b;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+26]=a;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+32]=r;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+33]=g;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+34]=b;kha_graphics4_ImageShaderPainter.rectVertices[baseIndex+35]=a},drawBuffer:function(){kha_graphics4_ImageShaderPainter.rectVertexBuffer.unlock();this.g.setVertexBuffer(kha_graphics4_ImageShaderPainter.rectVertexBuffer);this.g.setIndexBuffer(kha_graphics4_ImageShaderPainter.indexBuffer);this.g.setPipeline(this.get_pipeline()==null?kha_graphics4_ImageShaderPainter.shaderPipeline:this.get_pipeline());this.g.setTexture(this.textureLocation,kha_graphics4_ImageShaderPainter.lastTexture);this.g.setTextureParameters(this.textureLocation,2,2,this.bilinear?1:0,this.bilinear?1:0,this.bilinearMipmaps?2:0);this.g.setMatrix(this.projectionLocation,this.projectionMatrix);this.g.drawIndexedVertices(0,kha_graphics4_ImageShaderPainter.bufferIndex*2*3);this.g.setTexture(this.textureLocation,null);kha_graphics4_ImageShaderPainter.bufferIndex=0;kha_graphics4_ImageShaderPainter.rectVertices=kha_graphics4_ImageShaderPainter.rectVertexBuffer.lock()},setBilinearFilter:function(bilinear){this.end();this.bilinear=bilinear},drawImage:function(img,bottomleftx,bottomlefty,topleftx,toplefty,toprightx,toprighty,bottomrightx,bottomrighty,opacity,color){var tex=img;if(kha_graphics4_ImageShaderPainter.bufferIndex+1>=1500||kha_graphics4_ImageShaderPainter.lastTexture!=null&&tex!=kha_graphics4_ImageShaderPainter.lastTexture){this.drawBuffer()}this.setRectColor(((color&16711680)>>>16)*.00392156862745098,((color&65280)>>>8)*.00392156862745098,(color&255)*.00392156862745098,(color>>>24)*.00392156862745098*opacity);this.setRectTexCoords(0,0,tex.get_width()/tex.get_realWidth(),tex.get_height()/tex.get_realHeight());this.setRectVertices(bottomleftx,bottomlefty,topleftx,toplefty,toprightx,toprighty,bottomrightx,bottomrighty);++kha_graphics4_ImageShaderPainter.bufferIndex;kha_graphics4_ImageShaderPainter.lastTexture=tex},drawImage2:function(img,sx,sy,sw,sh,bottomleftx,bottomlefty,topleftx,toplefty,toprightx,toprighty,bottomrightx,bottomrighty,opacity,color){var tex=img;if(kha_graphics4_ImageShaderPainter.bufferIndex+1>=1500||kha_graphics4_ImageShaderPainter.lastTexture!=null&&tex!=kha_graphics4_ImageShaderPainter.lastTexture){this.drawBuffer()}this.setRectTexCoords(sx/tex.get_realWidth(),sy/tex.get_realHeight(),(sx+sw)/tex.get_realWidth(),(sy+sh)/tex.get_realHeight());this.setRectColor(((color&16711680)>>>16)*.00392156862745098,((color&65280)>>>8)*.00392156862745098,(color&255)*.00392156862745098,(color>>>24)*.00392156862745098*opacity);this.setRectVertices(bottomleftx,bottomlefty,topleftx,toplefty,toprightx,toprighty,bottomrightx,bottomrighty);++kha_graphics4_ImageShaderPainter.bufferIndex;kha_graphics4_ImageShaderPainter.lastTexture=tex},end:function(){if(kha_graphics4_ImageShaderPainter.bufferIndex>0){this.drawBuffer()}kha_graphics4_ImageShaderPainter.lastTexture=null},__class__:kha_graphics4_ImageShaderPainter,__properties__:{get_pipeline:"get_pipeline"}};var kha_graphics4_ColoredShaderPainter=function(g4){this.myPipeline=null;this.g=g4;kha_graphics4_ColoredShaderPainter.bufferIndex=0;kha_graphics4_ColoredShaderPainter.triangleBufferIndex=0;kha_graphics4_ColoredShaderPainter.initShaders();this.initBuffers();this.projectionLocation=kha_graphics4_ColoredShaderPainter.shaderPipeline.getConstantLocation("projectionMatrix")};$hxClasses["kha.graphics4.ColoredShaderPainter"]=kha_graphics4_ColoredShaderPainter;kha_graphics4_ColoredShaderPainter.__name__=true;kha_graphics4_ColoredShaderPainter.initShaders=function(){if(kha_graphics4_ColoredShaderPainter.structure==null){kha_graphics4_ColoredShaderPainter.structure=kha_graphics4_Graphics2.createColoredVertexStructure()}if(kha_graphics4_ColoredShaderPainter.shaderPipeline==null){kha_graphics4_ColoredShaderPainter.shaderPipeline=kha_graphics4_Graphics2.createColoredPipeline(kha_graphics4_ColoredShaderPainter.structure);kha_graphics4_ColoredShaderPainter.shaderPipeline.compile()}};kha_graphics4_ColoredShaderPainter.prototype={get_pipeline:function(){return this.myPipeline},setProjection:function(projectionMatrix){this.projectionMatrix=projectionMatrix},initBuffers:function(){if(kha_graphics4_ColoredShaderPainter.rectVertexBuffer==null){kha_graphics4_ColoredShaderPainter.rectVertexBuffer=new kha_graphics4_VertexBuffer(400,kha_graphics4_ColoredShaderPainter.structure,1);kha_graphics4_ColoredShaderPainter.rectVertices=kha_graphics4_ColoredShaderPainter.rectVertexBuffer.lock();kha_graphics4_ColoredShaderPainter.indexBuffer=new kha_graphics4_IndexBuffer(600,0);var indices=kha_graphics4_ColoredShaderPainter.indexBuffer.lock();var _g=0;while(_g<100){var i=_g++;indices[i*3*2]=i*4;indices[i*3*2+1]=i*4+1;indices[i*3*2+2]=i*4+2;indices[i*3*2+3]=i*4;indices[i*3*2+4]=i*4+2;indices[i*3*2+5]=i*4+3}kha_graphics4_ColoredShaderPainter.indexBuffer.unlock();kha_graphics4_ColoredShaderPainter.triangleVertexBuffer=new kha_graphics4_VertexBuffer(300,kha_graphics4_ColoredShaderPainter.structure,1);kha_graphics4_ColoredShaderPainter.triangleVertices=kha_graphics4_ColoredShaderPainter.triangleVertexBuffer.lock();kha_graphics4_ColoredShaderPainter.triangleIndexBuffer=new kha_graphics4_IndexBuffer(300,0);var triIndices=kha_graphics4_ColoredShaderPainter.triangleIndexBuffer.lock();var _g1=0;while(_g1<100){var i1=_g1++;triIndices[i1*3]=i1*3;triIndices[i1*3+1]=i1*3+1;triIndices[i1*3+2]=i1*3+2}kha_graphics4_ColoredShaderPainter.triangleIndexBuffer.unlock()}},setRectVertices:function(bottomleftx,bottomlefty,topleftx,toplefty,toprightx,toprighty,bottomrightx,bottomrighty){var baseIndex=kha_graphics4_ColoredShaderPainter.bufferIndex*7*4;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex]=bottomleftx;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+1]=bottomlefty;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+2]=-5;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+7]=topleftx;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+8]=toplefty;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+9]=-5;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+14]=toprightx;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+15]=toprighty;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+16]=-5;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+21]=bottomrightx;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+22]=bottomrighty;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+23]=-5},setRectColors:function(opacity,color){var baseIndex=kha_graphics4_ColoredShaderPainter.bufferIndex*7*4;var a=opacity*((color>>>24)*.00392156862745098);kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+3]=((color&16711680)>>>16)*.00392156862745098;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+4]=((color&65280)>>>8)*.00392156862745098;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+5]=(color&255)*.00392156862745098;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+6]=a;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+10]=((color&16711680)>>>16)*.00392156862745098;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+11]=((color&65280)>>>8)*.00392156862745098;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+12]=(color&255)*.00392156862745098;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+13]=a;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+17]=((color&16711680)>>>16)*.00392156862745098;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+18]=((color&65280)>>>8)*.00392156862745098;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+19]=(color&255)*.00392156862745098;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+20]=a;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+24]=((color&16711680)>>>16)*.00392156862745098;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+25]=((color&65280)>>>8)*.00392156862745098;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+26]=(color&255)*.00392156862745098;kha_graphics4_ColoredShaderPainter.rectVertices[baseIndex+27]=a},setTriVertices:function(x1,y1,x2,y2,x3,y3){var baseIndex=kha_graphics4_ColoredShaderPainter.triangleBufferIndex*7*3;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex]=x1;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+1]=y1;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+2]=-5;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+7]=x2;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+8]=y2;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+9]=-5;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+14]=x3;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+15]=y3;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+16]=-5},setTriColors:function(opacity,color){var baseIndex=kha_graphics4_ColoredShaderPainter.triangleBufferIndex*7*3;var a=opacity*((color>>>24)*.00392156862745098);kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+3]=((color&16711680)>>>16)*.00392156862745098;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+4]=((color&65280)>>>8)*.00392156862745098;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+5]=(color&255)*.00392156862745098;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+6]=a;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+10]=((color&16711680)>>>16)*.00392156862745098;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+11]=((color&65280)>>>8)*.00392156862745098;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+12]=(color&255)*.00392156862745098;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+13]=a;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+17]=((color&16711680)>>>16)*.00392156862745098;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+18]=((color&65280)>>>8)*.00392156862745098;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+19]=(color&255)*.00392156862745098;kha_graphics4_ColoredShaderPainter.triangleVertices[baseIndex+20]=a},drawBuffer:function(trisDone){if(!trisDone){this.endTris(true)}kha_graphics4_ColoredShaderPainter.rectVertexBuffer.unlock();this.g.setVertexBuffer(kha_graphics4_ColoredShaderPainter.rectVertexBuffer);this.g.setIndexBuffer(kha_graphics4_ColoredShaderPainter.indexBuffer);this.g.setPipeline(this.get_pipeline()==null?kha_graphics4_ColoredShaderPainter.shaderPipeline:this.get_pipeline());this.g.setMatrix(this.projectionLocation,this.projectionMatrix);this.g.drawIndexedVertices(0,kha_graphics4_ColoredShaderPainter.bufferIndex*2*3);kha_graphics4_ColoredShaderPainter.bufferIndex=0;kha_graphics4_ColoredShaderPainter.rectVertices=kha_graphics4_ColoredShaderPainter.rectVertexBuffer.lock()},drawTriBuffer:function(rectsDone){if(!rectsDone){this.endRects(true)}kha_graphics4_ColoredShaderPainter.triangleVertexBuffer.unlock();this.g.setVertexBuffer(kha_graphics4_ColoredShaderPainter.triangleVertexBuffer);this.g.setIndexBuffer(kha_graphics4_ColoredShaderPainter.triangleIndexBuffer);this.g.setPipeline(this.get_pipeline()==null?kha_graphics4_ColoredShaderPainter.shaderPipeline:this.get_pipeline());this.g.setMatrix(this.projectionLocation,this.projectionMatrix);this.g.drawIndexedVertices(0,kha_graphics4_ColoredShaderPainter.triangleBufferIndex*3);kha_graphics4_ColoredShaderPainter.triangleBufferIndex=0;kha_graphics4_ColoredShaderPainter.triangleVertices=kha_graphics4_ColoredShaderPainter.triangleVertexBuffer.lock()},fillRect:function(opacity,color,bottomleftx,bottomlefty,topleftx,toplefty,toprightx,toprighty,bottomrightx,bottomrighty){if(kha_graphics4_ColoredShaderPainter.triangleBufferIndex>0){this.drawTriBuffer(true)}if(kha_graphics4_ColoredShaderPainter.bufferIndex+1>=100){this.drawBuffer(false)}this.setRectColors(opacity,color);this.setRectVertices(bottomleftx,bottomlefty,topleftx,toplefty,toprightx,toprighty,bottomrightx,bottomrighty);++kha_graphics4_ColoredShaderPainter.bufferIndex},fillTriangle:function(opacity,color,x1,y1,x2,y2,x3,y3){if(kha_graphics4_ColoredShaderPainter.bufferIndex>0){this.drawBuffer(true)}if(kha_graphics4_ColoredShaderPainter.triangleBufferIndex+1>=100){this.drawTriBuffer(false)}this.setTriColors(opacity,color);this.setTriVertices(x1,y1,x2,y2,x3,y3);++kha_graphics4_ColoredShaderPainter.triangleBufferIndex},endTris:function(rectsDone){if(kha_graphics4_ColoredShaderPainter.triangleBufferIndex>0){this.drawTriBuffer(rectsDone)}},endRects:function(trisDone){if(kha_graphics4_ColoredShaderPainter.bufferIndex>0){this.drawBuffer(trisDone)}},end:function(){this.endTris(false);this.endRects(false)},__class__:kha_graphics4_ColoredShaderPainter,__properties__:{get_pipeline:"get_pipeline"}};var kha_graphics4_TextShaderPainter=function(g4){this.bakedQuadCache=new kha_AlignedQuad;this.bilinear=false;this.myPipeline=null;this.g=g4;kha_graphics4_TextShaderPainter.bufferIndex=0;kha_graphics4_TextShaderPainter.initShaders();this.initBuffers();this.projectionLocation=kha_graphics4_TextShaderPainter.shaderPipeline.getConstantLocation("projectionMatrix");this.textureLocation=kha_graphics4_TextShaderPainter.shaderPipeline.getTextureUnit("tex")};$hxClasses["kha.graphics4.TextShaderPainter"]=kha_graphics4_TextShaderPainter;kha_graphics4_TextShaderPainter.__name__=true;kha_graphics4_TextShaderPainter.initShaders=function(){if(kha_graphics4_TextShaderPainter.structure==null){kha_graphics4_TextShaderPainter.structure=kha_graphics4_Graphics2.createTextVertexStructure()}if(kha_graphics4_TextShaderPainter.shaderPipeline==null){kha_graphics4_TextShaderPainter.shaderPipeline=kha_graphics4_Graphics2.createTextPipeline(kha_graphics4_TextShaderPainter.structure);kha_graphics4_TextShaderPainter.shaderPipeline.compile()}};kha_graphics4_TextShaderPainter.findIndex=function(charCode){var glyphs=kha_graphics2_Graphics.fontGlyphs;var blocks=kha_KravurImage.charBlocks;var offset=0;var _g=0;var _g1=Std.int(blocks.length/2);while(_g<_g1){var i=_g++;var start=blocks[i*2];var end=blocks[i*2+1];if(charCode>=start&&charCode<=end){return offset+charCode-start}offset+=end-start+1}return 0};kha_graphics4_TextShaderPainter.prototype={get_pipeline:function(){return this.myPipeline},setProjection:function(projectionMatrix){this.projectionMatrix=projectionMatrix},initBuffers:function(){if(kha_graphics4_TextShaderPainter.rectVertexBuffer==null){kha_graphics4_TextShaderPainter.rectVertexBuffer=new kha_graphics4_VertexBuffer(400,kha_graphics4_TextShaderPainter.structure,1);kha_graphics4_TextShaderPainter.rectVertices=kha_graphics4_TextShaderPainter.rectVertexBuffer.lock();kha_graphics4_TextShaderPainter.indexBuffer=new kha_graphics4_IndexBuffer(600,0);var indices=kha_graphics4_TextShaderPainter.indexBuffer.lock();var _g=0;while(_g<100){var i=_g++;indices[i*3*2]=i*4;indices[i*3*2+1]=i*4+1;indices[i*3*2+2]=i*4+2;indices[i*3*2+3]=i*4;indices[i*3*2+4]=i*4+2;indices[i*3*2+5]=i*4+3}kha_graphics4_TextShaderPainter.indexBuffer.unlock()}},setRectVertices:function(bottomleftx,bottomlefty,topleftx,toplefty,toprightx,toprighty,bottomrightx,bottomrighty){var baseIndex=kha_graphics4_TextShaderPainter.bufferIndex*9*4;kha_graphics4_TextShaderPainter.rectVertices[baseIndex]=bottomleftx;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+1]=bottomlefty;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+2]=-5;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+9]=topleftx;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+10]=toplefty;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+11]=-5;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+18]=toprightx;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+19]=toprighty;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+20]=-5;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+27]=bottomrightx;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+28]=bottomrighty;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+29]=-5},setRectTexCoords:function(left,top,right,bottom){var baseIndex=kha_graphics4_TextShaderPainter.bufferIndex*9*4;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+3]=left;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+4]=bottom;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+12]=left;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+13]=top;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+21]=right;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+22]=top;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+30]=right;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+31]=bottom},setRectColors:function(opacity,color){var baseIndex=kha_graphics4_TextShaderPainter.bufferIndex*9*4;var a=opacity*((color>>>24)*.00392156862745098);kha_graphics4_TextShaderPainter.rectVertices[baseIndex+5]=((color&16711680)>>>16)*.00392156862745098;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+6]=((color&65280)>>>8)*.00392156862745098;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+7]=(color&255)*.00392156862745098;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+8]=a;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+14]=((color&16711680)>>>16)*.00392156862745098;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+15]=((color&65280)>>>8)*.00392156862745098;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+16]=(color&255)*.00392156862745098;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+17]=a;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+23]=((color&16711680)>>>16)*.00392156862745098;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+24]=((color&65280)>>>8)*.00392156862745098;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+25]=(color&255)*.00392156862745098;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+26]=a;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+32]=((color&16711680)>>>16)*.00392156862745098;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+33]=((color&65280)>>>8)*.00392156862745098;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+34]=(color&255)*.00392156862745098;kha_graphics4_TextShaderPainter.rectVertices[baseIndex+35]=a},drawBuffer:function(){kha_graphics4_TextShaderPainter.rectVertexBuffer.unlock();this.g.setVertexBuffer(kha_graphics4_TextShaderPainter.rectVertexBuffer);this.g.setIndexBuffer(kha_graphics4_TextShaderPainter.indexBuffer);this.g.setPipeline(this.get_pipeline()==null?kha_graphics4_TextShaderPainter.shaderPipeline:this.get_pipeline());this.g.setTexture(this.textureLocation,kha_graphics4_TextShaderPainter.lastTexture);this.g.setMatrix(this.projectionLocation,this.projectionMatrix);this.g.setTextureParameters(this.textureLocation,2,2,this.bilinear?1:0,this.bilinear?1:0,0);this.g.drawIndexedVertices(0,kha_graphics4_TextShaderPainter.bufferIndex*2*3);this.g.setTexture(this.textureLocation,null);kha_graphics4_TextShaderPainter.bufferIndex=0;kha_graphics4_TextShaderPainter.rectVertices=kha_graphics4_TextShaderPainter.rectVertexBuffer.lock()},setBilinearFilter:function(bilinear){this.end();this.bilinear=bilinear},setFont:function(font){this.font=js_Boot.__cast(font,kha_Kravur)},startString:function(text){this.text=text},charCodeAt:function(position){return HxOverrides.cca(this.text,position)},stringLength:function(){return this.text.length},endString:function(){this.text=null},drawString:function(text,opacity,color,x,y,transformation){var font=this.font._get(this.fontSize);var tex=font.getTexture();if(kha_graphics4_TextShaderPainter.lastTexture!=null&&tex!=kha_graphics4_TextShaderPainter.lastTexture){this.drawBuffer()}kha_graphics4_TextShaderPainter.lastTexture=tex;var xpos=x;var ypos=y;this.startString(text);var _g=0;var _g1=this.stringLength();while(_g<_g1){var i=_g++;var q=font.getBakedQuad(this.bakedQuadCache,kha_graphics4_TextShaderPainter.findIndex(this.charCodeAt(i)),xpos,ypos);if(q!=null){if(kha_graphics4_TextShaderPainter.bufferIndex+1>=100){this.drawBuffer()}this.setRectColors(opacity,color);this.setRectTexCoords(q.s0*tex.get_width()/tex.get_realWidth(),q.t0*tex.get_height()/tex.get_realHeight(),q.s1*tex.get_width()/tex.get_realWidth(),q.t1*tex.get_height()/tex.get_realHeight());var value=new kha_math_FastVector2(q.x0,q.y1);var w=transformation._02*value.x+transformation._12*value.y+transformation._22;var x1=(transformation._00*value.x+transformation._10*value.y+transformation._20)/w;var y1=(transformation._01*value.x+transformation._11*value.y+transformation._21)/w;var p0=new kha_math_FastVector2(x1,y1);var value1=new kha_math_FastVector2(q.x0,q.y0);var w1=transformation._02*value1.x+transformation._12*value1.y+transformation._22;var x2=(transformation._00*value1.x+transformation._10*value1.y+transformation._20)/w1;var y2=(transformation._01*value1.x+transformation._11*value1.y+transformation._21)/w1;var p1=new kha_math_FastVector2(x2,y2);var value2=new kha_math_FastVector2(q.x1,q.y0);var w2=transformation._02*value2.x+transformation._12*value2.y+transformation._22;var x3=(transformation._00*value2.x+transformation._10*value2.y+transformation._20)/w2;var y3=(transformation._01*value2.x+transformation._11*value2.y+transformation._21)/w2;var p2=new kha_math_FastVector2(x3,y3);var value3=new kha_math_FastVector2(q.x1,q.y1);var w3=transformation._02*value3.x+transformation._12*value3.y+transformation._22;var x4=(transformation._00*value3.x+transformation._10*value3.y+transformation._20)/w3;var y4=(transformation._01*value3.x+transformation._11*value3.y+transformation._21)/w3;var p3=new kha_math_FastVector2(x4,y4);this.setRectVertices(p0.x,p0.y,p1.x,p1.y,p2.x,p2.y,p3.x,p3.y);xpos+=q.xadvance;++kha_graphics4_TextShaderPainter.bufferIndex}}this.endString()},end:function(){if(kha_graphics4_TextShaderPainter.bufferIndex>0){this.drawBuffer()}kha_graphics4_TextShaderPainter.lastTexture=null},__class__:kha_graphics4_TextShaderPainter,__properties__:{get_pipeline:"get_pipeline"}};var kha_graphics4_Graphics2=function(canvas){this.myImageScaleQuality=kha_graphics2_ImageScaleQuality.High;kha_graphics2_Graphics.call(this);this.set_color(-1);this.canvas=canvas;this.g=canvas.get_g4();this.imagePainter=new kha_graphics4_ImageShaderPainter(this.g);this.coloredPainter=new kha_graphics4_ColoredShaderPainter(this.g);this.textPainter=new kha_graphics4_TextShaderPainter(this.g);this.textPainter.fontSize=this.get_fontSize();this.projectionMatrix=new kha_math_FastMatrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.setProjection();if(kha_graphics4_Graphics2.videoPipeline==null){kha_graphics4_Graphics2.videoPipeline=kha_graphics4_Graphics2.createImagePipeline(kha_graphics4_Graphics2.createImageVertexStructure());kha_graphics4_Graphics2.videoPipeline.fragmentShader=kha_Shaders.painter_video_frag;kha_graphics4_Graphics2.videoPipeline.vertexShader=kha_Shaders.painter_video_vert;kha_graphics4_Graphics2.videoPipeline.compile()}};$hxClasses["kha.graphics4.Graphics2"]=kha_graphics4_Graphics2;kha_graphics4_Graphics2.__name__=true;kha_graphics4_Graphics2.upperPowerOfTwo=function(v){--v;v|=v>>>1;v|=v>>>2;v|=v>>>4;v|=v>>>8;v|=v>>>16;return++v};kha_graphics4_Graphics2.createImageVertexStructure=function(){var structure=new kha_graphics4_VertexStructure;structure.add("vertexPosition",2);structure.add("texPosition",1);structure.add("vertexColor",3);return structure};kha_graphics4_Graphics2.createImagePipeline=function(structure){var shaderPipeline=new kha_graphics4_PipelineState;shaderPipeline.fragmentShader=kha_Shaders.painter_image_frag;shaderPipeline.vertexShader=kha_Shaders.painter_image_vert;shaderPipeline.inputLayout=[structure];shaderPipeline.blendSource=1;shaderPipeline.blendDestination=5;shaderPipeline.alphaBlendSource=1;shaderPipeline.alphaBlendDestination=5;return shaderPipeline};kha_graphics4_Graphics2.createColoredVertexStructure=function(){var structure=new kha_graphics4_VertexStructure;structure.add("vertexPosition",2);structure.add("vertexColor",3);return structure};kha_graphics4_Graphics2.createColoredPipeline=function(structure){var shaderPipeline=new kha_graphics4_PipelineState;shaderPipeline.fragmentShader=kha_Shaders.painter_colored_frag;shaderPipeline.vertexShader=kha_Shaders.painter_colored_vert;shaderPipeline.inputLayout=[structure];shaderPipeline.blendSource=3;shaderPipeline.blendDestination=5;shaderPipeline.alphaBlendSource=3;shaderPipeline.alphaBlendDestination=5;return shaderPipeline};kha_graphics4_Graphics2.createTextVertexStructure=function(){var structure=new kha_graphics4_VertexStructure;structure.add("vertexPosition",2);structure.add("texPosition",1);structure.add("vertexColor",3);return structure};kha_graphics4_Graphics2.createTextPipeline=function(structure){var shaderPipeline=new kha_graphics4_PipelineState;shaderPipeline.fragmentShader=kha_Shaders.painter_text_frag;shaderPipeline.vertexShader=kha_Shaders.painter_text_vert;shaderPipeline.inputLayout=[structure];shaderPipeline.blendSource=3;shaderPipeline.blendDestination=5;shaderPipeline.alphaBlendSource=3;shaderPipeline.alphaBlendDestination=5;return shaderPipeline};kha_graphics4_Graphics2.__super__=kha_graphics2_Graphics;kha_graphics4_Graphics2.prototype=$extend(kha_graphics2_Graphics.prototype,{setProjection:function(){var width=this.canvas.get_width();var height=this.canvas.get_height();if(this.canvas instanceof kha_Framebuffer){var _this=this.projectionMatrix;var m=kha_math_FastMatrix4.orthogonalProjection(0,width,height,0,.1,1e3);_this._00=m._00;_this._10=m._10;_this._20=m._20;_this._30=m._30;_this._01=m._01;_this._11=m._11;_this._21=m._21;_this._31=m._31;_this._02=m._02;_this._12=m._12;_this._22=m._22;_this._32=m._32;_this._03=m._03;_this._13=m._13;_this._23=m._23;_this._33=m._33}else{if(!kha_Image.get_nonPow2Supported()){width=kha_graphics4_Graphics2.upperPowerOfTwo(width);height=kha_graphics4_Graphics2.upperPowerOfTwo(height)}if(this.g.renderTargetsInvertedY()){var _this1=this.projectionMatrix;var m1=kha_math_FastMatrix4.orthogonalProjection(0,width,0,height,.1,1e3);_this1._00=m1._00;_this1._10=m1._10;_this1._20=m1._20;_this1._30=m1._30;_this1._01=m1._01;_this1._11=m1._11;_this1._21=m1._21;_this1._31=m1._31;_this1._02=m1._02;_this1._12=m1._12;_this1._22=m1._22;_this1._32=m1._32;_this1._03=m1._03;_this1._13=m1._13;_this1._23=m1._23;_this1._33=m1._33}else{var _this2=this.projectionMatrix;var m2=kha_math_FastMatrix4.orthogonalProjection(0,width,height,0,.1,1e3);_this2._00=m2._00;_this2._10=m2._10;_this2._20=m2._20;_this2._30=m2._30;_this2._01=m2._01;_this2._11=m2._11;_this2._21=m2._21;_this2._31=m2._31;_this2._02=m2._02;_this2._12=m2._12;_this2._22=m2._22;_this2._32=m2._32;_this2._03=m2._03;_this2._13=m2._13;_this2._23=m2._23;_this2._33=m2._33}}this.imagePainter.setProjection(this.projectionMatrix);this.coloredPainter.setProjection(this.projectionMatrix);this.textPainter.setProjection(this.projectionMatrix)},drawImage:function(img,x,y){this.coloredPainter.end();this.textPainter.end();var xw=x+img.get_width();var yh=y+img.get_height();var _this=this.get_transformation();var value=new kha_math_FastVector2(x,yh);var w=_this._02*value.x+_this._12*value.y+_this._22;var x1=(_this._00*value.x+_this._10*value.y+_this._20)/w;var y1=(_this._01*value.x+_this._11*value.y+_this._21)/w;var p1=new kha_math_FastVector2(x1,y1);var _this1=this.get_transformation();var value1=new kha_math_FastVector2(x,y);var w1=_this1._02*value1.x+_this1._12*value1.y+_this1._22;var x2=(_this1._00*value1.x+_this1._10*value1.y+_this1._20)/w1;var y2=(_this1._01*value1.x+_this1._11*value1.y+_this1._21)/w1;var p2=new kha_math_FastVector2(x2,y2);var _this2=this.get_transformation();var value2=new kha_math_FastVector2(xw,y);var w2=_this2._02*value2.x+_this2._12*value2.y+_this2._22;var x3=(_this2._00*value2.x+_this2._10*value2.y+_this2._20)/w2;var y3=(_this2._01*value2.x+_this2._11*value2.y+_this2._21)/w2;var p3=new kha_math_FastVector2(x3,y3);var _this3=this.get_transformation();var value3=new kha_math_FastVector2(xw,yh);var w3=_this3._02*value3.x+_this3._12*value3.y+_this3._22;var x4=(_this3._00*value3.x+_this3._10*value3.y+_this3._20)/w3;var y4=(_this3._01*value3.x+_this3._11*value3.y+_this3._21)/w3;var p4=new kha_math_FastVector2(x4,y4);this.imagePainter.drawImage(img,p1.x,p1.y,p2.x,p2.y,p3.x,p3.y,p4.x,p4.y,this.get_opacity(),this.get_color())},drawScaledSubImage:function(img,sx,sy,sw,sh,dx,dy,dw,dh){this.coloredPainter.end();this.textPainter.end();var _this=this.get_transformation();var value=new kha_math_FastVector2(dx,dy+dh);var w=_this._02*value.x+_this._12*value.y+_this._22;var x=(_this._00*value.x+_this._10*value.y+_this._20)/w;var y=(_this._01*value.x+_this._11*value.y+_this._21)/w;var p1=new kha_math_FastVector2(x,y);var _this1=this.get_transformation();var value1=new kha_math_FastVector2(dx,dy);var w1=_this1._02*value1.x+_this1._12*value1.y+_this1._22;var x1=(_this1._00*value1.x+_this1._10*value1.y+_this1._20)/w1;var y1=(_this1._01*value1.x+_this1._11*value1.y+_this1._21)/w1;var p2=new kha_math_FastVector2(x1,y1);var _this2=this.get_transformation();var value2=new kha_math_FastVector2(dx+dw,dy);var w2=_this2._02*value2.x+_this2._12*value2.y+_this2._22;var x2=(_this2._00*value2.x+_this2._10*value2.y+_this2._20)/w2;var y2=(_this2._01*value2.x+_this2._11*value2.y+_this2._21)/w2;var p3=new kha_math_FastVector2(x2,y2);var _this3=this.get_transformation();var value3=new kha_math_FastVector2(dx+dw,dy+dh);var w3=_this3._02*value3.x+_this3._12*value3.y+_this3._22;var x3=(_this3._00*value3.x+_this3._10*value3.y+_this3._20)/w3;var y3=(_this3._01*value3.x+_this3._11*value3.y+_this3._21)/w3;var p4=new kha_math_FastVector2(x3,y3);this.imagePainter.drawImage2(img,sx,sy,sw,sh,p1.x,p1.y,p2.x,p2.y,p3.x,p3.y,p4.x,p4.y,this.get_opacity(),this.get_color())},get_color:function(){return this.myColor},set_color:function(color){return this.myColor=color},drawRect:function(x,y,width,height,strength){if(strength==null){strength=1}this.imagePainter.end();this.textPainter.end();var _this=this.get_transformation();var value=new kha_math_FastVector2(x-strength/2,y+strength/2);var w=_this._02*value.x+_this._12*value.y+_this._22;var x1=(_this._00*value.x+_this._10*value.y+_this._20)/w;var y1=(_this._01*value.x+_this._11*value.y+_this._21)/w;var p1=new kha_math_FastVector2(x1,y1);var _this1=this.get_transformation();var value1=new kha_math_FastVector2(x-strength/2,y-strength/2);var w1=_this1._02*value1.x+_this1._12*value1.y+_this1._22;var x2=(_this1._00*value1.x+_this1._10*value1.y+_this1._20)/w1;var y2=(_this1._01*value1.x+_this1._11*value1.y+_this1._21)/w1;var p2=new kha_math_FastVector2(x2,y2);var _this2=this.get_transformation();var value2=new kha_math_FastVector2(x+width+strength/2,y-strength/2);var w2=_this2._02*value2.x+_this2._12*value2.y+_this2._22;var x3=(_this2._00*value2.x+_this2._10*value2.y+_this2._20)/w2;var y3=(_this2._01*value2.x+_this2._11*value2.y+_this2._21)/w2;var p3=new kha_math_FastVector2(x3,y3);var _this3=this.get_transformation();var value3=new kha_math_FastVector2(x+width+strength/2,y+strength/2);var w3=_this3._02*value3.x+_this3._12*value3.y+_this3._22;var x4=(_this3._00*value3.x+_this3._10*value3.y+_this3._20)/w3;var y4=(_this3._01*value3.x+_this3._11*value3.y+_this3._21)/w3;var p4=new kha_math_FastVector2(x4,y4);this.coloredPainter.fillRect(this.get_opacity(),this.get_color(),p1.x,p1.y,p2.x,p2.y,p3.x,p3.y,p4.x,p4.y);var _this4=this.get_transformation();var value4=new kha_math_FastVector2(x-strength/2,y+height-strength/2);var w4=_this4._02*value4.x+_this4._12*value4.y+_this4._22;var x5=(_this4._00*value4.x+_this4._10*value4.y+_this4._20)/w4;var y5=(_this4._01*value4.x+_this4._11*value4.y+_this4._21)/w4;p1=new kha_math_FastVector2(x5,y5);var _this5=this.get_transformation();var value5=new kha_math_FastVector2(x-strength/2,y+strength/2);var w5=_this5._02*value5.x+_this5._12*value5.y+_this5._22;var x6=(_this5._00*value5.x+_this5._10*value5.y+_this5._20)/w5;var y6=(_this5._01*value5.x+_this5._11*value5.y+_this5._21)/w5;p2=new kha_math_FastVector2(x6,y6);var _this6=this.get_transformation();var value6=new kha_math_FastVector2(x+strength/2,y+strength/2);var w6=_this6._02*value6.x+_this6._12*value6.y+_this6._22;var x7=(_this6._00*value6.x+_this6._10*value6.y+_this6._20)/w6;var y7=(_this6._01*value6.x+_this6._11*value6.y+_this6._21)/w6;p3=new kha_math_FastVector2(x7,y7);var _this7=this.get_transformation();var value7=new kha_math_FastVector2(x+strength/2,y+height-strength/2);var w7=_this7._02*value7.x+_this7._12*value7.y+_this7._22;var x8=(_this7._00*value7.x+_this7._10*value7.y+_this7._20)/w7;var y8=(_this7._01*value7.x+_this7._11*value7.y+_this7._21)/w7;p4=new kha_math_FastVector2(x8,y8);this.coloredPainter.fillRect(this.get_opacity(),this.get_color(),p1.x,p1.y,p2.x,p2.y,p3.x,p3.y,p4.x,p4.y);var _this8=this.get_transformation();var value8=new kha_math_FastVector2(x-strength/2,y+height+strength/2);var w8=_this8._02*value8.x+_this8._12*value8.y+_this8._22;var x9=(_this8._00*value8.x+_this8._10*value8.y+_this8._20)/w8;var y9=(_this8._01*value8.x+_this8._11*value8.y+_this8._21)/w8;p1=new kha_math_FastVector2(x9,y9);var _this9=this.get_transformation();var value9=new kha_math_FastVector2(x-strength/2,y+height-strength/2);var w9=_this9._02*value9.x+_this9._12*value9.y+_this9._22;var x10=(_this9._00*value9.x+_this9._10*value9.y+_this9._20)/w9;var y10=(_this9._01*value9.x+_this9._11*value9.y+_this9._21)/w9;p2=new kha_math_FastVector2(x10,y10);var _this10=this.get_transformation();var value10=new kha_math_FastVector2(x+width+strength/2,y+height-strength/2);var w10=_this10._02*value10.x+_this10._12*value10.y+_this10._22;var x11=(_this10._00*value10.x+_this10._10*value10.y+_this10._20)/w10;var y11=(_this10._01*value10.x+_this10._11*value10.y+_this10._21)/w10;p3=new kha_math_FastVector2(x11,y11);var _this11=this.get_transformation();var value11=new kha_math_FastVector2(x+width+strength/2,y+height+strength/2);var w11=_this11._02*value11.x+_this11._12*value11.y+_this11._22;var x12=(_this11._00*value11.x+_this11._10*value11.y+_this11._20)/w11;var y12=(_this11._01*value11.x+_this11._11*value11.y+_this11._21)/w11;p4=new kha_math_FastVector2(x12,y12);this.coloredPainter.fillRect(this.get_opacity(),this.get_color(),p1.x,p1.y,p2.x,p2.y,p3.x,p3.y,p4.x,p4.y);var _this12=this.get_transformation();var value12=new kha_math_FastVector2(x+width-strength/2,y+height-strength/2);var w12=_this12._02*value12.x+_this12._12*value12.y+_this12._22;var x13=(_this12._00*value12.x+_this12._10*value12.y+_this12._20)/w12;var y13=(_this12._01*value12.x+_this12._11*value12.y+_this12._21)/w12;p1=new kha_math_FastVector2(x13,y13);var _this13=this.get_transformation();var value13=new kha_math_FastVector2(x+width-strength/2,y+strength/2);var w13=_this13._02*value13.x+_this13._12*value13.y+_this13._22;var x14=(_this13._00*value13.x+_this13._10*value13.y+_this13._20)/w13;var y14=(_this13._01*value13.x+_this13._11*value13.y+_this13._21)/w13;p2=new kha_math_FastVector2(x14,y14);var _this14=this.get_transformation();var value14=new kha_math_FastVector2(x+width+strength/2,y+strength/2);var w14=_this14._02*value14.x+_this14._12*value14.y+_this14._22;var x15=(_this14._00*value14.x+_this14._10*value14.y+_this14._20)/w14;var y15=(_this14._01*value14.x+_this14._11*value14.y+_this14._21)/w14;p3=new kha_math_FastVector2(x15,y15);var _this15=this.get_transformation();var value15=new kha_math_FastVector2(x+width+strength/2,y+height-strength/2);var w15=_this15._02*value15.x+_this15._12*value15.y+_this15._22;var x16=(_this15._00*value15.x+_this15._10*value15.y+_this15._20)/w15;var y16=(_this15._01*value15.x+_this15._11*value15.y+_this15._21)/w15;p4=new kha_math_FastVector2(x16,y16);this.coloredPainter.fillRect(this.get_opacity(),this.get_color(),p1.x,p1.y,p2.x,p2.y,p3.x,p3.y,p4.x,p4.y)},fillRect:function(x,y,width,height){this.imagePainter.end();this.textPainter.end();var _this=this.get_transformation();var value=new kha_math_FastVector2(x,y+height);var w=_this._02*value.x+_this._12*value.y+_this._22;var x1=(_this._00*value.x+_this._10*value.y+_this._20)/w;var y1=(_this._01*value.x+_this._11*value.y+_this._21)/w;var p1=new kha_math_FastVector2(x1,y1);var _this1=this.get_transformation();var value1=new kha_math_FastVector2(x,y);var w1=_this1._02*value1.x+_this1._12*value1.y+_this1._22;var x2=(_this1._00*value1.x+_this1._10*value1.y+_this1._20)/w1;var y2=(_this1._01*value1.x+_this1._11*value1.y+_this1._21)/w1;var p2=new kha_math_FastVector2(x2,y2);var _this2=this.get_transformation();var value2=new kha_math_FastVector2(x+width,y);var w2=_this2._02*value2.x+_this2._12*value2.y+_this2._22;var x3=(_this2._00*value2.x+_this2._10*value2.y+_this2._20)/w2;var y3=(_this2._01*value2.x+_this2._11*value2.y+_this2._21)/w2;var p3=new kha_math_FastVector2(x3,y3);var _this3=this.get_transformation();var value3=new kha_math_FastVector2(x+width,y+height);var w3=_this3._02*value3.x+_this3._12*value3.y+_this3._22;var x4=(_this3._00*value3.x+_this3._10*value3.y+_this3._20)/w3;var y4=(_this3._01*value3.x+_this3._11*value3.y+_this3._21)/w3;var p4=new kha_math_FastVector2(x4,y4);this.coloredPainter.fillRect(this.get_opacity(),this.get_color(),p1.x,p1.y,p2.x,p2.y,p3.x,p3.y,p4.x,p4.y)},drawString:function(text,x,y){this.imagePainter.end();this.coloredPainter.end();this.textPainter.drawString(text,this.get_opacity(),this.get_color(),x,y,this.get_transformation())},get_font:function(){return this.myFont},set_font:function(font){this.textPainter.setFont(font);return this.myFont=font},set_fontSize:function(value){return kha_graphics2_Graphics.prototype.set_fontSize.call(this,this.textPainter.fontSize=value)},drawLine:function(x1,y1,x2,y2,strength){if(strength==null){strength=1}this.imagePainter.end();this.textPainter.end();var vec;if(y2==y1){vec=new kha_math_FastVector2(0,-1)}else{vec=new kha_math_FastVector2(1,-(x2-x1)/(y2-y1))}vec.set_length(strength);var p1=new kha_math_FastVector2(x1+.5*vec.x,y1+.5*vec.y);var p2=new kha_math_FastVector2(x2+.5*vec.x,y2+.5*vec.y);var p3=new kha_math_FastVector2(p1.x-vec.x,p1.y-vec.y);var p4=new kha_math_FastVector2(p2.x-vec.x,p2.y-vec.y);var _this=this.get_transformation();var w=_this._02*p1.x+_this._12*p1.y+_this._22;var x=(_this._00*p1.x+_this._10*p1.y+_this._20)/w;var y=(_this._01*p1.x+_this._11*p1.y+_this._21)/w;p1=new kha_math_FastVector2(x,y);var _this1=this.get_transformation();var w1=_this1._02*p2.x+_this1._12*p2.y+_this1._22;var x3=(_this1._00*p2.x+_this1._10*p2.y+_this1._20)/w1;var y3=(_this1._01*p2.x+_this1._11*p2.y+_this1._21)/w1;p2=new kha_math_FastVector2(x3,y3);var _this2=this.get_transformation();var w2=_this2._02*p3.x+_this2._12*p3.y+_this2._22;var x4=(_this2._00*p3.x+_this2._10*p3.y+_this2._20)/w2;var y4=(_this2._01*p3.x+_this2._11*p3.y+_this2._21)/w2;p3=new kha_math_FastVector2(x4,y4);var _this3=this.get_transformation();var w3=_this3._02*p4.x+_this3._12*p4.y+_this3._22;var x5=(_this3._00*p4.x+_this3._10*p4.y+_this3._20)/w3;var y5=(_this3._01*p4.x+_this3._11*p4.y+_this3._21)/w3;p4=new kha_math_FastVector2(x5,y5);this.coloredPainter.fillTriangle(this.get_opacity(),this.get_color(),p1.x,p1.y,p2.x,p2.y,p3.x,p3.y);this.coloredPainter.fillTriangle(this.get_opacity(),this.get_color(),p3.x,p3.y,p2.x,p2.y,p4.x,p4.y)},fillTriangle:function(x1,y1,x2,y2,x3,y3){this.imagePainter.end();this.textPainter.end();var _this=this.get_transformation();var value=new kha_math_FastVector2(x1,y1);var w=_this._02*value.x+_this._12*value.y+_this._22;var x=(_this._00*value.x+_this._10*value.y+_this._20)/w;var y=(_this._01*value.x+_this._11*value.y+_this._21)/w;var p1=new kha_math_FastVector2(x,y);var _this1=this.get_transformation();var value1=new kha_math_FastVector2(x2,y2);var w1=_this1._02*value1.x+_this1._12*value1.y+_this1._22;var x4=(_this1._00*value1.x+_this1._10*value1.y+_this1._20)/w1;var y4=(_this1._01*value1.x+_this1._11*value1.y+_this1._21)/w1;var p2=new kha_math_FastVector2(x4,y4);var _this2=this.get_transformation();var value2=new kha_math_FastVector2(x3,y3);var w2=_this2._02*value2.x+_this2._12*value2.y+_this2._22;var x5=(_this2._00*value2.x+_this2._10*value2.y+_this2._20)/w2;var y5=(_this2._01*value2.x+_this2._11*value2.y+_this2._21)/w2;var p3=new kha_math_FastVector2(x5,y5);this.coloredPainter.fillTriangle(this.get_opacity(),this.get_color(),p1.x,p1.y,p2.x,p2.y,p3.x,p3.y)},set_imageScaleQuality:function(value){this.imagePainter.setBilinearFilter(value==kha_graphics2_ImageScaleQuality.High);this.textPainter.setBilinearFilter(value==kha_graphics2_ImageScaleQuality.High);return this.myImageScaleQuality=value},begin:function(clear,clearColor){if(clear==null){clear=true}this.g.begin();if(clear){this.clear(clearColor)}this.setProjection()},clear:function(color){this.flush();this.g.clear(color==null?-16777216:color)},flush:function(){this.imagePainter.end();this.textPainter.end();this.coloredPainter.end()},end:function(){this.flush();this.g.end()},__class__:kha_graphics4_Graphics2});var kha_graphics4_IndexBuffer=function(indexCount,usage,canRead){if(canRead==null){canRead=false}this.usage=usage;this.mySize=indexCount;this.buffer=kha_SystemImpl.gl.createBuffer();var this1=new Uint32Array(indexCount);this._data=this1};$hxClasses["kha.graphics4.IndexBuffer"]=kha_graphics4_IndexBuffer;kha_graphics4_IndexBuffer.__name__=true;kha_graphics4_IndexBuffer.prototype={lock:function(start,count){if(start==null){start=0}if(count==null){count=this.mySize}return this._data.subarray(start,start+count)},unlock:function(){kha_SystemImpl.gl.bindBuffer(34963,this.buffer);var glData=kha_SystemImpl.elementIndexUint==null?new Uint16Array(this._data):this._data;kha_SystemImpl.gl.bufferData(34963,glData,this.usage==1?35048:35044)},set:function(){kha_SystemImpl.gl.bindBuffer(34963,this.buffer)},count:function(){return this.mySize},__class__:kha_graphics4_IndexBuffer};var kha_graphics4_PipelineStateBase=function(){this.inputLayout=null;this.vertexShader=null;this.fragmentShader=null;this.geometryShader=null;this.tessellationControlShader=null;this.tessellationEvaluationShader=null;this.cullMode=2;this.depthWrite=false;this.depthMode=0;this.stencilMode=0;this.stencilBothPass=0;this.stencilDepthFail=0;this.stencilFail=0;this.stencilReferenceValue=kha_graphics4_StencilValue.Static(0);this.stencilReadMask=255;this.stencilWriteMask=255;this.blendSource=1;this.blendDestination=2;this.blendOperation=0;this.alphaBlendSource=1;this.alphaBlendDestination=2;this.alphaBlendOperation=0;this.colorWriteMasksRed=[];this.colorWriteMasksGreen=[];this.colorWriteMasksBlue=[];this.colorWriteMasksAlpha=[];this.colorWriteMasksRed.push(true);this.colorWriteMasksRed.push(true);this.colorWriteMasksRed.push(true);this.colorWriteMasksRed.push(true);this.colorWriteMasksRed.push(true);this.colorWriteMasksRed.push(true);this.colorWriteMasksRed.push(true);this.colorWriteMasksRed.push(true);this.colorWriteMasksGreen.push(true);this.colorWriteMasksGreen.push(true);this.colorWriteMasksGreen.push(true);this.colorWriteMasksGreen.push(true);this.colorWriteMasksGreen.push(true);this.colorWriteMasksGreen.push(true);this.colorWriteMasksGreen.push(true);this.colorWriteMasksGreen.push(true);this.colorWriteMasksBlue.push(true);this.colorWriteMasksBlue.push(true);this.colorWriteMasksBlue.push(true);this.colorWriteMasksBlue.push(true);this.colorWriteMasksBlue.push(true);this.colorWriteMasksBlue.push(true);this.colorWriteMasksBlue.push(true);this.colorWriteMasksBlue.push(true);this.colorWriteMasksAlpha.push(true);this.colorWriteMasksAlpha.push(true);this.colorWriteMasksAlpha.push(true);this.colorWriteMasksAlpha.push(true);this.colorWriteMasksAlpha.push(true);this.colorWriteMasksAlpha.push(true);this.colorWriteMasksAlpha.push(true);this.colorWriteMasksAlpha.push(true);this.conservativeRasterization=false};$hxClasses["kha.graphics4.PipelineStateBase"]=kha_graphics4_PipelineStateBase;kha_graphics4_PipelineStateBase.__name__=true;kha_graphics4_PipelineStateBase.prototype={get_colorWriteMaskRed:function(){return this.colorWriteMasksRed[0]},set_colorWriteMaskRed:function(value){return this.colorWriteMasksRed[0]=value},get_colorWriteMaskGreen:function(){return this.colorWriteMasksGreen[0]},set_colorWriteMaskGreen:function(value){return this.colorWriteMasksGreen[0]=value},get_colorWriteMaskBlue:function(){return this.colorWriteMasksBlue[0]},set_colorWriteMaskBlue:function(value){return this.colorWriteMasksBlue[0]=value},get_colorWriteMaskAlpha:function(){return this.colorWriteMasksAlpha[0]},set_colorWriteMaskAlpha:function(value){return this.colorWriteMasksAlpha[0]=value},__class__:kha_graphics4_PipelineStateBase,__properties__:{set_colorWriteMaskAlpha:"set_colorWriteMaskAlpha",get_colorWriteMaskAlpha:"get_colorWriteMaskAlpha",set_colorWriteMaskBlue:"set_colorWriteMaskBlue",get_colorWriteMaskBlue:"get_colorWriteMaskBlue",set_colorWriteMaskGreen:"set_colorWriteMaskGreen",get_colorWriteMaskGreen:"get_colorWriteMaskGreen",set_colorWriteMaskRed:"set_colorWriteMaskRed",get_colorWriteMaskRed:"get_colorWriteMaskRed"}};var kha_graphics4_PipelineState=function(){this.program=null;kha_graphics4_PipelineStateBase.call(this);this.textures=[];this.textureValues=[]};$hxClasses["kha.graphics4.PipelineState"]=kha_graphics4_PipelineState;kha_graphics4_PipelineState.__name__=true;kha_graphics4_PipelineState.__super__=kha_graphics4_PipelineStateBase;kha_graphics4_PipelineState.prototype=$extend(kha_graphics4_PipelineStateBase.prototype,{delete:function(){if(this.program!=null){kha_SystemImpl.gl.deleteProgram(this.program)}},compile:function(){if(this.program!=null){kha_SystemImpl.gl.deleteProgram(this.program)}this.program=kha_SystemImpl.gl.createProgram();this.compileShader(this.vertexShader);this.compileShader(this.fragmentShader);kha_SystemImpl.gl.attachShader(this.program,this.vertexShader.shader);kha_SystemImpl.gl.attachShader(this.program,this.fragmentShader.shader);var index=0;var _g=0;var _g1=this.inputLayout;while(_g<_g1.length){var structure=_g1[_g];++_g;var _g2=0;var _g11=structure.elements;while(_g2<_g11.length){var element=_g11[_g2];++_g2;kha_SystemImpl.gl.bindAttribLocation(this.program,index,element.name);if(element.data==4){index+=4}else{++index}}}kha_SystemImpl.gl.linkProgram(this.program);if(!kha_SystemImpl.gl.getProgramParameter(this.program,35714)){throw new js__$Boot_HaxeError("Could not link the shader program:\n"+kha_SystemImpl.gl.getProgramInfoLog(this.program))}},set:function(){kha_SystemImpl.gl.useProgram(this.program);var _g=0;var _g1=this.textureValues.length;while(_g<_g1){var index=_g++;kha_SystemImpl.gl.uniform1i(this.textureValues[index],index)}kha_SystemImpl.gl.colorMask(this.get_colorWriteMaskRed(),this.get_colorWriteMaskGreen(),this.get_colorWriteMaskBlue(),this.get_colorWriteMaskAlpha())},compileShader:function(shader){if(shader.shader!=null){return}var s=kha_SystemImpl.gl.createShader(shader.type);var highp=kha_SystemImpl.gl.getShaderPrecisionFormat(35632,36338);var highpSupported=highp.precision!=0;var files=shader.files;var _g=0;var _g1=files.length;while(_g<_g1){var i=_g++;if(kha_SystemImpl.gl2){if(files[i].indexOf("-webgl2")>=0||files[i].indexOf("runtime-string")>=0){kha_SystemImpl.gl.shaderSource(s,shader.sources[i]);break}}else{if(!highpSupported&&(files[i].indexOf("-relaxed")>=0||files[i].indexOf("runtime-string")>=0)){kha_SystemImpl.gl.shaderSource(s,shader.sources[i]);break}if(highpSupported&&(files[i].indexOf("-relaxed")<0||files[i].indexOf("runtime-string")>=0)){kha_SystemImpl.gl.shaderSource(s,shader.sources[i]);break}}}kha_SystemImpl.gl.compileShader(s);if(!kha_SystemImpl.gl.getShaderParameter(s,35713)){throw new js__$Boot_HaxeError("Could not compile shader:\n"+kha_SystemImpl.gl.getShaderInfoLog(s))}shader.shader=s},getConstantLocation:function(name){var location=kha_SystemImpl.gl.getUniformLocation(this.program,name);if(location==null){haxe_Log.trace("Warning: Uniform "+name+" not found.",{fileName:"kha/graphics4/PipelineState.hx",lineNumber:92,className:"kha.graphics4.PipelineState",methodName:"getConstantLocation"})}var type=5126;var count=kha_SystemImpl.gl.getProgramParameter(this.program,35718);var _g=0;var _g1=count;while(_g<_g1){var i=_g++;var info=kha_SystemImpl.gl.getActiveUniform(this.program,i);if(info.name==name||info.name==name+"[0]"){type=info.type;break}}return new kha_js_graphics4_ConstantLocation(location,type)},getTextureUnit:function(name){var index=this.findTexture(name);if(index<0){var location=kha_SystemImpl.gl.getUniformLocation(this.program,name);if(location==null){haxe_Log.trace("Warning: Sampler "+name+" not found.",{fileName:"kha/graphics4/PipelineState.hx",lineNumber:111,className:"kha.graphics4.PipelineState",methodName:"getTextureUnit"})}index=this.textures.length;this.textureValues.push(location);this.textures.push(name)}return new kha_js_graphics4_TextureUnit(index)},findTexture:function(name){var _g=0;var _g1=this.textures.length;while(_g<_g1){var index=_g++;if(this.textures[index]==name){return index}}return-1},__class__:kha_graphics4_PipelineState});var kha_graphics4_StencilValue=$hxEnums["kha.graphics4.StencilValue"]={__ename__:true,__constructs__:["Dynamic","Static"],Dynamic:{_hx_index:0,__enum__:"kha.graphics4.StencilValue",toString:$estr},Static:($_=function(value){return{_hx_index:1,value:value,__enum__:"kha.graphics4.StencilValue",toString:$estr}},$_.__params__=["value"],$_)};var kha_graphics4_TessellationControlShader=function(){};$hxClasses["kha.graphics4.TessellationControlShader"]=kha_graphics4_TessellationControlShader;kha_graphics4_TessellationControlShader.__name__=true;var kha_graphics4_TessellationEvaluationShader=function(){};$hxClasses["kha.graphics4.TessellationEvaluationShader"]=kha_graphics4_TessellationEvaluationShader;kha_graphics4_TessellationEvaluationShader.__name__=true;var kha_graphics4_TextureUnit=function(){};$hxClasses["kha.graphics4.TextureUnit"]=kha_graphics4_TextureUnit;kha_graphics4_TextureUnit.__name__=true;var kha_graphics4_VertexBuffer=function(vertexCount,structure,usage,instanceDataStepRate,canRead){if(canRead==null){canRead=false}if(instanceDataStepRate==null){instanceDataStepRate=0}this.usage=usage;this.instanceDataStepRate=instanceDataStepRate;this.mySize=vertexCount;this.myStride=0;var _g=0;var _g1=structure.elements;while(_g<_g1.length){var element=_g1[_g];++_g;switch(element.data){case 0:this.myStride+=4;break;case 1:this.myStride+=8;break;case 2:this.myStride+=12;break;case 3:this.myStride+=16;break;case 4:this.myStride+=64;break;case 5:this.myStride+=4;break;case 6:this.myStride+=8;break}}this.buffer=kha_SystemImpl.gl.createBuffer();var this1=new Float32Array(Std.int(vertexCount*this.myStride/4));this._data=this1;this.sizes=[];this.offsets=[];this.types=[];this.sizes[structure.elements.length-1]=0;this.offsets[structure.elements.length-1]=0;this.types[structure.elements.length-1]=0;var offset=0;var index=0;var _g2=0;var _g3=structure.elements;while(_g2<_g3.length){var element1=_g3[_g2];++_g2;var size;var type;switch(element1.data){case 0:size=1;type=5126;break;case 1:size=2;type=5126;break;case 2:size=3;type=5126;break;case 3:size=4;type=5126;break;case 4:size=16;type=5126;break;case 5:size=2;type=5122;break;case 6:size=4;type=5122;break}this.sizes[index]=size;this.offsets[index]=offset;this.types[index]=type;switch(element1.data){case 0:offset+=4;break;case 1:offset+=8;break;case 2:offset+=12;break;case 3:offset+=16;break;case 4:offset+=64;break;case 5:offset+=4;break;case 6:offset+=8;break}++index}};$hxClasses["kha.graphics4.VertexBuffer"]=kha_graphics4_VertexBuffer;kha_graphics4_VertexBuffer.__name__=true;kha_graphics4_VertexBuffer.prototype={lock:function(start,count){if(start==null){start=0}if(count==null){count=this.mySize}return this._data.subarray(start*this.stride(),(start+count)*this.stride())},lockInt16:function(start,count){var this1=new Int16Array(this.lock(start,count).buffer);return this1},unlock:function(){kha_SystemImpl.gl.bindBuffer(34962,this.buffer);kha_SystemImpl.gl.bufferData(34962,this._data,this.usage==1?35048:35044)},stride:function(){return this.myStride},set:function(offset){var ext=kha_SystemImpl.gl2?true:kha_SystemImpl.gl.getExtension("ANGLE_instanced_arrays");kha_SystemImpl.gl.bindBuffer(34962,this.buffer);var attributesOffset=0;var _g=0;var _g1=this.sizes.length;while(_g<_g1){var i=_g++;if(this.sizes[i]>4){var size=this.sizes[i];var addonOffset=0;while(size>0){kha_SystemImpl.gl.enableVertexAttribArray(offset+attributesOffset);kha_SystemImpl.gl.vertexAttribPointer(offset+attributesOffset,4,5126,false,this.myStride,this.offsets[i]+addonOffset);if(ext){if(kha_SystemImpl.gl2){kha_SystemImpl.gl.vertexAttribDivisor(offset+attributesOffset,this.instanceDataStepRate)}else{ext.vertexAttribDivisorANGLE(offset+attributesOffset,this.instanceDataStepRate)}}size-=4;addonOffset+=16;++attributesOffset}}else{var normalized=this.types[i]==5126?false:true;kha_SystemImpl.gl.enableVertexAttribArray(offset+attributesOffset);kha_SystemImpl.gl.vertexAttribPointer(offset+attributesOffset,this.sizes[i],this.types[i],normalized,this.myStride,this.offsets[i]);if(ext){if(kha_SystemImpl.gl2){kha_SystemImpl.gl.vertexAttribDivisor(offset+attributesOffset,this.instanceDataStepRate)}else{ext.vertexAttribDivisorANGLE(offset+attributesOffset,this.instanceDataStepRate)}}++attributesOffset}}return attributesOffset},__class__:kha_graphics4_VertexBuffer};var kha_graphics4_VertexElement=function(name,data){this.name=name;this.data=data};$hxClasses["kha.graphics4.VertexElement"]=kha_graphics4_VertexElement;kha_graphics4_VertexElement.__name__=true;kha_graphics4_VertexElement.prototype={__class__:kha_graphics4_VertexElement};var kha_graphics4_VertexShader=function(sources,files){this.sources=[];var _g=0;while(_g<sources.length){var source=sources[_g];++_g;this.sources.push(source.toString())}this.type=35633;this.shader=null;this.files=files};$hxClasses["kha.graphics4.VertexShader"]=kha_graphics4_VertexShader;kha_graphics4_VertexShader.__name__=true;kha_graphics4_VertexShader.fromSource=function(source){var shader=new kha_graphics4_VertexShader([],["runtime-string"]);shader.sources.push(source);return shader};kha_graphics4_VertexShader.prototype={__class__:kha_graphics4_VertexShader};var kha_graphics4_VertexStructure=function(){this.elements=[];this.instanced=false};$hxClasses["kha.graphics4.VertexStructure"]=kha_graphics4_VertexStructure;kha_graphics4_VertexStructure.__name__=true;kha_graphics4_VertexStructure.prototype={add:function(name,data){this.elements.push(new kha_graphics4_VertexElement(name,data))},size:function(){return this.elements.length},byteSize:function(){var byteSize=0;var _g=0;var _g1=this.elements.length;while(_g<_g1){var i=_g++;byteSize+=this.dataByteSize(this.elements[i].data)}return byteSize},dataByteSize:function(data){switch(data){case 0:return 4;case 1:return 8;case 2:return 12;case 3:return 16;case 4:return 64;case 5:return 4;case 6:return 8}},get:function(index){return this.elements[index]},__class__:kha_graphics4_VertexStructure};var kha_graphics5_Graphics=function(){};$hxClasses["kha.graphics5.Graphics"]=kha_graphics5_Graphics;kha_graphics5_Graphics.__name__=true;var kha_input_Gamepad=$hx_exports["kha"]["input"]["Gamepad"]=function(index,id){if(id==null){id="unknown"}if(index==null){index=0}this.index=index;this.axisListeners=[];this.buttonListeners=[];kha_input_Gamepad.instances[index]=this};$hxClasses["kha.input.Gamepad"]=kha_input_Gamepad;kha_input_Gamepad.__name__=true;kha_input_Gamepad.get=function(index){if(index==null){index=0}if(index>=kha_input_Gamepad.instances.length){return null}return kha_input_Gamepad.instances[index]};kha_input_Gamepad.sendConnectEvent=function(index){kha_input_Gamepad.instances[index].connected=true;var _g=0;var _g1=kha_input_Gamepad.connectListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener(index)}};kha_input_Gamepad.sendDisconnectEvent=function(index){kha_input_Gamepad.instances[index].connected=false;var _g=0;var _g1=kha_input_Gamepad.disconnectListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener(index)}};kha_input_Gamepad.prototype={notify:function(axisListener,buttonListener){if(axisListener!=null){this.axisListeners.push(axisListener)}if(buttonListener!=null){this.buttonListeners.push(buttonListener)}},sendAxisEvent:function(axis,value){var _g=0;var _g1=this.axisListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener(axis,value)}},sendButtonEvent:function(button,value){var _g=0;var _g1=this.buttonListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener(button,value)}},__class__:kha_input_Gamepad};var kha_netsync_Controller=function(){this.__id=kha_netsync_ControllerBuilder.nextId++;this._inputBuffer=haxe_io_Bytes.alloc(1)};$hxClasses["kha.netsync.Controller"]=kha_netsync_Controller;kha_netsync_Controller.__name__=true;kha_netsync_Controller.prototype={_id:function(){return this.__id},__class__:kha_netsync_Controller};var kha_input_Keyboard=$hx_exports["kha"]["input"]["Keyboard"]=function(){kha_netsync_Controller.call(this);this.downListeners=[];this.upListeners=[];this.pressListeners=[];kha_input_Keyboard.instance=this};$hxClasses["kha.input.Keyboard"]=kha_input_Keyboard;kha_input_Keyboard.__name__=true;kha_input_Keyboard.get=function(num){if(num==null){num=0}return kha_SystemImpl.getKeyboard(num)};kha_input_Keyboard.__super__=kha_netsync_Controller;kha_input_Keyboard.prototype=$extend(kha_netsync_Controller.prototype,{notify:function(downListener,upListener,pressListener){if(downListener!=null){this.downListeners.push(downListener)}if(upListener!=null){this.upListeners.push(upListener)}if(pressListener!=null){this.pressListeners.push(pressListener)}},show:function(){},hide:function(){},sendDownEvent:function(code){if(kha_netsync_Session.the()!=null){var bytes=haxe_io_Bytes.alloc(5);bytes.setInt32(0,0);bytes.set(4,code);kha_netsync_Session.the().sendControllerUpdate(this._id(),bytes)}var _g=0;var _g1=this.downListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener(code)}},sendUpEvent:function(code){if(kha_netsync_Session.the()!=null){var bytes=haxe_io_Bytes.alloc(5);bytes.setInt32(0,1);bytes.set(4,code);kha_netsync_Session.the().sendControllerUpdate(this._id(),bytes)}var _g=0;var _g1=this.upListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener(code)}},sendPressEvent:function(char){if(kha_netsync_Session.the()!=null){var bytes=haxe_io_Bytes.alloc(5);bytes.setInt32(0,2);bytes.set(4,HxOverrides.cca(char,0));kha_netsync_Session.the().sendControllerUpdate(this._id(),bytes)}var _g=0;var _g1=this.pressListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener(char)}},__class__:kha_input_Keyboard});var kha_input_Mouse=$hx_exports["kha"]["input"]["Mouse"]=function(){kha_netsync_Controller.call(this);kha_input_Mouse.instance=this};$hxClasses["kha.input.Mouse"]=kha_input_Mouse;kha_input_Mouse.__name__=true;kha_input_Mouse.get=function(num){if(num==null){num=0}return kha_SystemImpl.getMouse(num)};kha_input_Mouse.__super__=kha_netsync_Controller;kha_input_Mouse.prototype=$extend(kha_netsync_Controller.prototype,{notify:function(downListener,upListener,moveListener,wheelListener,leaveListener){this.notifyWindowed(0,downListener,upListener,moveListener,wheelListener,leaveListener)},notifyWindowed:function(windowId,downListener,upListener,moveListener,wheelListener,leaveListener){if(downListener!=null){if(this.windowDownListeners==null){this.windowDownListeners=[]}while(this.windowDownListeners.length<=windowId)this.windowDownListeners.push([]);this.windowDownListeners[windowId].push(downListener)}if(upListener!=null){if(this.windowUpListeners==null){this.windowUpListeners=[]}while(this.windowUpListeners.length<=windowId)this.windowUpListeners.push([]);this.windowUpListeners[windowId].push(upListener)}if(moveListener!=null){if(this.windowMoveListeners==null){this.windowMoveListeners=[]}while(this.windowMoveListeners.length<=windowId)this.windowMoveListeners.push([]);this.windowMoveListeners[windowId].push(moveListener)}if(wheelListener!=null){if(this.windowWheelListeners==null){this.windowWheelListeners=[]}while(this.windowWheelListeners.length<=windowId)this.windowWheelListeners.push([]);this.windowWheelListeners[windowId].push(wheelListener)}if(leaveListener!=null){if(this.windowLeaveListeners==null){this.windowLeaveListeners=[]}while(this.windowLeaveListeners.length<=windowId)this.windowLeaveListeners.push([]);this.windowLeaveListeners[windowId].push(leaveListener)}},sendLeaveEvent:function(windowId){if(kha_netsync_Session.the()!=null){var bytes=haxe_io_Bytes.alloc(8);bytes.setInt32(0,0);bytes.setInt32(4,windowId);kha_netsync_Session.the().sendControllerUpdate(this._id(),bytes)}if(this.windowLeaveListeners!=null){var _g=0;var _g1=this.windowLeaveListeners[windowId];while(_g<_g1.length){var listener=_g1[_g];++_g;listener()}}},sendDownEvent:function(windowId,button,x,y){if(kha_netsync_Session.the()!=null){var bytes=haxe_io_Bytes.alloc(20);bytes.setInt32(0,1);bytes.setInt32(4,windowId);bytes.setInt32(8,button);bytes.setInt32(12,x);bytes.setInt32(16,y);kha_netsync_Session.the().sendControllerUpdate(this._id(),bytes)}if(this.windowDownListeners!=null){var _g=0;var _g1=this.windowDownListeners[windowId];while(_g<_g1.length){var listener=_g1[_g];++_g;listener(button,x,y)}}},sendUpEvent:function(windowId,button,x,y){if(kha_netsync_Session.the()!=null){var bytes=haxe_io_Bytes.alloc(20);bytes.setInt32(0,2);bytes.setInt32(4,windowId);bytes.setInt32(8,button);bytes.setInt32(12,x);bytes.setInt32(16,y);kha_netsync_Session.the().sendControllerUpdate(this._id(),bytes)}if(this.windowUpListeners!=null){var _g=0;var _g1=this.windowUpListeners[windowId];while(_g<_g1.length){var listener=_g1[_g];++_g;listener(button,x,y)}}},sendMoveEvent:function(windowId,x,y,movementX,movementY){if(kha_netsync_Session.the()!=null){var bytes=haxe_io_Bytes.alloc(24);bytes.setInt32(0,3);bytes.setInt32(4,windowId);bytes.setInt32(8,x);bytes.setInt32(12,y);bytes.setInt32(16,movementX);bytes.setInt32(20,movementY);kha_netsync_Session.the().sendControllerUpdate(this._id(),bytes)}if(this.windowMoveListeners!=null){var _g=0;var _g1=this.windowMoveListeners[windowId];while(_g<_g1.length){var listener=_g1[_g];++_g;listener(x,y,movementX,movementY)}}},sendWheelEvent:function(windowId,delta){if(kha_netsync_Session.the()!=null){var bytes=haxe_io_Bytes.alloc(12);bytes.setInt32(0,4);bytes.setInt32(4,windowId);bytes.setInt32(8,delta);kha_netsync_Session.the().sendControllerUpdate(this._id(),bytes)}if(this.windowWheelListeners!=null){var _g=0;var _g1=this.windowWheelListeners[windowId];while(_g<_g1.length){var listener=_g1[_g];++_g;listener(delta)}}},__class__:kha_input_Mouse});var kha_input_MouseImpl=function(){kha_input_Mouse.call(this)};$hxClasses["kha.input.MouseImpl"]=kha_input_MouseImpl;kha_input_MouseImpl.__name__=true;kha_input_MouseImpl.__super__=kha_input_Mouse;kha_input_MouseImpl.prototype=$extend(kha_input_Mouse.prototype,{__class__:kha_input_MouseImpl});var kha_input_Pen=function(){kha_input_Pen.instance=this};$hxClasses["kha.input.Pen"]=kha_input_Pen;kha_input_Pen.__name__=true;kha_input_Pen.get=function(num){if(num==null){num=0}return kha_SystemImpl.getPen(num)};kha_input_Pen.prototype={notify:function(downListener,upListener,moveListener){this.notifyWindowed(0,downListener,upListener,moveListener)},notifyWindowed:function(windowId,downListener,upListener,moveListener){if(downListener!=null){if(this.windowDownListeners==null){this.windowDownListeners=[]}while(this.windowDownListeners.length<=windowId)this.windowDownListeners.push([]);this.windowDownListeners[windowId].push(downListener)}if(upListener!=null){if(this.windowUpListeners==null){this.windowUpListeners=[]}while(this.windowUpListeners.length<=windowId)this.windowUpListeners.push([]);this.windowUpListeners[windowId].push(upListener)}if(moveListener!=null){if(this.windowMoveListeners==null){this.windowMoveListeners=[]}while(this.windowMoveListeners.length<=windowId)this.windowMoveListeners.push([]);this.windowMoveListeners[windowId].push(moveListener)}},__class__:kha_input_Pen};var kha_input_Surface=$hx_exports["kha"]["input"]["Surface"]=function(){this.touchStartListeners=[];this.touchEndListeners=[];this.moveListeners=[];kha_input_Surface.instance=this};$hxClasses["kha.input.Surface"]=kha_input_Surface;kha_input_Surface.__name__=true;kha_input_Surface.prototype={sendTouchStartEvent:function(index,x,y){var _g=0;var _g1=this.touchStartListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener(index,x,y)}},sendTouchEndEvent:function(index,x,y){var _g=0;var _g1=this.touchEndListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener(index,x,y)}},sendMoveEvent:function(index,x,y){var _g=0;var _g1=this.moveListeners;while(_g<_g1.length){var listener=_g1[_g];++_g;listener(index,x,y)}},__class__:kha_input_Surface};var kha_internal_BytesBlob=function(bytes){this.bytes=bytes};$hxClasses["kha.internal.BytesBlob"]=kha_internal_BytesBlob;kha_internal_BytesBlob.__name__=true;kha_internal_BytesBlob.__interfaces__=[kha_Resource];kha_internal_BytesBlob.fromBytes=function(bytes){return new kha_internal_BytesBlob(bytes)};kha_internal_BytesBlob.alloc=function(size){return new kha_internal_BytesBlob(haxe_io_Bytes.alloc(size))};kha_internal_BytesBlob.prototype={sub:function(start,length){return new kha_internal_BytesBlob(this.bytes.sub(start,length))},get_length:function(){return this.bytes.length},writeU8:function(position,value){this.bytes.set(position,value)},readU8:function(position){var byte=this.bytes.get(position);++position;return byte},toString:function(){return this.bytes.toString()},toBytes:function(){return this.bytes},__class__:kha_internal_BytesBlob,__properties__:{get_length:"get_length"}};var kha_internal_HdrFormat=function(){};$hxClasses["kha.internal.HdrFormat"]=kha_internal_HdrFormat;kha_internal_HdrFormat.__name__=true;kha_internal_HdrFormat.readBuf=function(buf){var bytesRead=0;while(true){buf[bytesRead++]=kha_internal_HdrFormat.buffer[kha_internal_HdrFormat.fileOffset]&255;if(!(++kha_internal_HdrFormat.fileOffset<kha_internal_HdrFormat.bufferLength&&bytesRead<buf.length)){break}}return bytesRead};kha_internal_HdrFormat.readBufOffset=function(buf,offset,length){var bytesRead=0;while(true){buf[offset+bytesRead++]=kha_internal_HdrFormat.buffer[kha_internal_HdrFormat.fileOffset]&255;if(!(++kha_internal_HdrFormat.fileOffset<kha_internal_HdrFormat.bufferLength&&bytesRead<length)){break}}return bytesRead};kha_internal_HdrFormat.readPixelsRaw=function(buffer,data,offset,numpixels){var numExpected=4*numpixels;var numRead=kha_internal_HdrFormat.readBufOffset(data,offset,numExpected);if(numRead<numExpected){haxe_Log.trace("Error reading raw pixels: got "+numRead+" bytes, expected "+numExpected,{fileName:"kha/internal/HdrFormat.hx",lineNumber:43,className:"kha.internal.HdrFormat",methodName:"readPixelsRaw"});return}};kha_internal_HdrFormat.readPixelsRawRLE=function(buffer,data,offset,scanline_width,num_scanlines){var this1=new Uint8Array(4);var rgbe=this1;var scanline_buffer=null;var ptr;var ptr_end;var count;var this2=new Uint8Array(2);var buf=this2;var bufferLength=buffer.length;while(num_scanlines>0){if(kha_internal_HdrFormat.readBuf(rgbe)<rgbe.length){haxe_Log.trace("Error reading bytes: expected "+rgbe.length,{fileName:"kha/internal/HdrFormat.hx",lineNumber:59,className:"kha.internal.HdrFormat",methodName:"readPixelsRawRLE"});return}if(rgbe[0]!=2||rgbe[1]!=2||(rgbe[2]&128)!=0){data[offset++]=rgbe[0]&255;data[offset++]=rgbe[1]&255;data[offset++]=rgbe[2]&255;data[offset++]=rgbe[3]&255;kha_internal_HdrFormat.readPixelsRaw(buffer,data,offset,scanline_width*num_scanlines-1);return}if(((rgbe[2]&255)<<8|rgbe[3]&255)!=scanline_width){haxe_Log.trace("Wrong scanline width "+((rgbe[2]&255)<<8|rgbe[3]&255)+", expected "+scanline_width,{fileName:"kha/internal/HdrFormat.hx",lineNumber:74,className:"kha.internal.HdrFormat",methodName:"readPixelsRawRLE"});return}if(scanline_buffer==null){var this3=new Uint8Array(4*scanline_width);scanline_buffer=this3}ptr=0;var _g=0;while(_g<4){var i=_g++;ptr_end=(i+1)*scanline_width;while(ptr<ptr_end){if(kha_internal_HdrFormat.readBuf(buf)<buf.length){haxe_Log.trace("Error reading 2-byte buffer",{fileName:"kha/internal/HdrFormat.hx",lineNumber:88,className:"kha.internal.HdrFormat",methodName:"readPixelsRawRLE"});return}if((buf[0]&255)>128){count=(buf[0]&255)-128;if(count==0||count>ptr_end-ptr){haxe_Log.trace("Bad scanline data",{fileName:"kha/internal/HdrFormat.hx",lineNumber:95,className:"kha.internal.HdrFormat",methodName:"readPixelsRawRLE"});return}while(count-- >0)scanline_buffer[ptr++]=buf[1]&255}else{count=buf[0]&255;if(count==0||count>ptr_end-ptr){haxe_Log.trace("Bad scanline data",{fileName:"kha/internal/HdrFormat.hx",lineNumber:106,className:"kha.internal.HdrFormat",methodName:"readPixelsRawRLE"});return}scanline_buffer[ptr++]=buf[1]&255;if(--count>0){if(kha_internal_HdrFormat.readBufOffset(scanline_buffer,ptr,count)<count){haxe_Log.trace("Error reading non-run data",{fileName:"kha/internal/HdrFormat.hx",lineNumber:112,className:"kha.internal.HdrFormat",methodName:"readPixelsRawRLE"});return}ptr+=count}}}}var _g1=0;var _g2=scanline_width;while(_g1<_g2){var i1=_g1++;data[offset]=scanline_buffer[i1]&255;data[offset+1]=scanline_buffer[i1+scanline_width]&255;data[offset+2]=scanline_buffer[i1+2*scanline_width]&255;data[offset+3]=scanline_buffer[i1+3*scanline_width]&255;offset+=4}--num_scanlines}};kha_internal_HdrFormat.readLine=function(){var buf="";while(true){var b=kha_internal_HdrFormat.buffer[kha_internal_HdrFormat.fileOffset];if(b==10){++kha_internal_HdrFormat.fileOffset;break}buf+=String.fromCodePoint(b);if(!(++kha_internal_HdrFormat.fileOffset<kha_internal_HdrFormat.bufferLength)){break}}return buf};kha_internal_HdrFormat.parse=function(bytes){kha_internal_HdrFormat.buffer=haxe_io__$UInt8Array_UInt8Array_$Impl_$.fromBytes(bytes);kha_internal_HdrFormat.bufferLength=kha_internal_HdrFormat.buffer.length;kha_internal_HdrFormat.fileOffset=0;var width=0;var height=0;var exposure=1;var gamma=1;var rle=false;var _g=0;while(_g<20){var i=_g++;var line=kha_internal_HdrFormat.readLine();if(kha_internal_HdrFormat.formatPattern.match(line)){rle=true}else if(kha_internal_HdrFormat.exposurePattern.match(line)){exposure=Std.parseFloat(kha_internal_HdrFormat.exposurePattern.matched(1))}else if(kha_internal_HdrFormat.widthHeightPattern.match(line)){height=Std.parseInt(kha_internal_HdrFormat.widthHeightPattern.matched(1));width=Std.parseInt(kha_internal_HdrFormat.widthHeightPattern.matched(2));break}}if(!rle){haxe_Log.trace("File is not run length encoded!",{fileName:"kha/internal/HdrFormat.hx",lineNumber:175,className:"kha.internal.HdrFormat",methodName:"parse"});return null}var this1=new Uint8Array(width*height*4);var data=this1;var scanline_width=width;var num_scanlines=height;kha_internal_HdrFormat.readPixelsRawRLE(kha_internal_HdrFormat.buffer,data,0,scanline_width,num_scanlines);var this2=new Float32Array(width*height*4);var floatData=this2;var offset=0;while(offset<data.length){var r=data[offset]/255;var g=data[offset+1]/255;var b=data[offset+2]/255;var e=data[offset+3];var f=Math.pow(2,e-128);r*=f;g*=f;b*=f;floatData[offset]=r;floatData[offset+1]=g;floatData[offset+2]=b;floatData[offset+3]=1;offset+=4}return{width:width,height:height,data:floatData}};var kha_js_AEAudioChannel=function(element){this.stopped=false;this.element=element};$hxClasses["kha.js.AEAudioChannel"]=kha_js_AEAudioChannel;kha_js_AEAudioChannel.__name__=true;kha_js_AEAudioChannel.__interfaces__=[kha_audio1_AudioChannel];kha_js_AEAudioChannel.prototype={play:function(){this.stopped=false;if(kha_SystemImpl.mobile){if(kha_SystemImpl.insideInputEvent){this.element.play();kha_SystemImpl.mobileAudioPlaying=true}else if(kha_SystemImpl.mobileAudioPlaying){this.element.play()}else{kha_js_AEAudioChannel.todo.push(this)}}else{this.element.play()}},get_length:function(){if(isFinite(this.element.duration)){return this.element.duration}else{return Infinity}},get_position:function(){return this.element.currentTime},set_volume:function(value){return this.element.volume=value},get_finished:function(){if(!this.stopped){return this.get_position()>=this.get_length()}else{return true}},__class__:kha_js_AEAudioChannel,__properties__:{get_finished:"get_finished",set_volume:"set_volume",get_position:"get_position",get_length:"get_length"}};var kha_js_AudioElementAudio=function(){};$hxClasses["kha.js.AudioElementAudio"]=kha_js_AudioElementAudio;kha_js_AudioElementAudio.__name__=true;kha_js_AudioElementAudio.play=function(sound,loop){if(loop==null){loop=false}return kha_js_AudioElementAudio.stream(sound,loop)};kha_js_AudioElementAudio.stream=function(sound,loop){if(loop==null){loop=false}sound.element.loop=loop;var channel=new kha_js_AEAudioChannel(sound.element);channel.play();return channel};var kha_js_CanvasGraphics=function(canvas){this.bakedQuadCache=new kha_AlignedQuad;kha_graphics2_Graphics.call(this);this.canvas=canvas;kha_js_CanvasGraphics.instance=this;this.myColor=kha__$Color_Color_$Impl_$.fromBytes(0,0,0)};$hxClasses["kha.js.CanvasGraphics"]=kha_js_CanvasGraphics;kha_js_CanvasGraphics.__name__=true;kha_js_CanvasGraphics.__super__=kha_graphics2_Graphics;kha_js_CanvasGraphics.prototype=$extend(kha_graphics2_Graphics.prototype,{begin:function(clear,clearColor){if(clear==null){clear=true}if(clear){this.clear(clearColor)}},clear:function(color){if(color==null){color=0}this.canvas.strokeStyle="rgba("+((color&16711680)>>>16)+","+((color&65280)>>>8)+","+(color&255)+","+(color>>>24)*.00392156862745098+")";this.canvas.fillStyle="rgba("+((color&16711680)>>>16)+","+((color&65280)>>>8)+","+(color&255)+","+(color>>>24)*.00392156862745098+")";if((color>>>24)*.00392156862745098==0){this.canvas.clearRect(0,0,this.canvas.canvas.width,this.canvas.canvas.height)}else{this.canvas.fillRect(0,0,this.canvas.canvas.width,this.canvas.canvas.height)}this.set_color(this.myColor)},end:function(){},drawImage:function(img,x,y){this.canvas.globalAlpha=this.get_opacity();this.canvas.drawImage(js_Boot.__cast(img,kha_CanvasImage).image,x,y);this.canvas.globalAlpha=1},drawScaledSubImage:function(image,sx,sy,sw,sh,dx,dy,dw,dh){this.canvas.globalAlpha=this.get_opacity();try{if(dw<0||dh<0){this.canvas.save();this.canvas.translate(dx,dy);var x=0;var y=0;if(dw<0){this.canvas.scale(-1,1);x=-dw}if(dh<0){this.canvas.scale(1,-1);y=-dh}this.canvas.drawImage(js_Boot.__cast(image,kha_CanvasImage).image,sx,sy,sw,sh,x,y,dw,dh);this.canvas.restore()}else{this.canvas.drawImage(js_Boot.__cast(image,kha_CanvasImage).image,sx,sy,sw,sh,dx,dy,dw,dh)}}catch(ex){var ex1=ex instanceof js__$Boot_HaxeError?ex.val:ex}this.canvas.globalAlpha=1},set_color:function(color){this.myColor=color;this.canvas.strokeStyle="rgba("+((color&16711680)>>>16)+","+((color&65280)>>>8)+","+(color&255)+","+(color>>>24)*.00392156862745098+")";this.canvas.fillStyle="rgba("+((color&16711680)>>>16)+","+((color&65280)>>>8)+","+(color&255)+","+(color>>>24)*.00392156862745098+")";return color},get_color:function(){return this.myColor},set_imageScaleQuality:function(value){if(value==kha_graphics2_ImageScaleQuality.Low){this.canvas.mozImageSmoothingEnabled=false;this.canvas.webkitImageSmoothingEnabled=false;this.canvas.msImageSmoothingEnabled=false;this.canvas.imageSmoothingEnabled=false}else{this.canvas.mozImageSmoothingEnabled=true;this.canvas.webkitImageSmoothingEnabled=true;this.canvas.msImageSmoothingEnabled=true;this.canvas.imageSmoothingEnabled=true}return this.scaleQuality=value},drawRect:function(x,y,width,height,strength){if(strength==null){strength=1}this.canvas.beginPath();var oldStrength=this.canvas.lineWidth;this.canvas.lineWidth=Math.round(strength);this.canvas.rect(x,y,width,height);this.canvas.stroke();this.canvas.lineWidth=oldStrength},fillRect:function(x,y,width,height){var tmp=this.get_opacity();this.canvas.globalAlpha=tmp*((this.myColor>>>24)*.00392156862745098);this.canvas.fillRect(x,y,width,height);this.canvas.globalAlpha=this.get_opacity()},fillCircle:function(cx,cy,radius){this.canvas.beginPath();this.canvas.arc(cx,cy,radius,0,2*Math.PI,false);this.canvas.fill()},drawString:function(text,x,y){var image=this.webfont.getImage(this.get_fontSize(),this.myColor);if(image.width>0){var xpos=x;var ypos=y;var _g=0;var _g1=text.length;while(_g<_g1){var i=_g++;var q=this.webfont.kravur._get(this.get_fontSize()).getBakedQuad(this.bakedQuadCache,kha_graphics2_Graphics.fontGlyphs.indexOf(HxOverrides.cca(text,i)),xpos,ypos);if(q!=null){if(q.s1-q.s0>0&&q.t1-q.t0>0&&q.x1-q.x0>0&&q.y1-q.y0>0){this.canvas.drawImage(image,q.s0*image.width,q.t0*image.height,(q.s1-q.s0)*image.width,(q.t1-q.t0)*image.height,q.x0,q.y0,q.x1-q.x0,q.y1-q.y0)}xpos+=q.xadvance}}}},set_font:function(font){this.webfont=js_Boot.__cast(font,kha_js_Font);return this.webfont},get_font:function(){return this.webfont},drawLine:function(x1,y1,x2,y2,strength){if(strength==null){strength=1}this.canvas.beginPath();var oldWith=this.canvas.lineWidth;this.canvas.lineWidth=Math.round(strength);this.canvas.moveTo(x1,y1);this.canvas.lineTo(x2,y2);this.canvas.moveTo(0,0);this.canvas.stroke();this.canvas.lineWidth=oldWith},fillTriangle:function(x1,y1,x2,y2,x3,y3){this.canvas.beginPath();this.canvas.closePath();this.canvas.fill()},setTransformation:function(transformation){this.canvas.setTransform(transformation._00,transformation._01,transformation._10,transformation._11,transformation._20,transformation._21)},__class__:kha_js_CanvasGraphics});var kha_js_Font=function(blob){this.images=new haxe_ds_IntMap;this.kravur=new kha_js_Font.Kravur(blob)};$hxClasses["kha.js.Font"]=kha_js_Font;kha_js_Font.__name__=true;kha_js_Font.__interfaces__=[kha_Resource];kha_js_Font.prototype={getImage:function(fontSize,color){var glyphs=kha_graphics2_Graphics.fontGlyphs;var imageIndex=fontSize*1e4+glyphs.length;if(!this.images.exists(imageIndex)){var this1=this.images;var v=new haxe_ds_IntMap;this1.set(imageIndex,v)}if(!this.images.get(imageIndex).exists(color)){var kravur=this.kravur._get(fontSize);var canvas=window.document.createElement("canvas");canvas.width=kravur.width;canvas.height=kravur.height;var ctx=canvas.getContext("2d");ctx.fillStyle="black";ctx.fillRect(0,0,kravur.width,kravur.height);var imageData=ctx.getImageData(0,0,kravur.width,kravur.height);var bytes=js_Boot.__cast(kravur.getTexture(),kha_CanvasImage).bytes;var _g=0;var _g1=bytes.length;while(_g<_g1){var i=_g++;imageData.data[i*4]=(color&16711680)>>>16;imageData.data[i*4+1]=(color&65280)>>>8;imageData.data[i*4+2]=color&255;imageData.data[i*4+3]=bytes.get(i)}ctx.putImageData(imageData,0,0);var img=window.document.createElement("img");img.src=canvas.toDataURL("image/png");this.images.get(imageIndex).set(color,img);return img}return this.images.get(imageIndex).get(color)},__class__:kha_js_Font};var kha_js_MobileWebAudio=function(){};$hxClasses["kha.js.MobileWebAudio"]=kha_js_MobileWebAudio;kha_js_MobileWebAudio.__name__=true;kha_js_MobileWebAudio._init=function(){try{kha_js_MobileWebAudio._context=new AudioContext;return}catch(e){var e1=e instanceof js__$Boot_HaxeError?e.val:e}try{this._context=new webkitAudioContext;return}catch(e2){var e3=e2 instanceof js__$Boot_HaxeError?e2.val:e2}};kha_js_MobileWebAudio.play=function(sound,loop){if(loop==null){loop=false}var channel=new kha_js_MobileWebAudioChannel(sound,loop);channel.play();return channel};kha_js_MobileWebAudio.stream=function(sound,loop){if(loop==null){loop=false}return kha_js_MobileWebAudio.play(sound,loop)};var kha_js_MobileWebAudioChannel=function(sound,loop){this.stopped=false;this.paused=false;this.buffer=sound._buffer;this.loop=loop;this.createSource()};$hxClasses["kha.js.MobileWebAudioChannel"]=kha_js_MobileWebAudioChannel;kha_js_MobileWebAudioChannel.__name__=true;kha_js_MobileWebAudioChannel.__interfaces__=[kha_audio1_AudioChannel];kha_js_MobileWebAudioChannel.prototype={createSource:function(){var _gthis=this;this.source=kha_js_MobileWebAudio._context.createBufferSource();this.source.loop=this.loop;this.source.buffer=this.buffer;this.source.onended=function(){_gthis.stopped=true};this.gain=kha_js_MobileWebAudio._context.createGain();this.source.connect(this.gain);this.gain.connect(kha_js_MobileWebAudio._context.destination)},play:function(){if(this.paused||this.stopped){this.createSource()}this.stopped=false;if(this.paused){this.paused=false;this.startTime=kha_js_MobileWebAudio._context.currentTime-this.pauseTime;this.source.start(0,this.pauseTime)}else{this.startTime=kha_js_MobileWebAudio._context.currentTime;this.source.start()}},set_volume:function(value){return this.gain.gain.value=value},get_finished:function(){return this.stopped},__class__:kha_js_MobileWebAudioChannel,__properties__:{get_finished:"get_finished",set_volume:"set_volume"}};var kha_js_MobileWebAudioSound=function(filename,done,failed){var _gthis=this;kha_Sound.call(this);var request=new XMLHttpRequest;request.open("GET",filename,true);request.responseType="arraybuffer";request.onerror=function(){failed({url:filename})};request.onload=function(){_gthis.compressedData=haxe_io_Bytes.ofData(request.response);_gthis.uncompressedData=null;kha_js_MobileWebAudio._context.decodeAudioData(_gthis.compressedData.getData(),function(buffer){_gthis._buffer=buffer;done(_gthis)},function(){failed({url:filename,error:"Audio format not supported"})})};request.send(null)};$hxClasses["kha.js.MobileWebAudioSound"]=kha_js_MobileWebAudioSound;kha_js_MobileWebAudioSound.__name__=true;kha_js_MobileWebAudioSound.__super__=kha_Sound;kha_js_MobileWebAudioSound.prototype=$extend(kha_Sound.prototype,{__class__:kha_js_MobileWebAudioSound});var kha_js_Sound=function(filenames,done,failed){kha_Sound.call(this);this.done=done;this.failed=failed;kha_js_Sound.loading.push(this);this.element=window.document.createElement("audio");this.filenames=[];var _g=0;while(_g<filenames.length){var filename=filenames[_g];++_g;if(this.element.canPlayType("audio/ogg")!=""&&StringTools.endsWith(filename,".ogg")){this.filenames.push(filename)}if(this.element.canPlayType("audio/mp4")!=""&&StringTools.endsWith(filename,".mp4")){this.filenames.push(filename)}}this.element.addEventListener("error",$bind(this,this.errorListener),false);this.element.addEventListener("canplay",$bind(this,this.canPlayThroughListener),false);this.element.src=this.filenames[0];this.element.preload="auto";this.element.load()};$hxClasses["kha.js.Sound"]=kha_js_Sound;kha_js_Sound.__name__=true;kha_js_Sound.__super__=kha_Sound;kha_js_Sound.prototype=$extend(kha_Sound.prototype,{errorListener:function(eventInfo){if(this.element.error.code==4){var _g=0;var _g1=this.filenames.length-1;while(_g<_g1){var i=_g++;if(this.element.src==this.filenames[i]){this.element.src=this.filenames[i+1];return}}}this.failed({url:this.element.src});this.finishAsset()},canPlayThroughListener:function(eventInfo){this.finishAsset()},finishAsset:function(){this.element.removeEventListener("error",$bind(this,this.errorListener),false);this.element.removeEventListener("canplaythrough",$bind(this,this.canPlayThroughListener),false);this.done(this);HxOverrides.remove(kha_js_Sound.loading,this)},__class__:kha_js_Sound});var kha_js_graphics4_ConstantLocation=function(value,type){this.value=value;this.type=type};$hxClasses["kha.js.graphics4.ConstantLocation"]=kha_js_graphics4_ConstantLocation;kha_js_graphics4_ConstantLocation.__name__=true;kha_js_graphics4_ConstantLocation.__interfaces__=[kha_graphics4_ConstantLocation];kha_js_graphics4_ConstantLocation.prototype={__class__:kha_js_graphics4_ConstantLocation};var kha_js_graphics4_Graphics=function(renderTarget){this.matrix3Cache=new Float32Array(9);this.matrixCache=new Float32Array(16);this.isDepthAttachment=false;this.isCubeMap=false;this.colorMaskAlpha=true;this.colorMaskBlue=true;this.colorMaskGreen=true;this.colorMaskRed=true;this.depthMask=false;this.depthTest=false;this.currentPipeline=null;this.renderTarget=renderTarget;this.init();if(kha_SystemImpl.gl2){this.instancedExtension=true}else{this.instancedExtension=kha_SystemImpl.gl.getExtension("ANGLE_instanced_arrays");this.blendMinMaxExtension=kha_SystemImpl.gl.getExtension("EXT_blend_minmax")}};$hxClasses["kha.js.graphics4.Graphics"]=kha_js_graphics4_Graphics;kha_js_graphics4_Graphics.__name__=true;kha_js_graphics4_Graphics.__interfaces__=[kha_graphics4_Graphics];kha_js_graphics4_Graphics.getBlendFunc=function(factor){switch(factor){case 1:return 1;case 0:case 2:return 0;case 3:return 770;case 4:return 772;case 5:return 771;case 6:return 773;case 7:return 768;case 8:return 774;case 9:return 769;case 10:return 775}};kha_js_graphics4_Graphics.getBlendOp=function(op){switch(op){case 0:return 32774;case 1:return 32778;case 2:return 32779;case 3:return 32775;case 4:return 32776}};kha_js_graphics4_Graphics.prototype={init:function(){if(this.renderTarget==null){return}this.isCubeMap=this.renderTarget instanceof kha_graphics4_CubeMap;if(this.isCubeMap){var cubeMap=js_Boot.__cast(this.renderTarget,kha_graphics4_CubeMap);this.renderTargetFrameBuffer=cubeMap.frameBuffer;this.renderTargetTexture=cubeMap.texture;this.isDepthAttachment=cubeMap.isDepthAttachment}else{var image=js_Boot.__cast(this.renderTarget,kha_WebGLImage);this.renderTargetFrameBuffer=image.frameBuffer;this.renderTargetTexture=image.texture}},begin:function(additionalRenderTargets){kha_SystemImpl.gl.enable(3042);kha_SystemImpl.gl.blendFunc(770,771);if(this.renderTarget==null){kha_SystemImpl.gl.bindFramebuffer(36160,null);kha_SystemImpl.gl.viewport(0,0,kha_System.windowWidth(),kha_System.windowHeight())}else{kha_SystemImpl.gl.bindFramebuffer(36160,this.renderTargetFrameBuffer);kha_SystemImpl.gl.viewport(0,0,this.renderTarget.get_width(),this.renderTarget.get_height());if(additionalRenderTargets!=null){kha_SystemImpl.gl.framebufferTexture2D(36160,kha_SystemImpl.drawBuffers.COLOR_ATTACHMENT0_WEBGL,3553,this.renderTargetTexture,0);var _g=0;var _g1=additionalRenderTargets.length;while(_g<_g1){var i=_g++;kha_SystemImpl.gl.framebufferTexture2D(36160,kha_SystemImpl.drawBuffers.COLOR_ATTACHMENT0_WEBGL+i+1,3553,js_Boot.__cast(additionalRenderTargets[i],kha_WebGLImage).texture,0)}var attachments=[kha_SystemImpl.drawBuffers.COLOR_ATTACHMENT0_WEBGL];var _g2=0;var _g3=additionalRenderTargets.length;while(_g2<_g3){var i1=_g2++;attachments.push(kha_SystemImpl.drawBuffers.COLOR_ATTACHMENT0_WEBGL+i1+1)}if(kha_SystemImpl.gl2){kha_SystemImpl.gl.drawBuffers(attachments)}else{kha_SystemImpl.drawBuffers.drawBuffersWEBGL(attachments)}}}},beginFace:function(face){kha_SystemImpl.gl.enable(3042);kha_SystemImpl.gl.blendFunc(770,771);kha_SystemImpl.gl.bindFramebuffer(36160,this.renderTargetFrameBuffer);kha_SystemImpl.gl.framebufferTexture2D(36160,this.isDepthAttachment?36096:36064,34069+face,this.renderTargetTexture,0);kha_SystemImpl.gl.viewport(0,0,this.renderTarget.get_width(),this.renderTarget.get_height())},end:function(){},clear:function(color,depth,stencil){var clearMask=0;if(color!=null){clearMask|=16384;kha_SystemImpl.gl.colorMask(true,true,true,true);kha_SystemImpl.gl.clearColor(((color&16711680)>>>16)*.00392156862745098,((color&65280)>>>8)*.00392156862745098,(color&255)*.00392156862745098,(color>>>24)*.00392156862745098)}if(depth!=null){clearMask|=256;kha_SystemImpl.gl.enable(2929);kha_SystemImpl.gl.depthMask(true);kha_SystemImpl.gl.clearDepth(depth)}if(stencil!=null){clearMask|=1024;kha_SystemImpl.gl.enable(2960);kha_SystemImpl.gl.stencilMask(255);kha_SystemImpl.gl.clearStencil(stencil)}kha_SystemImpl.gl.clear(clearMask);kha_SystemImpl.gl.colorMask(this.colorMaskRed,this.colorMaskGreen,this.colorMaskBlue,this.colorMaskAlpha);if(this.depthTest){kha_SystemImpl.gl.enable(2929)}else{kha_SystemImpl.gl.disable(2929)}kha_SystemImpl.gl.depthMask(this.depthMask)},viewport:function(x,y,width,height){if(this.renderTarget==null){kha_SystemImpl.gl.viewport(x,kha_System.windowHeight(0)-y-height,width,height)}else{kha_SystemImpl.gl.viewport(x,y,width,height)}},scissor:function(x,y,width,height){kha_SystemImpl.gl.enable(3089);if(this.renderTarget==null){kha_SystemImpl.gl.scissor(x,kha_System.windowHeight(0)-y-height,width,height)}else{kha_SystemImpl.gl.scissor(x,y,width,height)}},disableScissor:function(){kha_SystemImpl.gl.disable(3089)},renderTargetsInvertedY:function(){return true},setDepthMode:function(write,mode){switch(mode){case 0:if(write){kha_SystemImpl.gl.enable(2929)}else{kha_SystemImpl.gl.disable(2929)}this.depthTest=write;kha_SystemImpl.gl.depthFunc(519);break;case 1:kha_SystemImpl.gl.enable(2929);this.depthTest=true;kha_SystemImpl.gl.depthFunc(512);break;case 2:kha_SystemImpl.gl.enable(2929);this.depthTest=true;kha_SystemImpl.gl.depthFunc(514);break;case 3:kha_SystemImpl.gl.enable(2929);this.depthTest=true;kha_SystemImpl.gl.depthFunc(517);break;case 4:kha_SystemImpl.gl.enable(2929);this.depthTest=true;kha_SystemImpl.gl.depthFunc(513);break;case 5:kha_SystemImpl.gl.enable(2929);this.depthTest=true;kha_SystemImpl.gl.depthFunc(515);break;case 6:kha_SystemImpl.gl.enable(2929);this.depthTest=true;kha_SystemImpl.gl.depthFunc(516);break;case 7:kha_SystemImpl.gl.enable(2929);this.depthTest=true;kha_SystemImpl.gl.depthFunc(518);break}kha_SystemImpl.gl.depthMask(write);this.depthMask=write},setBlendingMode:function(source,destination,operation,alphaSource,alphaDestination,alphaOperation){if(source==1&&destination==2){kha_SystemImpl.gl.disable(3042)}else{kha_SystemImpl.gl.enable(3042);kha_SystemImpl.gl.blendFuncSeparate(kha_js_graphics4_Graphics.getBlendFunc(source),kha_js_graphics4_Graphics.getBlendFunc(destination),kha_js_graphics4_Graphics.getBlendFunc(alphaSource),kha_js_graphics4_Graphics.getBlendFunc(alphaDestination));kha_SystemImpl.gl.blendEquationSeparate(kha_js_graphics4_Graphics.getBlendOp(operation),kha_js_graphics4_Graphics.getBlendOp(alphaOperation))}},setVertexBuffer:function(vertexBuffer){js_Boot.__cast(vertexBuffer,kha_graphics4_VertexBuffer).set(0)},setVertexBuffers:function(vertexBuffers){var offset=0;var _g=0;while(_g<vertexBuffers.length){var vertexBuffer=vertexBuffers[_g];++_g;offset+=js_Boot.__cast(vertexBuffer,kha_graphics4_VertexBuffer).set(offset)}},setIndexBuffer:function(indexBuffer){this.indicesCount=indexBuffer.count();js_Boot.__cast(indexBuffer,kha_graphics4_IndexBuffer).set()},setTexture:function(stage,texture){if(texture==null){kha_SystemImpl.gl.activeTexture(33984+js_Boot.__cast(stage,kha_js_graphics4_TextureUnit).value);kha_SystemImpl.gl.bindTexture(3553,null)}else{js_Boot.__cast(texture,kha_WebGLImage).set(js_Boot.__cast(stage,kha_js_graphics4_TextureUnit).value)}},setTextureDepth:function(stage,texture){js_Boot.__cast(texture,kha_WebGLImage).setDepth(js_Boot.__cast(stage,kha_js_graphics4_TextureUnit).value)},setImageTexture:function(unit,texture){},setTextureParameters:function(texunit,uAddressing,vAddressing,minificationFilter,magnificationFilter,mipmapFilter){kha_SystemImpl.gl.activeTexture(33984+js_Boot.__cast(texunit,kha_js_graphics4_TextureUnit).value);switch(uAddressing){case 0:kha_SystemImpl.gl.texParameteri(3553,10242,10497);break;case 1:kha_SystemImpl.gl.texParameteri(3553,10242,33648);break;case 2:kha_SystemImpl.gl.texParameteri(3553,10242,33071);break}switch(vAddressing){case 0:kha_SystemImpl.gl.texParameteri(3553,10243,10497);break;case 1:kha_SystemImpl.gl.texParameteri(3553,10243,33648);break;case 2:kha_SystemImpl.gl.texParameteri(3553,10243,33071);break}switch(minificationFilter){case 0:switch(mipmapFilter){case 0:kha_SystemImpl.gl.texParameteri(3553,10241,9728);break;case 1:kha_SystemImpl.gl.texParameteri(3553,10241,9984);break;case 2:kha_SystemImpl.gl.texParameteri(3553,10241,9986);break}break;case 1:case 2:switch(mipmapFilter){case 0:kha_SystemImpl.gl.texParameteri(3553,10241,9729);break;case 1:kha_SystemImpl.gl.texParameteri(3553,10241,9985);break;case 2:kha_SystemImpl.gl.texParameteri(3553,10241,9987);break}if(minificationFilter==2){kha_SystemImpl.gl.texParameteri(3553,kha_SystemImpl.anisotropicFilter.TEXTURE_MAX_ANISOTROPY_EXT,4)}break}switch(magnificationFilter){case 0:kha_SystemImpl.gl.texParameteri(3553,10240,9728);break;case 1:case 2:kha_SystemImpl.gl.texParameteri(3553,10240,9729);break}},setTexture3DParameters:function(texunit,uAddressing,vAddressing,wAddressing,minificationFilter,magnificationFilter,mipmapFilter){},setTextureCompareMode:function(texunit,enabled){if(enabled){kha_SystemImpl.gl.texParameteri(3553,34892,34894);kha_SystemImpl.gl.texParameteri(3553,34893,515)}else{kha_SystemImpl.gl.texParameteri(3553,34892,0)}},setCubeMapCompareMode:function(texunit,enabled){if(enabled){kha_SystemImpl.gl.texParameteri(34067,34892,34894);kha_SystemImpl.gl.texParameteri(34067,34893,515)}else{kha_SystemImpl.gl.texParameteri(34067,34892,0)}},setCubeMap:function(stage,cubeMap){if(cubeMap==null){kha_SystemImpl.gl.activeTexture(33984+js_Boot.__cast(stage,kha_js_graphics4_TextureUnit).value);kha_SystemImpl.gl.bindTexture(34067,null)}else{cubeMap.set(js_Boot.__cast(stage,kha_js_graphics4_TextureUnit).value)}},setCubeMapDepth:function(stage,cubeMap){cubeMap.setDepth(js_Boot.__cast(stage,kha_js_graphics4_TextureUnit).value)},setCullMode:function(mode){switch(mode){case 0:kha_SystemImpl.gl.enable(2884);kha_SystemImpl.gl.cullFace(1029);break;case 1:kha_SystemImpl.gl.enable(2884);kha_SystemImpl.gl.cullFace(1028);break;case 2:kha_SystemImpl.gl.disable(2884);break}},setPipeline:function(pipe){this.setCullMode(pipe.cullMode);this.setDepthMode(pipe.depthWrite,pipe.depthMode);this.setStencilParameters(pipe.stencilMode,pipe.stencilBothPass,pipe.stencilDepthFail,pipe.stencilFail,pipe.stencilReferenceValue,pipe.stencilReadMask,pipe.stencilWriteMask);this.setBlendingMode(pipe.blendSource,pipe.blendDestination,pipe.blendOperation,pipe.alphaBlendSource,pipe.alphaBlendDestination,pipe.alphaBlendOperation);this.currentPipeline=pipe;pipe.set();this.colorMaskRed=pipe.get_colorWriteMaskRed();this.colorMaskGreen=pipe.get_colorWriteMaskGreen();this.colorMaskBlue=pipe.get_colorWriteMaskBlue();this.colorMaskAlpha=pipe.get_colorWriteMaskAlpha()},setBool:function(location,value){kha_SystemImpl.gl.uniform1i(js_Boot.__cast(location,kha_js_graphics4_ConstantLocation).value,value?1:0)},setInt:function(location,value){kha_SystemImpl.gl.uniform1i(js_Boot.__cast(location,kha_js_graphics4_ConstantLocation).value,value)},setFloat:function(location,value){kha_SystemImpl.gl.uniform1f(js_Boot.__cast(location,kha_js_graphics4_ConstantLocation).value,value)},setFloat2:function(location,value1,value2){kha_SystemImpl.gl.uniform2f(js_Boot.__cast(location,kha_js_graphics4_ConstantLocation).value,value1,value2)},setFloat3:function(location,value1,value2,value3){kha_SystemImpl.gl.uniform3f(js_Boot.__cast(location,kha_js_graphics4_ConstantLocation).value,value1,value2,value3)},setFloat4:function(location,value1,value2,value3,value4){kha_SystemImpl.gl.uniform4f(js_Boot.__cast(location,kha_js_graphics4_ConstantLocation).value,value1,value2,value3,value4)},setFloats:function(location,values){var webglLocation=js_Boot.__cast(location,kha_js_graphics4_ConstantLocation);switch(webglLocation.type){case 35664:kha_SystemImpl.gl.uniform2fv(webglLocation.value,values);break;case 35665:kha_SystemImpl.gl.uniform3fv(webglLocation.value,values);break;case 35666:kha_SystemImpl.gl.uniform4fv(webglLocation.value,values);break;case 35676:kha_SystemImpl.gl.uniformMatrix4fv(webglLocation.value,false,values);break;default:kha_SystemImpl.gl.uniform1fv(webglLocation.value,values)}},setMatrix:function(location,matrix){this.matrixCache[0]=matrix._00;this.matrixCache[1]=matrix._01;this.matrixCache[2]=matrix._02;this.matrixCache[3]=matrix._03;this.matrixCache[4]=matrix._10;this.matrixCache[5]=matrix._11;this.matrixCache[6]=matrix._12;this.matrixCache[7]=matrix._13;this.matrixCache[8]=matrix._20;this.matrixCache[9]=matrix._21;this.matrixCache[10]=matrix._22;this.matrixCache[11]=matrix._23;this.matrixCache[12]=matrix._30;this.matrixCache[13]=matrix._31;this.matrixCache[14]=matrix._32;this.matrixCache[15]=matrix._33;kha_SystemImpl.gl.uniformMatrix4fv(js_Boot.__cast(location,kha_js_graphics4_ConstantLocation).value,false,this.matrixCache)},setMatrix3:function(location,matrix){this.matrix3Cache[0]=matrix._00;this.matrix3Cache[1]=matrix._01;this.matrix3Cache[2]=matrix._02;this.matrix3Cache[3]=matrix._10;this.matrix3Cache[4]=matrix._11;this.matrix3Cache[5]=matrix._12;this.matrix3Cache[6]=matrix._20;this.matrix3Cache[7]=matrix._21;this.matrix3Cache[8]=matrix._22;kha_SystemImpl.gl.uniformMatrix3fv(js_Boot.__cast(location,kha_js_graphics4_ConstantLocation).value,false,this.matrix3Cache)},drawIndexedVertices:function(start,count){if(count==null){count=-1}if(start==null){start=0}var type=kha_SystemImpl.elementIndexUint==null?5123:5125;var size=type==5123?2:4;kha_SystemImpl.gl.drawElements(4,count==-1?this.indicesCount:count,type,start*size)},convertStencilAction:function(action){switch(action){case 0:return 7680;case 1:return 0;case 2:return 7681;case 3:return 7682;case 4:return 34055;case 5:return 7683;case 6:return 34056;case 7:return 5386}},convertCompareMode:function(compareMode){switch(compareMode){case 0:return 519;case 1:return 512;case 2:return 514;case 3:return 517;case 4:return 513;case 5:return 515;case 6:return 516;case 7:return 518}},setStencilParameters:function(compareMode,bothPass,depthFail,stencilFail,referenceValue,readMask,writeMask){if(writeMask==null){writeMask=255}if(readMask==null){readMask=255}if(compareMode==0&&bothPass==0&&depthFail==0&&stencilFail==0){kha_SystemImpl.gl.disable(2960)}else{kha_SystemImpl.gl.enable(2960);var stencilFunc=this.convertCompareMode(compareMode);kha_SystemImpl.gl.stencilMask(writeMask);kha_SystemImpl.gl.stencilOp(this.convertStencilAction(stencilFail),this.convertStencilAction(depthFail),this.convertStencilAction(bothPass));switch(referenceValue._hx_index){case 0:kha_SystemImpl.gl.stencilFunc(stencilFunc,0,readMask);break;case 1:var value=referenceValue.value;kha_SystemImpl.gl.stencilFunc(stencilFunc,value,readMask);break}}},drawIndexedVerticesInstanced:function(instanceCount,start,count){if(count==null){count=-1}if(start==null){start=0}if(this.instancedRenderingAvailable()){var type=kha_SystemImpl.elementIndexUint==null?5123:5125;var typeSize=kha_SystemImpl.elementIndexUint==null?2:4;if(kha_SystemImpl.gl2){kha_SystemImpl.gl.drawElementsInstanced(4,count==-1?this.indicesCount:count,type,start*typeSize,instanceCount)}else{this.instancedExtension.drawElementsInstancedANGLE(4,count==-1?this.indicesCount:count,type,start*typeSize,instanceCount)}}},instancedRenderingAvailable:function(){return this.instancedExtension},__class__:kha_js_graphics4_Graphics};var kha_js_graphics4_Graphics2=function(canvas){kha_graphics4_Graphics2.call(this,canvas)};$hxClasses["kha.js.graphics4.Graphics2"]=kha_js_graphics4_Graphics2;kha_js_graphics4_Graphics2.__name__=true;kha_js_graphics4_Graphics2.__super__=kha_graphics4_Graphics2;kha_js_graphics4_Graphics2.prototype=$extend(kha_graphics4_Graphics2.prototype,{begin:function(clear,clearColor){if(clear==null){clear=true}kha_SystemImpl.gl.colorMask(true,true,true,true);kha_SystemImpl.gl.disable(2929);kha_SystemImpl.gl.depthFunc(519);kha_graphics4_Graphics2.prototype.begin.call(this,clear,clearColor)},__class__:kha_js_graphics4_Graphics2});var kha_js_graphics4_TextureUnit=function(value){this.value=value};$hxClasses["kha.js.graphics4.TextureUnit"]=kha_js_graphics4_TextureUnit;kha_js_graphics4_TextureUnit.__name__=true;kha_js_graphics4_TextureUnit.__interfaces__=[kha_graphics4_TextureUnit];kha_js_graphics4_TextureUnit.prototype={__class__:kha_js_graphics4_TextureUnit};var kha_vr_VrInterface=function(){};$hxClasses["kha.vr.VrInterface"]=kha_vr_VrInterface;kha_vr_VrInterface.__name__=true;kha_vr_VrInterface.prototype={IsVrEnabled:function(){return false},__class__:kha_vr_VrInterface};var kha_js_vr_VrInterface=function(){this.vrHeight=0;this.vrWidth=0;this.height=0;this.width=0;this.vrEnabled=false;kha_vr_VrInterface.call(this);var displayEnabled=false;if(displayEnabled){this.vrEnabled=true;this.getVRDisplays();haxe_Log.trace("Display enabled.",{fileName:"kha/js/vr/VrInterface.hx",lineNumber:39,className:"kha.js.vr.VrInterface",methodName:"new"})}};$hxClasses["kha.js.vr.VrInterface"]=kha_js_vr_VrInterface;kha_js_vr_VrInterface.__name__=true;kha_js_vr_VrInterface.__super__=kha_vr_VrInterface;kha_js_vr_VrInterface.prototype=$extend(kha_vr_VrInterface.prototype,{getVRDisplays:function(){var _gthis=this;var vrDisplayInstance=navigator.getVRDisplays();vrDisplayInstance.then(function(displays){if(displays.length>0){_gthis.frameData=new VRFrameData;_gthis.vrDisplay=displays[0];_gthis.vrDisplay.depthNear=.1;_gthis.vrDisplay.depthFar=1024;var leftEye=_gthis.vrDisplay.getEyeParameters("left");var rightEye=_gthis.vrDisplay.getEyeParameters("right");_gthis.width=kha_SystemImpl.khanvas.width;_gthis.height=kha_SystemImpl.khanvas.height;_gthis.vrWidth=Std.int(Math.max(leftEye.renderWidth,rightEye.renderWidth)*2);_gthis.vrHeight=Std.int(Math.max(leftEye.renderHeight,rightEye.renderHeight))}else{haxe_Log.trace("There are no VR displays connected.",{fileName:"kha/js/vr/VrInterface.hx",lineNumber:59,className:"kha.js.vr.VrInterface",methodName:"getVRDisplays"})}})},IsVrEnabled:function(){return this.vrEnabled},__class__:kha_js_vr_VrInterface});var kha_math_FastVector2=function(x,y){if(y==null){y=0}if(x==null){x=0}this.x=x;this.y=y};$hxClasses["kha.math.FastVector2"]=kha_math_FastVector2;kha_math_FastVector2.__name__=true;kha_math_FastVector2.prototype={get_length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},set_length:function(length){var currentLength=this.get_length();if(currentLength==0){return 0}var mul=length/currentLength;this.x*=mul;this.y*=mul;return length},__class__:kha_math_FastVector2,__properties__:{set_length:"set_length",get_length:"get_length"}};var kha_netsync_ControllerBuilder=function(){};$hxClasses["kha.netsync.ControllerBuilder"]=kha_netsync_ControllerBuilder;kha_netsync_ControllerBuilder.__name__=true;var kha_netsync_Session=function(maxPlayers,address,port){this.controllers=new haxe_ds_IntMap;kha_netsync_Session.instance=this;this.maxPlayers=maxPlayers;this.address=address;this.port=port};$hxClasses["kha.netsync.Session"]=kha_netsync_Session;kha_netsync_Session.__name__=true;kha_netsync_Session.the=function(){return kha_netsync_Session.instance};kha_netsync_Session.prototype={sendControllerUpdate:function(id,bytes){if(this.controllers.exists(id)){if(this.controllers.get(id)._inputBuffer.length<this.controllers.get(id)._inputBufferIndex+4+bytes.length){var newBuffer=haxe_io_Bytes.alloc(this.controllers.get(id)._inputBufferIndex+4+bytes.length);newBuffer.blit(0,this.controllers.get(id)._inputBuffer,0,this.controllers.get(id)._inputBufferIndex);this.controllers.get(id)._inputBuffer=newBuffer}this.controllers.get(id)._inputBuffer.setInt32(this.controllers.get(id)._inputBufferIndex,bytes.length);this.controllers.get(id)._inputBuffer.blit(this.controllers.get(id)._inputBufferIndex+4,bytes,0,bytes.length);this.controllers.get(id)._inputBufferIndex+=4+bytes.length}},__class__:kha_netsync_Session};var zui_Handle=function(ops){this.changed=false;this.dragY=0;this.dragX=0;this.dragEnabled=false;this.dragging=false;this.lastMaxY=0;this.lastMaxX=0;this.layout=0;this.scrollEnabled=false;this.scrollOffset=0;this.scrolling=false;this.redraws=2;this.texture=null;this.text="";this.value=0;this.color=-1;this.position=0;this.selected=false;if(ops!=null){if(ops.selected!=null){this.selected=ops.selected}if(ops.position!=null){this.position=ops.position}if(ops.value!=null){this.value=ops.value}if(ops.text!=null){this.text=ops.text}if(ops.color!=null){this.color=ops.color}if(ops.layout!=null){this.layout=ops.layout}}};$hxClasses["zui.Handle"]=zui_Handle;zui_Handle.__name__=true;zui_Handle.prototype={nest:function(i,ops){if(this.children==null){this.children=[]}while(this.children.length<=i)this.children.push(null);if(this.children[i]==null){this.children[i]=new zui_Handle(ops)}return this.children[i]},__class__:zui_Handle};var zui_Canvas=function(){};$hxClasses["zui.Canvas"]=zui_Canvas;zui_Canvas.__name__=true;zui_Canvas.draw=function(ui,canvas,g){if(zui_Canvas.screenW==-1){zui_Canvas.screenW=kha_System.windowWidth();zui_Canvas.screenH=kha_System.windowHeight()}zui_Canvas.events=[];zui_Canvas._ui=ui;ui.begin(g);ui.g=g;var _g=0;var _g1=canvas.elements;while(_g<_g1.length){var elem=_g1[_g];++_g;if(elem.parent==null){zui_Canvas.drawElement(ui,canvas,elem)}}ui.end();return zui_Canvas.events};zui_Canvas.drawElement=function(ui,canvas,element,px,py){if(py==null){py=0}if(px==null){px=0}if(element==null||element.visible==false){return}ui._x=canvas.x+zui_Canvas.scaled(element.x)+zui_Canvas.scaled(px);ui._y=canvas.y+zui_Canvas.scaled(element.y)+zui_Canvas.scaled(py);ui._w=zui_Canvas.scaled(element.width);var cw=zui_Canvas.scaled(canvas.width);var ch=zui_Canvas.scaled(canvas.height);switch(element.anchor){case 1:ui._x-=(cw-zui_Canvas.screenW)/2;break;case 2:ui._x-=cw-zui_Canvas.screenW;break;case 3:ui._y-=(ch-zui_Canvas.screenH)/2;break;case 4:ui._x-=(cw-zui_Canvas.screenW)/2;ui._y-=(ch-zui_Canvas.screenH)/2;break;case 5:ui._x-=cw-zui_Canvas.screenW;ui._y-=(ch-zui_Canvas.screenH)/2;break;case 6:ui._y-=ch-zui_Canvas.screenH;break;case 7:ui._x-=(cw-zui_Canvas.screenW)/2;ui._y-=ch-zui_Canvas.screenH;break;case 8:ui._x-=cw-zui_Canvas.screenW;ui._y-=ch-zui_Canvas.screenH;break}var rotated=element.rotation!=null&&element.rotation!=0;if(rotated){ui.g.pushRotation(element.rotation,ui._x+zui_Canvas.scaled(element.width)/2,ui._y+zui_Canvas.scaled(element.height)/2)}switch(element.type){case 0:var font=ui.ops.font;var size=ui.fontSize;var tcol=ui.t.TEXT_COL;var fontAsset=element.asset!=null&&StringTools.endsWith(element.asset,".ttf");if(fontAsset){ui.ops.font=zui_Canvas.getAsset(canvas,element.asset)}ui.fontSize=zui_Canvas.scaled(element.height);ui.t.TEXT_COL=element.color;ui.text(zui_Canvas.getText(canvas,element));ui.ops.font=font;ui.fontSize=size;ui.t.TEXT_COL=tcol;break;case 1:var image=zui_Canvas.getAsset(canvas,element.asset);var fontAsset1=element.asset!=null&&StringTools.endsWith(element.asset,".ttf");if(image!=null&&!fontAsset1){ui.imageScrollAlign=false;var tint=element.color!=null?element.color:-1;if(ui.image(image,tint,zui_Canvas.scaled(element.height))==3){var e=element.event;if(e!=null&&e!=""){zui_Canvas.events.push(e)}}ui.imageScrollAlign=true}break;case 2:var bh=ui.t.BUTTON_H;ui.t.BUTTON_H=zui_Canvas.scaled(element.height);if(ui.button(zui_Canvas.getText(canvas,element))){var e1=element.event;if(e1!=null&&e1!=""){zui_Canvas.events.push(e1)}}ui.t.BUTTON_H=bh;break;case 3:break;case 6:ui.check(zui_Canvas.h.nest(element.id),zui_Canvas.getText(canvas,element));break;case 7:ui.inlineRadio(zui_Canvas.h.nest(element.id),zui_Canvas.getText(canvas,element).split(";"));break;case 8:ui.combo(zui_Canvas.h.nest(element.id),zui_Canvas.getText(canvas,element).split(";"));break;case 9:var col=ui.g.get_color();ui.g.set_color(element.color);ui.g.fillRect(ui._x,ui._y,ui._w,zui_Canvas.scaled(element.height));ui.g.set_color(col);break;case 10:ui.slider(zui_Canvas.h.nest(element.id),zui_Canvas.getText(canvas,element),0,1,true);break;case 11:ui.textInput(zui_Canvas.h.nest(element.id),zui_Canvas.getText(canvas,element));break}if(element.children!=null){var _g2=0;var _g3=element.children;while(_g2<_g3.length){var id=_g3[_g2];++_g2;zui_Canvas.drawElement(ui,canvas,zui_Canvas.elemById(canvas,id),element.x+px,element.y+py)}}if(rotated){ui.g.popTransformation()}};zui_Canvas.getText=function(canvas,e){return e.text};zui_Canvas.getAsset=function(canvas,asset){var _g=0;var _g1=canvas.assets;while(_g<_g1.length){var a=_g1[_g];++_g;if(a.name==asset){return zui_Canvas.assetMap.get(a.id)}}return null};zui_Canvas.elemById=function(canvas,id){var _g=0;var _g1=canvas.elements;while(_g<_g1.length){var e=_g1[_g];++_g;if(e.id==id){return e}}return null};zui_Canvas.scaled=function(f){return Std.int(f*zui_Canvas._ui.SCALE)};var zui_Ext=function(){};$hxClasses["zui.Ext"]=zui_Ext;zui_Ext.__name__=true;zui_Ext.colorWheel=function(ui,handle,alpha,w,rowAlign){if(rowAlign==null){rowAlign=false}if(alpha==null){alpha=false}if(w==null){w=ui._w}zui_Ext.rgbToHsv(((handle.color&16711680)>>>16)*.00392156862745098,((handle.color&65280)>>>8)*.00392156862745098,(handle.color&255)*.00392156862745098,zui_Ext.ar);var chue=zui_Ext.ar[0];var csat=zui_Ext.ar[1];var cval=zui_Ext.ar[2];var calpha=(handle.color>>>24)*.00392156862745098;var px=ui._x;var py=ui._y;var scroll=ui.currentWindow!=null&&ui.currentWindow.scrollEnabled;if(!scroll){w-=ui.SCROLL_W();px+=ui.SCROLL_W()/2}ui.image(ui.ops.color_wheel,kha__$Color_Color_$Impl_$.fromFloats(cval,cval,cval));var ph=ui._y-py;var ox=px+w/2;var oy=py+ph/2;var cw=w*.7;var cwh=cw/2;var cx=ox;var cy=oy+csat*cwh;var theta=chue*(Math.PI*2);var cx2=Math.cos(theta)*(cx-ox)-Math.sin(theta)*(cy-oy)+ox;var cy2=Math.sin(theta)*(cx-ox)+Math.cos(theta)*(cy-oy)+oy;cx=cx2;cy=cy2;ui.g.set_color(-16777216);ui.g.fillRect(cx-3,cy-3,6,6);ui.g.set_color(-1);ui.g.fillRect(cx-2,cy-2,4,4);if(rowAlign){if(alpha){ui.row([.3333333333333333,.3333333333333333,.3333333333333333])}else{ui.row([.5,.5])}}var valhandle=handle.nest(0);valhandle.value=Math.round(cval*100)/100;cval=ui.slider(valhandle,"Value",0,1,true);if(alpha){calpha=ui.slider(handle.nest(1,{value:Math.round(calpha*100)/100}),"Alpha",0,1,true)}var gx=ox+ui._windowX;var gy=oy+ui._windowY;if(ui.inputStarted&&ui.getInputInRect(gx-cwh,gy-cwh,cw,cw)){zui_Ext.wheelSelectedHande=handle}if(ui.inputReleased){zui_Ext.wheelSelectedHande=null}if(ui.inputDown&&zui_Ext.wheelSelectedHande==handle){csat=Math.min(zui_Ext.dist(gx,gy,ui.inputX,ui.inputY),cwh)/cwh;var angle=Math.atan2(ui.inputX-gx,ui.inputY-gy);if(angle<0){angle=Math.PI+(Math.PI-Math.abs(angle))}angle=Math.PI*2-angle;chue=angle/(Math.PI*2);handle.changed=ui.changed=true}zui_Ext.hsvToRgb(chue,csat,cval,zui_Ext.ar);handle.color=kha__$Color_Color_$Impl_$.fromFloats(zui_Ext.ar[0],zui_Ext.ar[1],zui_Ext.ar[2],calpha);ui.text("",2,handle.color);return handle.color};zui_Ext.dist=function(x1,y1,x2,y2){var vx=x1-x2;var vy=y1-y2;return Math.sqrt(vx*vx+vy*vy)};zui_Ext.fract=function(f){return f-Std.int(f)};zui_Ext.mix=function(x,y,a){return x*(1-a)+y*a};zui_Ext.clamp=function(x,minVal,maxVal){return Math.min(Math.max(x,minVal),maxVal)};zui_Ext.step=function(edge,x){if(x<edge){return 0}else{return 1}};zui_Ext.hsvToRgb=function(cR,cG,cB,out){var px=Math.abs(zui_Ext.fract(cR+1)*6-3);var py=Math.abs(zui_Ext.fract(cR+.6666666666666666)*6-3);var pz=Math.abs(zui_Ext.fract(cR+.3333333333333333)*6-3);out[0]=cB*zui_Ext.mix(1,zui_Ext.clamp(px-1,0,1),cG);out[1]=cB*zui_Ext.mix(1,zui_Ext.clamp(py-1,0,1),cG);out[2]=cB*zui_Ext.mix(1,zui_Ext.clamp(pz-1,0,1),cG)};zui_Ext.rgbToHsv=function(cR,cG,cB,out){var px=zui_Ext.mix(cB,cG,zui_Ext.step(cB,cG));var py=zui_Ext.mix(cG,cB,zui_Ext.step(cB,cG));var pz=zui_Ext.mix(-1,0,zui_Ext.step(cB,cG));var pw=zui_Ext.mix(.6666666666666666,-.3333333333333333,zui_Ext.step(cB,cG));var qx=zui_Ext.mix(px,cR,zui_Ext.step(px,cR));var qy=zui_Ext.mix(py,py,zui_Ext.step(px,cR));var qz=zui_Ext.mix(pw,pz,zui_Ext.step(px,cR));var qw=zui_Ext.mix(cR,px,zui_Ext.step(px,cR));var d=qx-Math.min(qw,qy);out[0]=Math.abs(qz+(qw-qy)/(6*d+1e-10));out[1]=d/(qx+1e-10);out[2]=qx};var zui_Nodes=function(){this.nodeId=-1;this.lastNodesCount=0;this.handle=new zui_Handle;this.snapY=0;this.snapX=0;this.snapSocket=0;this.snapToId=-1;this.snapFromId=-1;this.linkDrag=null;this.SCALE=1;this.uih=0;this.uiw=0;this.zoom=1;this.panY=0;this.panX=0;this.nodeSelected=null;this.nodeDrag=null};$hxClasses["zui.Nodes"]=zui_Nodes;zui_Nodes.__name__=true;zui_Nodes.prototype={PAN_X:function(){var zoomPan=(1-this.zoom)*this.uiw/2.5;return this.panX*this.SCALE+zoomPan},PAN_Y:function(){var zoomPan=(1-this.zoom)*this.uih/2.5;return this.panY*this.SCALE+zoomPan},LINE_H:function(){return Std.int(22*this.SCALE)},BUTTONS_H:function(node){var buttonsH=0;var _g=0;var _g1=node.buttons;while(_g<_g1.length){var but=_g1[_g];++_g;if(but.type=="RGBA"){buttonsH+=132*this.SCALE}else if(but.type=="VECTOR"){buttonsH+=this.LINE_H()*4}else if(but.type=="RAMP"){buttonsH+=this.LINE_H()*9.5}else if(but.type=="CURVES"){buttonsH+=this.LINE_H()*8}else{buttonsH+=this.LINE_H()}}return Std.int(buttonsH)},NODE_H:function(node){return Std.int(this.LINE_H()*2+node.inputs.length*this.LINE_H()+node.outputs.length*this.LINE_H()+this.BUTTONS_H(node))},NODE_W:function(){return Std.int(140*this.SCALE)},NODE_X:function(node){return node.x*this.SCALE+this.PAN_X()},NODE_Y:function(node){return node.y*this.SCALE+this.PAN_Y()},SOCKET_Y:function(pos){return this.LINE_H()*2+pos*this.LINE_H()},p:function(f){return f*this.SCALE},getNode:function(nodes,id){var _g=0;while(_g<nodes.length){var node=nodes[_g];++_g;if(node.id==id){return node}}return null},getNodeId:function(nodes){if(this.nodeId==-1){var _g=0;while(_g<nodes.length){var n=nodes[_g];++_g;if(this.nodeId<n.id){this.nodeId=n.id}}}return++this.nodeId},getLinkId:function(links){var id=0;var _g=0;while(_g<links.length){var l=links[_g];++_g;if(l.id>=id){id=l.id+1}}return id},getSocketId:function(nodes){var id=0;var _g=0;while(_g<nodes.length){var n=nodes[_g];++_g;var _g1=0;var _g11=n.inputs;while(_g1<_g11.length){var s=_g11[_g1];++_g1;if(s.id>=id){id=s.id+1}}var _g2=0;var _g3=n.outputs;while(_g2<_g3.length){var s1=_g3[_g2];++_g2;if(s1.id>=id){id=s1.id+1}}}return id},bakeElements:function(ui){ui.g.end();zui_Nodes.elementsBaked=true;zui_Nodes.socketImage=kha_Image.createRenderTarget(20,20);var g=zui_Nodes.socketImage.get_g2();g.begin(true,0);g.set_color(-16777216);kha_graphics2_GraphicsExtension.fillCircle(g,10,10,10);g.set_color(-1);kha_graphics2_GraphicsExtension.fillCircle(g,10,10,8);g.end();ui.g.begin(false)},nodeCanvas:function(ui,canvas){if(!zui_Nodes.elementsBaked){this.bakeElements(ui)}if(this.lastNodesCount>canvas.nodes.length){ui.changed=true}this.lastNodesCount=canvas.nodes.length;var wx=ui._windowX;var wy=ui._windowY;if(ui.inputDownR){this.panX+=ui.inputDX/this.SCALE;this.panY+=ui.inputDY/this.SCALE}if(ui.inputWheelDelta!=0){this.zoom+=-ui.inputWheelDelta/10;if(this.zoom<.4){this.zoom=.4}else if(this.zoom>1){this.zoom=1}this.zoom=Math.round(this.zoom*10)/10;this.uiw=ui._w;this.uih=ui._h}this.SCALE=ui.ops.scaleFactor*this.zoom;var _SCALE=ui.SCALE;ui.setScale(this.SCALE);ui.elementsBaked=true;ui.g.set_font(ui.ops.font);ui.g.set_fontSize(ui.fontSize);var _g=0;var _g1=canvas.links;while(_g<_g1.length){var link=_g1[_g];++_g;var from=this.getNode(canvas.nodes,link.from_id);var to=this.getNode(canvas.nodes,link.to_id);var fromX=from==null?ui.inputX:wx+this.NODE_X(from)+this.NODE_W();var fromY=from==null?ui.inputY:wy+this.NODE_Y(from)+this.SOCKET_Y(link.from_socket);var toX=to==null?ui.inputX:wx+this.NODE_X(to);var toY=to==null?ui.inputY:wy+this.NODE_Y(to)+this.SOCKET_Y(link.to_socket+to.outputs.length)+this.BUTTONS_H(to);if(this.linkDrag==link){if(this.snapFromId!=-1){fromX=this.snapX;fromY=this.snapY}if(this.snapToId!=-1){toX=this.snapX;toY=this.snapY}this.snapFromId=this.snapToId=-1;var _g2=0;var _g11=canvas.nodes;while(_g2<_g11.length){var node=_g11[_g2];++_g2;var inps=node.inputs;var outs=node.outputs;var nodeh=this.NODE_H(node);var rx=wx+this.NODE_X(node)-this.LINE_H()/2;var ry=wy+this.NODE_Y(node)-this.LINE_H()/2;var rw=this.NODE_W()+this.LINE_H();var rh=nodeh+this.LINE_H();if(ui.getInputInRect(rx,ry,rw,rh)){if(from==null&&node.id!=to.id){var _g3=0;var _g12=outs.length;while(_g3<_g12){var i=_g3++;var sx=wx+this.NODE_X(node)+this.NODE_W();var sy=wy+this.NODE_Y(node)+this.SOCKET_Y(i);var rx1=sx-this.LINE_H()/2;var ry1=sy-this.LINE_H()/2;if(ui.getInputInRect(rx1,ry1,this.LINE_H(),this.LINE_H())){this.snapX=sx;this.snapY=sy;this.snapFromId=node.id;this.snapSocket=i;break}}}else if(to==null&&node.id!=from.id){var _g4=0;var _g13=inps.length;while(_g4<_g13){var i1=_g4++;var sx1=wx+this.NODE_X(node);var sy1=wy+this.NODE_Y(node)+this.SOCKET_Y(i1+outs.length)+this.BUTTONS_H(node);var rx2=sx1-this.LINE_H()/2;var ry2=sy1-this.LINE_H()/2;if(ui.getInputInRect(rx2,ry2,this.LINE_H(),this.LINE_H())){this.snapX=sx1;this.snapY=sy1;this.snapToId=node.id;this.snapSocket=i1;break}}}}}}var selected=this.nodeSelected!=null&&(link.from_id==this.nodeSelected.id||link.to_id==this.nodeSelected.id);this.drawLink(ui,fromX-wx,fromY-wy,toX-wx,toY-wy,selected)}var _g21=0;var _g31=canvas.nodes;while(_g21<_g31.length){var node1=_g31[_g21];++_g21;var inps1=node1.inputs;var outs1=node1.outputs;var nodeh1=this.NODE_H(node1);if(ui.inputStarted&&ui.getInputInRect(wx+this.NODE_X(node1)-this.LINE_H()/2,wy+this.NODE_Y(node1),this.NODE_W()+this.LINE_H(),this.LINE_H())){this.nodeDrag=node1;this.nodeSelected=this.nodeDrag}if(ui.inputStarted&&ui.getInputInRect(wx+this.NODE_X(node1)-this.LINE_H()/2,wy+this.NODE_Y(node1)-this.LINE_H()/2,this.NODE_W()+this.LINE_H(),nodeh1+this.LINE_H())){var _g22=0;var _g32=outs1.length;while(_g22<_g32){var i2=_g22++;var sx2=wx+this.NODE_X(node1)+this.NODE_W();var sy2=wy+this.NODE_Y(node1)+this.SOCKET_Y(i2);if(ui.getInputInRect(sx2-this.LINE_H()/2,sy2-this.LINE_H()/2,this.LINE_H(),this.LINE_H())){var l={id:this.getLinkId(canvas.links),from_id:node1.id,from_socket:i2,to_id:-1,to_socket:-1};canvas.links.push(l);this.linkDrag=l;break}}if(this.linkDrag==null){var _g41=0;var _g5=inps1.length;while(_g41<_g5){var i3=_g41++;var sx3=wx+this.NODE_X(node1);var sy3=wy+this.NODE_Y(node1)+this.SOCKET_Y(i3+outs1.length)+this.BUTTONS_H(node1);if(ui.getInputInRect(sx3-this.LINE_H()/2,sy3-this.LINE_H()/2,this.LINE_H(),this.LINE_H())){var _g42=0;var _g51=canvas.links;while(_g42<_g51.length){var l1=_g51[_g42];++_g42;if(l1.to_id==node1.id&&l1.to_socket==i3){l1.to_id=l1.to_socket=-1;this.linkDrag=l1;break}}if(this.linkDrag!=null){break}var l2={id:this.getLinkId(canvas.links),from_id:-1,from_socket:-1,to_id:node1.id,to_socket:i3};canvas.links.push(l2);this.linkDrag=l2;break}}}}else if(ui.inputReleased){if(this.snapToId!=-1){var _g23=0;var _g33=canvas.links;while(_g23<_g33.length){var l3=_g33[_g23];++_g23;if(l3.to_id==this.snapToId&&l3.to_socket==this.snapSocket){HxOverrides.remove(canvas.links,l3);break}}this.linkDrag.to_id=this.snapToId;this.linkDrag.to_socket=this.snapSocket;ui.changed=true}else if(this.snapFromId!=-1){this.linkDrag.from_id=this.snapFromId;this.linkDrag.from_socket=this.snapSocket;ui.changed=true}else if(this.linkDrag!=null){HxOverrides.remove(canvas.links,this.linkDrag);ui.changed=true}this.snapToId=this.snapFromId=-1;this.linkDrag=null;this.nodeDrag=null}if(this.nodeDrag==node1&&!ui.inputDownR){node1.x+=Std.int(ui.inputDX/this.SCALE);node1.y+=Std.int(ui.inputDY/this.SCALE)}this.drawNode(ui,node1,canvas)}ui.setScale(_SCALE);ui.elementsBaked=true},drawNode:function(ui,node,canvas){var wx=ui._windowX;var wy=ui._windowY;var w=this.NODE_W();var g=ui.g;var h=this.NODE_H(node);var nx=this.NODE_X(node);var ny=this.NODE_Y(node);var text=node.name;var lineh=this.LINE_H();g.set_color(node==this.nodeSelected?-5592406:-14671840);g.fillRect(nx-1,ny-1,w+2,h+2);g.set_color(node.color);g.fillRect(nx,ny,w,lineh);g.set_color(-14671840);g.fillRect(nx,ny+lineh,w,h-lineh);g.set_color(-1579033);var textw=g.get_font().width(ui.fontSize,text);g.drawString(text,nx+w/2-textw/2,ny+this.p(4));ny+=lineh;var _g=0;var _g1=node.outputs;while(_g<_g1.length){var out=_g1[_g];++_g;ny+=lineh;g.set_color(out.color);g.drawScaledImage(zui_Nodes.socketImage,nx+w-this.p(5),ny-this.p(5),this.p(10),this.p(10))}ny-=lineh*node.outputs.length;g.set_color(-1579033);var _g2=0;var _g3=node.outputs;while(_g2<_g3.length){var out1=_g3[_g2];++_g2;ny+=lineh;var strw=ui.ops.font.width(ui.fontSize,out1.name);g.drawString(out1.name,nx+w-strw-this.p(12),ny-this.p(7))}var nhandle=this.handle.nest(node.id);ny-=lineh/3;var _g4=0;var _g5=node.buttons.length;while(_g4<_g5){var buti=_g4++;var but=node.buttons[buti];if(but.type=="RGBA"){ny+=lineh;ui._x=nx;ui._y=ny;ui._w=w;var val=node.outputs[but.output].default_value;nhandle.color=kha__$Color_Color_$Impl_$.fromFloats(val[0],val[1],val[2]);zui_Ext.colorWheel(ui,nhandle,false);val[0]=((nhandle.color&16711680)>>>16)*.00392156862745098;val[1]=((nhandle.color&65280)>>>8)*.00392156862745098;val[2]=(nhandle.color&255)*.00392156862745098}else if(but.type=="VECTOR"){ny+=lineh;ui._x=nx;ui._y=ny;ui._w=w;var min=but.min!=null?but.min:0;var max=but.max!=null?but.max:1;var labelCol=ui.t.LABEL_COL;var textOff=ui.t.TEXT_OFFSET;ui.t.LABEL_COL=-1;ui.t.TEXT_OFFSET=6;ui.text(but.name);var but1=but.default_value[0];but.default_value[0]=ui.slider(nhandle.nest(buti).nest(0,{value:but1}),"X",min,max,true,100,true,0);var but2=but.default_value[1];but.default_value[1]=ui.slider(nhandle.nest(buti).nest(1,{value:but2}),"Y",min,max,true,100,true,0);var but3=but.default_value[2];but.default_value[2]=ui.slider(nhandle.nest(buti).nest(2,{value:but3}),"Z",min,max,true,100,true,0);ui.t.LABEL_COL=labelCol;ui.t.TEXT_OFFSET=textOff;if(but.output!=null){node.outputs[but.output].default_value=but.default_value}ny+=lineh*3}else if(but.type=="VALUE"){ny+=lineh;ui._x=nx;ui._y=ny;ui._w=w;var soc=node.outputs[but.output];var min1=but.min!=null?but.min:0;var max1=but.max!=null?but.max:1;var labelCol1=ui.t.LABEL_COL;var textOff1=ui.t.TEXT_OFFSET;ui.t.LABEL_COL=-1;ui.t.TEXT_OFFSET=6;soc.default_value=ui.slider(nhandle.nest(0,{value:soc.default_value}),"Value",min1,max1,true,100,true,0);ui.t.LABEL_COL=labelCol1;ui.t.TEXT_OFFSET=textOff1}else if(but.type=="STRING"){ny+=lineh;ui._x=nx;ui._y=ny;ui._w=w;var soc1=but.output!=null?node.outputs[but.output]:null;but.default_value=ui.textInput(nhandle.nest(0,{text:soc1!=null?soc1.default_value:""}),but.name);if(soc1!=null){soc1.default_value=but.default_value}}else if(but.type=="ENUM"){ny+=lineh;ui._x=nx;ui._y=ny;ui._w=w;var arrayData=but.data instanceof Array&&but.data.__enum__==null;var texts=arrayData?but.data:zui_Nodes.getEnumTexts();but.default_value=ui.combo(nhandle.nest(buti,{position:but.default_value}),texts,but.name);if(!arrayData){but.data=zui_Nodes.mapEnum(texts[but.default_value])}}else if(but.type=="BOOL"){ny+=lineh;ui._x=nx;ui._y=ny;ui._w=w;ui.check(nhandle.nest(0,{selected:but.default_value}),but.name)}else if(but.type=="RAMP"){ny+=lineh;ui._x=nx;ui._y=ny;ui._w=w;var vals=but.default_value;var sw=w/this.SCALE;var _g41=0;while(_g41<vals.length){var val1=vals[_g41];++_g41;var pos=val1[4];var col=kha__$Color_Color_$Impl_$.fromFloats(val1[0],val1[1],val1[2]);ui.fill(pos*sw,0,(1-pos)*sw,lineh-2*this.SCALE,col)}ui._y+=lineh;var ihandle=nhandle.nest(2);ui.row([.25,.25,.5]);if(ui.button("+")){var last=vals[vals.length-1];vals.push([last[0],last[1],last[2],last[3],1]);ihandle.value+=1}if(ui.button("-")&&vals.length>1){vals.pop();ihandle.value-=1}but.data=ui.combo(nhandle.nest(1,{position:but.data}),["Linear","Constant"],"Interpolate");ui.row([.5,.5]);var i=Std.int(ui.slider(ihandle,"Index",0,vals.length-1,false,1,true,0));var val2=vals[i];nhandle.nest(3).value=val2[4];val2[4]=ui.slider(nhandle.nest(3),"Pos",0,1,true,100,true,0);var chandle=nhandle.nest(4);chandle.color=kha__$Color_Color_$Impl_$.fromFloats(val2[0],val2[1],val2[2]);zui_Ext.colorWheel(ui,chandle,false);val2[0]=((chandle.color&16711680)>>>16)*.00392156862745098;val2[1]=((chandle.color&65280)>>>8)*.00392156862745098;val2[2]=(chandle.color&255)*.00392156862745098;ny+=lineh*8+lineh*.5}else if(but.type=="CURVES"){ny+=lineh;ui._x=nx;ui._y=ny;ui._w=w;ui.row([.3333333333333333,.3333333333333333,.3333333333333333]);ui.radio(nhandle.nest(1),0,"X");ui.radio(nhandle.nest(1),1,"Y");ui.radio(nhandle.nest(1),2,"Z");var axis=nhandle.nest(1).position;var val3=but.default_value[axis];var num=Std.int(val3.length/2);ui._y+=lineh*5;ui.row([.2,.2,.6]);if(ui.button("+")){val3.push(0);val3.push(0)}if(ui.button("-")){if(val3.length>4){val3.pop();val3.pop()}}var i1=Std.int(ui.slider(nhandle.nest(2).nest(axis,{position:0}),"Index",0,num-1,false,1,true,0));ui.row([.5,.5]);nhandle.nest(3).value=val3[i1*2];nhandle.nest(4).value=val3[i1*2+1];val3[i1*2]=ui.slider(nhandle.nest(3,{value:0}),"X",-1,1,true,100,true,0);val3[i1*2+1]=ui.slider(nhandle.nest(4,{value:0}),"Y",-1,1,true,100,true,0);ny+=lineh*7}}ny+=lineh/3;var _g6=0;var _g7=node.inputs.length;while(_g6<_g7){var i2=_g6++;var inp=node.inputs[i2];ny+=lineh;g.set_color(inp.color);g.drawScaledImage(zui_Nodes.socketImage,nx-this.p(5),ny-this.p(5),this.p(10),this.p(10));var isLinked=false;var _g61=0;var _g71=canvas.links;while(_g61<_g71.length){var l=_g71[_g61];++_g61;if(l.to_id==node.id&&l.to_socket==i2){isLinked=true;break}}if(!isLinked&&inp.type=="VALUE"){ui._x=nx+this.p(6);ui._y=ny-this.p(9);ui._w=Std.int(w-this.p(6));var soc2=inp;var min2=soc2.min!=null?soc2.min:0;var max2=soc2.max!=null?soc2.max:1;var labelCol2=ui.t.LABEL_COL;var textOff2=ui.t.TEXT_OFFSET;ui.t.LABEL_COL=-1;ui.t.TEXT_OFFSET=6;soc2.default_value=ui.slider(nhandle.nest(i2,{value:soc2.default_value}),inp.name,min2,max2,true,100,true,0);ui.t.LABEL_COL=labelCol2;ui.t.TEXT_OFFSET=textOff2}else{g.set_color(-1579033);g.drawString(inp.name,nx+this.p(12),ny-this.p(7))}}},drawLink:function(ui,x1,y1,x2,y2,highlight){if(highlight==null){highlight=false}var g=ui.g;g.set_color(highlight?-861033043:-864585865);g.drawLine(x1,y1,x2,y2,1);g.set_color(highlight?-1716671059:-1720223881);g.drawLine(x1+.5,y1,x2+.5,y2,1);g.drawLine(x1-.5,y1,x2-.5,y2,1);g.drawLine(x1,y1+.5,x2,y2+.5,1);g.drawLine(x1,y1-.5,x2,y2-.5,1)},removeNode:function(n,canvas){if(n==null){return}var i=0;while(i<canvas.links.length){var l=canvas.links[i];if(l.from_id==n.id||l.to_id==n.id){canvas.links.splice(i,1)}else{++i}}HxOverrides.remove(canvas.nodes,n)},__class__:zui_Nodes};var zui_Themes=function(){};$hxClasses["zui.Themes"]=zui_Themes;zui_Themes.__name__=true;var zui_Zui=function(ops){this.restoreY=-1;this.restoreX=-1;this.checkSelectImage=null;this.elementsBaked=false;this.tabScroll=0;this.tabHandle=null;this.tabNames=null;this.tooltipTime=0;this.tooltipShown=false;this.tooltipY=0;this.tooltipX=0;this.tooltipInvertY=false;this.tooltipImg=null;this.tooltipText="";this.comboToSubmit=0;this.submitComboHandle=null;this.comboSelectedWindow=null;this.comboSelectedHandle=null;this.tabPressedHandle=null;this.tabPressed=false;this.textToSubmit="";this.submitTextHandle=null;this.textSelectedHandle=null;this.windowHeader=0;this.scrollingHandle=null;this.windowEnded=true;this.imageScrollAlign=true;this.scrollAlign=0;this.curRatio=-1;this.highlightAnchor=0;this.cursorY=0;this.cursorX=0;this.key=null;this.isAltDown=false;this.isCtrlDown=false;this.isShiftDown=false;this.isKeyDown=false;this.inputWheelDelta=0;this.inputEnabled=true;this.inputRegistered=false;this.scrollEnabled=true;this.imageInvertY=false;this.alwaysRedraw=false;this.changed=false;this.isReleased=false;this.isHovered=false;this.isPushed=false;this.isStarted=false;this.isTyping=false;this.isScrolling=false;if(ops.theme==null){ops.theme=zui_Themes.dark}this.t=ops.theme;if(ops.khaWindowId==null){ops.khaWindowId=0}if(ops.scaleFactor==null){ops.scaleFactor=1}if(ops.scaleTexture==null){ops.scaleTexture=1}if(ops.autoNotifyInput==null){ops.autoNotifyInput=true}this.ops=ops;this.setScale(ops.scaleFactor);if(ops.autoNotifyInput){this.registerInput()}this.bakeElements()};$hxClasses["zui.Zui"]=zui_Zui;zui_Zui.__name__=true;zui_Zui.prototype={setScale:function(factor){this.ops.scaleFactor=factor;this.SCALE=this.ops.scaleFactor*this.ops.scaleTexture;this.fontSize=Std.int(this.t.FONT_SIZE*this.ops.scaleFactor);var fontHeight=this.ops.font.height(this.fontSize);this.fontOffsetY=(this.ELEMENT_H()-fontHeight)/2;this.arrowOffsetY=(this.ELEMENT_H()-this.ARROW_SIZE())/2;this.arrowOffsetX=this.arrowOffsetY;this.titleOffsetX=(this.arrowOffsetX*2+this.ARROW_SIZE())/this.SCALE;this.buttonOffsetY=(this.ELEMENT_H()-this.BUTTON_H())/2;this.checkOffsetY=(this.ELEMENT_H()-this.CHECK_SIZE())/2;this.checkOffsetX=this.checkOffsetY;this.checkSelectOffsetY=(this.CHECK_SIZE()-this.CHECK_SELECT_SIZE())/2;this.checkSelectOffsetX=this.checkSelectOffsetY;this.radioOffsetY=(this.ELEMENT_H()-this.CHECK_SIZE())/2;this.radioOffsetX=this.radioOffsetY;this.radioSelectOffsetY=(this.CHECK_SIZE()-this.CHECK_SELECT_SIZE())/2;this.radioSelectOffsetX=this.radioSelectOffsetY;this.elementsBaked=false},bakeElements:function(){if(this.checkSelectImage!=null){this.checkSelectImage.unload()}this.checkSelectImage=kha_Image.createRenderTarget(Std.int(this.CHECK_SELECT_SIZE()),Std.int(this.CHECK_SELECT_SIZE()),null,0,1,this.ops.khaWindowId);var g=this.checkSelectImage.get_g2();g.begin(true,0);g.set_color(this.t.ACCENT_SELECT_COL);g.drawLine(0,0,this.checkSelectImage.get_width(),this.checkSelectImage.get_height(),2*this.SCALE);g.drawLine(this.checkSelectImage.get_width(),0,0,this.checkSelectImage.get_height(),2*this.SCALE);g.end();this.elementsBaked=true},registerInput:function(){kha_input_Mouse.get().notifyWindowed(this.ops.khaWindowId,$bind(this,this.onMouseDown),$bind(this,this.onMouseUp),$bind(this,this.onMouseMove),$bind(this,this.onMouseWheel));kha_input_Keyboard.get().notify($bind(this,this.onKeyDown),$bind(this,this.onKeyUp),$bind(this,this.onKeyPress));kha_System.notifyOnCutCopyPaste($bind(this,this.onCut),$bind(this,this.onCopy),$bind(this,this.onPaste));this.inputRegistered=true},begin:function(g){if(!this.elementsBaked){this.bakeElements()}this.changed=false;this.globalG=g;this._x=0;this._y=0;this._w=0;this._h=0},end:function(last){if(last==null){last=true}if(!this.windowEnded){this.endWindow()}if(this.comboSelectedHandle!=null){this.drawCombo()}if(last){this.endInput()}if(this.tabPressedHandle!=null){this.tabPressedHandle=null}},endInput:function(){this.isKeyDown=false;this.inputStarted=false;this.inputStartedR=false;this.inputReleased=false;this.inputReleasedR=false;this.inputDX=0;this.inputDY=0;this.inputWheelDelta=0;zui_Zui.textToPaste="";zui_Zui.isCut=false},beginLayout:function(g,x,y,w){if(!this.elementsBaked){this.bakeElements()}this.currentWindow=null;this.g=g;this._windowX=0;this._windowY=0;this._windowW=w;this._x=x;this._y=y;this._w=w},endLayout:function(last){if(last==null){last=true}if(last){this.endInput()}},inputChanged:function(){if(!(this.inputDX!=0||this.inputDY!=0||this.inputWheelDelta!=0||this.inputStarted||this.inputStartedR||this.inputReleased||this.inputReleasedR||this.inputDown||this.inputDownR)){return this.isKeyDown}else{return true}},windowDirty:function(handle,x,y,w,h){var wx=x+handle.dragX;var wy=y+handle.dragY;var inputChanged=this.getInputInRect(wx,wy,w,h)&&this.inputChanged();if(!(this.alwaysRedraw||this.isScrolling||this.isTyping)){return inputChanged}else{return true}},window:function(handle,x,y,w,h,drag){if(drag==null){drag=false}if(handle.texture==null||w!=handle.texture.get_width()||h!=handle.texture.get_height()){this.resize(handle,w,h,this.ops.khaWindowId)}if(!this.windowEnded){this.endWindow()}this.windowEnded=false;this.g=handle.texture.get_g2();this.currentWindow=handle;this._windowX=x+handle.dragX;this._windowY=y+handle.dragY;this._windowW=w;this._windowH=h;this.windowHeader=0;if(this.windowDirty(handle,x,y,w,h)){handle.redraws=2}if(handle.redraws==0){return false}this._x=0;this._y=handle.scrollOffset;if(handle.layout==1){w=Std.int(this.ELEMENT_W())}this._w=!handle.scrollEnabled?w:w-this.SCROLL_W();this._h=h;this.tooltipText="";this.tooltipImg=null;this.tabNames=null;if(this.t.FILL_WINDOW_BG){this.g.begin(true,this.t.WINDOW_BG_COL)}else{this.g.begin(true,0);this.g.set_color(this.t.WINDOW_BG_COL);this.g.fillRect(this._x,this._y-handle.scrollOffset,handle.lastMaxX,handle.lastMaxY)}handle.dragEnabled=drag;if(drag){if(this.inputStarted&&this.getInputInRect(this._windowX,this._windowY,this._windowW,15)){handle.dragging=true}else if(this.inputReleased){handle.dragging=false}if(handle.dragging){handle.redraws=2;handle.dragX+=Std.int(this.inputDX);handle.dragY+=Std.int(this.inputDY)}this._y+=15;this.windowHeader+=15}return true},endWindow:function(bindGlobalG){if(bindGlobalG==null){bindGlobalG=true}var handle=this.currentWindow;if(handle==null){return}if(handle.redraws>0||this.isScrolling||this.isTyping){if(this.tabNames!=null){this.drawTabs()}if(handle.dragEnabled){this.g.set_color(this.t.SEPARATOR_COL);this.g.fillRect(0,0,this._windowW,15)}var fullHeight=this._y-handle.scrollOffset;if(fullHeight<this._windowH||handle.layout==1||!this.scrollEnabled){handle.scrollEnabled=false;handle.scrollOffset=0}else{handle.scrollEnabled=true;if(this.tabScroll<0){handle.scrollOffset=this.tabScroll;this.tabScroll=0}var amountToScroll=fullHeight-this._windowH;var amountScrolled=-handle.scrollOffset;var ratio=amountScrolled/amountToScroll;var barH=this._windowH*Math.abs(this._windowH/fullHeight);barH=Math.max(barH,this.ELEMENT_H());var totalScrollableArea=this._windowH-barH;var e=amountToScroll/totalScrollableArea;var barY=totalScrollableArea*ratio;if(this.inputStarted&&this.getInputInRect(this._windowX+this._windowW-this.SCROLL_W(),barY+this._windowY,this.SCROLL_W(),barH)){handle.scrolling=true;this.scrollingHandle=handle;this.isScrolling=true}if(handle.scrolling){this.scroll(this.inputDY*e,fullHeight)}else if(this.inputWheelDelta!=0){this.scroll(this.inputWheelDelta*this.ELEMENT_H(),fullHeight)}if(handle.scrollOffset>0){handle.scrollOffset=0}else if(fullHeight+handle.scrollOffset<this._windowH){handle.scrollOffset=this._windowH-fullHeight}this.g.set_color(this.t.WINDOW_BG_COL);this.g.fillRect(this._windowW-this.SCROLL_W(),this._windowY,this.SCROLL_W(),this._windowH);this.g.set_color(this.t.ACCENT_COL);this.g.fillRect(this._windowW-this.SCROLL_W()-this.scrollAlign,barY,this.SCROLL_W(),barH)}handle.lastMaxX=this._x;handle.lastMaxY=this._y;if(handle.layout==0){handle.lastMaxX+=this._windowW}else{handle.lastMaxY+=this._windowH}handle.redraws--;this.g.end()}this.windowEnded=true;if(bindGlobalG){this.globalG.begin(false)}this.globalG.set_color(this.t.WINDOW_TINT_COL);this.globalG.drawScaledImage(handle.texture,this._windowX,this._windowY,handle.texture.get_width()/this.ops.scaleTexture,handle.texture.get_height()/this.ops.scaleTexture);if(this.tooltipText!=""||this.tooltipImg!=null){if(!this.tooltipShown){this.tooltipShown=true;this.tooltipX=this.inputX;this.tooltipTime=kha_Scheduler.time()}if(kha_Scheduler.time()-this.tooltipTime>this.t.TOOLTIP_DELAY){if(this.tooltipText!=""){this.drawTooltip()}else{this.drawTooltipImage()}}}else{this.tooltipShown=false}if(bindGlobalG){this.globalG.end()}},scroll:function(delta,fullHeight){this.currentWindow.scrollOffset-=delta},drawTabs:function(){this.inputX=this.restoreX;this.inputY=this.restoreY;if(this.currentWindow==null){return}var tabX=0;var origy=this._y;this._y=this.currentWindow.dragEnabled?15:0;this.g.set_color(this.t.WINDOW_BG_COL);this.g.fillRect(0,this._y,this._windowW,this.buttonOffsetY+this.BUTTON_H());this.g.set_color(this.t.ACCENT_COL);this.g.fillRect(this.buttonOffsetY,this._y+this.buttonOffsetY+this.BUTTON_H(),this._windowW-this.buttonOffsetY*2,this.LINE_STRENGTH());var _g=0;var _g1=this.tabNames.length;while(_g<_g1){var i=_g++;this._x=tabX;this._w=Std.int(this.ops.font.width(this.fontSize,this.tabNames[i])+this.buttonOffsetY*2+14*this.SCALE);var released=this.getReleased();var pushed=this.getPushed();var hover=this.getHover();if(released){var h=this.tabHandle.nest(this.tabHandle.position);h.scrollOffset=this.currentWindow.scrollOffset;h=this.tabHandle.nest(i);this.tabScroll=h.scrollOffset;this.tabHandle.position=i;this.currentWindow.redraws=3}var selected=this.tabHandle.position==i;this.g.set_color(pushed?this.t.ACCENT_HOVER_COL:hover?this.t.ACCENT_HOVER_COL:this.t.ACCENT_COL);tabX+=this._w+5;this.drawRect(this.g,!selected,this._x+this.buttonOffsetY,this._y+this.buttonOffsetY,this._w,this.BUTTON_H());this.g.set_color(this.t.BUTTON_TEXT_COL);this.drawString(this.g,this.tabNames[i],this.TEXT_OFFSET(),0,0);if(selected){this.g.set_color(this.t.WINDOW_BG_COL);this.g.fillRect(this._x+this.buttonOffsetY+1,this._y+this.buttonOffsetY+this.BUTTON_H(),this._w-1,this.LINE_STRENGTH())}}this._x=0;this._y=origy;this._w=Std.int(!this.currentWindow.scrollEnabled?this._windowW:this._windowW-this.SCROLL_W())},image:function(image,tint,h){if(tint==null){tint=-1}var iw=image.get_width()*this.SCALE;var ih=image.get_height()*this.SCALE;var w=Math.min(iw,this._w);var x=this._x;if(this.imageScrollAlign){w=Math.min(iw,this._w-this.buttonOffsetY*2);x+=this.buttonOffsetY;var scroll=this.currentWindow!=null&&this.currentWindow.scrollEnabled;if(!scroll){var r=this.curRatio==-1?1:this.ratios[this.curRatio];w-=this.SCROLL_W()*r;x+=this.SCROLL_W()*r/2}}var ratio=h==null?w/iw:h/ih;if(h==null){h=ih*ratio}else{w=iw*ratio}if(!this.isVisible(h)){this.endElement(h);return 0}var started=this.getStarted(h);var down=this.getPushed(h);var released=this.getReleased(h);var hover=this.getHover();this.g.set_color(tint);var h_float=h;if(this.imageInvertY){this.g.drawScaledImage(image,x,this._y+h_float,w,-h_float)}else{this.g.drawScaledImage(image,x,this._y,w,h_float)}this.endElement(h);if(started){return 1}else if(released){return 3}else if(down){return 2}else{return 0}},text:function(text,align,bg){if(bg==null){bg=0}if(align==null){align=0}if(!this.isVisible(this.ELEMENT_H())){this.endElement();return}this.getReleased();if(bg!=0){this.g.set_color(bg);this.g.fillRect(this._x+this.buttonOffsetY,this._y+this.buttonOffsetY,this._w-this.buttonOffsetY*2,this.BUTTON_H())}this.g.set_color(this.t.TEXT_COL);this.drawString(this.g,text,this.TEXT_OFFSET(),0,align);this.endElement()},startTextEdit:function(handle){this.isTyping=true;this.submitTextHandle=this.textSelectedHandle;this.textToSubmit=this.textSelectedCurrentText;this.textSelectedHandle=handle;this.textSelectedCurrentText=handle.text;this.tabPressed=false;this.tabPressedHandle=handle;this.cursorX=handle.text.length;this.cursorY=0;this.highlightAnchor=0;if(kha_input_Keyboard.get()!=null){kha_input_Keyboard.get().show()}},submitTextEdit:function(){this.submitTextHandle.text=this.textToSubmit;this.submitTextHandle.changed=this.changed=true;this.submitTextHandle=null;this.textToSubmit="";this.textSelectedCurrentText=""},updateTextEdit:function(align){if(align==null){align=0}var text=this.textSelectedCurrentText;if(this.isKeyDown){if(this.key==37){if(this.cursorX>0){this.cursorX--}}else if(this.key==39){if(this.cursorX<text.length){this.cursorX++}}else if(this.key==8){if(this.cursorX>0&&this.highlightAnchor==this.cursorX){text=HxOverrides.substr(text,0,this.cursorX-1)+HxOverrides.substr(text,this.cursorX,text.length);this.cursorX--}else if(this.highlightAnchor<this.cursorX){text=HxOverrides.substr(text,0,this.highlightAnchor)+HxOverrides.substr(text,this.cursorX,text.length);this.cursorX=this.highlightAnchor}else{text=HxOverrides.substr(text,0,this.cursorX)+HxOverrides.substr(text,this.highlightAnchor,text.length)}}else if(this.key==46){if(this.highlightAnchor==this.cursorX){text=HxOverrides.substr(text,0,this.cursorX)+HxOverrides.substr(text,this.cursorX+1,null)}else if(this.highlightAnchor<this.cursorX){text=HxOverrides.substr(text,0,this.highlightAnchor)+HxOverrides.substr(text,this.cursorX,text.length);this.cursorX=this.highlightAnchor}else{text=HxOverrides.substr(text,0,this.cursorX)+HxOverrides.substr(text,this.highlightAnchor,text.length)}}else if(this.key==13){this.deselectText()}else if(this.key==27){this.textSelectedCurrentText=this.textSelectedHandle.text;this.deselectText()}else if(this.key==9){this.tabPressed=true;this.deselectText();this.key=null}else if(this.key==36){this.cursorX=0}else if(this.key==35){this.cursorX=text.length}else if(this.key!=16&&this.key!=20&&this.key!=17&&this.key!=18){if(this.char!=null&&this.char!=""&&HxOverrides.cca(this.char,0)>=32&&HxOverrides.cca(this.char,0)!=127){text=HxOverrides.substr(text,0,this.highlightAnchor)+this.char+HxOverrides.substr(text,this.cursorX,null);this.cursorX++}}var selecting=this.isShiftDown&&(this.key==37||this.key==39);if(!selecting&&!this.isCtrlDown){this.highlightAnchor=this.cursorX}}if(zui_Zui.textToPaste!=""){text=HxOverrides.substr(text,0,this.highlightAnchor)+zui_Zui.textToPaste+HxOverrides.substr(text,this.cursorX,null);this.cursorX+=zui_Zui.textToPaste.length;this.highlightAnchor=this.cursorX;zui_Zui.textToPaste=""}if(this.highlightAnchor==this.cursorX){zui_Zui.textToCopy=text}else if(this.highlightAnchor<this.cursorX){zui_Zui.textToCopy=text.substring(this.highlightAnchor,this.cursorX)}else{zui_Zui.textToCopy=text.substring(this.cursorX,this.highlightAnchor)}if(zui_Zui.isCut){if(this.highlightAnchor==this.cursorX){text=""}else if(this.highlightAnchor<this.cursorX){text=HxOverrides.substr(text,0,this.highlightAnchor)+HxOverrides.substr(text,this.cursorX,text.length);this.cursorX=this.highlightAnchor}else{text=HxOverrides.substr(text,0,this.cursorX)+HxOverrides.substr(text,this.highlightAnchor,text.length)}}var off=this.TEXT_OFFSET();var lineHeight=this.ELEMENT_H();var cursorHeight=lineHeight-this.buttonOffsetY*3;if(this.highlightAnchor!=this.cursorX){var istart=this.cursorX;var iend=this.highlightAnchor;if(this.highlightAnchor<this.cursorX){istart=this.highlightAnchor;iend=this.cursorX}var hlstr=HxOverrides.substr(text,istart,iend-istart);var hlstrw=this.g.get_font().width(this.g.get_fontSize(),hlstr);var startoff=this.g.get_font().width(this.g.get_fontSize(),HxOverrides.substr(text,0,istart));var hlStart=align==0?this._x+startoff+off:this._x+this._w-hlstrw-off;if(align==2){hlStart-=this.g.get_font().width(this.g.get_fontSize(),HxOverrides.substr(text,iend,text.length))}this.g.fillRect(hlStart,this._y+this.cursorY*lineHeight+this.buttonOffsetY*1.5,hlstrw*this.SCALE,cursorHeight)}var time=kha_Scheduler.time();if(time%(this.t.FLASH_SPEED*2)<this.t.FLASH_SPEED){this.g.set_color(this.t.TEXT_COL);var str=align==0?HxOverrides.substr(text,0,this.cursorX):text.substring(this.cursorX,text.length);var strw=this.g.get_font().width(this.g.get_fontSize(),str);var cursorX=align==0?this._x+strw+off:this._x+this._w-strw-off;this.g.fillRect(cursorX,this._y+this.cursorY*lineHeight+this.buttonOffsetY*1.5,this.SCALE,cursorHeight)}this.textSelectedCurrentText=text},textInput:function(handle,label,align){if(align==null){align=0}if(label==null){label=""}if(!this.isVisible(this.ELEMENT_H())){this.endElement();return handle.text}var hover=this.getHover();this.g.set_color(hover?this.t.ACCENT_HOVER_COL:this.t.ACCENT_COL);this.drawRect(this.g,this.t.FILL_ACCENT_BG,this._x+this.buttonOffsetY,this._y+this.buttonOffsetY,this._w-this.buttonOffsetY*2,this.BUTTON_H());var startEdit=this.getReleased()||this.tabPressed;if(this.textSelectedHandle!=handle&&startEdit){this.startTextEdit(handle)}if(this.textSelectedHandle==handle){this.updateTextEdit(align)}if(this.submitTextHandle==handle){this.submitTextEdit()}else{handle.changed=false}if(label!=""){this.g.set_color(this.t.LABEL_COL);var labelAlign=align==2?0:2;var xOffset=labelAlign==0?7:0;this.drawString(this.g,label,xOffset,0,labelAlign)}this.g.set_color(this.t.TEXT_COL);if(this.textSelectedHandle!=handle){this.drawString(this.g,handle.text,null,0,align)}else{this.drawString(this.g,this.textSelectedCurrentText,null,0,align)}this.endElement();return handle.text},deselectText:function(){this.submitTextHandle=this.textSelectedHandle;this.textToSubmit=this.textSelectedCurrentText;this.textSelectedHandle=null;this.isTyping=false;if(this.currentWindow!=null){this.currentWindow.redraws=2}if(kha_input_Keyboard.get()!=null){kha_input_Keyboard.get().hide()}this.highlightAnchor=this.cursorX},button:function(text,align){if(align==null){align=1}if(!this.isVisible(this.ELEMENT_H())){this.endElement();return false}var released=this.getReleased();var pushed=this.getPushed();var hover=this.getHover();this.g.set_color(pushed?this.t.BUTTON_PRESSED_COL:hover?this.t.BUTTON_HOVER_COL:this.t.BUTTON_COL);this.drawRect(this.g,this.t.FILL_BUTTON_BG,this._x+this.buttonOffsetY,this._y+this.buttonOffsetY,this._w-this.buttonOffsetY*2,this.BUTTON_H());this.g.set_color(this.t.BUTTON_TEXT_COL);this.drawString(this.g,text,this.TEXT_OFFSET(),0,align);this.endElement();return released},check:function(handle,text){if(!this.isVisible(this.ELEMENT_H())){this.endElement();return handle.selected}if(this.getReleased()){handle.selected=!handle.selected;handle.changed=this.changed=true}else{handle.changed=false}var hover=this.getHover();this.drawCheck(handle.selected,hover);this.g.set_color(this.t.TEXT_COL);this.drawString(this.g,text,this.titleOffsetX,0,0);this.endElement();return handle.selected},radio:function(handle,position,text){if(!this.isVisible(this.ELEMENT_H())){this.endElement();return handle.position==position}if(this.getReleased()){handle.position=position;handle.changed=this.changed=true}else{handle.changed=false}var hover=this.getHover();this.drawRadio(handle.position==position,hover);this.g.set_color(this.t.TEXT_COL);this.drawString(this.g,text,this.titleOffsetX,0);this.endElement();return handle.position==position},inlineRadio:function(handle,texts){if(!this.isVisible(this.ELEMENT_H())){this.endElement();return handle.position}if(this.getReleased()){if(++handle.position>=texts.length){handle.position=0}handle.changed=this.changed=true}else{handle.changed=false}var hover=this.getHover();this.drawInlineRadio(texts[handle.position],hover);this.endElement();return handle.position},combo:function(handle,texts,label,showLabel,align){if(align==null){align=0}if(showLabel==null){showLabel=false}if(label==null){label=""}if(!this.isVisible(this.ELEMENT_H())){this.endElement();return handle.position}if(this.getReleased()){if(this.comboSelectedHandle==null){this.inputEnabled=false;this.comboSelectedHandle=handle;this.comboSelectedWindow=this.currentWindow;this.comboSelectedAlign=align;this.comboSelectedTexts=texts;this.comboSelectedLabel=label;this.comboSelectedX=Std.int(this._x+this._windowX);this.comboSelectedY=Std.int(this._y+this._windowY+this.ELEMENT_H()+this.ELEMENT_OFFSET());this.comboSelectedW=Std.int(this._w)}}if(handle==this.submitComboHandle){handle.position=this.comboToSubmit;this.submitComboHandle=null;handle.changed=this.changed=true}else{handle.changed=false}var hover=this.getHover();if(hover){this.g.set_color(this.t.ACCENT_HOVER_COL);this.drawRect(this.g,this.t.FILL_ACCENT_BG,this._x+this.buttonOffsetY,this._y+this.buttonOffsetY,this._w-this.buttonOffsetY*2,this.BUTTON_H())}else{this.g.set_color(this.t.ACCENT_COL);this.drawRect(this.g,this.t.FILL_ACCENT_BG,this._x+this.buttonOffsetY,this._y+this.buttonOffsetY,this._w-this.buttonOffsetY*2,this.BUTTON_H())}var x=this._x+this._w-this.arrowOffsetX-8;var y=this._y+this.arrowOffsetY+3;this.g.fillTriangle(x,y,x+this.ARROW_SIZE(),y,x+this.ARROW_SIZE()/2,y+this.ARROW_SIZE()/2);this.g.set_color(this.t.TEXT_COL);if(showLabel&&label!=""){if(align==0){this._x-=15}this.drawString(this.g,label,null,0,align==0?2:0);if(align==0){this._x+=15}}if(align==2){this._x-=15}this.drawString(this.g,texts[handle.position],null,0,align);if(align==2){this._x+=15}this.endElement();return handle.position},slider:function(handle,text,from,to,filled,precision,displayValue,align,textEdit){if(textEdit==null){textEdit=true}if(align==null){align=2}if(displayValue==null){displayValue=true}if(precision==null){precision=100}if(filled==null){filled=false}if(to==null){to=1}if(from==null){from=0}if(!this.isVisible(this.ELEMENT_H())){this.endElement();return handle.value}if(this.getStarted()){handle.scrolling=true;this.scrollingHandle=handle;this.isScrolling=true}handle.changed=false;if(handle.scrolling){var range=to-from;var sliderX=this._x+this._windowX+this.buttonOffsetY;var sliderW=this._w-this.buttonOffsetY*2;var step=range/sliderW;var value=from+(this.inputX-sliderX)*step;handle.value=Math.round(value*precision)/precision;if(handle.value<from){handle.value=from}else if(handle.value>to){handle.value=to}handle.changed=this.changed=true}var hover=this.getHover();this.drawSlider(handle.value,from,to,filled,hover);var startEdit=(this.getReleased()||this.tabPressed)&&textEdit;if(startEdit){handle.text=handle.value+"";this.startTextEdit(handle)}var lalign=align==0?2:0;if(this.textSelectedHandle==handle){this.updateTextEdit(lalign)}if(this.submitTextHandle==handle){this.submitTextEdit();handle.value=Std.parseFloat(handle.text)}this.g.set_color(this.t.LABEL_COL);this.drawString(this.g,text,null,0,align);if(displayValue){this.g.set_color(this.t.TEXT_COL);if(this.textSelectedHandle!=handle){this.drawString(this.g,handle.value+"",null,0,lalign)}else{this.drawString(this.g,this.textSelectedCurrentText,null,0,lalign)}}this.endElement();return handle.value},drawCheck:function(selected,hover){var x=this._x+this.checkOffsetX;var y=this._y+this.checkOffsetY;this.g.set_color(hover?this.t.ACCENT_HOVER_COL:this.t.ACCENT_COL);this.drawRect(this.g,this.t.FILL_ACCENT_BG,x,y,this.CHECK_SIZE(),this.CHECK_SIZE());if(selected){this.g.set_color(-1);this.g.drawImage(this.checkSelectImage,x+this.checkSelectOffsetX,y+this.checkSelectOffsetY)}},drawRadio:function(selected,hover){var x=this._x+this.radioOffsetX;var y=this._y+this.radioOffsetY;this.g.set_color(hover?this.t.ACCENT_HOVER_COL:this.t.ACCENT_COL);this.drawRect(this.g,this.t.FILL_ACCENT_BG,x,y,this.CHECK_SIZE(),this.CHECK_SIZE());if(selected){this.g.set_color(this.t.ACCENT_SELECT_COL);this.g.fillRect(x+this.radioSelectOffsetX,y+this.radioSelectOffsetY,this.CHECK_SELECT_SIZE(),this.CHECK_SELECT_SIZE())}},drawInlineRadio:function(text,hover){if(hover){this.g.set_color(this.t.ACCENT_HOVER_COL);this.g.fillRect(this._x+this.buttonOffsetY,this._y+this.buttonOffsetY,this._w-this.buttonOffsetY*2,this.BUTTON_H())}else{this.g.set_color(this.t.ACCENT_COL);this.g.drawRect(this._x+this.buttonOffsetY,this._y+this.buttonOffsetY,this._w-this.buttonOffsetY*2,this.BUTTON_H())}this.g.set_color(this.t.TEXT_COL);this.drawString(this.g,text,this.titleOffsetX,0,1)},drawSlider:function(value,from,to,filled,hover){var x=this._x+this.buttonOffsetY;var y=this._y+this.buttonOffsetY;var w=this._w-this.buttonOffsetY*2;this.g.set_color(hover?this.t.ACCENT_HOVER_COL:this.t.ACCENT_COL);this.drawRect(this.g,this.t.FILL_ACCENT_BG,x,y,w,this.BUTTON_H());this.g.set_color(hover?this.t.ACCENT_HOVER_COL:this.t.ACCENT_COL);var offset=(value-from)/(to-from);var barW=8*this.SCALE;var sliderX=filled?x:x+(w-barW)*offset;var sliderW=filled?w*offset:barW;sliderW=Math.min(sliderW,w);this.g.fillRect(sliderX,y,sliderW,this.BUTTON_H())},drawCombo:function(){var _g=this.g;this.globalG.set_color(-14540254);var elementSize=this.ELEMENT_H()+this.ELEMENT_OFFSET();this.globalG.begin(false);this.globalG.fillRect(this.comboSelectedX,this.comboSelectedY,this.comboSelectedW,(this.comboSelectedTexts.length+1)*elementSize);this.beginLayout(this.globalG,this.comboSelectedX,this.comboSelectedY,this.comboSelectedW);this.inputEnabled=true;var _g1=0;var _g11=this.comboSelectedTexts.length;while(_g1<_g11){var i=_g1++;if(this.button(this.comboSelectedTexts[i],this.comboSelectedAlign)){this.comboToSubmit=i;this.submitComboHandle=this.comboSelectedHandle;if(this.comboSelectedWindow!=null){this.comboSelectedWindow.redraws=2}break}}this.text(this.comboSelectedLabel);if(this.inputReleased&&!zui_Zui.comboFirst){this.comboSelectedHandle=null;zui_Zui.comboFirst=true}else{zui_Zui.comboFirst=false}this.inputEnabled=this.comboSelectedHandle==null;this.endLayout(false);this.globalG.end();this.g=_g},drawTooltip:function(){this.globalG.set_color(this.t.TEXT_COL);var lines=this.tooltipText.split("\n");var tooltipW=0;var _g=0;while(_g<lines.length){var line=lines[_g];++_g;var lineTooltipW=this.ops.font.width(this.fontSize,line);if(lineTooltipW>tooltipW){tooltipW=lineTooltipW}}this.tooltipX=Math.min(this.tooltipX,kha_System.windowWidth()-tooltipW-20);this.globalG.fillRect(this.tooltipX,this.tooltipY,tooltipW+20,this.ELEMENT_H()*lines.length*.6);this.globalG.set_font(this.ops.font);this.globalG.set_fontSize(this.fontSize);this.globalG.set_color(this.t.ACCENT_COL);var _g1=0;var _g2=lines.length;while(_g1<_g2){var i=_g1++;this.globalG.drawString(lines[i],this.tooltipX+5,this.tooltipY+i*this.fontSize)}},drawTooltipImage:function(){this.tooltipX=Math.min(this.tooltipX,kha_System.windowWidth()-this.tooltipImg.get_width()-20);this.globalG.set_color(-16777216);this.globalG.fillRect(this.tooltipX,this.tooltipY,this.tooltipImg.get_width(),this.tooltipImg.get_height());this.globalG.set_color(-1);if(this.tooltipInvertY){this.globalG.drawScaledImage(this.tooltipImg,this.tooltipX,this.tooltipY+this.tooltipImg.get_height(),this.tooltipImg.get_width(),-this.tooltipImg.get_height())}else{this.globalG.drawImage(this.tooltipImg,this.tooltipX,this.tooltipY)}},drawString:function(g,text,xOffset,yOffset,align){if(align==null){align=0}if(yOffset==null){yOffset=0}var maxChars=Std.int(this._w/Std.int(this.fontSize/2));if(text.length>maxChars){text=text.substring(0,maxChars)+".."}if(xOffset==null){xOffset=this.t.TEXT_OFFSET}xOffset*=this.SCALE;g.set_font(this.ops.font);g.set_fontSize(this.fontSize);if(align==1){xOffset=this._w/2-this.ops.font.width(this.fontSize,text)/2}else if(align==2){xOffset=this._w-this.ops.font.width(this.fontSize,text)-this.TEXT_OFFSET()}g.drawString(text,this._x+xOffset,this._y+this.fontOffsetY+yOffset)},endElement:function(elementSize){if(this.currentWindow==null){this._y+=this.ELEMENT_H()+this.ELEMENT_OFFSET();return}if(this.currentWindow.layout==0){if(this.curRatio==-1||this.ratios!=null&&this.curRatio==this.ratios.length-1){if(elementSize==null){elementSize=this.ELEMENT_H()+this.ELEMENT_OFFSET()}this._y+=elementSize;if(this.ratios!=null&&this.curRatio==this.ratios.length-1){this.curRatio=-1;this.ratios=null;this._x=this.xBeforeSplit;this._w=this.wBeforeSplit}}else{this.curRatio++;this._x+=this._w;this._w=Std.int(this.wBeforeSplit*this.ratios[this.curRatio])}}else{this._x+=this._w+this.ELEMENT_OFFSET()}},row:function(ratios){this.ratios=ratios;this.curRatio=0;this.xBeforeSplit=this._x;this.wBeforeSplit=this._w;this._w=Std.int(this._w*ratios[this.curRatio])},fill:function(x,y,w,h,color){this.g.set_color(color);this.g.fillRect(this._x+x*this.SCALE,this._y+y*this.SCALE,w*this.SCALE,h*this.SCALE);this.g.set_color(-1)},drawRect:function(g,fill,x,y,w,h,strength){if(strength==null){strength=0}if(strength==0){strength=this.LINE_STRENGTH()}if(fill){g.fillRect(x,y,w,h)}else{g.drawRect(x,y,w,h,strength)}},isVisible:function(elemH){if(this.currentWindow==null){return true}if(this._y+elemH>0){return this._y<this.currentWindow.texture.get_height()}else{return false}},getReleased:function(elemH){if(elemH==null){elemH=-1}this.isReleased=this.inputEnabled&&this.inputReleased&&this.getHover(elemH)&&this.getInitialHover(elemH);return this.isReleased},getPushed:function(elemH){if(elemH==null){elemH=-1}this.isPushed=this.inputEnabled&&this.inputDown&&this.getHover(elemH)&&this.getInitialHover(elemH);return this.isPushed},getStarted:function(elemH){if(elemH==null){elemH=-1}this.isStarted=this.inputEnabled&&this.inputStarted&&this.getHover(elemH);return this.isStarted},getInitialHover:function(elemH){if(elemH==null){elemH=-1}if(elemH==-1){elemH=this.ELEMENT_H()}if(this.inputEnabled&&this.inputInitialX>=this._windowX+this._x&&this.inputInitialX<this._windowX+this._x+this._w&&this.inputInitialY>=this._windowY+this._y){return this.inputInitialY<this._windowY+this._y+elemH}else{return false}},getHover:function(elemH){if(elemH==null){elemH=-1}if(elemH==-1){elemH=this.ELEMENT_H()}this.isHovered=this.inputEnabled&&this.inputX>=this._windowX+this._x&&this.inputX<this._windowX+this._x+this._w&&this.inputY>=this._windowY+this._y&&this.inputY<this._windowY+this._y+elemH;return this.isHovered},getInputInRect:function(x,y,w,h,scale){if(scale==null){scale=1}if(this.inputEnabled&&this.inputX>=x*scale&&this.inputX<(x+w)*scale&&this.inputY>=y*scale){return this.inputY<(y+h)*scale}else{return false}},onMouseDown:function(button,x,y){if(button==0){this.inputStarted=true}else{this.inputStartedR=true}if(button==0){this.inputDown=true}else{this.inputDownR=true}var sx=Std.int(x*this.ops.scaleTexture);var sy=Std.int(y*this.ops.scaleTexture);this.setInputPosition(sx,sy);this.inputInitialX=sx;this.inputInitialY=sy},onMouseUp:function(button,x,y){if(button==0){if(this.isScrolling){this.isScrolling=false;if(this.scrollingHandle!=null){this.scrollingHandle.scrolling=false}if(x==this.inputInitialX&&y==this.inputInitialY){this.inputReleased=true}}else{this.inputReleased=true}}else if(button==1){this.inputReleasedR=true}if(button==0){this.inputDown=false}else{this.inputDownR=false}this.setInputPosition(Std.int(x*this.ops.scaleTexture),Std.int(y*this.ops.scaleTexture));this.deselectText()},onMouseMove:function(x,y,movementX,movementY){this.setInputPosition(Std.int(x*this.ops.scaleTexture),Std.int(y*this.ops.scaleTexture))},onMouseWheel:function(delta){this.inputWheelDelta=delta},setInputPosition:function(x,y){this.inputDX+=x-this.inputX;this.inputDY+=y-this.inputY;this.inputX=x;this.inputY=y},onKeyDown:function(code){this.key=code;this.isKeyDown=true;switch(code){case 16:this.isShiftDown=true;break;case 17:this.isCtrlDown=true;break;case 18:this.isAltDown=true;break;case 32:this.char=" ";break;default:}},onKeyUp:function(code){switch(code){case 16:this.isShiftDown=false;break;case 17:this.isCtrlDown=false;break;case 18:this.isAltDown=false;break;default:}},onKeyPress:function(char){this.char=char;this.isKeyDown=true},onCut:function(){zui_Zui.isCut=true;return this.onCopy()},onCopy:function(){return zui_Zui.textToCopy},onPaste:function(s){zui_Zui.textToPaste=s},ELEMENT_W:function(){return this.t.ELEMENT_W*this.SCALE},ELEMENT_H:function(){return this.t.ELEMENT_H*this.SCALE},ELEMENT_OFFSET:function(){return this.t.ELEMENT_OFFSET*this.SCALE},ARROW_SIZE:function(){return this.t.ARROW_SIZE*this.SCALE},BUTTON_H:function(){return this.t.BUTTON_H*this.SCALE},CHECK_SIZE:function(){return this.t.CHECK_SIZE*this.SCALE},CHECK_SELECT_SIZE:function(){return this.t.CHECK_SELECT_SIZE*this.SCALE},SCROLL_W:function(){return Std.int(this.t.SCROLL_W*this.SCALE)},TEXT_OFFSET:function(){return this.t.TEXT_OFFSET},LINE_STRENGTH:function(){return this.t.LINE_STRENGTH*this.SCALE},resize:function(handle,w,h,khaWindowId){if(khaWindowId==null){khaWindowId=0}handle.redraws=2;if(handle.texture!=null){handle.texture.unload()}handle.texture=kha_Image.createRenderTarget(w,h,0,0,1,khaWindowId);handle.texture.get_g2().set_imageScaleQuality(kha_graphics2_ImageScaleQuality.High)},__class__:zui_Zui};var $fid=0;function $bind(o,m){if(m==null)return null;if(m.__id__==null)m.__id__=$fid++;var f;if(o.hx__closures__==null)o.hx__closures__={};else f=o.hx__closures__[m.__id__];if(f==null){f=m.bind(o);o.hx__closures__[m.__id__]=f}return f}$hxClasses["Math"]=Math;if(String.fromCodePoint==null)String.fromCodePoint=function(c){return c<65536?String.fromCharCode(c):String.fromCharCode((c>>10)+55232)+String.fromCharCode((c&1023)+56320)};String.prototype.__class__=$hxClasses["String"]=String;String.__name__=true;$hxClasses["Array"]=Array;Array.__name__=true;Date.prototype.__class__=$hxClasses["Date"]=Date;Date.__name__="Date";var Int={};var Dynamic={};var Float=Number;var Bool=Boolean;var Class={};var Enum={};haxe_ds_ObjectMap.count=0;var __map_reserved={};Object.defineProperty(js__$Boot_HaxeError.prototype,"message",{get:function(){return String(this.val)}});if(ArrayBuffer.prototype.slice==null){ArrayBuffer.prototype.slice=js_html__$ArrayBuffer_ArrayBufferCompat.sliceImpl}arm_App.lastW=-1;arm_App.lastH=-1;iron_math_Mat4.helpVec=new iron_math_Vec4;iron_math_Mat4.helpMat=iron_math_Mat4.identity();armory_renderpath_Inc.pointIndex=0;armory_renderpath_Inc.spotIndex=0;armory_renderpath_RenderPathCreator.drawMeshes=armory_renderpath_RenderPathForward.drawMeshes;armory_system_Event.events=new haxe_ds_StringMap;armory_system_Logic.packageName="armory.logicnode";haxe_Unserializer.DEFAULT_RESOLVER=new haxe__$Unserializer_DefaultResolver;haxe_Unserializer.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:";haxe_io_FPHelper.helper=new DataView(new ArrayBuffer(8));iron_App.traitInits=[];iron_App.traitUpdates=[];iron_App.traitLateUpdates=[];iron_App.traitRenders=[];iron_App.traitRenders2D=[];iron_App.pauseUpdates=false;iron_App.lastw=-1;iron_App.lasth=-1;iron_Scene.uidCounter=0;iron_Scene.framePassed=true;iron_data_Data.cachedSceneRaws=new haxe_ds_StringMap;iron_data_Data.cachedMeshes=new haxe_ds_StringMap;iron_data_Data.cachedLights=new haxe_ds_StringMap;iron_data_Data.cachedCameras=new haxe_ds_StringMap;iron_data_Data.cachedMaterials=new haxe_ds_StringMap;iron_data_Data.cachedWorlds=new haxe_ds_StringMap;iron_data_Data.cachedShaders=new haxe_ds_StringMap;iron_data_Data.cachedBlobs=new haxe_ds_StringMap;iron_data_Data.cachedImages=new haxe_ds_StringMap;iron_data_Data.cachedFonts=new haxe_ds_StringMap;iron_data_Data.dataPath="";iron_data_Data.loadingMeshes=new haxe_ds_StringMap;iron_data_Data.loadingLights=new haxe_ds_StringMap;iron_data_Data.loadingCameras=new haxe_ds_StringMap;iron_data_Data.loadingMaterials=new haxe_ds_StringMap;iron_data_Data.loadingWorlds=new haxe_ds_StringMap;iron_data_Data.loadingShaders=new haxe_ds_StringMap;iron_data_Data.loadingSceneRaws=new haxe_ds_StringMap;iron_data_Data.assetsLoaded=0;iron_data_Data.loadingBlobs=new haxe_ds_StringMap;iron_data_Data.loadingImages=new haxe_ds_StringMap;iron_data_Data.loadingFonts=new haxe_ds_StringMap;iron_data_MaterialData.uidCounter=0;iron_data_MaterialContext.num=0;iron_object_Animation.m1=iron_math_Mat4.identity();iron_object_Animation.m2=iron_math_Mat4.identity();iron_object_Animation.vpos=new iron_math_Vec4;iron_object_Animation.vpos2=new iron_math_Vec4;iron_object_Animation.vscl=new iron_math_Vec4;iron_object_Animation.vscl2=new iron_math_Vec4;iron_object_Animation.q1=new iron_math_Quat;iron_object_Animation.q2=new iron_math_Quat;iron_object_Animation.q3=new iron_math_Quat;iron_object_Animation.vp=new iron_math_Vec4;iron_object_Animation.vs=new iron_math_Vec4;iron_object_Object.uidCounter=0;iron_object_Object.seed=1;iron_object_CameraObject.temp=new iron_math_Vec4;iron_object_CameraObject.sphereCenter=new iron_math_Vec4;iron_object_CameraObject.vcenter=new iron_math_Vec4;iron_object_CameraObject.vup=new iron_math_Vec4;iron_object_LightObject.cascadeBounds=1;iron_object_LightObject.m=iron_math_Mat4.identity();iron_object_LightObject.eye=new iron_math_Vec4;iron_object_Transform.temp=iron_math_Mat4.identity();iron_object_Uniforms.biasMat=new iron_math_Mat4(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);iron_object_Uniforms.helpMat=iron_math_Mat4.identity();iron_object_Uniforms.helpMat2=iron_math_Mat4.identity();iron_object_Uniforms.helpMat3=iron_math_Mat3.identity();iron_object_Uniforms.helpVec=new iron_math_Vec4;iron_object_Uniforms.helpVec2=new iron_math_Vec4;iron_object_Uniforms.helpQuat=new iron_math_Quat;iron_system_Input.occupied=false;iron_system_Input.gamepads=[];iron_system_Input.registered=false;iron_system_Mouse.buttons=["left","right","middle"];iron_system_Keyboard.keys=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","period","comma","space","backspace","tab","enter","shift","control","alt","escape","delete","back","up","right","left","down","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12"];iron_system_Gamepad.buttonsPS=["cross","circle","square","triangle","l1","r1","l2","r2","share","options","l3","r3","up","down","left","right","home","touchpad"];iron_system_Gamepad.buttons=iron_system_Gamepad.buttonsPS;iron_system_Time.scale=1;iron_system_Time.last=0;iron_system_Time.realDelta=0;js_Boot.__toStr={}.toString;kha_Assets.fonts=new kha__$Assets_FontList;kha_CompilerDefines.canvas_id="khanvas";kha_Display.instance=new kha_Display;kha_Scheduler.DIF_COUNT=3;kha_Scheduler.maxframetime=.5;kha_Scheduler.startTime=0;kha_Shaders.Material_shadowmap_fragData0="s107:I3ZlcnNpb24gMzAwIGVzCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gaGlnaHAgaW50OwoKdm9pZCBtYWluKCkKewp9Cgo";kha_Shaders.Material_mesh_vertData0="s399:I3ZlcnNpb24gMzAwIGVzCgp1bmlmb3JtIG1hdDQgVzsKdW5pZm9ybSBtYXQzIE47CnVuaWZvcm0gbWF0NCBXVlA7CgppbiB2ZWM0IHBvczsKb3V0IHZlYzMgd3Bvc2l0aW9uOwpvdXQgdmVjMyB3bm9ybWFsOwppbiB2ZWMyIG5vcjsKCnZvaWQgbWFpbigpCnsKICAgIHZlYzQgc3BvcyA9IHZlYzQocG9zLnh5eiwgMS4wKTsKICAgIHdwb3NpdGlvbiA9IHZlYzQoVyAqIHNwb3MpLnh5ejsKICAgIHdub3JtYWwgPSBub3JtYWxpemUoTiAqIHZlYzMobm9yLCBwb3MudykpOwogICAgZ2xfUG9zaXRpb24gPSBXVlAgKiBzcG9zOwp9Cgo";kha_Shaders.Material_mesh_fragData0="s2231:I3ZlcnNpb24gMzAwIGVzCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gaGlnaHAgaW50OwoKdW5pZm9ybSBoaWdocCB2ZWMzIHBvaW50UG9zOwp1bmlmb3JtIGhpZ2hwIGZsb2F0IHBvaW50QmlhczsKdW5pZm9ybSBoaWdocCB2ZWMyIGxpZ2h0UHJvajsKdW5pZm9ybSBoaWdocCBzYW1wbGVyQ3ViZVNoYWRvdyBzaGFkb3dNYXBQb2ludFsxXTsKdW5pZm9ybSBoaWdocCB2ZWMzIHBvaW50Q29sOwp1bmlmb3JtIGhpZ2hwIGZsb2F0IGVudm1hcFN0cmVuZ3RoOwoKaW4gaGlnaHAgdmVjMyB3bm9ybWFsOwppbiBoaWdocCB2ZWMzIHdwb3NpdGlvbjsKb3V0IGhpZ2hwIHZlYzQgZnJhZ0NvbG9yOwoKaGlnaHAgZmxvYXQgbHBUb0RlcHRoKGlub3V0IGhpZ2hwIHZlYzMgbHAsIGhpZ2hwIHZlYzIgbGlnaHRQcm9qXzEpCnsKICAgIGxwID0gYWJzKGxwKTsKICAgIGhpZ2hwIGZsb2F0IHpjb21wID0gbWF4KGxwLngsIG1heChscC55LCBscC56KSk7CiAgICB6Y29tcCA9IGxpZ2h0UHJval8xLnggLSAobGlnaHRQcm9qXzEueSAvIHpjb21wKTsKICAgIHJldHVybiAoemNvbXAgKiAwLjUpICsgMC41Owp9CgpoaWdocCBmbG9hdCBhdHRlbnVhdGUoaGlnaHAgZmxvYXQgZGlzdCkKewogICAgcmV0dXJuIDEuMCAvIChkaXN0ICogZGlzdCk7Cn0KCnZvaWQgbWFpbigpCnsKICAgIGhpZ2hwIHZlYzMgbiA9IG5vcm1hbGl6ZSh3bm9ybWFsKTsKICAgIGhpZ2hwIHZlYzMgYmFzZWNvbCA9IHZlYzMoMC44MDAwMDAwMTE5MjA5Mjg5NTUwNzgxMjUpOwogICAgaGlnaHAgZmxvYXQgcm91Z2huZXNzID0gMC4wOwogICAgaGlnaHAgZmxvYXQgbWV0YWxsaWMgPSAwLjA7CiAgICBoaWdocCBmbG9hdCBvY2NsdXNpb24gPSAxLjA7CiAgICBoaWdocCBmbG9hdCBzcGVjdWxhciA9IDAuMDsKICAgIGhpZ2hwIHZlYzMgZGlyZWN0ID0gdmVjMygwLjApOwogICAgaGlnaHAgZmxvYXQgdmlzaWJpbGl0eSA9IDEuMDsKICAgIGhpZ2hwIHZlYzMgbGQgPSBwb2ludFBvcyAtIHdwb3NpdGlvbjsKICAgIGhpZ2hwIHZlYzMgbCA9IG5vcm1hbGl6ZShsZCk7CiAgICBoaWdocCBmbG9hdCBkb3ROTCA9IG1heChkb3QobiwgbCksIDAuMCk7CiAgICBoaWdocCB2ZWMzIHBhcmFtID0gbGQgLSAoKG4gKiBwb2ludEJpYXMpICogODAuMCk7CiAgICBoaWdocCBmbG9hdCBfOTYgPSBscFRvRGVwdGgocGFyYW0sIGxpZ2h0UHJvaik7CiAgICBoaWdocCBmbG9hdCBjb21wYXJlID0gXzk2OwogICAgaGlnaHAgdmVjNCBfMTE5ID0gdmVjNCgoLWwpICsgKChuICogcG9pbnRCaWFzKSAqIDgwLjApLCBjb21wYXJlKTsKICAgIHZpc2liaWxpdHkgPSB0ZXh0dXJlKHNoYWRvd01hcFBvaW50WzBdLCB2ZWM0KF8xMTkueHl6LCBfMTE5LncpKTsKICAgIGRpcmVjdCArPSAoKCgoYmFzZWNvbCAqIGRvdE5MKSAqIHBvaW50Q29sKSAqIGF0dGVudWF0ZShkaXN0YW5jZSh3cG9zaXRpb24sIHBvaW50UG9zKSkpICogdmlzaWJpbGl0eSk7CiAgICBmcmFnQ29sb3IgPSB2ZWM0KGRpcmVjdCArICgoYmFzZWNvbCAqIDAuNSkgKiBlbnZtYXBTdHJlbmd0aCksIDEuMCk7CiAgICBoaWdocCB2ZWMzIF8xNTQgPSBwb3coZnJhZ0NvbG9yLnh5eiwgdmVjMygwLjQ1NDU0NTQ2ODA5MTk2NDcyMTY3OTY4NzUpKTsKICAgIGZyYWdDb2xvciA9IHZlYzQoXzE1NC54LCBfMTU0LnksIF8xNTQueiwgZnJhZ0NvbG9yLncpOwp9Cgo";kha_Shaders.Material_shadowmap_vertData0="s180:I3ZlcnNpb24gMzAwIGVzCgp1bmlmb3JtIG1hdDQgTFdWUDsKCmluIHZlYzQgcG9zOwoKdm9pZCBtYWluKCkKewogICAgdmVjNCBzcG9zID0gdmVjNChwb3MueHl6LCAxLjApOwogICAgZ2xfUG9zaXRpb24gPSBMV1ZQICogc3BvczsKfQoK";kha_Shaders.painter_image_vertData0="s380:I3ZlcnNpb24gMzAwIGVzCgp1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeDsKCmluIHZlYzMgdmVydGV4UG9zaXRpb247Cm91dCB2ZWMyIHRleENvb3JkOwppbiB2ZWMyIHRleFBvc2l0aW9uOwpvdXQgdmVjNCBjb2xvcjsKaW4gdmVjNCB2ZXJ0ZXhDb2xvcjsKCnZvaWQgbWFpbigpCnsKICAgIGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIHZlYzQodmVydGV4UG9zaXRpb24sIDEuMCk7CiAgICB0ZXhDb29yZCA9IHRleFBvc2l0aW9uOwogICAgY29sb3IgPSB2ZXJ0ZXhDb2xvcjsKfQoK";kha_Shaders.painter_colored_vertData0="s311:I3ZlcnNpb24gMzAwIGVzCgp1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeDsKCmluIHZlYzMgdmVydGV4UG9zaXRpb247Cm91dCB2ZWM0IGZyYWdtZW50Q29sb3I7CmluIHZlYzQgdmVydGV4Q29sb3I7Cgp2b2lkIG1haW4oKQp7CiAgICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiB2ZWM0KHZlcnRleFBvc2l0aW9uLCAxLjApOwogICAgZnJhZ21lbnRDb2xvciA9IHZlcnRleENvbG9yOwp9Cgo";kha_Shaders.painter_colored_fragData0="s223:I3ZlcnNpb24gMzAwIGVzCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gaGlnaHAgaW50OwoKb3V0IGhpZ2hwIHZlYzQgRnJhZ0NvbG9yOwppbiBoaWdocCB2ZWM0IGZyYWdtZW50Q29sb3I7Cgp2b2lkIG1haW4oKQp7CiAgICBGcmFnQ29sb3IgPSBmcmFnbWVudENvbG9yOwp9Cgo";kha_Shaders.painter_image_fragData0="s487:I3ZlcnNpb24gMzAwIGVzCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gaGlnaHAgaW50OwoKdW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgdGV4OwoKaW4gaGlnaHAgdmVjMiB0ZXhDb29yZDsKaW4gaGlnaHAgdmVjNCBjb2xvcjsKb3V0IGhpZ2hwIHZlYzQgRnJhZ0NvbG9yOwoKdm9pZCBtYWluKCkKewogICAgaGlnaHAgdmVjNCB0ZXhjb2xvciA9IHRleHR1cmUodGV4LCB0ZXhDb29yZCkgKiBjb2xvcjsKICAgIGhpZ2hwIHZlYzMgXzMyID0gdGV4Y29sb3IueHl6ICogY29sb3IudzsKICAgIHRleGNvbG9yID0gdmVjNChfMzIueCwgXzMyLnksIF8zMi56LCB0ZXhjb2xvci53KTsKICAgIEZyYWdDb2xvciA9IHRleGNvbG9yOwp9Cgo";kha_Shaders.painter_text_fragData0="s367:I3ZlcnNpb24gMzAwIGVzCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gaGlnaHAgaW50OwoKdW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgdGV4OwoKb3V0IGhpZ2hwIHZlYzQgRnJhZ0NvbG9yOwppbiBoaWdocCB2ZWM0IGZyYWdtZW50Q29sb3I7CmluIGhpZ2hwIHZlYzIgdGV4Q29vcmQ7Cgp2b2lkIG1haW4oKQp7CiAgICBGcmFnQ29sb3IgPSB2ZWM0KGZyYWdtZW50Q29sb3IueHl6LCB0ZXh0dXJlKHRleCwgdGV4Q29vcmQpLnggKiBmcmFnbWVudENvbG9yLncpOwp9Cgo";kha_Shaders.painter_text_vertData0="s402:I3ZlcnNpb24gMzAwIGVzCgp1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeDsKCmluIHZlYzMgdmVydGV4UG9zaXRpb247Cm91dCB2ZWMyIHRleENvb3JkOwppbiB2ZWMyIHRleFBvc2l0aW9uOwpvdXQgdmVjNCBmcmFnbWVudENvbG9yOwppbiB2ZWM0IHZlcnRleENvbG9yOwoKdm9pZCBtYWluKCkKewogICAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogdmVjNCh2ZXJ0ZXhQb3NpdGlvbiwgMS4wKTsKICAgIHRleENvb3JkID0gdGV4UG9zaXRpb247CiAgICBmcmFnbWVudENvbG9yID0gdmVydGV4Q29sb3I7Cn0KCg";kha_Shaders.painter_video_fragData0="s487:I3ZlcnNpb24gMzAwIGVzCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gaGlnaHAgaW50OwoKdW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgdGV4OwoKaW4gaGlnaHAgdmVjMiB0ZXhDb29yZDsKaW4gaGlnaHAgdmVjNCBjb2xvcjsKb3V0IGhpZ2hwIHZlYzQgRnJhZ0NvbG9yOwoKdm9pZCBtYWluKCkKewogICAgaGlnaHAgdmVjNCB0ZXhjb2xvciA9IHRleHR1cmUodGV4LCB0ZXhDb29yZCkgKiBjb2xvcjsKICAgIGhpZ2hwIHZlYzMgXzMyID0gdGV4Y29sb3IueHl6ICogY29sb3IudzsKICAgIHRleGNvbG9yID0gdmVjNChfMzIueCwgXzMyLnksIF8zMi56LCB0ZXhjb2xvci53KTsKICAgIEZyYWdDb2xvciA9IHRleGNvbG9yOwp9Cgo";kha_Shaders.painter_video_vertData0="s380:I3ZlcnNpb24gMzAwIGVzCgp1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeDsKCmluIHZlYzMgdmVydGV4UG9zaXRpb247Cm91dCB2ZWMyIHRleENvb3JkOwppbiB2ZWMyIHRleFBvc2l0aW9uOwpvdXQgdmVjNCBjb2xvcjsKaW4gdmVjNCB2ZXJ0ZXhDb2xvcjsKCnZvaWQgbWFpbigpCnsKICAgIGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIHZlYzQodmVydGV4UG9zaXRpb24sIDEuMCk7CiAgICB0ZXhDb29yZCA9IHRleFBvc2l0aW9uOwogICAgY29sb3IgPSB2ZXJ0ZXhDb2xvcjsKfQoK";kha_System.renderListeners=[];kha_System.foregroundListeners=[];kha_System.backgroundListeners=[];kha_System.shutdownListeners=[];kha_SystemImpl.mobile=false;kha_SystemImpl.ios=false;kha_SystemImpl.mobileAudioPlaying=false;kha_SystemImpl.chrome=false;kha_SystemImpl.firefox=false;kha_SystemImpl.ie=false;kha_SystemImpl.insideInputEvent=false;kha_SystemImpl.leftMouseCtrlDown=false;kha_SystemImpl.minimumScroll=999;kha_SystemImpl.lastFirstTouchX=0;kha_SystemImpl.lastFirstTouchY=0;kha_SystemImpl.iosSoundEnabled=false;kha_SystemImpl.soundEnabled=false;kha_SystemImpl.iosTouchs=[];kha_Window.windows=[];kha_graphics2_Graphics.fontGlyphs=function($this){var $r;var _g=[];{var _g1=32;while(_g1<256){var i=_g1++;_g.push(i)}}$r=_g;return $r}(this);kha_input_Gamepad.__meta__={statics:{sendConnectEvent:{input:null},sendDisconnectEvent:{input:null}},fields:{sendAxisEvent:{input:null},sendButtonEvent:{input:null}}};kha_input_Gamepad.instances=[];kha_input_Gamepad.connectListeners=[];kha_input_Gamepad.disconnectListeners=[];kha_input_Keyboard.__meta__={fields:{sendDownEvent:{input:null},sendUpEvent:{input:null},sendPressEvent:{input:null}}};kha_input_Mouse.__meta__={fields:{sendLeaveEvent:{input:null},sendDownEvent:{input:null},sendUpEvent:{input:null},sendMoveEvent:{input:null},sendWheelEvent:{input:null}}};kha_internal_HdrFormat.exposurePattern=new EReg("EXPOSURE=\\s*([0-9]*[.][0-9]*)","i");kha_internal_HdrFormat.formatPattern=new EReg("FORMAT=32-bit_rle_rgbe","i");kha_internal_HdrFormat.widthHeightPattern=new EReg("-Y ([0-9]+) \\+X ([0-9]+)","i");kha_js_AEAudioChannel.todo=[];kha_js_Sound.loading=[];kha_netsync_ControllerBuilder.nextId=0;zui_Handle.global=new zui_Handle;zui_Canvas.assetMap=new haxe_ds_IntMap;zui_Canvas.events=[];zui_Canvas.screenW=-1;zui_Canvas.screenH=-1;zui_Canvas.h=new zui_Handle;zui_Ext.ar=[0,0,0];zui_Nodes.elementsBaked=false;zui_Themes.dark={FONT_SIZE:13,ELEMENT_W:100,ELEMENT_H:22,ELEMENT_OFFSET:2,ARROW_SIZE:5,BUTTON_H:17,CHECK_SIZE:15,CHECK_SELECT_SIZE:8,SCROLL_W:8,TEXT_OFFSET:8,TAB_W:12,LINE_STRENGTH:1,FLASH_SPEED:.5,TOOLTIP_DELAY:1,FILL_WINDOW_BG:false,FILL_BUTTON_BG:true,FILL_ACCENT_BG:false,WINDOW_BG_COL:-14671840,WINDOW_TINT_COL:-1,ACCENT_COL:-12566464,ACCENT_HOVER_COL:-11513776,ACCENT_SELECT_COL:-10066330,PANEL_BG_COL:-16777216,PANEL_TEXT_COL:-1118482,BUTTON_COL:-13948117,BUTTON_TEXT_COL:-3487289,BUTTON_HOVER_COL:-12895429,BUTTON_PRESSED_COL:-15000805,TEXT_COL:-3487289,LABEL_COL:-5592406,ARROW_COL:-3487289,SEPARATOR_COL:-14277082};zui_Themes.light={FONT_SIZE:26,ELEMENT_W:200,ELEMENT_H:44,ELEMENT_OFFSET:4,ARROW_SIZE:10,BUTTON_H:34,CHECK_SIZE:30,CHECK_SELECT_SIZE:16,SCROLL_W:16,TEXT_OFFSET:16,TAB_W:24,LINE_STRENGTH:2,FLASH_SPEED:.5,TOOLTIP_DELAY:1,FILL_WINDOW_BG:false,FILL_BUTTON_BG:true,FILL_ACCENT_BG:false,WINDOW_BG_COL:-1052689,WINDOW_TINT_COL:-14540254,ACCENT_COL:-1118482,ACCENT_HOVER_COL:-4473925,ACCENT_SELECT_COL:-5592406,PANEL_BG_COL:-1,PANEL_TEXT_COL:-14540254,BUTTON_COL:-3355444,BUTTON_TEXT_COL:-14540254,BUTTON_HOVER_COL:-5000269,BUTTON_PRESSED_COL:-5131855,TEXT_COL:-6710887,LABEL_COL:-5592406,ARROW_COL:-3487289,SEPARATOR_COL:-6710887};zui_Zui.textToPaste="";zui_Zui.textToCopy="";zui_Zui.isCut=false;zui_Zui.comboFirst=true;Main.main()})(typeof exports!="undefined"?exports:typeof window!="undefined"?window:typeof self!="undefined"?self:this,typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:this);