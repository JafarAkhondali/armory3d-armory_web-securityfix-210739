!function(e,t){"use strict";function i(e,t){function i(){}i.prototype=e;var a=new i;for(var s in t)a[s]=t[s];return t.toString!==Object.prototype.toString&&(a.toString=t.toString),a}function a(e,t){if(null==t)return null;null==t.__id__&&(t.__id__=ma++);var i;return null==e.hx__closures__?e.hx__closures__={}:i=e.hx__closures__[t.__id__],null==i&&((i=function(){return i.method.apply(i.scope,arguments)}).scope=e,i.method=t,e.hx__closures__[t.__id__]=i),i}e.kha=e.kha||{},e.kha.input=e.kha.input||{},e.kha._Color=e.kha._Color||{};var s={},r=function(){return qe.__string_rec(this,"")},n=function(e,t){this.r=new RegExp(e,t.split("u").join(""))};s.EReg=n,n.__name__=!0,n.prototype={match:function(e){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(e),this.r.s=e,null!=this.r.m},matched:function(e){if(null!=this.r.m&&e>=0&&e<this.r.m.length)return this.r.m[e];throw new Je("EReg::matched")},__class__:n};var l=function(){};s.HxOverrides=l,l.__name__=!0,l.strDate=function(e){switch(e.length){case 8:var t=e.split(":"),i=new Date;return i.setTime(0),i.setUTCHours(t[0]),i.setUTCMinutes(t[1]),i.setUTCSeconds(t[2]),i;case 10:var a=e.split("-");return new Date(a[0],a[1]-1,a[2],0,0,0);case 19:var s=e.split(" "),r=s[0].split("-"),n=s[1].split(":");return new Date(r[0],r[1]-1,r[2],n[0],n[1],n[2]);default:throw new Je("Invalid date format : "+e)}},l.cca=function(e,t){var i=e.charCodeAt(t);if(i==i)return i},l.substr=function(e,t,i){if(null==i)i=e.length;else if(i<0){if(0!=t)return"";i=e.length+i}return e.substr(t,i)},l.remove=function(e,t){var i=e.indexOf(t);return-1!=i&&(e.splice(i,1),!0)},l.iter=function(e){return{cur:0,arr:e,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var o=function(){this.length=0};s.List=o,o.__name__=!0,o.prototype={add:function(e){var t=new h(e,null);null==this.h?this.h=t:this.q.next=t,this.q=t,this.length++},push:function(e){var t=new h(e,this.h);this.h=t,null==this.q&&(this.q=t),this.length++},first:function(){return null==this.h?null:this.h.item},iterator:function(){return new c(this.h)},__class__:o};var h=function(e,t){this.item=e,this.next=t};s["_List.ListNode"]=h,h.__name__=!0,h.prototype={__class__:h};var c=function(e){this.head=e};s["_List.ListIterator"]=c,c.__name__=!0,c.prototype={hasNext:function(){return null!=this.head},next:function(){var e=this.head.item;return this.head=this.head.next,e},__class__:c};var u=s["kha.WindowMode"]={__ename__:!0,__constructs__:["Window","BorderlessWindow","Fullscreen"]};u.Window=["Window",0],u.Window.toString=r,u.Window.__enum__=u,u.BorderlessWindow=["BorderlessWindow",1],u.BorderlessWindow.toString=r,u.BorderlessWindow.__enum__=u,u.Fullscreen=["Fullscreen",2],u.Fullscreen.toString=r,u.Fullscreen.__enum__=u;var d=function(){};s.Main=d,d.__name__=!0,d.main=function(){Ie.skinMaxBones=8,d.state=1,d.state--,d.start()},d.start=function(){d.state>0||(w.register(),d.projectWindowMode==u.Fullscreen&&(d.projectWindowMode=u.BorderlessWindow,d.projectWidth=ht.width(0),d.projectHeight=ht.height(0)),Bt.init({title:"baked",width:d.projectWidth,height:d.projectHeight,samplesPerPixel:4,vSync:!0,windowMode:d.projectWindowMode,resizable:!1,maximizable:!1,minimizable:!0},function(){q.init(function(){q.notifyOnRender2D(x.render),re.setActive("Scene",function(e){ie.setActive(y.get())})})}))},Math.__name__=!0;var f=function(){};s.Reflect=f,f.__name__=!0,f.field=function(e,t){try{return e[t]}catch(e){return null}},f.getProperty=function(e,t){var i;if(null==e)return null;var a;return a=!!e.__properties__&&(i=e.__properties__["get_"+t]),a?e[i]():e[t]},f.setProperty=function(e,t,i){var a;!!e.__properties__&&(a=e.__properties__["set_"+t])?e[a](i):e[t]=i},f.fields=function(e){var t=[];if(null!=e){var i=Object.prototype.hasOwnProperty;for(var a in e)"__id__"!=a&&"hx__closures__"!=a&&i.call(e,a)&&t.push(a)}return t},f.isFunction=function(e){return"function"==typeof e&&!(e.__name__||e.__ename__)};var _=function(){};s.Std=_,_.__name__=!0,_.string=function(e){return qe.__string_rec(e,"")},_.parseInt=function(e){var t=parseInt(e,10);return 0!=t||120!=l.cca(e,1)&&88!=l.cca(e,1)||(t=parseInt(e)),isNaN(t)?null:t};var v=function(){};s.StringTools=v,v.__name__=!0,v.endsWith=function(e,t){var i=t.length,a=e.length;return a>=i&&l.substr(e,a-i,i)==t},v.replace=function(e,t,i){return e.split(t).join(i)};var p=function(){};s.Type=p,p.__name__=!0,p.resolveClass=function(e){var t=s[e];return null!=t&&t.__name__?t:null},p.resolveEnum=function(e){var t=s[e];return null!=t&&t.__ename__?t:null},p.createInstance=function(e,t){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6]);case 8:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]);case 9:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]);case 10:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9]);case 11:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10]);case 12:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11]);case 13:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12]);case 14:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13]);default:throw new Je("Too many arguments")}},p.createEmptyInstance=function(e){function t(){}return t.prototype=e.prototype,new t},p.createEnum=function(e,t,i){var a=f.field(e,t);if(null==a)throw new Je("No such constructor "+t);if(f.isFunction(a)){if(null==i)throw new Je("Constructor "+t+" need parameters");return a.apply(e,i)}if(null!=i&&0!=i.length)throw new Je("Constructor "+t+" does not need parameters");return a};var m={};s["_UInt.UInt_Impl_"]=m,m.__name__=!0,m.gt=function(e,t){var i=e<0;return i!=t<0?i:e>t},m.gte=function(e,t){var i=e<0;return i!=t<0?i:e>=t},m.toFloat=function(e){var t=e;return t<0?4294967296+t:t+0};var g=function(){this._render2D=null,this._render=null,this._lateUpdate=null,this._update=null,this._remove=null,this._init=null,this._add=null};s["iron.Trait"]=g,g.__name__=!0,g.prototype={remove:function(){this.object.removeTrait(this)},notifyOnUpdate:function(e){null==this._update&&(this._update=[]),this._update.push(e),q.notifyOnUpdate(e)},__class__:g};var b=function(){g.call(this),this.notifyOnUpdate(a(this,this.update))};s["arm.ArcBall"]=b,b.__name__=!0,b.__super__=g,b.prototype=i(g.prototype,{update:function(){if(!Ue.occupied){var e=Ue.getMouse();e.down()&&(this.object.transform.rotate(new ee(0,0,1),e.movementX/100),this.object.transform.buildMatrix())}},__class__:b});var w=function(){};s["armory.object.Uniforms"]=w,w.__name__=!0,w.register=function(){We.externalTextureLinks=[w.externalTextureLink],We.externalVec3Links=[w.externalVec3Link],We.externalFloatLinks=[w.externalFloatLink]},w.externalTextureLink=function(e){if("_smaaSearch"==e){var t=re.active.embedded;return null!=Ia["smaa_search.png"]?t.getReserved("smaa_search.png"):t.h["smaa_search.png"]}if("_smaaArea"==e){var i=re.active.embedded;return null!=Ia["smaa_area.png"]?i.getReserved("smaa_area.png"):i.h["smaa_area.png"]}if("_lensTexture"==e){var a=re.active.embedded;return null!=Ia["lenstexture.jpg"]?a.getReserved("lenstexture.jpg"):a.h["lenstexture.jpg"]}if("_lutTexture"==e){var s=re.active.embedded;return null!=Ia["luttexture.jpg"]?s.getReserved("luttexture.jpg"):s.h["luttexture.jpg"]}if("_cloudsTexture"==e){var r=re.active.embedded;return null!=Ia["cloudstexture.png"]?r.getReserved("cloudstexture.png"):r.h["cloudstexture.png"]}return null},w.externalVec3Link=function(e){return null},w.externalFloatLink=function(e){return"_dynamicScale"==e?B.dynamicScale:0};var B=function(){};s["armory.renderpath.DynamicResolutionScale"]=B,B.__name__=!0;var y=function(){};s["armory.renderpath.RenderPathCreator"]=y,y.__name__=!0,y.get=function(){return y.path=new ie,y.init(),y.path.commands=y.commands,y.path},y.init=function(){},y.commands=function(){y.path.setTarget(""),y.path.clearTarget(-1,1);y.path.drawMeshes("mesh")};var x=function(){};s["armory.trait.internal.LoadBar"]=x,x.__name__=!0,x.render=function(e){null!=re.active&&re.active.ready?q.removeRender2D(x.render):(e.set_color(-3200189),e.fillRect(0,Bt.windowHeight()-4,Bt.windowWidth()/4*le.assetsLoaded,4))};var I=function(){};s["haxe.IMap"]=I,I.__name__=!0;var S=function(e,t){this.high=e,this.low=t};s["haxe._Int64.___Int64"]=S,S.__name__=!0,S.prototype={__class__:S};var k=function(){};s["haxe.Log"]=k,k.__name__=!0,k.trace=function(e,t){qe.__trace(e,t)};var C=function(){};s["haxe._Unserializer.DefaultResolver"]=C,C.__name__=!0,C.prototype={resolveClass:function(e){return p.resolveClass(e)},resolveEnum:function(e){return p.resolveEnum(e)},__class__:C};var A=function(e){this.buf=e,this.length=e.length,this.pos=0,this.scache=[],this.cache=[];var t=A.DEFAULT_RESOLVER;null==t&&(t=new C,A.DEFAULT_RESOLVER=t),this.resolver=t};s["haxe.Unserializer"]=A,A.__name__=!0,A.initCodes=function(){for(var e=[],t=0,i=A.BASE64.length;t<i;){var a=t++;e[A.BASE64.charCodeAt(a)]=a}return e},A.run=function(e){return new A(e).unserialize()},A.prototype={readDigits:function(){for(var e=0,t=!1,i=this.pos;;){var a=this.buf.charCodeAt(this.pos);if(a!=a)break;if(45!=a){if(a<48||a>57)break;e=10*e+(a-48),this.pos++}else{if(this.pos!=i)break;t=!0,this.pos++}}return t&&(e*=-1),e},readFloat:function(){for(var e=this.pos;;){var t=this.buf.charCodeAt(this.pos);if(t!=t)break;if(!(t>=43&&t<58||101==t||69==t))break;this.pos++}return parseFloat(l.substr(this.buf,e,this.pos-e))},unserializeObject:function(e){for(;;){if(this.pos>=this.length)throw new Je("Invalid object");if(103==this.buf.charCodeAt(this.pos))break;var t=this.unserialize();if("string"!=typeof t)throw new Je("Invalid object key");var i=this.unserialize();e[t]=i}this.pos++},unserializeEnum:function(e,t){if(58!=this.buf.charCodeAt(this.pos++))throw new Je("Invalid enum format");var i=this.readDigits();if(0==i)return p.createEnum(e,t);for(var a=[];i-- >0;)a.push(this.unserialize());return p.createEnum(e,t,a)},unserialize:function(){switch(this.buf.charCodeAt(this.pos++)){case 65:var e=this.unserialize(),t=this.resolver.resolveClass(e);if(null==t)throw new Je("Class not found "+e);return t;case 66:var i=this.unserialize(),a=this.resolver.resolveEnum(i);if(null==a)throw new Je("Enum not found "+i);return a;case 67:var s=this.unserialize(),r=this.resolver.resolveClass(s);if(null==r)throw new Je("Class not found "+s);var n=p.createEmptyInstance(r);if(this.cache.push(n),n.hxUnserialize(this),103!=this.buf.charCodeAt(this.pos++))throw new Je("Invalid custom data");return n;case 77:var h=new F;this.cache.push(h);for(this.buf;104!=this.buf.charCodeAt(this.pos);){var c=this.unserialize();h.set(c,this.unserialize())}return this.pos++,h;case 82:var u=this.readDigits();if(u<0||u>=this.scache.length)throw new Je("Invalid string reference");return this.scache[u];case 97:this.buf;var d=[];for(this.cache.push(d);;){var f=this.buf.charCodeAt(this.pos);if(104==f){this.pos++;break}if(117==f){this.pos++;var _=this.readDigits();d[d.length+_-1]=null}else d.push(this.unserialize())}return d;case 98:var v=new R;this.cache.push(v);for(this.buf;104!=this.buf.charCodeAt(this.pos);){var m=this.unserialize(),g=this.unserialize();null!=Ia[m]?v.setReserved(m,g):v.h[m]=g}return this.pos++,v;case 99:var b=this.unserialize(),w=this.resolver.resolveClass(b);if(null==w)throw new Je("Class not found "+b);var B=p.createEmptyInstance(w);return this.cache.push(B),this.unserializeObject(B),B;case 100:return this.readFloat();case 102:return!1;case 105:return this.readDigits();case 106:var y=this.unserialize(),x=this.resolver.resolveEnum(y);if(null==x)throw new Je("Enum not found "+y);this.pos++;var I=this.readDigits(),S=x.__constructs__.slice()[I];if(null==S)throw new Je("Unknown enum index "+y+"@"+I);var k=this.unserializeEnum(x,S);return this.cache.push(k),k;case 107:return NaN;case 108:var C=new o;this.cache.push(C);for(this.buf;104!=this.buf.charCodeAt(this.pos);)C.add(this.unserialize());return this.pos++,C;case 109:return-1/0;case 110:return null;case 111:var M={};return this.cache.push(M),this.unserializeObject(M),M;case 112:return 1/0;case 113:var D=new T;this.cache.push(D);this.buf;for(var P=this.buf.charCodeAt(this.pos++);58==P;){var E=this.readDigits(),V=this.unserialize();D.h[E]=V,P=this.buf.charCodeAt(this.pos++)}if(104!=P)throw new Je("Invalid IntMap format");return D;case 114:var L=this.readDigits();if(L<0||L>=this.cache.length)throw new Je("Invalid reference");return this.cache[L];case 115:var W=this.readDigits(),G=this.buf;if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<W)throw new Je("Invalid bytes length");var Z=A.CODES;null==Z&&(Z=A.initCodes(),A.CODES=Z);for(var U=this.pos,z=3&W,O=U+(W-z),H=new N(new Sa(3*(W>>2)+(z>=2?z-1:0))),j=0;U<O;){var X=Z[G.charCodeAt(U++)],Y=Z[G.charCodeAt(U++)];H.b[j++]=255&(X<<2|Y>>4);var K=Z[G.charCodeAt(U++)];H.b[j++]=255&(Y<<4|K>>2);var Q=Z[G.charCodeAt(U++)];H.b[j++]=255&(K<<6|Q)}if(z>=2){var J=Z[G.charCodeAt(U++)],q=Z[G.charCodeAt(U++)];if(H.b[j++]=255&(J<<2|q>>4),3==z){var $=Z[G.charCodeAt(U++)];H.b[j++]=255&(q<<4|$>>2)}}return this.pos+=W,this.cache.push(H),H;case 116:return!0;case 118:var ee;if(this.buf.charCodeAt(this.pos)>=48&&this.buf.charCodeAt(this.pos)<=57&&this.buf.charCodeAt(this.pos+1)>=48&&this.buf.charCodeAt(this.pos+1)<=57&&this.buf.charCodeAt(this.pos+2)>=48&&this.buf.charCodeAt(this.pos+2)<=57&&this.buf.charCodeAt(this.pos+3)>=48&&this.buf.charCodeAt(this.pos+3)<=57&&45==this.buf.charCodeAt(this.pos+4))ee=l.strDate(l.substr(this.buf,this.pos,19)),this.pos+=19;else{var te=this.readFloat();ee=new Date(te)}return this.cache.push(ee),ee;case 119:var ie=this.unserialize(),ae=this.resolver.resolveEnum(ie);if(null==ae)throw new Je("Enum not found "+ie);var se=this.unserializeEnum(ae,this.unserialize());return this.cache.push(se),se;case 120:throw Je.wrap(this.unserialize());case 121:var re=this.readDigits();if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<re)throw new Je("Invalid string length");var ne=l.substr(this.buf,this.pos,re);return this.pos+=re,ne=decodeURIComponent(ne.split("+").join(" ")),this.scache.push(ne),ne;case 122:return 0}throw this.pos--,new Je("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos)},__class__:A};var M=function(){this.a1=1,this.a2=0};s["haxe.crypto.Adler32"]=M,M.__name__=!0,M.read=function(e){var t=new M,i=e.readByte(),a=e.readByte(),s=e.readByte(),r=e.readByte();return t.a1=s<<8|r,t.a2=i<<8|a,t},M.prototype={update:function(e,t,i){for(var a=this.a1,s=this.a2,r=t,n=t+i;r<n;){var l=r++;s=(s+(a=(a+e.b[l])%65521))%65521}this.a1=a,this.a2=s},equals:function(e){return e.a1==this.a1&&e.a2==this.a2},__class__:M};var N=function(e){this.length=e.byteLength,this.b=new Aa(e),this.b.bufferValue=e,e.hxBytes=this,e.bytes=this.b};s["haxe.io.Bytes"]=N,N.__name__=!0,N.ofData=function(e){var t=e.hxBytes;return null!=t?t:new N(e)},N.prototype={blit:function(e,t,i,a){if(e<0||i<0||a<0||e+a>this.length||i+a>t.length)throw new Je(Z.OutsideBounds);0==i&&a==t.b.byteLength?this.b.set(t.b,e):this.b.set(t.b.subarray(i,i+a),e)},sub:function(e,t){if(e<0||t<0||e+t>this.length)throw new Je(Z.OutsideBounds);return new N(this.b.buffer.slice(e+this.b.byteOffset,e+this.b.byteOffset+t))},getFloat:function(e){return null==this.data&&(this.data=new ka(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.getFloat32(e,!0)},setInt32:function(e,t){null==this.data&&(this.data=new ka(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.setInt32(e,t,!0)},getString:function(e,t){if(e<0||t<0||e+t>this.length)throw new Je(Z.OutsideBounds);for(var i="",a=this.b,s=String.fromCharCode,r=e,n=e+t;r<n;){var l=a[r++];if(l<128){if(0==l)break;i+=s(l)}else if(l<224)i+=s((63&l)<<6|127&a[r++]);else if(l<240)i+=s((31&l)<<12|(127&a[r++])<<6|127&a[r++]);else{var o=(15&l)<<18|(127&a[r++])<<12|(127&a[r++])<<6|127&a[r++];i+=s(55232+(o>>10)),i+=s(1023&o|56320)}}return i},toString:function(){return this.getString(0,this.length)},__class__:N};var T=function(){this.h={}};s["haxe.ds.IntMap"]=T,T.__name__=!0,T.__interfaces__=[I],T.prototype={__class__:T};var F=function(){this.h={__keys__:{}}};s["haxe.ds.ObjectMap"]=F,F.__name__=!0,F.__interfaces__=[I],F.prototype={set:function(e,t){var i=e.__id__||(e.__id__=++F.count);this.h[i]=t,this.h.__keys__[i]=e},keys:function(){var e=[];for(var t in this.h.__keys__)this.h.hasOwnProperty(t)&&e.push(this.h.__keys__[t]);return l.iter(e)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var e=this.it.next();return this.ref[e.__id__]}}},__class__:F};var D=function(e,t){this.map=e,this.keys=t,this.index=0,this.count=t.length};s["haxe.ds._StringMap.StringMapIterator"]=D,D.__name__=!0,D.prototype={hasNext:function(){return this.index<this.count},next:function(){var e=this.map,t=this.keys[this.index++];return null!=Ia[t]?e.getReserved(t):e.h[t]},__class__:D};var R=function(){this.h={}};s["haxe.ds.StringMap"]=R,R.__name__=!0,R.__interfaces__=[I],R.prototype={setReserved:function(e,t){null==this.rh&&(this.rh={}),this.rh["$"+e]=t},getReserved:function(e){return null==this.rh?null:this.rh["$"+e]},existsReserved:function(e){return null!=this.rh&&this.rh.hasOwnProperty("$"+e)},remove:function(e){return null!=Ia[e]?(e="$"+e,!(null==this.rh||!this.rh.hasOwnProperty(e))&&(delete this.rh[e],!0)):!!this.h.hasOwnProperty(e)&&(delete this.h[e],!0)},arrayKeys:function(){var e=[];for(var t in this.h)this.h.hasOwnProperty(t)&&e.push(t);if(null!=this.rh)for(var t in this.rh)36==t.charCodeAt(0)&&e.push(t.substr(1));return e},__class__:R};var P=function(){this.b=[]};s["haxe.io.BytesBuffer"]=P,P.__name__=!0,P.prototype={getBytes:function(){var e=new N(new Aa(this.b).buffer);return this.b=null,e},__class__:P};var E=function(){};s["haxe.io.Input"]=E,E.__name__=!0,E.prototype={readByte:function(){throw new Je("Not implemented")},readBytes:function(e,t,i){var a=i,s=e.b;if(t<0||i<0||t+i>e.length)throw new Je(Z.OutsideBounds);try{for(;a>0;)s[t]=this.readByte(),++t,--a}catch(e){if(e instanceof Je&&(e=e.val),!qe.__instanceof(e,G))throw e}return i-a},set_bigEndian:function(e){return this.bigEndian=e,e},readFullBytes:function(e,t,i){for(;i>0;){var a=this.readBytes(e,t,i);if(0==a)throw new Je(Z.Blocked);t+=a,i-=a}},read:function(e){for(var t=new N(new Sa(e)),i=0;e>0;){var a=this.readBytes(t,i,e);if(0==a)throw new Je(Z.Blocked);i+=a,e-=a}return t},readFloat:function(){return U.i32ToFloat(this.readInt32())},readDouble:function(){var e=this.readInt32(),t=this.readInt32();return this.bigEndian?U.i64ToDouble(t,e):U.i64ToDouble(e,t)},readInt8:function(){var e=this.readByte();return e>=128?e-256:e},readInt16:function(){var e=this.readByte(),t=this.readByte(),i=this.bigEndian?t|e<<8:e|t<<8;return 0!=(32768&i)?i-65536:i},readUInt16:function(){var e=this.readByte(),t=this.readByte();return this.bigEndian?t|e<<8:e|t<<8},readInt32:function(){var e=this.readByte(),t=this.readByte(),i=this.readByte(),a=this.readByte();return this.bigEndian?a|i<<8|t<<16|e<<24:e|t<<8|i<<16|a<<24},readString:function(e){var t=new N(new Sa(e));return this.readFullBytes(t,0,e),t.toString()},__class__:E,__properties__:{set_bigEndian:"set_bigEndian"}};var V=function(e,t,i){if(null==t&&(t=0),null==i&&(i=e.length-t),t<0||i<0||t+i>e.length)throw new Je(Z.OutsideBounds);this.b=e.b,this.pos=t,this.len=i,this.totlen=i};s["haxe.io.BytesInput"]=V,V.__name__=!0,V.__super__=E,V.prototype=i(E.prototype,{set_position:function(e){return e<0?e=0:e>this.totlen&&(e=this.totlen),this.len=this.totlen-e,this.pos=e},readByte:function(){if(0==this.len)throw new Je(new G);return this.len--,this.b[this.pos++]},readBytes:function(e,t,i){if(t<0||i<0||t+i>e.length)throw new Je(Z.OutsideBounds);if(0==this.len&&i>0)throw new Je(new G);this.len<i&&(i=this.len);for(var a=this.b,s=e.b,r=0,n=i;r<n;){var l=r++;s[t+l]=a[this.pos+l]}return this.pos+=i,this.len-=i,i},__class__:V,__properties__:i(E.prototype.__properties__,{set_position:"set_position"})});var L=function(){};s["haxe.io.Output"]=L,L.__name__=!0,L.prototype={writeByte:function(e){throw new Je("Not implemented")},writeBytes:function(e,t,i){if(t<0||i<0||t+i>e.length)throw new Je(Z.OutsideBounds);for(var a=e.b,s=i;s>0;)this.writeByte(a[t]),++t,--s;return i},write:function(e){for(var t=e.length,i=0;t>0;){var a=this.writeBytes(e,i,t);if(0==a)throw new Je(Z.Blocked);i+=a,t-=a}},writeFloat:function(e){this.writeInt32(U.floatToI32(e))},writeInt32:function(e){this.bigEndian?(this.writeByte(e>>>24),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)):(this.writeByte(255&e),this.writeByte(e>>8&255),this.writeByte(e>>16&255),this.writeByte(e>>>24))},__class__:L};var W=function(){this.b=new P};s["haxe.io.BytesOutput"]=W,W.__name__=!0,W.__super__=L,W.prototype=i(L.prototype,{writeByte:function(e){this.b.b.push(e)},writeBytes:function(e,t,i){var a=this.b;if(t<0||i<0||t+i>e.length)throw new Je(Z.OutsideBounds);a.b;for(var s=e.b,r=t,n=t+i;r<n;){var l=r++;a.b.push(s[l])}return i},getBytes:function(){return this.b.getBytes()},__class__:W});var G=function(){};s["haxe.io.Eof"]=G,G.__name__=!0,G.prototype={toString:function(){return"Eof"},__class__:G};var Z=s["haxe.io.Error"]={__ename__:!0,__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]};Z.Blocked=["Blocked",0],Z.Blocked.toString=r,Z.Blocked.__enum__=Z,Z.Overflow=["Overflow",1],Z.Overflow.toString=r,Z.Overflow.__enum__=Z,Z.OutsideBounds=["OutsideBounds",2],Z.OutsideBounds.toString=r,Z.OutsideBounds.__enum__=Z,Z.Custom=function(e){var t=["Custom",3,e];return t.__enum__=Z,t.toString=r,t};var U=function(){};s["haxe.io.FPHelper"]=U,U.__name__=!0,U.i32ToFloat=function(e){var t=1-(e>>>31<<1),i=e>>>23&255,a=8388607&e;return 0==a&&0==i?0:t*(1+Math.pow(2,-23)*a)*Math.pow(2,i-127)},U.floatToI32=function(e){if(0==e)return 0;var t=e<0?-e:e,i=Math.floor(Math.log(t)/.6931471805599453);i<-127?i=-127:i>128&&(i=128);var a=Math.round(8388608*(t/Math.pow(2,i)-1));return 8388608==a&&i<128&&(a=0,++i),(e<0?-2147483648:0)|i+127<<23|a},U.i64ToDouble=function(e,t){var i=1-(t>>>31<<1),a=(t>>20&2047)-1023,s=4294967296*(1048575&t)+2147483648*(e>>>31)+(2147483647&e);return 0==s&&-1023==a?0:i*(1+Math.pow(2,-52)*s)*Math.pow(2,a)},U.doubleToI64=function(e){var t=U.i64tmp;if(0==e)t.low=0,t.high=0;else if(isFinite(e)){var i=e<0?-e:e,a=Math.floor(Math.log(i)/.6931471805599453),s=Math.round(4503599627370496*(i/Math.pow(2,a)-1)),r=0|s,n=s/4294967296|0;t.low=r,t.high=(e<0?-2147483648:0)|a+1023<<20|n}else e>0?(t.low=0,t.high=2146435072):(t.low=0,t.high=-1048576);return t};var z={};s["haxe.io._UInt8Array.UInt8Array_Impl_"]=z,z.__name__=!0,z.fromBytes=function(e,t,i){return null==t&&(t=0),null==i&&(i=e.length-t),new Aa(e.b.bufferValue,t,i)};var O=s["haxe.zip.ExtraField"]={__ename__:!0,__constructs__:["FUnknown","FInfoZipUnicodePath","FUtf8"]};O.FUnknown=function(e,t){var i=["FUnknown",0,e,t];return i.__enum__=O,i.toString=r,i},O.FInfoZipUnicodePath=function(e,t){var i=["FInfoZipUnicodePath",1,e,t];return i.__enum__=O,i.toString=r,i},O.FUtf8=["FUtf8",2],O.FUtf8.toString=r,O.FUtf8.__enum__=O;var H=s["haxe.zip.Huffman"]={__ename__:!0,__constructs__:["Found","NeedBit","NeedBits"]};H.Found=function(e){var t=["Found",0,e];return t.__enum__=H,t.toString=r,t},H.NeedBit=function(e,t){var i=["NeedBit",1,e,t];return i.__enum__=H,i.toString=r,i},H.NeedBits=function(e,t){var i=["NeedBits",2,e,t];return i.__enum__=H,i.toString=r,i};var j=function(){};s["haxe.zip.HuffTools"]=j,j.__name__=!0,j.prototype={treeDepth:function(e){switch(e[1]){case 0:return 0;case 1:var t=e[3],i=e[2],a=this.treeDepth(i),s=this.treeDepth(t);return 1+(a<s?a:s);case 2:throw new Je("assert")}},treeCompress:function(e){var t=this.treeDepth(e);if(0==t)return e;if(1==t){if(1==e[1]){var i=e[3],a=e[2];return H.NeedBit(this.treeCompress(a),this.treeCompress(i))}throw new Je("assert")}for(var s=[],r=0,n=1<<t;r<n;){r++;s.push(H.Found(-1))}return this.treeWalk(s,0,0,t,e),H.NeedBits(t,s)},treeWalk:function(e,t,i,a,s){if(1==s[1]){var r=s[3],n=s[2];a>0?(this.treeWalk(e,t,i+1,a-1,n),this.treeWalk(e,t|1<<i,i+1,a-1,r)):e[t]=this.treeCompress(s)}else e[t]=this.treeCompress(s)},treeMake:function(e,t,i,a){if(a>t)throw new Je("Invalid huffman");var s=i<<5|a;return e.h.hasOwnProperty(s)?H.Found(e.h[s]):(i<<=1,++a,H.NeedBit(this.treeMake(e,t,i,a),this.treeMake(e,t,1|i,a)))},make:function(e,t,i,a){var s=[],r=[];if(a>32)throw new Je("Invalid huffman");for(var n=0,l=a;n<l;){n++;s.push(0),r.push(0)}for(var o=0,h=i;o<h;){var c=e[o+++t];if(c>=a)throw new Je("Invalid huffman");s[c]++}for(var u=0,d=1,f=a-1;d<f;){var _=d++;u=u+s[_]<<1,r[_]=u}for(var v=new T,p=0,m=i;p<m;){var g=p++,b=e[g+t];if(0!=b){var w=r[b-1];r[b-1]=w+1,v.h[w<<5|b]=g}}return this.treeCompress(H.NeedBit(this.treeMake(v,a,0,1),this.treeMake(v,a,1,1)))},__class__:j};var X=function(e){this.buffer=new N(new Sa(65536)),this.pos=0,e&&(this.crc=new M)};s["haxe.zip._InflateImpl.Window"]=X,X.__name__=!0,X.prototype={slide:function(){null!=this.crc&&this.crc.update(this.buffer,0,32768);var e=new N(new Sa(65536));this.pos-=32768,e.blit(0,this.buffer,32768,this.pos),this.buffer=e},addBytes:function(e,t,i){this.pos+i>65536&&this.slide(),this.buffer.blit(this.pos,e,t,i),this.pos+=i},addByte:function(e){65536==this.pos&&this.slide(),this.buffer.b[this.pos]=255&e,this.pos++},getLastChar:function(){return this.buffer.b[this.pos-1]},available:function(){return this.pos},checksum:function(){return null!=this.crc&&this.crc.update(this.buffer,0,this.pos),this.crc},__class__:X};var Y=s["haxe.zip._InflateImpl.State"]={__ename__:!0,__constructs__:["Head","Block","CData","Flat","Crc","Dist","DistOne","Done"]};Y.Head=["Head",0],Y.Head.toString=r,Y.Head.__enum__=Y,Y.Block=["Block",1],Y.Block.toString=r,Y.Block.__enum__=Y,Y.CData=["CData",2],Y.CData.toString=r,Y.CData.__enum__=Y,Y.Flat=["Flat",3],Y.Flat.toString=r,Y.Flat.__enum__=Y,Y.Crc=["Crc",4],Y.Crc.toString=r,Y.Crc.__enum__=Y,Y.Dist=["Dist",5],Y.Dist.toString=r,Y.Dist.__enum__=Y,Y.DistOne=["DistOne",6],Y.DistOne.toString=r,Y.DistOne.__enum__=Y,Y.Done=["Done",7],Y.Done.toString=r,Y.Done.__enum__=Y;var K=function(e,t,i){null==i&&(i=!0),null==t&&(t=!0),this.final=!1,this.htools=new j,this.huffman=this.buildFixedHuffman(),this.huffdist=null,this.len=0,this.dist=0,this.state=t?Y.Head:Y.Block,this.input=e,this.bits=0,this.nbits=0,this.needed=0,this.output=null,this.outpos=0,this.lengths=[];for(var a=0;a<19;){a++;this.lengths.push(-1)}this.window=new X(i)};s["haxe.zip.InflateImpl"]=K,K.__name__=!0,K.prototype={buildFixedHuffman:function(){if(null!=K.FIXED_HUFFMAN)return K.FIXED_HUFFMAN;for(var e=[],t=0;t<288;){var i=t++;e.push(i<=143?8:i<=255?9:i<=279?7:8)}return K.FIXED_HUFFMAN=this.htools.make(e,0,288,10)},readBytes:function(e,t,i){if(this.needed=i,this.outpos=t,this.output=e,i>0)for(;this.inflateLoop(););return i-this.needed},getBits:function(e){for(;this.nbits<e;)this.bits|=this.input.readByte()<<this.nbits,this.nbits+=8;var t=this.bits&(1<<e)-1;return this.nbits-=e,this.bits>>=e,t},getBit:function(){0==this.nbits&&(this.nbits=8,this.bits=this.input.readByte());var e=1==(1&this.bits);return this.nbits--,this.bits>>=1,e},getRevBits:function(e){return 0==e?0:this.getBit()?1<<e-1|this.getRevBits(e-1):this.getRevBits(e-1)},resetBits:function(){this.bits=0,this.nbits=0},addBytes:function(e,t,i){this.window.addBytes(e,t,i),this.output.blit(this.outpos,e,t,i),this.needed-=i,this.outpos+=i},addByte:function(e){this.window.addByte(e),this.output.b[this.outpos]=255&e,this.needed--,this.outpos++},addDistOne:function(e){for(var t=this.window.getLastChar(),i=0,a=e;i<a;){i++;this.addByte(t)}},addDist:function(e,t){this.addBytes(this.window.buffer,this.window.pos-e,t)},applyHuffman:function(e){switch(e[1]){case 0:return e[2];case 1:var t=e[3],i=e[2];return this.applyHuffman(this.getBit()?t:i);case 2:var a=e[3],s=e[2];return this.applyHuffman(a[this.getBits(s)])}},inflateLengths:function(e,t){for(var i=0,a=0;i<t;){var s=this.applyHuffman(this.huffman);switch(s){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:a=s,e[i]=s,++i;break;case 16:var r=i+3+this.getBits(2);if(r>t)throw new Je("Invalid data");for(;i<r;)e[i]=a,++i;break;case 17:if((i+=3+this.getBits(3))>t)throw new Je("Invalid data");break;case 18:if((i+=11+this.getBits(7))>t)throw new Je("Invalid data");break;default:throw new Je("Invalid data")}}},inflateLoop:function(){switch(this.state[1]){case 0:var e=this.input.readByte();if(8!=(15&e))throw new Je("Invalid data");var t=this.input.readByte(),i=0!=(32&t);if(((e<<8)+t)%31!=0)throw new Je("Invalid data");if(i)throw new Je("Unsupported dictionary");return this.state=Y.Block,!0;case 1:switch(this.final=this.getBit(),this.getBits(2)){case 0:if(this.len=this.input.readUInt16(),this.input.readUInt16()!=65535-this.len)throw new Je("Invalid data");this.state=Y.Flat;var a=this.inflateLoop();return this.resetBits(),a;case 1:return this.huffman=this.buildFixedHuffman(),this.huffdist=null,this.state=Y.CData,!0;case 2:for(var s=this.getBits(5)+257,r=this.getBits(5)+1,n=this.getBits(4)+4,l=0,o=n;l<o;){var h=l++;this.lengths[K.CODE_LENGTHS_POS[h]]=this.getBits(3)}for(var c=n;c<19;){var u=c++;this.lengths[K.CODE_LENGTHS_POS[u]]=0}this.huffman=this.htools.make(this.lengths,0,19,8);for(var d=[],f=0,_=s+r;f<_;){f++;d.push(0)}return this.inflateLengths(d,s+r),this.huffdist=this.htools.make(d,s,r,16),this.huffman=this.htools.make(d,0,s,16),this.state=Y.CData,!0;default:throw new Je("Invalid data")}break;case 2:var v=this.applyHuffman(this.huffman);if(v<256)return this.addByte(v),this.needed>0;if(256==v)return this.state=this.final?Y.Crc:Y.Block,!0;v-=257;var p=K.LEN_EXTRA_BITS_TBL[v];if(-1==p)throw new Je("Invalid data");this.len=K.LEN_BASE_VAL_TBL[v]+this.getBits(p);var m=null==this.huffdist?this.getRevBits(5):this.applyHuffman(this.huffdist);if(-1==(p=K.DIST_EXTRA_BITS_TBL[m]))throw new Je("Invalid data");if(this.dist=K.DIST_BASE_VAL_TBL[m]+this.getBits(p),this.dist>this.window.available())throw new Je("Invalid data");return this.state=1==this.dist?Y.DistOne:Y.Dist,!0;case 3:var g=this.len<this.needed?this.len:this.needed,b=this.input.read(g);return this.len-=g,this.addBytes(b,0,g),0==this.len&&(this.state=this.final?Y.Crc:Y.Block),this.needed>0;case 4:var w=this.window.checksum();if(null==w)return this.state=Y.Done,!0;var B=M.read(this.input);if(!w.equals(B))throw new Je("Invalid CRC");return this.state=Y.Done,!0;case 5:for(;this.len>0&&this.needed>0;){var y=this.len<this.dist?this.len:this.dist,x=this.needed<y?this.needed:y;this.addDist(this.dist,x),this.len-=x}return 0==this.len&&(this.state=Y.CData),this.needed>0;case 6:var I=this.len<this.needed?this.len:this.needed;return this.addDistOne(I),this.len-=I,0==this.len&&(this.state=Y.CData),this.needed>0;case 7:return!1}},__class__:K};var Q=function(e){this.i=e};s["haxe.zip.Reader"]=Q,Q.__name__=!0,Q.readZip=function(e){return new Q(e).read()},Q.unzip=function(e){if(!e.compressed)return e.data;var t=new J(-15),i=new N(new Sa(e.fileSize)),a=t.execute(e.data,0,i,0);if(t.close(),!a.done||a.read!=e.data.length||a.write!=e.fileSize)throw new Je("Invalid compressed data for "+e.fileName);return e.compressed=!1,e.dataSize=e.fileSize,e.data=i,e.data},Q.prototype={readZipDate:function(){var e=this.i.readUInt16(),t=e>>11&31,i=e>>5&63,a=31&e,s=this.i.readUInt16(),r=s>>9,n=s>>5&15,l=31&s;return new Date(r+1980,n-1,l,t,i,a<<1)},readExtraFields:function(e){for(var t=new o;e>0;){if(e<4)throw new Je("Invalid extra fields data");var i=this.i.readUInt16(),a=this.i.readUInt16();if(e<a)throw new Je("Invalid extra fields data");if(28789==i){var s=this.i.readByte();if(1!=s){var r=new P;r.b.push(s);for(var n=this.i.read(a-1),l=(r.b,n.b),h=0,c=n.length;h<c;){var u=h++;r.b.push(l[u])}t.add(O.FUnknown(i,r.getBytes()))}else{var d=this.i.readInt32(),f=this.i.read(a-5).toString();t.add(O.FInfoZipUnicodePath(f,d))}}else t.add(O.FUnknown(i,this.i.read(a)));e-=4+a}return t},readEntryHeader:function(){var e=this.i,t=e.readInt32();if(33639248==t||101010256==t)return null;if(67324752!=t)throw new Je("Invalid Zip Data");e.readUInt16();var i=e.readUInt16(),a=0!=(2048&i);if(0!=(63473&i))throw new Je("Unsupported flags "+i);var s=e.readUInt16(),r=0!=s;if(r&&8!=s)throw new Je("Unsupported compression "+s);var n=this.readZipDate(),l=e.readInt32(),o=e.readInt32(),h=e.readInt32(),c=e.readInt16(),u=e.readInt16(),d=e.readString(c),f=this.readExtraFields(u);a&&f.push(O.FUtf8);return 0!=(8&i)&&(l=null),{fileName:d,fileSize:h,fileTime:n,compressed:r,dataSize:o,data:null,crc32:l,extraFields:f}},read:function(){for(var e=new o,t=null;;){var i=this.readEntryHeader();if(null==i)break;if(null==i.crc32){if(i.compressed){null==t&&(t=new N(new Sa(65536)));for(var a=new P,s=new K(this.i,!1,!1);;){var r=s.readBytes(t,0,65536);if(r<0||r>t.length)throw new Je(Z.OutsideBounds);a.b;for(var n=t.b,l=0,h=r;l<h;){var c=l++;a.b.push(n[c])}if(r<65536)break}i.data=a.getBytes()}else i.data=this.i.read(i.dataSize);i.crc32=this.i.readInt32(),134695760==i.crc32&&(i.crc32=this.i.readInt32()),i.dataSize=this.i.readInt32(),i.fileSize=this.i.readInt32(),i.dataSize=i.fileSize,i.compressed=!1}else i.data=this.i.read(i.dataSize);e.add(i)}return e},__class__:Q};var J=function(e){throw new Je("Not implemented for this platform")};s["haxe.zip.Uncompress"]=J,J.__name__=!0,J.prototype={execute:function(e,t,i,a){return null},close:function(){},__class__:J};var q=function(e){e(),Bt.notifyOnRender(q.render),mt.addTimeTask(q.update,0,.016666666666666666*Ke.scale)};s["iron.App"]=q,q.__name__=!0,q.init=function(e){new q(e)},q.update=function(){if(!q.pauseUpdates){if(Qe.update(),Ke.update(),null!=re.active&&re.active.updateFrame(),q.traitInits.length>0){for(var e=0,t=q.traitInits;e<t.length;){var i=t[e];if(++e,0==q.traitInits.length)break;i()}q.traitInits.splice(0,q.traitInits.length)}for(var a=0,s=q.traitUpdates.length;a<s;)q.traitUpdates[a](),s<=q.traitUpdates.length?++a:s=q.traitUpdates.length;for(a=0,s=q.traitLateUpdates.length;a<s;)q.traitLateUpdates[a](),s<=q.traitLateUpdates.length?++a:s=q.traitLateUpdates.length;Ue.endFrame(),-1==q.lastw&&(q.lastw=Bt.windowWidth(),q.lasth=Bt.windowHeight()),q.lastw==Bt.windowWidth()&&q.lasth==Bt.windowHeight()||null!=re.active&&null!=re.active.camera&&re.active.camera.buildProjection(),q.lastw=Bt.windowWidth(),q.lasth=Bt.windowHeight()}},q.render=function(e){if(q.traitInits.length>0){for(var t=0,i=q.traitInits;t<i.length;){var a=i[t];if(++t,0==q.traitInits.length)break;a()}q.traitInits.splice(0,q.traitInits.length)}null!=re.active&&re.active.renderFrame(e.get_g4());for(var s=0,r=q.traitRenders;s<r.length;){var n=r[s];if(++s,0==q.traitRenders.length)break;n(e.get_g4())}if(q.traitRenders2D.length>0){e.get_g2().begin(!1);for(var l=0,o=q.traitRenders2D;l<o.length;){var h=o[l];if(++l,0==q.traitRenders2D.length)break;h(e.get_g2())}e.get_g2().end()}},q.removeInit=function(e){l.remove(q.traitInits,e)},q.notifyOnUpdate=function(e){q.traitUpdates.push(e)},q.removeUpdate=function(e){l.remove(q.traitUpdates,e)},q.removeLateUpdate=function(e){l.remove(q.traitLateUpdates,e)},q.removeRender=function(e){l.remove(q.traitRenders,e)},q.notifyOnRender2D=function(e){q.traitRenders2D.push(e)},q.removeRender2D=function(e){l.remove(q.traitRenders2D,e)},q.prototype={__class__:q};var $=function(e,t,i,a,s,r,n,l,o,h,c,u,d,f,_,v){this._00=e,this._10=t,this._20=i,this._30=a,this._01=s,this._11=r,this._21=n,this._31=l,this._02=o,this._12=h,this._22=c,this._32=u,this._03=d,this._13=f,this._23=_,this._33=v};s["kha.math.FastMatrix4"]=$,$.__name__=!0,$.orthogonalProjection=function(e,t,i,a,s,r){return new $(2/(t-e),0,0,-(t+e)/(t-e),0,2/(a-i),0,-(a+i)/(a-i),0,0,-2/(r-s),-(r+s)/(r-s),0,0,0,1)},$.prototype={__class__:$};var ee=function(e,t,i,a){null==a&&(a=1),null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.x=e,this.y=t,this.z=i,this.w=a};s["iron.math.Vec4"]=ee,ee.__name__=!0,ee.lerp=function(e,t,i){var a=new ee;return a.x=t.x+(e.x-t.x)*i,a.y=t.y+(e.y-t.y)*i,a.z=t.z+(e.z-t.z)*i,a},ee.distance3d=function(e,t){var i=e.x-t.x,a=e.y-t.y,s=e.z-t.z;return Math.sqrt(i*i+a*a+s*s)},ee.distance=function(e,t){var i=e.x-t.x,a=e.y-t.y,s=e.z-t.z;return Math.sqrt(i*i+a*a+s*s)},ee.distancef=function(e,t,i,a,s,r){var n=e-a,l=t-s,o=i-r;return Math.sqrt(n*n+l*l+o*o)},ee.xAxis=function(){return new ee(1,0,0)},ee.yAxis=function(){return new ee(0,1,0)},ee.zAxis=function(){return new ee(0,0,1)},ee.one=function(){return new ee(1,1,1)},ee.zero=function(){return new ee(0,0,0,0)},ee.back=function(){return new ee(0,-1,0)},ee.forward=function(){return new ee(0,1,0)},ee.down=function(){return new ee(0,0,-1)},ee.up=function(){return new ee(0,0,1)},ee.left=function(){return new ee(-1,0,0)},ee.right=function(){return new ee(1,0,0)},ee.negativeInfinity=function(){return new ee(-1/0,-1/0,-1/0,-1/0)},ee.positiveInfinity=function(){return new ee(1/0,1/0,1/0,1/0)},ee.prototype={set:function(e,t,i,a){return null==a&&(a=1),this.x=e,this.y=t,this.z=i,this.w=a,this},addf:function(e,t,i){return this.x+=e,this.y+=t,this.z+=i,this},addvecs:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},mult:function(e){return this.x*=e,this.y*=e,this.z*=e,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},setFrom:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},applymat:function(e){var t=this.x,i=this.y,a=this.z;return this.x=e.self._00*t+e.self._10*i+e.self._20*a+e.self._30,this.y=e.self._01*t+e.self._11*i+e.self._21*a+e.self._31,this.z=e.self._02*t+e.self._12*i+e.self._22*a+e.self._32,this},applymat4:function(e){var t=this.x,i=this.y,a=this.z,s=this.w;return this.x=e.self._00*t+e.self._10*i+e.self._20*a+e.self._30*s,this.y=e.self._01*t+e.self._11*i+e.self._21*a+e.self._31*s,this.z=e.self._02*t+e.self._12*i+e.self._22*a+e.self._32*s,this.w=e.self._03*t+e.self._13*i+e.self._23*a+e.self._33*s,this},__class__:ee};var te=function(e,t,i,a,s,r,n,l,o,h,c,u,d,f,_,v){this.self=new $(e,t,i,a,s,r,n,l,o,h,c,u,d,f,_,v)};s["iron.math.Mat4"]=te,te.__name__=!0,te.identity=function(){return new te(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},te.fromFloat32Array=function(e,t){return null==t&&(t=0),new te(e[t],e[1+t],e[2+t],e[3+t],e[4+t],e[5+t],e[6+t],e[7+t],e[8+t],e[9+t],e[10+t],e[11+t],e[12+t],e[13+t],e[14+t],e[15+t])},te.perspective=function(e,t,i,a){var s=1/Math.tan(e/2);return new te(s/t,0,0,0,0,s,0,0,0,0,(a+i)/(i-a),2*a*i/(i-a),0,0,-1,0)},te.orthogonal=function(e,t,i,a,s,r,n){null==n&&(n=2);var l=t-e,o=a-i,h=r-s;return new te(n/l,0,0,-((t+e)/l),0,n/o,0,-((a+i)/o),0,0,-n/h,-((r+s)/h),0,0,0,1)},te.prototype={compose:function(e,t,i){return this.fromQuaternion(t),this.scale(i),this.setLocation(e),this},decompose:function(e,t,i){te.helpVec.w=0;var a=te.helpVec.set(this.self._00,this.self._01,this.self._02),s=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),r=te.helpVec.set(this.self._10,this.self._11,this.self._12),n=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z),l=te.helpVec.set(this.self._20,this.self._21,this.self._22),o=Math.sqrt(l.x*l.x+l.y*l.y+l.z*l.z),h=this.self,c=h._12,u=h._22,d=h._32,f=h._13,_=h._23,v=h._33,p=h._11*(u*v-d*_)-h._21*(c*v-d*f)+h._31*(c*_-u*f),m=h._12,g=h._22,b=h._32,w=h._13,B=h._23,y=h._33,x=h._10*(g*y-b*B)-h._20*(m*y-b*w)+h._30*(m*B-g*w),I=h._11,S=h._21,k=h._31,C=h._13,A=h._23,M=h._33,N=h._10*(S*M-k*A)-h._20*(I*M-k*C)+h._30*(I*A-S*C),T=h._11,F=h._21,D=h._31,R=h._12,P=h._22,E=h._32,V=h._10*(F*E-D*P)-h._20*(T*E-D*R)+h._30*(T*P-F*R);h._00*p-h._01*x+h._02*N-h._03*V<0&&(s=-s),e.x=this.self._30,e.y=this.self._31,e.z=this.self._32,te.helpMat.self._00=this.self._00,te.helpMat.self._10=this.self._10,te.helpMat.self._20=this.self._20,te.helpMat.self._30=this.self._30,te.helpMat.self._01=this.self._01,te.helpMat.self._11=this.self._11,te.helpMat.self._21=this.self._21,te.helpMat.self._31=this.self._31,te.helpMat.self._02=this.self._02,te.helpMat.self._12=this.self._12,te.helpMat.self._22=this.self._22,te.helpMat.self._32=this.self._32,te.helpMat.self._03=this.self._03,te.helpMat.self._13=this.self._13,te.helpMat.self._23=this.self._23,te.helpMat.self._33=this.self._33;var L=1/s,W=1/n,G=1/o;return te.helpMat.self._00*=L,te.helpMat.self._01*=L,te.helpMat.self._02*=L,te.helpMat.self._03=0,te.helpMat.self._10*=W,te.helpMat.self._11*=W,te.helpMat.self._12*=W,te.helpMat.self._13=0,te.helpMat.self._20*=G,te.helpMat.self._21*=G,te.helpMat.self._22*=G,te.helpMat.self._23=0,te.helpMat.self._30=0,te.helpMat.self._31=0,te.helpMat.self._32=0,te.helpMat.self._33=0,t.fromRotationMat(te.helpMat),i.x=s,i.y=n,i.z=o,this},setLocation:function(e){return this.self._30=e.x,this.self._31=e.y,this.self._32=e.z,this},fromQuaternion:function(e){var t=e.x,i=e.y,a=e.z,s=e.w,r=t+t,n=i+i,l=a+a,o=t*r,h=t*n,c=t*l,u=i*n,d=i*l,f=a*l,_=s*r,v=s*n,p=s*l;return this.self._00=1-(u+f),this.self._10=h-p,this.self._20=c+v,this.self._01=h+p,this.self._11=1-(o+f),this.self._21=d-_,this.self._02=c-v,this.self._12=d+_,this.self._22=1-(o+u),this.self._03=0,this.self._13=0,this.self._23=0,this.self._30=0,this.self._31=0,this.self._32=0,this.self._33=1,this},setIdentity:function(){return this.self._00=1,this.self._01=0,this.self._02=0,this.self._03=0,this.self._10=0,this.self._11=1,this.self._12=0,this.self._13=0,this.self._20=0,this.self._21=0,this.self._22=1,this.self._23=0,this.self._30=0,this.self._31=0,this.self._32=0,this.self._33=1,this},initTranslate:function(e,t,i){null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.self._00=1,this.self._01=0,this.self._02=0,this.self._03=0,this.self._10=0,this.self._11=1,this.self._12=0,this.self._13=0,this.self._20=0,this.self._21=0,this.self._22=1,this.self._23=0,this.self._30=e,this.self._31=t,this.self._32=i,this.self._33=1},scale:function(e){this.self._00*=e.x,this.self._01*=e.x,this.self._02*=e.x,this.self._03*=e.x,this.self._10*=e.y,this.self._11*=e.y,this.self._12*=e.y,this.self._13*=e.y,this.self._20*=e.z,this.self._21*=e.z,this.self._22*=e.z,this.self._23*=e.z},multmat3x4:function(e,t){var i=e.self._00,a=e.self._01,s=e.self._02,r=e.self._10,n=e.self._11,l=e.self._12,o=e.self._20,h=e.self._21,c=e.self._22,u=e.self._30,d=e.self._31,f=e.self._32,_=t.self._00,v=t.self._01,p=t.self._02,m=t.self._10,g=t.self._11,b=t.self._12,w=t.self._20,B=t.self._21,y=t.self._22,x=t.self._30,I=t.self._31,S=t.self._32;this.self._00=i*_+a*m+s*w,this.self._01=i*v+a*g+s*B,this.self._02=i*p+a*b+s*y,this.self._03=0,this.self._10=r*_+n*m+l*w,this.self._11=r*v+n*g+l*B,this.self._12=r*p+n*b+l*y,this.self._13=0,this.self._20=o*_+h*m+c*w,this.self._21=o*v+h*g+c*B,this.self._22=o*p+h*b+c*y,this.self._23=0,this.self._30=u*_+d*m+f*w+x,this.self._31=u*v+d*g+f*B+I,this.self._32=u*p+d*b+f*y+S,this.self._33=1},multmat2:function(e){var t=this.self._00,i=this.self._01,a=this.self._02,s=this.self._03,r=this.self._10,n=this.self._11,l=this.self._12,o=this.self._13,h=this.self._20,c=this.self._21,u=this.self._22,d=this.self._23,f=this.self._30,_=this.self._31,v=this.self._32,p=this.self._33,m=e.self._00,g=e.self._01,b=e.self._02,w=e.self._03,B=e.self._10,y=e.self._11,x=e.self._12,I=e.self._13,S=e.self._20,k=e.self._21,C=e.self._22,A=e.self._23,M=e.self._30,N=e.self._31,T=e.self._32,F=e.self._33;return this.self._00=t*m+i*B+a*S+s*M,this.self._01=t*g+i*y+a*k+s*N,this.self._02=t*b+i*x+a*C+s*T,this.self._03=t*w+i*I+a*A+s*F,this.self._10=r*m+n*B+l*S+o*M,this.self._11=r*g+n*y+l*k+o*N,this.self._12=r*b+n*x+l*C+o*T,this.self._13=r*w+n*I+l*A+o*F,this.self._20=h*m+c*B+u*S+d*M,this.self._21=h*g+c*y+u*k+d*N,this.self._22=h*b+c*x+u*C+d*T,this.self._23=h*w+c*I+u*A+d*F,this.self._30=f*m+_*B+v*S+p*M,this.self._31=f*g+_*y+v*k+p*N,this.self._32=f*b+_*x+v*C+p*T,this.self._33=f*w+_*I+v*A+p*F,this},multmats:function(e,t){var i=e.self._00,a=e.self._10,s=e.self._20,r=e.self._30,n=e.self._01,l=e.self._11,o=e.self._21,h=e.self._31,c=e.self._02,u=e.self._12,d=e.self._22,f=e.self._32,_=e.self._03,v=e.self._13,p=e.self._23,m=e.self._33,g=t.self._00,b=t.self._10,w=t.self._20,B=t.self._30,y=t.self._01,x=t.self._11,I=t.self._21,S=t.self._31,k=t.self._02,C=t.self._12,A=t.self._22,M=t.self._32,N=t.self._03,T=t.self._13,F=t.self._23,D=t.self._33;return this.self._00=i*g+a*y+s*k+r*N,this.self._10=i*b+a*x+s*C+r*T,this.self._20=i*w+a*I+s*A+r*F,this.self._30=i*B+a*S+s*M+r*D,this.self._01=n*g+l*y+o*k+h*N,this.self._11=n*b+l*x+o*C+h*T,this.self._21=n*w+l*I+o*A+h*F,this.self._31=n*B+l*S+o*M+h*D,this.self._02=c*g+u*y+d*k+f*N,this.self._12=c*b+u*x+d*C+f*T,this.self._22=c*w+u*I+d*A+f*F,this.self._32=c*B+u*S+d*M+f*D,this.self._03=_*g+v*y+p*k+m*N,this.self._13=_*b+v*x+p*C+m*T,this.self._23=_*w+v*I+p*A+m*F,this.self._33=_*B+v*S+p*M+m*D,this},getInverse:function(e){var t=e.self._00,i=e.self._10,a=e.self._20,s=e.self._30,r=e.self._01,n=e.self._11,l=e.self._21,o=e.self._31,h=e.self._02,c=e.self._12,u=e.self._22,d=e.self._32,f=e.self._03,_=e.self._13,v=e.self._23,p=e.self._33;this.self._00=l*d*_-o*u*_+o*c*v-n*d*v-l*c*p+n*u*p,this.self._10=s*u*_-a*d*_-s*c*v+i*d*v+a*c*p-i*u*p,this.self._20=a*o*_-s*l*_+s*n*v-i*o*v-a*n*p+i*l*p,this.self._30=s*l*c-a*o*c-s*n*u+i*o*u+a*n*d-i*l*d,this.self._01=o*u*f-l*d*f-o*h*v+r*d*v+l*h*p-r*u*p,this.self._11=a*d*f-s*u*f+s*h*v-t*d*v-a*h*p+t*u*p,this.self._21=s*l*f-a*o*f-s*r*v+t*o*v+a*r*p-t*l*p,this.self._31=a*o*h-s*l*h+s*r*u-t*o*u-a*r*d+t*l*d,this.self._02=n*d*f-o*c*f+o*h*_-r*d*_-n*h*p+r*c*p,this.self._12=s*c*f-i*d*f-s*h*_+t*d*_+i*h*p-t*c*p,this.self._22=i*o*f-s*n*f+s*r*_-t*o*_-i*r*p+t*n*p,this.self._32=s*n*h-i*o*h-s*r*c+t*o*c+i*r*d-t*n*d,this.self._03=l*c*f-n*u*f-l*h*_+r*u*_+n*h*v-r*c*v,this.self._13=i*u*f-a*c*f+a*h*_-t*u*_-i*h*v+t*c*v,this.self._23=a*n*f-i*l*f-a*r*_+t*l*_+i*r*v-t*n*v,this.self._33=i*l*h-a*n*h+a*r*c-t*l*c-i*r*u+t*n*u;var m=t*this.self._00+r*this.self._10+h*this.self._20+f*this.self._30;return 0==m?this.setIdentity():(this.mult(1/m),this)},transpose:function(){var e=this.self._01;this.self._01=this.self._10,this.self._10=e,e=this.self._02,this.self._02=this.self._20,this.self._20=e,e=this.self._03,this.self._03=this.self._30,this.self._30=e,e=this.self._12,this.self._12=this.self._21,this.self._21=e,e=this.self._13,this.self._13=this.self._31,this.self._31=e,e=this.self._23,this.self._23=this.self._32,this.self._32=e},transpose3x3:function(){var e=this.self._01;this.self._01=this.self._10,this.self._10=e,e=this.self._02,this.self._02=this.self._20,this.self._20=e,e=this.self._12,this.self._12=this.self._21,this.self._21=e},setF32:function(e,t){null==t&&(t=0),this.self._00=e[t],this.self._10=e[1+t],this.self._20=e[2+t],this.self._30=e[3+t],this.self._01=e[4+t],this.self._11=e[5+t],this.self._21=e[6+t],this.self._31=e[7+t],this.self._02=e[8+t],this.self._12=e[9+t],this.self._22=e[10+t],this.self._32=e[11+t],this.self._03=e[12+t],this.self._13=e[13+t],this.self._23=e[14+t],this.self._33=e[15+t]},setFrom:function(e){this.self._00=e.self._00,this.self._01=e.self._01,this.self._02=e.self._02,this.self._03=e.self._03,this.self._10=e.self._10,this.self._11=e.self._11,this.self._12=e.self._12,this.self._13=e.self._13,this.self._20=e.self._20,this.self._21=e.self._21,this.self._22=e.self._22,this.self._23=e.self._23,this.self._30=e.self._30,this.self._31=e.self._31,this.self._32=e.self._32,this.self._33=e.self._33},getScale:function(){return new ee(Math.sqrt(this.self._00*this.self._00+this.self._10*this.self._10+this.self._20*this.self._20),Math.sqrt(this.self._01*this.self._01+this.self._11*this.self._11+this.self._21*this.self._21),Math.sqrt(this.self._02*this.self._02+this.self._12*this.self._12+this.self._22*this.self._22))},mult:function(e){return this.self._00*=e,this.self._10*=e,this.self._20*=e,this.self._30*=e,this.self._01*=e,this.self._11*=e,this.self._21*=e,this.self._31*=e,this.self._02*=e,this.self._12*=e,this.self._22*=e,this.self._32*=e,this.self._03*=e,this.self._13*=e,this.self._23*=e,this.self._33*=e,this},toRotation:function(){var e=new ee,t=e.set(this.self._00,this.self._01,this.self._02),i=1/Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),a=e.set(this.self._10,this.self._11,this.self._12),s=1/Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),r=e.set(this.self._20,this.self._21,this.self._22),n=1/Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return this.self._00*=i,this.self._01*=i,this.self._02*=i,this.self._03=0,this.self._10*=s,this.self._11*=s,this.self._12*=s,this.self._13=0,this.self._20*=n,this.self._21*=n,this.self._22*=n,this.self._23=0,this.self._30=0,this.self._31=0,this.self._32=0,this.self._33=1,this},setLookAt:function(e,t,i){var a=t.x-e.x,s=t.y-e.y,r=t.z-e.z,n=1/Math.sqrt(a*a+s*s+r*r);a*=n,r*=n;var l=(s*=n)*i.z-r*i.y,o=r*i.x-a*i.z,h=a*i.y-s*i.x,c=(o*=n=1/Math.sqrt(l*l+o*o+h*h))*r-(h*=n)*s,u=h*a-(l*=n)*r,d=l*s-o*a,f=-e.x*l-e.y*o-e.z*h,_=-e.x*c-e.y*u-e.z*d,v=e.x*a+e.y*s+e.z*r;return this.self._00=l,this.self._10=o,this.self._20=h,this.self._30=f,this.self._01=c,this.self._11=u,this.self._21=d,this.self._31=_,this.self._02=-a,this.self._12=-s,this.self._22=-r,this.self._32=v,this.self._03=0,this.self._13=0,this.self._23=0,this.self._33=1,this},__class__:te};var ie=function(){this.depthBuffers=[],this.currentMaterial=null,this.depthToRenderTarget=new R,this.renderTargets=new R,this.commands=null,this.loading=0,this.currentLampIndex=0,this.lastH=0,this.lastW=0,this.viewportScaled=!1,this.scissorSet=!1,this.frameScissorH=0,this.frameScissorW=0,this.frameScissorY=0,this.frameScissorX=0,this.frameScissor=!1;var e=new ae;e.name="arm_empty",e.width=1,e.height=1,e.format="DEPTH16",this.createRenderTarget(e);var t=new ae;t.name="arm_empty_cube",t.width=1,t.height=1,t.format="DEPTH16",t.is_cubemap=!0,this.createRenderTarget(t)};s["iron.RenderPath"]=ie,ie.__name__=!0,ie.setActive=function(e){ie.active=e},ie.sortMeshes=function(e,t){for(var i=t.transform.world.self._30,a=t.transform.world.self._31,s=t.transform.world.self._32,r=0;r<e.length;){var n=e[r];++r;var l=i-n.transform.world.self._30,o=a-n.transform.world.self._31,h=s-n.transform.world.self._32;n.cameraDistance=Math.sqrt(l*l+o*o+h*h)}e.sort(function(e,t){return e.cameraDistance>=t.cameraDistance?1:-1})},ie.prototype={get_ready:function(){return 0==this.loading},renderFrame:function(e){if(this.get_ready()&&0!=Bt.windowWidth()&&0!=Bt.windowHeight()){this.lastW>0&&(this.lastW!=Bt.windowWidth()||this.lastH!=Bt.windowHeight())&&this.resize(),this.lastW=Bt.windowWidth(),this.lastH=Bt.windowHeight(),this.frameG=null==re.active.camera.data.mirror?e:re.active.camera.data.mirror.get_g4(),this.currentG=this.frameG,this.currentW=Bt.windowWidth(),this.currentH=Bt.windowHeight(),this.currentD=1,this.currentCube=!1,this.currentFace=-1,this.meshesSorted=!1,this.currentLampIndex=0;for(var t=0,i=re.active.lamps;t<i.length;){var a=i[t];++t,a.visible&&a.buildMatrices(re.active.camera)}this.commands()}},setTarget:function(e,t,i){if(null==i&&(i=1),""==e)this.currentG=this.frameG,this.currentW=Bt.windowWidth(),this.currentH=Bt.windowHeight(),this.currentD=1,this.currentCube=!1,this.currentFace=-1,this.frameScissor&&this.setFrameScissor(),this.currentG.begin(null);else{var a=this.renderTargets,s=null!=Ia[e]?a.getReserved(e):a.h[e];if("shadowMap"==e&&(re.active.lamps.length>0?re.active.lamps[this.currentLampIndex]:null).data.raw.shadowmap_cube){var r=this.renderTargets,n=e+"Cube";if(null==(s=null!=Ia[n]?r.getReserved(n):r.h[n])){var l=0|(re.active.lamps.length>0?re.active.lamps[this.currentLampIndex]:null).data.raw.shadowmap_size,o=new ae;o.name=e+"Cube",o.width=l,o.height=l,o.format="DEPTH16",o.is_cubemap=!0,s=this.createRenderTarget(o)}}if("shadowMap"==e&&null==s){var h=(re.active.lamps.length>0?re.active.lamps[this.currentLampIndex]:null).data.raw.shadowmap_size,c=h,u=new ae;u.name=e,u.width=h,u.height=c,u.format="DEPTH16",s=this.createRenderTarget(u)}var d=null;if(null!=t){d=[];for(var f=0;f<t.length;){var _=t[f];++f;var v=this.renderTargets,p=null!=Ia[_]?v.getReserved(_):v.h[_];d.push(p.image)}}this.currentG=s.isCubeMap?s.cubeMap.get_g4():s.image.get_g4(),this.currentW=s.isCubeMap?s.cubeMap.get_width():s.image.get_width(),this.currentH=s.isCubeMap?s.cubeMap.get_height():s.image.get_height(),s.is3D&&(this.currentD=s.image.get_depth()),this.currentCube=s.isCubeMap;var m=this.currentG,g=this.currentFace;g>=0?m.beginFace(5-g):m.begin(d)}if(1!=i){this.viewportScaled=!0;var b=this.currentW*i|0,w=this.currentH*i|0;this.currentG.viewport(0,w,b,w),this.currentG.scissor(0,w,b,w)}else this.viewportScaled&&(this.viewportScaled=!1,this.setCurrentViewport(this.currentW,this.currentH),this.setCurrentScissor(this.currentW,this.currentH));this.bindParams=null},setCurrentViewport:function(e,t){this.currentG.viewport(0,this.currentH-t,e,t)},setCurrentScissor:function(e,t){this.currentG.scissor(0,this.currentH-t,e,t),this.scissorSet=!0},setFrameScissor:function(){this.frameG.scissor(this.frameScissorX,this.currentH-(this.frameScissorH-this.frameScissorY),this.frameScissorW,this.frameScissorH)},clearTarget:function(e,t){-1==e&&(e=re.active.world.raw.background_color),this.currentG.clear(e,t,null)},drawMeshes:function(e){var t=re.active.lamps.length>0?re.active.lamps[this.currentLampIndex]:null;if((null==t||t.visible||!(this.currentLampIndex>0))&&(!("shadowmap"==e)||null!=t&&t.data.raw.cast_shadow)){this.currentFace>=0&&null!=t&&t.setCubeFace(5-this.currentFace,re.active.camera);var i=this.currentG;this.submitDraw(e),i.end(),this.scissorSet&&(i.disableScissor(),this.scissorSet=!1),this.bindParams=null}},submitDraw:function(e){var t=re.active.lamps.length>0?re.active.lamps[this.currentLampIndex]:null,i=this.currentG;this.meshesSorted||(ie.sortMeshes(re.active.meshes,re.active.camera),this.meshesSorted=!0);for(var a=0,s=re.active.meshes;a<s.length;){var r=s[a];++a,r.render(i,e,re.active.camera,t,this.bindParams)}},resize:function(){for(var e=this.renderTargets,t=new D(e,e.arrayKeys());t.hasNext();){var i=t.next();if(0==i.raw.width&&(i.image.unload(),i.image=this.createImage(i.raw,i.depthStencil),""!=i.depthStencilFrom)){var a=i.depthStencilFrom,s=this.depthToRenderTarget;i.image.setDepthStencilFrom((null!=Ia[a]?s.getReserved(a):s.h[a]).image)}}},createRenderTarget:function(e){var t=this.createTarget(e),i=e.name,a=this.renderTargets;return null!=Ia[i]?a.setReserved(i,t):a.h[i]=t,t},createTarget:function(e){var t=new se(e);if(null!=e.depth_buffer){t.hasDepth=!0;var i=e.depth_buffer,a=this.depthToRenderTarget,s=null!=Ia[i]?a.getReserved(i):a.h[i];if(null==s)for(var r=0,n=this.depthBuffers;r<n.length;){var l=n[r];if(++r,l.name==e.depth_buffer){var o=l.name,h=this.depthToRenderTarget;null!=Ia[o]?h.setReserved(o,t):h.h[o]=t;var c,u=l.format;if(null==u||""==u)c=1;else switch(u){case"DEPTH16":c=5;break;case"DEPTH24":c=1;break;default:c=1}t.depthStencil=c,t.image=this.createImage(e,t.depthStencil);break}}else t.depthStencil=0,t.depthStencilFrom=e.depth_buffer,t.image=this.createImage(e,t.depthStencil),t.image.setDepthStencilFrom(s.image)}else t.hasDepth=!1,null!=e.depth&&e.depth>1&&(t.is3D=!0),e.is_cubemap?(t.isCubeMap=!0,t.depthStencil=0,t.cubeMap=this.createCubeMap(e,t.depthStencil)):(t.depthStencil=0,t.image=this.createImage(e,t.depthStencil));return t},createImage:function(e,t){var i=0==e.width?Bt.windowWidth():e.width,a=0==e.height?Bt.windowHeight():e.height,s=null!=e.depth?e.depth:0;if(null!=e.displayp&&(i>a?(a=a*(e.displayp/i)|0,i=e.displayp):(i=i*(e.displayp/a)|0,a=e.displayp)),null!=e.scale&&(i=i*e.scale|0,a=a*e.scale|0,s=s*e.scale|0),null!=e.depth&&e.depth>1){var r;if(null!=e.format)switch(e.format){case"A16":r=Ei.A16;break;case"A32":r=Ei.A32;break;case"A8":r=Ei.L8;break;case"DEPTH16":r=Ei.DEPTH16;break;case"R16":r=Ei.A16;break;case"R32":r=Ei.A32;break;case"R8":r=Ei.L8;break;case"RGBA128":r=Ei.RGBA128;break;case"RGBA32":r=Ei.RGBA32;break;case"RGBA64":r=Ei.RGBA64;break;default:r=Ei.RGBA32}else r=Ei.RGBA32;return rt.create3D(i,a,s,r)}if(null!=e.is_image&&e.is_image){var n;if(null!=e.format)switch(e.format){case"A16":n=Ei.A16;break;case"A32":n=Ei.A32;break;case"A8":n=Ei.L8;break;case"DEPTH16":n=Ei.DEPTH16;break;case"R16":n=Ei.A16;break;case"R32":n=Ei.A32;break;case"R8":n=Ei.L8;break;case"RGBA128":n=Ei.RGBA128;break;case"RGBA32":n=Ei.RGBA32;break;case"RGBA64":n=Ei.RGBA64;break;default:n=Ei.RGBA32}else n=Ei.RGBA32;return rt.create(i,a,n)}var l;if(null!=e.format)switch(e.format){case"A16":l=Ei.A16;break;case"A32":l=Ei.A32;break;case"A8":l=Ei.L8;break;case"DEPTH16":l=Ei.DEPTH16;break;case"R16":l=Ei.A16;break;case"R32":l=Ei.A32;break;case"R8":l=Ei.L8;break;case"RGBA128":l=Ei.RGBA128;break;case"RGBA32":l=Ei.RGBA32;break;case"RGBA64":l=Ei.RGBA64;break;default:l=Ei.RGBA32}else l=Ei.RGBA32;return rt.createRenderTarget(i,a,l,t)},createCubeMap:function(e,t){var i;if(null!=e.format)switch(e.format){case"A16":i=Ei.A16;break;case"A32":i=Ei.A32;break;case"A8":i=Ei.L8;break;case"DEPTH16":i=Ei.DEPTH16;break;case"R16":i=Ei.A16;break;case"R32":i=Ei.A32;break;case"R8":i=Ei.L8;break;case"RGBA128":i=Ei.RGBA128;break;case"RGBA32":i=Ei.RGBA32;break;case"RGBA64":i=Ei.RGBA64;break;default:i=Ei.RGBA32}else i=Ei.RGBA32;return gi.createRenderTarget(e.width,i,t)},__class__:ie,__properties__:{get_ready:"get_ready"}};var ae=function(){this.is_cubemap=null,this.is_image=null,this.depth=null,this.mipmaps=null,this.depth_buffer=null,this.displayp=null,this.scale=null,this.format=null};s["iron.RenderTargetRaw"]=ae,ae.__name__=!0,ae.prototype={__class__:ae};var se=function(e){this.isCubeMap=!1,this.is3D=!1,this.hasDepth=!1,this.cubeMap=null,this.image=null,this.depthStencilFrom="",this.raw=e};s["iron.RenderTarget"]=se,se.__name__=!0,se.prototype={__class__:se};var re=function(){this.traitInits=[],this.groups=null,this.meshBatch=null,this.meshes=[],this.lamps=[],this.cameras=[],this.speakers=[],this.decals=[],this.empties=[],this.animations=[],this.armatures=[],this.embedded=new R,this.root=new Se,this.root.name="Root",this.traitInits=[],null==re.global&&(re.global=new Se)};s["iron.Scene"]=re,re.__name__=!0,re.create=function(e,t){re.active=new re,re.active.ready=!1,re.active.raw=e,le.getWorld(e.name,e.world_ref,function(i){re.active.world=i,re.active.addScene(e.name,null,function(i){0==re.active.cameras.length&&(k.trace('No camera found for scene "'+e.name+'"!',{fileName:"Scene.hx",lineNumber:91,className:"iron.Scene",methodName:"create"}),t(null)),re.active.camera=re.active.getCamera(e.camera_ref),t(i);for(var a=0,s=re.active.traitInits;a<s.length;){var r=s[a];++a,r()}re.active.traitInits=[]})})},re.setActive=function(e,t){re.framePassed&&(re.framePassed=!1,null!=re.active&&re.active.remove(),le.getSceneRaw(e,function(e){re.create(e,function(e){null!=t&&t(e),re.active.ready=!0})}))},re.generateTranform=function(e,t){t.world=te.fromFloat32Array(e.transform.values),t.world.decompose(t.loc,t.rot,t.scale),null!=e.local_transform_only&&(t.localOnly=e.local_transform_only),null!=t.object.parent&&t.update()},re.createTraits=function(e,t){if(null!=e)for(var i=0;i<e.length;){var a=e[i];if(++i,"Script"==a.type){var s=[];if(null!=a.parameters)for(var r=0,n=a.parameters;r<n.length;){var l=n[r];++r,s.push(re.parseArg(l))}var o=re.createTraitClassInstance(a.class_name,s);if(null==o){k.trace("Error: Trait '"+a.class_name+"' referenced in object '"+t.name+"' not found",{fileName:"Scene.hx",lineNumber:576,className:"iron.Scene",methodName:"createTraits"});continue}if(null!=a.props)for(var h=0,c=a.props.length/2|0;h<c;){var u=h++,d=a.props[2*u],_=a.props[2*u+1];""!=_&&f.setProperty(o,d,re.parseArg(_))}t.addTrait(o)}}},re.parseArg=function(e){if("true"==e)return!0;if("false"==e)return!1;if("null"==e)return null;if("'"==e.charAt(0))return v.replace(e,"'","");if('"'==e.charAt(0))return v.replace(e,'"',"");if("["==e.charAt(0)){e=v.replace(e,"[",""),e=v.replace(e,"]","");for(var t=[],i=(e=v.replace(e," ","")).split(","),a=0;a<i.length;){var s=i[a];++a,t.push(re.parseArg(s))}return t}var r=parseFloat(e),n=_.parseInt(e);return r==n?n:r},re.createConstraints=function(e,t){if(null!=e){t.constraints=[];for(var i=0;i<e.length;){var a=e[i];++i;var s=new Ae(a);t.constraints.push(s)}}},re.createTraitClassInstance=function(e,t){var i=p.resolveClass(e);return null==i?null:p.createInstance(i,t)},re.prototype={remove:function(){null!=this.meshBatch&&this.meshBatch.remove();for(var e=0,t=this.meshes;e<t.length;){var i=t[e];++e,i.remove()}for(var a=0,s=this.lamps;a<s.length;){var r=s[a];++a,r.remove()}for(var n=0,l=this.cameras;n<l.length;){var o=l[n];++n,o.remove()}for(var h=0,c=this.speakers;h<c.length;){var u=c[h];++h,u.remove()}for(var d=0,f=this.decals;d<f.length;){var _=f[d];++d,_.remove()}for(var v=0,p=this.empties;v<p.length;){var m=p[v];++v,m.remove()}this.groups=null,this.root.remove()},updateFrame:function(){if(this.ready){for(var e=0,t=this.animations;e<t.length;){var i=t[e];++e,i.update(.016666666666666666*Ke.scale)}for(var a=0,s=this.empties;a<s.length;){var r=s[a];++a,null!=r&&null!=r.parent&&r.transform.update()}}},renderFrame:function(e){if(this.ready&&null!=ie.active){re.framePassed=!0;for(var t=this.camera,i=0,a=this.cameras;i<a.length;){var s=a[i];++i,null!=s.data.mirror&&(this.camera=s,this.camera.renderFrame(e))}this.camera=t,this.camera.renderFrame(e)}},addObject:function(e){var t=new Se;return null!=e?e.addChild(t):this.root.addChild(t),t},getChild:function(e){return this.root.getChild(e)},getCamera:function(e){for(var t=0,i=this.cameras;t<i.length;){var a=i[t];if(++t,a.name==e)return a}return null},addMeshObject:function(e,t,i){var a=new Te(e,t);return null!=i?i.addChild(a):this.root.addChild(a),a},addLampObject:function(e,t){var i=new Ne(e);return null!=t?t.addChild(i):this.root.addChild(i),i},addCameraObject:function(e,t){var i=new ke(e);return null!=t?t.addChild(i):this.root.addChild(i),i},addSpeakerObject:function(e,t){var i=new Pe(e);return null!=t?t.addChild(i):this.root.addChild(i),i},addDecalObject:function(e,t){var i=new Me(e);return null!=t?t.addChild(i):this.root.addChild(i),i},addScene:function(e,t,i){var a=this;null==t&&((t=this.addObject()).name=e),le.getSceneRaw(e,function(e){re.createTraits(e.traits,t),a.loadEmbeddedData(e.embedded_datas,function(){var s=0,r=a.getObjectsCount(e.objects),n=null;(n=function(t,i,l,o){if(null!=i)for(var h=0,c=i.length;h<c;){var u=[i[h++]];if(null==u[0].spawn||0!=u[0].spawn){var d=u[0],f=function(e){return function(t){null!=t&&n(t,e[0].children,e[0],o),(s+=1)==r&&o()}}(u);a.createObject(d,e,t,l,f)}else(s+=1)==r&&o()}})(t,e.objects,null,function(){i(t)})})})},getObjectsCount:function(e,t){null==t&&(t=!0);for(var i=e.length,a=0;a<e.length;){var s=e[a];++a,t&&null!=s.spawn&&0==s.spawn||null!=s.children&&(i+=this.getObjectsCount(s.children))}return i},spawnObject:function(e,t,i,a){null==a&&(a=!0);var s=this,r=0,n=this.getObj(this.raw,e),l=a?this.getObjectsCount([n],!1):1,o=null;(o=function(e,t,i){s.createObject(e,s.raw,t,null,function(t){if(a&&null!=e.children)for(var s=0,n=e.children;s<n.length;){var h=n[s];++s,o(h,t,i)}(r+=1)==l&&null!=i&&i(t)})})(n,t,i)},getObj:function(e,t){return this.traverseObjs(e.objects,t)},traverseObjs:function(e,t){for(var i=0;i<e.length;){var a=e[i];if(++i,a.name==t)return a;if(null!=a.children){var s=this.traverseObjs(a.children,t);if(null!=s)return s}}return null},createObject:function(e,t,i,a,s){var r=this,n=t.name;if("camera_object"==e.type)le.getCamera(n,e.data_ref,function(t){var a=r.addCameraObject(t,i);r.returnObject(a,e,s)});else if("lamp_object"==e.type)le.getLamp(n,e.data_ref,function(t){var a=r.addLampObject(t,i);r.returnObject(a,e,s)});else if("mesh_object"==e.type)if(null==e.material_refs||0==e.material_refs.length){var l=this.addObject(i);this.returnObject(l,e,s)}else for(var o=e.material_refs.length,h=new Array(o),c=0,u=0,d=e.material_refs.length;u<d;){var f=[u++],_=e.material_refs[f[0]],v=function(t){return function(l){if(h[t[0]]=l,(c+=1)==e.material_refs.length){var o=e.data_ref.split("/"),u="",d="";if(2==o.length?(u=o[0],d=o[1]):(u=n,d=e.data_ref),null!=a&&null!=a.bone_actions)for(var f=[],_=0,v=a.bone_actions;_<v.length;){var p=v[_];++_,le.getSceneRaw(p,function(t){if(f.push(t),f.length==a.bone_actions.length){var l=new ne(a.name,f);r.armatures.push(l),r.returnMeshObject(u,d,n,l,h,i,e,s)}})}else r.returnMeshObject(u,d,n,null,h,i,e,s)}}}(f);le.getMaterial(n,_,v)}else if("speaker_object"==e.type){var p=this.addSpeakerObject(le.getSpeakerRawByName(t.speaker_datas,e.data_ref),i);this.returnObject(p,e,s)}else if("decal_object"==e.type)if(null!=e.material_refs&&e.material_refs.length>0)le.getMaterial(n,e.material_refs[0],function(t){var a=r.addDecalObject(t,i);r.returnObject(a,e,s)});else{var m=this.addDecalObject(null,i);this.returnObject(m,e,s)}else if("object"==e.type){var g=this.addObject(i);this.returnObject(g,e,function(t){if(null!=e.group_ref){var i=0,a=r.getGroupObjectRefs(e.group_ref);if(0==a.length)s(t);else for(var n=0;n<a.length;){var l=a[n];++n,r.spawnObject(l,t,function(e){(i+=1)==a.length&&s(t)})}}else s(t)})}else s(null)},getGroupObjectRefs:function(e){for(var t=0,i=this.raw.groups;t<i.length;){var a=i[t];if(++t,a.name==e)return a.object_refs}return null},returnMeshObject:function(e,t,i,a,s,r,n,l){var o=this;le.getMesh(e,t,a,function(e){var t=o.addMeshObject(e,s,r);if(null!=n.particle_refs)for(var a=0,h=n.particle_refs;a<h.length;){var c=h[a];++a,qe.__cast(t,Te).setupParticleSystem(i,c)}null!=n.tilesheet_ref&&qe.__cast(t,Te).setupTilesheet(i,n.tilesheet_ref,n.tilesheet_action_ref),o.returnObject(t,n,l)})},returnObject:function(e,t,i){var a=this;if(null!=e&&null!=t.object_actions){for(var s=[];s.length<t.object_actions.length;)s.push(null);for(var r=0,n=0,l=t.object_actions.length;n<l;){var o=[n++],h=t.object_actions[o[0]];"null"!=h?le.getSceneRaw(h,function(n){return function(l){s[n[0]]=l,(r+=1)==t.object_actions.length&&a.returnObjectLoaded(e,t,s,i)}}(o)):r+=1}}else this.returnObjectLoaded(e,t,null,i)},returnObjectLoaded:function(e,t,i,a){if(null!=e){if(e.raw=t,e.name=t.name,null!=t.visible&&(e.visible=t.visible),null!=t.visible_mesh&&(e.visibleMesh=t.visible_mesh),null!=t.visible_shadow&&(e.visibleShadow=t.visible_shadow),re.createConstraints(t.constraints,e),re.generateTranform(t,e.transform),e.setupAnimation(i),null!=t.groups){null==this.groups&&(this.groups=new R);for(var s=0,r=t.groups;s<r.length;){var n=r[s];++s;var l=this.groups,o=null!=Ia[n]?l.getReserved(n):l.h[n];if(null==o){o=[];var h=this.groups;null!=Ia[n]?h.setReserved(n,o):h.h[n]=o}o.push(e)}}re.createTraits(t.traits,e)}a(e)},loadEmbeddedData:function(e,t){var i=this;if(null!=e)for(var a=0,s=0;s<e.length;){var r=[e[s]];++s,le.getImage(r[0],function(s){return function(r){var n=i.embedded;null!=Ia[s[0]]?n.setReserved(s[0],r):n.h[s[0]]=r,(a+=1)==e.length&&t()}}(r))}else t()},notifyOnInit:function(e){this.ready?e():this.traitInits.push(e)},__class__:re};var ne=function(e,t){this.matsReady=!1,this.actions=[],this.name=e;for(var i=0;i<t.length;){var a=t[i];++i;for(var s=0,r=a.objects;s<r.length;){var n=r[s];++s,ne.setParents(n)}var l=[[]];ne.traverseBones(a.objects,function(e){return function(t){e[0].push(t)}}(l)),this.actions.push({name:a.name,bones:l[0],mats:null})}};s["iron.data.Armature"]=ne,ne.__name__=!0,ne.setParents=function(e){if(null!=e.children)for(var t=0,i=e.children;t<i.length;){var a=i[t];++t,a.parent=e,ne.setParents(a)}},ne.traverseBones=function(e,t){for(var i=0,a=e.length;i<a;){var s=i++;ne.traverseBonesStep(e[s],t)}},ne.traverseBonesStep=function(e,t){if("bone_object"==e.type&&t(e),null!=e.children)for(var i=0,a=e.children.length;i<a;){var s=i++;ne.traverseBonesStep(e.children[s],t)}},ne.prototype={initMats:function(){if(!this.matsReady){this.matsReady=!0;for(var e=0,t=this.actions;e<t.length;){var i=t[e];if(++e,null==i.mats){i.mats=[];for(var a=0,s=i.bones;a<s.length;){var r=s[a];++a,i.mats.push(te.fromFloat32Array(r.transform.values))}}}}},getAction:function(e){for(var t=0,i=this.actions;t<i.length;){var a=i[t];if(++t,a.name==e)return a}return null},__class__:ne};var le=function(){};s["iron.data.Data"]=le,le.__name__=!0,le.getMesh=function(e,t,i,a){var s=e+t,r=le.cachedMeshes,n=null!=Ia[s]?r.getReserved(s):r.h[s];if(null==n){var l=le.loadingMeshes,o=null!=Ia[s]?l.getReserved(s):l.h[s];if(null==o){var h=le.loadingMeshes,c=e+t,u=[a];null!=Ia[c]?h.setReserved(c,u):h.h[c]=u,ve.parse(e,t,i,function(i){var a=le.cachedMeshes,r=e+t;null!=Ia[r]?a.setReserved(r,i):a.h[r]=i,i.handle=s;for(var n=0,l=le.loadingMeshes,o=e+t,h=null!=Ia[o]?l.getReserved(o):l.h[o];n<h.length;){var c=h[n];++n,c(i)}le.loadingMeshes.remove(e+t)})}else o.push(a)}else a(n)},le.getLamp=function(e,t,i){var a=le.cachedLamps,s=e+t,r=null!=Ia[s]?a.getReserved(s):a.h[s];if(null==r){var n=le.loadingLamps,l=e+t,o=null!=Ia[l]?n.getReserved(l):n.h[l];if(null==o){var h=le.loadingLamps,c=e+t,u=[i];null!=Ia[c]?h.setReserved(c,u):h.h[c]=u,ce.parse(e,t,function(i){var a=le.cachedLamps,s=e+t;null!=Ia[s]?a.setReserved(s,i):a.h[s]=i;for(var r=0,n=le.loadingLamps,l=e+t,o=null!=Ia[l]?n.getReserved(l):n.h[l];r<o.length;){var h=o[r];++r,h(i)}le.loadingLamps.remove(e+t)})}else o.push(i)}else i(r)},le.getCamera=function(e,t,i){var a=le.cachedCameras,s=e+t,r=null!=Ia[s]?a.getReserved(s):a.h[s];if(null==r){var n=le.loadingCameras,l=e+t,o=null!=Ia[l]?n.getReserved(l):n.h[l];if(null==o){var h=le.loadingCameras,c=e+t,u=[i];null!=Ia[c]?h.setReserved(c,u):h.h[c]=u,oe.parse(e,t,function(i){var a=le.cachedCameras,s=e+t;null!=Ia[s]?a.setReserved(s,i):a.h[s]=i;for(var r=0,n=le.loadingCameras,l=e+t,o=null!=Ia[l]?n.getReserved(l):n.h[l];r<o.length;){var h=o[r];++r,h(i)}le.loadingCameras.remove(e+t)})}else o.push(i)}else i(r)},le.getMaterial=function(e,t,i){var a=le.cachedMaterials,s=e+t,r=null!=Ia[s]?a.getReserved(s):a.h[s];if(null==r){var n=le.loadingMaterials,l=e+t,o=null!=Ia[l]?n.getReserved(l):n.h[l];if(null==o){var h=le.loadingMaterials,c=e+t,u=[i];null!=Ia[c]?h.setReserved(c,u):h.h[c]=u,ue.parse(e,t,function(i){var a=le.cachedMaterials,s=e+t;null!=Ia[s]?a.setReserved(s,i):a.h[s]=i;for(var r=0,n=le.loadingMaterials,l=e+t,o=null!=Ia[l]?n.getReserved(l):n.h[l];r<o.length;){var h=o[r];++r,h(i)}le.loadingMaterials.remove(e+t)})}else o.push(i)}else i(r)},le.getParticle=function(e,t,i){var a=le.cachedParticles,s=e+t,r=null!=Ia[s]?a.getReserved(s):a.h[s];if(null==r){var n=le.loadingParticles,l=e+t,o=null!=Ia[l]?n.getReserved(l):n.h[l];if(null==o){var h=le.loadingParticles,c=e+t,u=[i];null!=Ia[c]?h.setReserved(c,u):h.h[c]=u,pe.parse(e,t,function(i){var a=le.cachedParticles,s=e+t;null!=Ia[s]?a.setReserved(s,i):a.h[s]=i;for(var r=0,n=le.loadingParticles,l=e+t,o=null!=Ia[l]?n.getReserved(l):n.h[l];r<o.length;){var h=o[r];++r,h(i)}le.loadingParticles.remove(e+t)})}else o.push(i)}else i(r)},le.getWorld=function(e,t,i){if(null!=t){var a=le.cachedWorlds,s=e+t,r=null!=Ia[s]?a.getReserved(s):a.h[s];if(null==r){var n=le.loadingWorlds,l=e+t,o=null!=Ia[l]?n.getReserved(l):n.h[l];if(null==o){var h=le.loadingWorlds,c=e+t,u=[i];null!=Ia[c]?h.setReserved(c,u):h.h[c]=u,be.parse(e,t,function(i){var a=le.cachedWorlds,s=e+t;null!=Ia[s]?a.setReserved(s,i):a.h[s]=i;for(var r=0,n=le.loadingWorlds,l=e+t,o=null!=Ia[l]?n.getReserved(l):n.h[l];r<o.length;){var h=o[r];++r,h(i)}le.loadingWorlds.remove(e+t)})}else o.push(i)}else i(r)}else i(null)},le.getShader=function(e,t,i,a){var s=t;null!=i&&(s+="2");var r=le.cachedShaders,n=null!=Ia[s]?r.getReserved(s):r.h[s];if(null==n){var l=le.loadingShaders,o=null!=Ia[s]?l.getReserved(s):l.h[s];if(null==o){var h=le.loadingShaders,c=[a];null!=Ia[s]?h.setReserved(s,c):h.h[s]=c,me.parse(e,t,i,function(e){var t=le.cachedShaders;null!=Ia[s]?t.setReserved(s,e):t.h[s]=e;for(var i=0,a=le.loadingShaders,r=null!=Ia[s]?a.getReserved(s):a.h[s];i<r.length;){var n=r[i];++i,n(e)}le.loadingShaders.remove(s)})}else o.push(a)}else a(n)},le.getSceneRaw=function(e,t){var i=le.cachedSceneRaws,a=null!=Ia[e]?i.getReserved(e):i.h[e];if(null==a){var s=le.loadingSceneRaws,r=null!=Ia[e]?s.getReserved(e):s.h[e];if(null==r){var n=le.loadingSceneRaws,l=[t];null!=Ia[e]?n.setReserved(e,l):n.h[e]=l;var o=v.endsWith(e,".zip"),h=o||v.endsWith(e,".arm")?"":".arm";le.getBlob(e+h,function(t){if(o){var i=new V(t.toBytes()),a=Q.readZip(i).first();if(null==a)return void k.trace("Failed to uncompress "+e,{fileName:"Data.hx",lineNumber:237,className:"iron.data.Data",methodName:"getSceneRaw"});t=a.compressed?Qi.fromBytes(Q.unzip(a)):Qi.fromBytes(a.data)}var s=new V(t.toBytes());s.set_bigEndian(!0);var r=Ge.read(s);le.returnSceneRaw(e,r)})}else r.push(t)}else t(a)},le.returnSceneRaw=function(e,t){var i=le.cachedSceneRaws;null!=Ia[e]?i.setReserved(e,t):i.h[e]=t;for(var a=0,s=le.loadingSceneRaws,r=null!=Ia[e]?s.getReserved(e):s.h[e];a<r.length;){var n=r[a];++a,n(t)}le.loadingSceneRaws.remove(e)},le.getMeshRawByName=function(e,t){if(""==t)return e[0];for(var i=0;i<e.length;){var a=e[i];if(++i,a.name==t)return a}return null},le.getLampRawByName=function(e,t){if(""==t)return e[0];for(var i=0;i<e.length;){var a=e[i];if(++i,a.name==t)return a}return null},le.getCameraRawByName=function(e,t){if(""==t)return e[0];for(var i=0;i<e.length;){var a=e[i];if(++i,a.name==t)return a}return null},le.getMaterialRawByName=function(e,t){if(""==t)return e[0];for(var i=0;i<e.length;){var a=e[i];if(++i,a.name==t)return a}return null},le.getParticleRawByName=function(e,t){if(""==t)return e[0];for(var i=0;i<e.length;){var a=e[i];if(++i,a.name==t)return a}return null},le.getWorldRawByName=function(e,t){if(""==t)return e[0];for(var i=0;i<e.length;){var a=e[i];if(++i,a.name==t)return a}return null},le.getShaderRawByName=function(e,t){if(""==t)return e[0];for(var i=0;i<e.length;){var a=e[i];if(++i,a.name==t)return a}return null},le.getSpeakerRawByName=function(e,t){if(""==t)return e[0];for(var i=0;i<e.length;){var a=e[i];if(++i,a.name==t)return a}return null},le.getBlob=function(e,t){var i=le.cachedBlobs,a=null!=Ia[e]?i.getReserved(e):i.h[e];if(null==a){var s=le.loadingBlobs,r=null!=Ia[e]?s.getReserved(e):s.h[e];if(null==r){var n=le.loadingBlobs,l=[t];null!=Ia[e]?n.setReserved(e,l):n.h[e]=l;var o={files:[e]};_t.loadBlobFromDescription(o,function(t){var i=le.cachedBlobs;null!=Ia[e]?i.setReserved(e,t):i.h[e]=t;for(var a=0,s=le.loadingBlobs,r=null!=Ia[e]?s.getReserved(e):s.h[e];a<r.length;){var n=r[a];++a,n(t)}le.loadingBlobs.remove(e),le.assetsLoaded++})}else r.push(t)}else t(a)},le.getImage=function(e,t,i,a){null==a&&(a="RGBA32"),null==i&&(i=!1);var s=le.cachedImages,r=null!=Ia[e]?s.getReserved(e):s.h[e];if(null==r){var n=le.loadingImages,l=null!=Ia[e]?n.getReserved(e):n.h[e];if(null==l){var o=le.loadingImages,h=[t];null!=Ia[e]?o.setReserved(e,h):o.h[e]=h;var c={files:[e],readable:i,format:a};_t.loadImageFromDescription(c,function(t){var i=le.cachedImages;null!=Ia[e]?i.setReserved(e,t):i.h[e]=t;for(var a=0,s=le.loadingImages,r=null!=Ia[e]?s.getReserved(e):s.h[e];a<r.length;){var n=r[a];++a,n(t)}le.loadingImages.remove(e),le.assetsLoaded++})}else l.push(t)}else t(r)},le.getSound=function(e,t){v.endsWith(e,".wav")&&(e=e.substring(0,e.length-4)+".ogg");var i=le.cachedSounds,a=null!=Ia[e]?i.getReserved(e):i.h[e];if(null==a){var s=le.loadingSounds,r=null!=Ia[e]?s.getReserved(e):s.h[e];if(null==r){var n=le.loadingSounds,l=[t];null!=Ia[e]?n.setReserved(e,l):n.h[e]=l;var o={files:[e]};_t.loadSoundFromDescription(o,function(t){t.uncompress(function(){var i=le.cachedSounds;null!=Ia[e]?i.setReserved(e,t):i.h[e]=t;for(var a=0,s=le.loadingSounds,r=null!=Ia[e]?s.getReserved(e):s.h[e];a<r.length;){var n=r[a];++a,n(t)}le.loadingSounds.remove(e),le.assetsLoaded++})})}else r.push(t)}else t(a)},le.prototype={__class__:le};var oe=function(e,t,i){null==i&&(i=""),this.mirror=null,le.call(this),this.raw=e,this.name=e.name,e.render_to_texture&&(this.mirror=rt.createRenderTarget(e.texture_resolution_x,e.texture_resolution_y,Ei.RGBA32,0)),t(this)};s["iron.data.CameraData"]=oe,oe.__name__=!0,oe.parse=function(e,t,i){le.getSceneRaw(e,function(a){var s=le.getCameraRawByName(a.camera_datas,t);null==s&&(k.trace('Camera data "'+t+'" not found!',{fileName:"CameraData.hx",lineNumber:30,className:"iron.data.CameraData",methodName:"parse"}),i(null)),new oe(s,i,e)})},oe.__super__=le,oe.prototype=i(le.prototype,{__class__:oe});var he=function(e,t,i,a,s,r,n,l,o,h,c,u){this.mats=null,this.actions=null,this.skeletonBoneRefs=null,this.skeletonTransformsI=null,this.skinBoneWeights=null,this.skinBoneIndices=null,this.skinBoneCounts=null,this.instanceCount=0,this.instanced=!1,this.instancedVB=null,this.numTris=0,this.ready=!1,null==c&&(c=Li.StaticUsage),this.indices=e,this.materialIndices=t,this.usage=c,this.positions=i,this.normals=a,this.uvs=s,this.uvs1=r,this.cols=n,this.tangents=l,this.bones=o,this.weights=h,this.instanceOffsets=u,this.struct=he.getVertexStructure(null!=i,null!=a,null!=s,null!=r,null!=n,null!=l,null!=o,null!=h),this.structLength=this.struct.byteSize()/4|0};s["iron.data.Geometry"]=he,he.__name__=!0,he.getVertexStructure=function(e,t,i,a,s,r,n,l){null==l&&(l=!1),null==n&&(n=!1),null==r&&(r=!1),null==s&&(s=!1),null==a&&(a=!1),null==i&&(i=!1),null==t&&(t=!1),null==e&&(e=!1);var o=new zi;return e&&o.add("pos",Gi.Float3),t&&o.add("nor",Gi.Float3),i&&o.add("tex",Gi.Float2),a&&o.add("tex1",Gi.Float2),s&&o.add("col",Gi.Float3),r&&o.add("tang",Gi.Float3),n&&o.add("bone",Gi.Float4),l&&o.add("weight",Gi.Float4),o},he.buildVertices=function(e,t,i,a,s,r,n,l,o,h){null==h&&(h=0);for(var c=-1+h,u=0,d=t.length/3|0;u<d;){var f=u++;e[++c]=t[3*f],e[++c]=t[3*f+1],e[++c]=t[3*f+2],null!=i&&(e[++c]=i[3*f],e[++c]=i[3*f+1],e[++c]=i[3*f+2]),null!=a&&(e[++c]=a[2*f],e[++c]=a[2*f+1]),null!=s&&(e[++c]=s[2*f],e[++c]=s[2*f+1]),null!=r&&(e[++c]=r[3*f],e[++c]=r[3*f+1],e[++c]=r[3*f+2]),null!=n&&(e[++c]=n[3*f],e[++c]=n[3*f+1],e[++c]=n[3*f+2]),null!=l&&(e[++c]=l[4*f],e[++c]=l[4*f+1],e[++c]=l[4*f+2],e[++c]=l[4*f+3]),null!=o&&(e[++c]=o[4*f],e[++c]=o[4*f+1],e[++c]=o[4*f+2],e[++c]=o[4*f+3])}},he.prototype={applyScale:function(e,t,i){for(var a=this.vertexBuffer.lock(),s=0,r=a.length/this.structLength|0;s<r;){var n=s++;a[n*this.structLength]*=e,a[n*this.structLength+1]*=t,a[n*this.structLength+2]*=i}this.vertexBuffer.unlock()},setupInstanced:function(e,t){this.offsetVecs=[];for(var i=0,a=e.length/3|0;i<a;){var s=i++;this.offsetVecs.push(new ee(e[3*s],e[3*s+1],e[3*s+2]))}this.instanced=!0,this.instanceCount=e.length/3|0;var r=new zi;r.instanced=!0,r.add("off",Gi.Float3),this.instancedVB=new Wi(this.instanceCount,r,t,1);for(var n=this.instancedVB.lock(),l=0,o=n.length;l<o;){var h=l++;n[h]=e[h]}this.instancedVB.unlock()},build:function(){if(!this.ready){this.vertexBuffer=new Wi(this.positions.length/3|0,this.struct,this.usage),this.vertices=this.vertexBuffer.lock(),he.buildVertices(this.vertices,this.positions,this.normals,this.uvs,this.uvs1,this.cols,this.tangents,this.bones,this.weights),this.vertexBuffer.unlock(),this.indexBuffers=[];for(var e=0,t=this.indices;e<t.length;){var i=t[e];if(++e,0!=i.length){var a=new Ci(i.length,this.usage);this.numTris+=i.length/3|0,a._data=i,a.unlock(),this.indexBuffers.push(a)}}null!=this.instanceOffsets&&this.setupInstanced(this.instanceOffsets,this.usage),this.ready=!0}},setArmature:function(e){for(var t=0,i=e.actions;t<i.length;){var a=i[t];++t,this.addAction(a.bones,a.name)}},addAction:function(e,t){null==this.actions&&(this.actions=new R,this.mats=new R);for(var i=[],a=0,s=this.skeletonBoneRefs;a<s.length;){var r=s[a];++a;for(var n=0;n<e.length;){var l=e[n];++n,l.name==r&&i.push(l)}}var o=this.actions;null!=Ia[t]?o.setReserved(t,i):o.h[t]=i;for(var h=[],c=0;c<i.length;){var u=i[c];++c,h.push(te.fromFloat32Array(u.transform.values))}var d=this.mats;null!=Ia[t]?d.setReserved(t,h):d.h[t]=h},initSkeletonTransforms:function(e){this.skeletonTransformsI=[];for(var t=0;t<e.length;){var i=e[t];++t;var a=te.fromFloat32Array(i);this.skeletonTransformsI.push(a)}},__class__:he};var ce=function(e,t){this.colorTexture=null;var i=this;le.call(this),this.raw=e,this.name=e.name,null!=e.color_texture?le.getImage(e.color_texture,function(e){i.colorTexture=e,t(i)}):t(this)};s["iron.data.LampData"]=ce,ce.__name__=!0,ce.parse=function(e,t,i){le.getSceneRaw(e,function(e){var a=le.getLampRawByName(e.lamp_datas,t);null==a&&(k.trace('Lamp data "'+t+'" not found!',{fileName:"LampData.hx",lineNumber:42,className:"iron.data.LampData",methodName:"parse"}),i(null)),new ce(a,i)})},ce.__super__=le,ce.prototype=i(le.prototype,{__class__:ce});var ue=function(e,t,i){null==i&&(i=""),this.contexts=null;var a=this;le.call(this),this.uid=++ue.uidCounter,this.raw=e,this.name=e.name;var s=e.shader.split("/"),r="",n="";2==s.length?(r=s[0],n=s[1]):(r=i,n=e.shader),le.getShader(r,n,e.override_context,function(i){for(a.shader=i,a.contexts=[];a.contexts.length<e.contexts.length;)a.contexts.push(null);for(var s=0,r=0,n=e.contexts.length;r<n;){var l=[r++],o=e.contexts[l[0]];new de(o,function(i){return function(r){a.contexts[i[0]]=r,(s+=1)==e.contexts.length&&t(a)}}(l))}})};s["iron.data.MaterialData"]=ue,ue.__name__=!0,ue.parse=function(e,t,i){le.getSceneRaw(e,function(a){var s=le.getMaterialRawByName(a.material_datas,t);null==s&&(k.trace('Material data "'+t+'" not found!',{fileName:"MaterialData.hx",lineNumber:61,className:"iron.data.MaterialData",methodName:"parse"}),i(null)),new ue(s,i,e)})},ue.__super__=le,ue.prototype=i(le.prototype,{getContext:function(e){for(var t=0,i=this.contexts;t<i.length;){var a=i[t];if(++t,l.substr(a.raw.name,0,e.length)==e)return a}return null},__class__:ue});var de=function(e,t){this.id=0,this.textures=null;var i=this;if(this.raw=e,this.id=de.num++,null!=e.bind_textures&&e.bind_textures.length>0){var a=e.bind_textures.length,s=new Array(a);this.textures=s;for(var r=0,n=0,l=e.bind_textures.length;n<l;){var o=[n++],h=[e.bind_textures[o[0]]];""!=h[0].file?le.getImage(h[0].file,function(a,s){return function(n){if(i.textures[s[0]]=n,r+=1,null!=a[0].mipmaps){for(var l=[];l.length<a[0].mipmaps.length;)l.push(null);for(var o=0,h=0,c=a[0].mipmaps.length;h<c;){var u=[h++],d=a[0].mipmaps[u[0]];le.getImage(d,function(a,s){return function(h){l[a[0]]=h,(o+=1)==s[0].mipmaps.length&&(n.setMipmaps(l),s[0].mipmaps=null,s[0].generate_mipmaps=!1,r==e.bind_textures.length&&t(i))}}(u,a))}}else 1==a[0].generate_mipmaps&&null!=n?(n.generateMipmaps(1e3),a[0].mipmaps=null,a[0].generate_mipmaps=!1,r==e.bind_textures.length&&t(i)):r==e.bind_textures.length&&t(i)}}(h,o),!1,null!=h[0].format?h[0].format:"RGBA32"):(r+=1)==e.bind_textures.length&&t(this)}}else t(this)};s["iron.data.MaterialContext"]=de,de.__name__=!0,de.prototype={setTextureParameters:function(e,t,i,a){var s=this.raw.bind_textures[t];null==s.params_set&&(i.setTextureParameters(e,a,s),s.params_set=!0)},__class__:de};var fe=function(){this.buckets=new F};s["iron.data.MeshBatch"]=fe,fe.__name__=!0,fe.prototype={remove:function(){for(var e=this.buckets.iterator();e.hasNext();){e.next();this.remove()}},__class__:fe};var _e=function(){};s["iron.data.Bucket"]=_e,_e.__name__=!0;var ve=function(e,t){this.refcount=0,le.call(this),this.raw=e,this.name=e.name;for(var i=[],a=[],s=0,r=e.index_arrays;s<r.length;){var n=r[s];++s,i.push(n.values),a.push(n.material)}var l=this.getVertexArrayValues("pos"),o=this.getVertexArrayValues("nor"),h=this.getVertexArrayValues("tex"),c=this.getVertexArrayValues("tex1"),u=this.getVertexArrayValues("col"),d=this.getVertexArrayValues("tang");this.isSkinned=null!=e.skin;var f=Li.StaticUsage;null!=e.dynamic_usage&&1==e.dynamic_usage&&(f=Li.DynamicUsage);var _=f,v=null,p=null;if(this.isSkinned){var m=4*(l.length/3|0);v=new Ca(m),p=new Ca(m);for(var g=0,b=0,w=0,B=l.length/3|0;w<B;){for(var y=w++,x=e.skin.bone_count_array[y],I=g,S=g+x;I<S;){var k=I++;v[b]=e.skin.bone_index_array[k],p[b]=e.skin.bone_weight_array[k],++b}for(var C=x;C<4;){C++;v[b]=0,p[b]=0,++b}g+=x}}this.geom=new he(i,a,l,o,h,c,u,d,v,p,_,e.instance_offsets),t(this)};s["iron.data.MeshData"]=ve,ve.__name__=!0,ve.parse=function(e,t,i,a){le.getSceneRaw(e,function(e){var s=le.getMeshRawByName(e.mesh_datas,t);null==s&&(k.trace('Mesh data "'+t+'" not found!',{fileName:"MeshData.hx",lineNumber:105,className:"iron.data.MeshData",methodName:"parse"}),a(null)),new ve(s,function(t){null!=s.skin&&(t.geom.skinBoneCounts=s.skin.bone_count_array,t.geom.skinBoneIndices=s.skin.bone_index_array,t.geom.skinBoneWeights=s.skin.bone_weight_array,t.geom.skeletonBoneRefs=s.skin.skeleton.bone_ref_array,t.geom.initSkeletonTransforms(s.skin.skeleton.transformsI),null!=i?t.geom.setArmature(i):t.geom.addAction(e.objects,"none")),a(t)})})},ve.__super__=le,ve.prototype=i(le.prototype,{getVertexArrayValues:function(e){for(var t=0,i=this.raw.vertex_arrays;t<i.length;){var a=i[t];if(++t,a.attrib==e)return a.values}return null},__class__:ve});var pe=function(e,t){le.call(this),this.raw=e,this.name=e.name,t(this)};s["iron.data.ParticleData"]=pe,pe.__name__=!0,pe.parse=function(e,t,i){le.getSceneRaw(e,function(e){var a=le.getParticleRawByName(e.particle_datas,t);null==a&&(k.trace('Particle data "'+t+'" not found!',{fileName:"ParticleData.hx",lineNumber:23,className:"iron.data.ParticleData",methodName:"parse"}),i(null)),new pe(a,i)})},pe.__super__=le,pe.prototype=i(le.prototype,{__class__:pe});var me=function(e,t,i){this.contexts=[];var a=this;le.call(this),this.raw=e,this.name=e.name;for(var s=0,r=e.contexts;s<r.length;){r[s];++s,this.contexts.push(null)}for(var n=0,l=0,o=e.contexts.length;l<o;){var h=[l++],c=e.contexts[h[0]];new ge(c,t,function(t){return function(s){a.contexts[t[0]]=s,(n+=1)==e.contexts.length&&i(a)}}(h))}};s["iron.data.ShaderData"]=me,me.__name__=!0,me.parse=function(e,t,i,a){le.getSceneRaw(e,function(e){var s=le.getShaderRawByName(e.shader_datas,t);null==s&&(k.trace('Shader data "'+t+'" not found!',{fileName:"ShaderData.hx",lineNumber:49,className:"iron.data.ShaderData",methodName:"parse"}),a(null)),new me(s,i,a)})},me.__super__=le,me.prototype=i(le.prototype,{getContext:function(e){for(var t=0,i=this.contexts;t<i.length;){var a=i[t];if(++t,a.raw.name==e)return a}return null},__class__:me});var ge=function(e,t,i){this.instancing=!1,this.raw=e,this.overrideContext=t,"rect"==e.name?(this.structure=ge.getStructureRect(),this.instancing=!1):this.parseVertexStructure(),this.compile(i)};s["iron.data.ShaderContext"]=ge,ge.__name__=!0,ge.getStructureRect=function(){return null==ge.structureRect&&(ge.structureRect=new zi,ge.structureRect.add("pos",Gi.Float2)),ge.structureRect},ge.prototype={compile:function(e){if(null!=this.pipeState&&this.pipeState.delete(),this.pipeState=new Ni,this.constants=[],this.textureUnits=[],this.instancing){var t=new zi;t.add("off",Gi.Float3),t.instanced=!0,this.pipeState.inputLayout=[this.structure,t]}else this.pipeState.inputLayout=[this.structure];if(this.pipeState.depthWrite=this.raw.depth_write,this.pipeState.depthMode=this.getCompareMode(this.raw.compare_mode),null!=this.raw.stencil_mode&&("always"==this.raw.stencil_mode?this.pipeState.stencilMode=pi.Always:"equal"==this.raw.stencil_mode?this.pipeState.stencilMode=pi.Equal:"not_equal"==this.raw.stencil_mode&&(this.pipeState.stencilMode=pi.NotEqual)),null!=this.raw.stencil_pass&&("replace"==this.raw.stencil_pass?this.pipeState.stencilBothPass=Ti.Replace:"keep"==this.raw.stencil_pass&&(this.pipeState.stencilBothPass=Ti.Keep)),null!=this.raw.stencil_fail&&"keep"==this.raw.stencil_fail&&(this.pipeState.stencilDepthFail=Ti.Keep,this.pipeState.stencilFail=Ti.Keep),null!=this.raw.stencil_reference_value&&(this.pipeState.stencilReferenceValue=this.raw.stencil_reference_value),this.pipeState.cullMode=this.getCullMode(this.raw.cull_mode),null!=this.raw.blend_source&&(this.pipeState.blendSource=this.getBlendingFactor(this.raw.blend_source)),null!=this.raw.blend_destination&&(this.pipeState.blendDestination=this.getBlendingFactor(this.raw.blend_destination)),null!=this.raw.blend_operation&&(this.pipeState.blendOperation=this.getBlendingOperation(this.raw.blend_operation)),null!=this.raw.alpha_blend_source&&(this.pipeState.alphaBlendSource=this.getBlendingFactor(this.raw.alpha_blend_source)),null!=this.raw.alpha_blend_destination&&(this.pipeState.alphaBlendDestination=this.getBlendingFactor(this.raw.alpha_blend_destination)),null!=this.raw.alpha_blend_operation&&(this.pipeState.alphaBlendOperation=this.getBlendingOperation(this.raw.alpha_blend_operation)),null!=this.raw.color_write_red&&(this.pipeState.colorWriteMaskRed=this.raw.color_write_red),null!=this.raw.color_write_green&&(this.pipeState.colorWriteMaskGreen=this.raw.color_write_green),null!=this.raw.color_write_blue&&(this.pipeState.colorWriteMaskBlue=this.raw.color_write_blue),null!=this.raw.color_write_alpha&&(this.pipeState.colorWriteMaskAlpha=this.raw.color_write_alpha),null!=this.raw.conservative_raster&&(this.pipeState.conservativeRasterization=this.raw.conservative_raster),this.raw.shader_from_source)this.pipeState.fragmentShader=wi.fromSource(this.raw.fragment_shader),this.pipeState.vertexShader=Ui.fromSource(this.raw.vertex_shader),this.finishCompile(e);else{var i=v.replace(this.raw.fragment_shader,".","_");this.pipeState.fragmentShader=f.field(bt,i);var a=v.replace(this.raw.vertex_shader,".","_");if(this.pipeState.vertexShader=f.field(bt,a),null!=this.raw.geometry_shader){var s=v.replace(this.raw.geometry_shader,".","_");this.pipeState.geometryShader=f.field(bt,s)}if(null!=this.raw.tesscontrol_shader){var r=v.replace(this.raw.tesscontrol_shader,".","_");this.pipeState.tessellationControlShader=f.field(bt,r)}if(null!=this.raw.tesseval_shader){var n=v.replace(this.raw.tesseval_shader,".","_");this.pipeState.tessellationEvaluationShader=f.field(bt,n)}this.finishCompile(e)}},finishCompile:function(e){if(null!=this.overrideContext&&null!=this.overrideContext.cull_mode&&(this.pipeState.cullMode=this.getCullMode(this.overrideContext.cull_mode)),this.pipeState.compile(),null!=this.raw.constants)for(var t=0,i=this.raw.constants;t<i.length;){var a=i[t];++t,this.addConstant(a)}if(null!=this.raw.texture_units)for(var s=0,r=this.raw.texture_units;s<r.length;){var n=r[s];++s,this.addTexture(n)}e(this)},sizeToVD:function(e){return 1==e?Gi.Float1:2==e?Gi.Float2:3==e?Gi.Float3:4==e?Gi.Float4:null},parseVertexStructure:function(){this.structure=new zi;for(var e=0,t=this.raw.vertex_structure;e<t.length;){var i=t[e];++e,"off"!=i.name?this.structure.add(i.name,this.sizeToVD(i.size)):this.instancing=!0}},getCompareMode:function(e){switch(e){case"always":return pi.Always;case"equal":return pi.Equal;case"greater":return pi.Greater;case"greater_equal":return pi.GreaterEqual;case"less":return pi.Less;case"less_equal":return pi.LessEqual;case"never":return pi.Never;case"not_equal":return pi.NotEqual;default:return pi.Less}},getCullMode:function(e){switch(e){case"clockwise":return bi.Clockwise;case"none":return bi.None;default:return bi.CounterClockwise}},getBlendingOperation:function(e){switch(e){case"add":return vi.Add;case"max":return vi.Max;case"min":return vi.Min;case"reverse_substract":return vi.ReverseSubtract;case"substract":return vi.Subtract;default:return vi.Add}},getBlendingFactor:function(e){switch(e){case"blend_one":return _i.BlendOne;case"blend_zero":return _i.BlendZero;case"destination_alpha":return _i.DestinationAlpha;case"destination_color":return _i.DestinationColor;case"inverse_destination_alpha":return _i.InverseDestinationAlpha;case"inverse_destination_color":return _i.InverseDestinationColor;case"inverse_source_alpha":return _i.InverseSourceAlpha;case"inverse_source_color":return _i.InverseSourceColor;case"source_alpha":return _i.SourceAlpha;case"source_color":return _i.SourceColor;default:return _i.Undefined}},getTextureAddresing:function(e){switch(e){case"mirror":return Ri.Mirror;case"repeat":return Ri.Repeat;default:return Ri.Clamp}},getTextureFilter:function(e){switch(e){case"linear":return Pi.LinearFilter;case"point":return Pi.PointFilter;default:return Pi.AnisotropicFilter}},getMipmapFilter:function(e){switch(e){case"no":return Ai.NoMipFilter;case"point":return Ai.PointMipFilter;default:return Ai.LinearMipFilter}},addConstant:function(e){this.constants.push(this.pipeState.getConstantLocation(e.name))},addTexture:function(e){var t=this.pipeState.getTextureUnit(e.name);this.textureUnits.push(t)},setTextureParameters:function(e,t,i){var a=this.textureUnits[t];e.setTextureParameters(a,null==i.u_addressing?Ri.Repeat:this.getTextureAddresing(i.u_addressing),null==i.v_addressing?Ri.Repeat:this.getTextureAddresing(i.v_addressing),null==i.min_filter?Pi.LinearFilter:this.getTextureFilter(i.min_filter),null==i.mag_filter?Pi.LinearFilter:this.getTextureFilter(i.mag_filter),null==i.mipmap_filter?Ai.NoMipFilter:this.getMipmapFilter(i.mipmap_filter))},__class__:ge};var be=function(e,t){this.vec=new ee,this.shirr=null;var i=this;if(le.call(this),this.raw=e,this.name=e.name,null!=e.probes&&e.probes.length>0){this.probes=[];for(var a=0,s=e.probes;a<s.length;){var r=s[a];++a,new we(r,function(a){i.probes.push(a),i.probes.length==e.probes.length&&i.loadEnvmap(t)})}}else this.loadEnvmap(t)};s["iron.data.WorldData"]=be,be.__name__=!0,be.parse=function(e,t,i){le.getSceneRaw(e,function(e){var a=le.getWorldRawByName(e.world_datas,t);null==a&&(k.trace('World data "'+t+'" not found!',{fileName:"WorldData.hx",lineNumber:51,className:"iron.data.WorldData",methodName:"parse"}),i(null)),new be(a,i)})},be.getEmptyIrradiance=function(){if(null==be.emptyIrr){var e=new Array(28);be.emptyIrr=e;for(var t=0,i=be.emptyIrr.length;t<i;){var a=t++;be.emptyIrr[a]=0}}return be.emptyIrr},be.__super__=le,be.prototype=i(le.prototype,{loadEnvmap:function(e){var t=this;null!=this.raw.envmap?le.getImage(this.raw.envmap,function(i){t.envmap=i,e(t)}):e(this)},getGlobalProbe:function(){return this.probes[0]},getSHIrradiance:function(){if(null==this.shirr){var e=new Array(28);this.shirr=e;for(var t=this.probes[0],i=0,a=t.irradiance.length;i<a;){var s=i++;this.shirr[s]=t.irradiance[s]}}return this.shirr},getProbeID:function(e){this.vec.x=e.world.self._30,this.vec.y=e.world.self._31,this.vec.z=e.world.self._32;for(var t=e.dim,i=1,a=this.probes.length;i<a;){var s=i++,r=this.probes[s];if(!(this.vec.x+t.x/2<r.volumeMin.x||this.vec.x-t.x/2>r.volumeMax.x||this.vec.y+t.y/2<r.volumeMin.y||this.vec.y-t.y/2>r.volumeMax.y||this.vec.z+t.z/2<r.volumeMin.z||this.vec.z-t.z/2>r.volumeMax.z))return s}return 0},getProbeVolumeCenter:function(e){return this.probes[this.getProbeID(e)].volumeCenter},getProbeVolumeSize:function(e){return this.probes[this.getProbeID(e)].volume},getProbeStrength:function(e){return this.probes[this.getProbeID(e)].raw.strength},getProbeBlending:function(e){return this.probes[this.getProbeID(e)].raw.blending},__class__:be});var we=function(e,t){var i=this;this.raw=e,this.setIrradiance(function(a){i.irradiance=a,null!=e.radiance?le.getImage(e.radiance,function(a){i.radiance=a;for(var s=[];s.length<e.radiance_mipmaps;)s.push(null);for(var r=e.radiance.substring(e.radiance.length-4),n=e.radiance.substring(0,e.radiance.length-4),l=0,o=0,h=e.radiance_mipmaps;o<h;){var c=[o++];le.getImage(n+"_"+c[0]+r,function(a){return function(r){s[a[0]]=r,(l+=1)==e.radiance_mipmaps&&(i.radiance.setMipmaps(s),i.mipsSet(t))}}(c),!0)}}):i.mipsSet(t)})};s["iron.data.Probe"]=we,we.__name__=!0,we.prototype={mipsSet:function(e){this.volume=new ee(this.raw.volume[0],this.raw.volume[1],this.raw.volume[2]),this.volumeCenter=new ee(this.raw.volume_center[0],this.raw.volume_center[1],this.raw.volume_center[2]),this.volumeMin=new ee(this.volumeCenter.x-this.volume.x,this.volumeCenter.y-this.volume.y,this.volumeCenter.z-this.volume.z),this.volumeMax=new ee(this.volumeCenter.x+this.volume.x,this.volumeCenter.y+this.volume.y,this.volumeCenter.z+this.volume.z),e(this)},setIrradiance:function(e){""==this.raw.irradiance?e([.7759665994411109,1.1676103577251633,1.498638725994038,.1336947481217397,.2152815237067897,.05665912629858376,-.02226816760879319,-.019376587567080147,-.010651384270937897,.000279290102432495,.0001858273851672515,633030727032015e-19,-678543609893525e-19,-.0003936997772915445,-.0007750453454300294,.010973699524451886,.02726825295855786,.04391820633315139,.08526796789315332,.07367063541652231,.03887702349408202,-134621815948975e-19,-39675084850967e-18,-37799572176155e-18,.13517727692935497,.11561459222778457,.06079408647605916]):le.getBlob(this.raw.irradiance+".arm",function(t){var i=new V(t.toBytes());i.set_bigEndian(!0);for(var a=Ge.read(i),s=new Array(28),r=0;r<27;){var n=r++;s[n]=a.irradiance[n]}s[27]=0,e(s)})},__class__:we};var Be=function(e,t,i,a,s,r,n,l,o){this.self=new Le(e,t,i,a,s,r,n,l,o)};s["iron.math.Mat3"]=Be,Be.__name__=!0,Be.identity=function(){return new Be(1,0,0,0,1,0,0,0,1)},Be.prototype={setFrom4:function(e){this.self._00=e.self._00,this.self._01=e.self._01,this.self._02=e.self._02,this.self._10=e.self._10,this.self._11=e.self._11,this.self._12=e.self._12,this.self._20=e.self._20,this.self._21=e.self._21,this.self._22=e.self._22},__class__:Be};var ye=function(e,t,i,a){null==a&&(a=1),null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.x=e,this.y=t,this.z=i,this.w=a};s["iron.math.Quat"]=ye,ye.__name__=!0,ye.identity=function(){return new ye(0,0,0,1)},ye.lerp=function(e,t,i){var a=new ye,s=new ye;return s.setFrom(e),e.dot(t)<0&&(s.w=-s.w,s.x=-s.x,s.y=-s.y,s.z=-s.z),a.x=s.x+(t.x-s.x)*i,a.y=s.y+(t.y-s.y)*i,a.z=s.z+(t.z-s.z)*i,a.w=s.w+(t.w-s.w)*i,a.normalize(),a},ye.slerp=function(e,t,i){var a=new ye,s=e.dot(t);if(Math.abs(s)>=1)return a.x=e.x,a.y=e.y,a.z=e.z,a.w=e.w,a;var r=Math.acos(s),n=1/Math.sqrt(1-s*s);if(Math.abs(n)>1e3)return ye.lerp(e,t,.5);var l=Math.sin((1-i)*r)*n,o=Math.sin(i*r)*n*(s<0?-1:1);return a.x=e.x*l+t.x*o,a.y=e.y*l+t.y*o,a.z=e.z*l+t.z*o,a.w=e.w*l+t.w*o,a},ye.prototype={fromAxisAngle:function(e,t){var i=Math.sin(.5*t);this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(.5*t),this.normalize()},fromRotationMat:function(e){var t=e.self._00,i=e.self._10,a=e.self._20,s=e.self._01,r=e.self._11,n=e.self._21,l=e.self._02,o=e.self._12,h=e.self._22,c=t+r+h,u=0;return c>0?(u=.5/Math.sqrt(c+1),this.w=.25/u,this.x=(o-n)*u,this.y=(a-l)*u,this.z=(s-i)*u):t>r&&t>h?(u=2*Math.sqrt(1+t-r-h),this.w=(o-n)/u,this.x=.25*u,this.y=(i+s)/u,this.z=(a+l)/u):r>h?(u=2*Math.sqrt(1+r-t-h),this.w=(a-l)/u,this.x=(i+s)/u,this.y=.25*u,this.z=(n+o)/u):(u=2*Math.sqrt(1+h-t-r),this.w=(s-i)/u,this.x=(a+l)/u,this.y=(n+o)/u,this.z=.25*u),this},multquats:function(e,t){var i=e.x*t.w+e.w*t.x+e.y*t.z-e.z*t.y,a=e.w*t.y-e.x*t.z+e.y*t.w+e.z*t.x,s=e.w*t.z+e.x*t.y-e.y*t.x+e.z*t.w,r=e.w*t.w-e.x*t.x-e.y*t.y-e.z*t.z;this.x=i,this.y=a,this.z=s,this.w=r},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0==e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e)},setFrom:function(e){this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w},fromEuler:function(e,t,i){var a=Math.cos(e/2),s=Math.cos(t/2),r=Math.cos(i/2),n=Math.sin(e/2),l=Math.sin(t/2),o=Math.sin(i/2);return this.x=n*s*r+a*l*o,this.y=a*l*r+n*s*o,this.z=a*s*o-n*l*r,this.w=a*s*r-n*l*o,this},toMat:function(e){var t=this.x+this.x,i=this.y+this.y,a=this.z+this.z,s=this.x*t,r=this.x*i,n=this.x*a,l=this.y*i,o=this.y*a,h=this.z*a,c=this.w*t,u=this.w*i,d=this.w*a;return e.self._00=1-(l+h),e.self._10=r-d,e.self._20=n+u,e.self._01=r+d,e.self._11=1-(s+h),e.self._21=o-c,e.self._02=n-u,e.self._12=o+c,e.self._22=1-(s+l),e.self._03=0,e.self._13=0,e.self._23=0,e.self._30=0,e.self._31=0,e.self._32=0,e.self._33=1,e},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},__class__:ye};var xe=function(){this.markerEvents=null,this.lastFrameIndex=-1,this.blendAction="",this.blendCurrent=0,this.blendTime=0,this.paused=!1,this.onComplete=null,this.frameIndex=0,this.loop=!0,this.speed=1,this.time=0,this.action="",re.active.animations.push(this),this.frameTime=re.active.raw.frame_time,this.play()};s["iron.object.Animation"]=xe,xe.__name__=!0,xe.prototype={play:function(e,t,i,a,s){null==s&&(s=!0),null==a&&(a=1),null==i&&(i=0),null==e&&(e=""),i>0?(this.blendTime=i,this.blendCurrent=0,this.blendAction=this.action):this.frameIndex=-1,this.action=e,this.onComplete=t,this.speed=a,this.loop=s,this.paused=!1},remove:function(){l.remove(re.active.animations,this)},update:function(e){this.paused||(this.time+=e*this.speed,this.blendTime>0&&(this.blendCurrent+=e,this.blendCurrent>=this.blendTime&&(this.blendTime=0)))},rewind:function(e){this.frameIndex=this.speed>0?0:e.frames.length-1,this.time=e.frames[this.frameIndex]*this.frameTime},updateTrack:function(e){if(null!=e){var t=e.tracks[0];-1==this.frameIndex&&this.rewind(t);for(var i=this.speed>0?1:-1;;){var a=t.frames;if(!(this.speed>0?this.frameIndex+1<a.length&&this.time>a[this.frameIndex+1]*this.frameTime:this.frameIndex-1>-1&&this.time<a[this.frameIndex-1]*this.frameTime))break;this.frameIndex+=i}if(null!=this.markerEvents&&null!=e.marker_names&&this.frameIndex!=this.lastFrameIndex){for(var s=0,r=e.marker_frames.length;s<r;){var n=s++;if(this.frameIndex==e.marker_frames[n])for(var l=e.marker_names[n],o=this.markerEvents,h=null!=Ia[l]?o.getReserved(l):o.h[l],c=0;c<h.length;){var u=h[c];++c,u()}}this.lastFrameIndex=this.frameIndex}(this.speed>0?this.frameIndex>=t.frames.length-1:this.frameIndex<=0)&&(null!=this.onComplete&&0==this.blendTime&&this.onComplete(),this.loop||this.blendTime>0?this.rewind(t):(this.frameIndex-=i,this.paused=!0))}},updateAnimSampled:function(e,t){if(null!=e){var i=e.tracks[0],a=this.speed>0?1:-1,s=this.time,r=this.frameIndex,n=i.frames[r]*this.frameTime,l=(s-n)/(i.frames[r+a]*this.frameTime-n);xe.m1.setF32(i.values,16*r),xe.m2.setF32(i.values,16*(r+a)),xe.m1.decompose(xe.vpos,xe.q1,xe.vscl),xe.m2.decompose(xe.vpos2,xe.q2,xe.vscl2);var o=ee.lerp(xe.vpos,xe.vpos2,1-l),h=ee.lerp(xe.vscl,xe.vscl2,1-l),c=t;ye.lerp(xe.q1,xe.q2,l).toMat(c),c.scale(h),c.self._30=o.x,c.self._31=o.y,c.self._32=o.z}},__class__:xe};var Ie=function(e){null==e&&(e=""),this.onUpdate=null,this.m2=te.identity(),this.m1=te.identity(),this.m=te.identity(),this.boneChildren=null,this.skeletonMatsBlend=null,this.skeletonBonesBlend=null,this.skeletonMats=null,this.skeletonBones=null,xe.call(this),this.isSampled=!1;for(var t=0,i=re.active.armatures;t<i.length;){var a=i[t];if(++t,a.name==e){this.armature=a;break}}};s["iron.object.BoneAnimation"]=Ie,Ie.__name__=!0,Ie.__super__=xe,Ie.prototype=i(xe.prototype,{setSkin:function(e){var t=this;if(this.object=e,this.data=null!=e?e.data:null,this.isSkinned=null!=this.data&&this.data.isSkinned,this.isSkinned){var i=8*Ie.skinMaxBones,a=new Array(i);this.skinBuffer=a;for(var s=0,r=this.skinBuffer.length;s<r;){var n=s++;this.skinBuffer[n]=0}var l=e.parent.raw.bone_actions;null!=l&&l.length>0&&le.getSceneRaw(l[0],function(e){t.play(e.name)})}},addBoneChild:function(e,t){null==this.boneChildren&&(this.boneChildren=new R);var i=this.boneChildren,a=null!=Ia[e]?i.getReserved(e):i.h[e];if(null==a){a=[];var s=this.boneChildren;null!=Ia[e]?s.setReserved(e,a):s.h[e]=a}a.push(t)},updateBoneChildren:function(e,t){var i=e.name,a=this.boneChildren,s=null!=Ia[i]?a.getReserved(i):a.h[i];if(null!=s)for(var r=0;r<s.length;){var n=s[r];++r;var l=n.transform;if(null==l.boneParent&&(l.boneParent=te.identity()),null!=n.raw.parent_bone_tail){var o=n.raw.parent_bone_tail;l.boneParent.initTranslate(o[0],o[1],o[2]),l.boneParent.multmat2(t)}else l.boneParent.setFrom(t);l.buildMatrix()}},setAction:function(e){if(this.isSkinned){var t=this.data.geom.actions;this.skeletonBones=null!=Ia[e]?t.getReserved(e):t.h[e];var i=this.data.geom.mats;this.skeletonMats=null!=Ia[e]?i.getReserved(e):i.h[e]}else{this.armature.initMats();var a=this.armature.getAction(e);this.skeletonBones=a.bones,this.skeletonMats=a.mats}},setActionBlend:function(e){if(this.isSkinned){this.skeletonBonesBlend=this.skeletonBones,this.skeletonMatsBlend=this.skeletonMats;var t=this.data.geom.actions;this.skeletonBones=null!=Ia[e]?t.getReserved(e):t.h[e];var i=this.data.geom.mats;this.skeletonMats=null!=Ia[e]?i.getReserved(e):i.h[e]}else{this.armature.initMats();var a=this.armature.getAction(e);this.skeletonBones=a.bones,this.skeletonMats=a.mats}},play:function(e,t,i,a,s){null==s&&(s=!0),null==a&&(a=1),null==i&&(i=0),null==e&&(e=""),xe.prototype.play.call(this,e,t,i,a,s),""!=e&&(i>0?this.setActionBlend(e):this.setAction(e))},update:function(e){this.isSkinned||null!=this.skeletonBones||this.setAction(this.armature.actions[0].name),(null==this.object||this.object.visible&&!this.object.culled)&&null!=this.skeletonBones&&0!=this.skeletonBones.length&&(xe.prototype.update.call(this,e),this.paused||this.updateAnim())},updateAnim:function(){for(var e=0,t=this.skeletonBones;e<t.length;){var i=t[e];if(++e,null!=i.anim){this.updateTrack(i.anim);break}}for(var a=0,s=this.skeletonBones.length;a<s;){var r=a++;this.updateAnimSampled(this.skeletonBones[r].anim,this.skeletonMats[r])}if(this.blendTime>0&&null!=this.skeletonBonesBlend){for(var n=0,l=this.skeletonBonesBlend;n<l.length;){var o=l[n];if(++n,null!=o.anim){this.updateTrack(o.anim);break}}for(var h=0,c=this.skeletonBonesBlend.length;h<c;){var u=h++;this.updateAnimSampled(this.skeletonBonesBlend[u].anim,this.skeletonMatsBlend[u])}}null!=this.onUpdate&&this.onUpdate(),this.isSkinned?this.updateSkinGpu():this.updateBonesOnly()},updateBonesOnly:function(){for(var e=0,t=this.skeletonBones.length;e<t;){var i=e++,a=this.skeletonBones[i];this.m.setFrom(this.skeletonMats[i]),this.applyParent(this.m,a,this.skeletonMats,this.skeletonBones),null!=this.boneChildren&&this.updateBoneChildren(a,this.m)}},applyParent:function(e,t,i,a){for(var s=t.parent;null!=s;){var r=this.getBoneIndex(s,a);if(-1!=r){var n=i[r];e.multmat2(n),s=s.parent}}},updateSkinGpu:function(){var e=this.skeletonBones,t=this.blendCurrent/this.blendTime;t=t*t*(3-2*t);for(var i=0,a=e.length;i<a;){var s=i++;if(this.m.setFrom(this.data.geom.skeletonTransformsI[s]),this.blendTime>0){var r=this.skeletonBonesBlend;this.m1.setFrom(this.skeletonMatsBlend[s]),this.applyParent(this.m1,r[s],this.skeletonMatsBlend,this.skeletonBonesBlend),this.m2.setFrom(this.skeletonMats[s]),this.applyParent(this.m2,e[s],this.skeletonMats,this.skeletonBones),this.m1.decompose(Ie.vpos,Ie.q1,Ie.vscl),this.m2.decompose(Ie.vpos2,Ie.q2,Ie.vscl2);var n=ee.lerp(Ie.vpos,Ie.vpos2,1-t),l=ee.lerp(Ie.vscl,Ie.vscl2,1-t);ye.lerp(Ie.q1,Ie.q2,t).toMat(this.m1),this.m1.scale(l),this.m1.self._30=n.x,this.m1.self._31=n.y,this.m1.self._32=n.z,this.m.multmat2(this.m1)}else this.m.multmat2(this.skeletonMats[s]),this.applyParent(this.m,e[s],this.skeletonMats,this.skeletonBones);null!=this.boneChildren&&this.updateBoneChildren(e[s],this.m),this.m.decompose(Ie.vpos,Ie.q1,Ie.vscl),Ie.q1.normalize();var o=Ie.q2;o.x=Ie.vpos.x,o.y=Ie.vpos.y,o.z=Ie.vpos.z,o.w=0,Ie.q2.multquats(Ie.q2,Ie.q1),Ie.q2.x*=.5,Ie.q2.y*=.5,Ie.q2.z*=.5,Ie.q2.w*=.5,this.skinBuffer[8*s]=Ie.q1.x,this.skinBuffer[8*s+1]=Ie.q1.y,this.skinBuffer[8*s+2]=Ie.q1.z,this.skinBuffer[8*s+3]=Ie.q1.w,this.skinBuffer[8*s+4]=Ie.q2.x,this.skinBuffer[8*s+5]=Ie.q2.y,this.skinBuffer[8*s+6]=Ie.q2.z,this.skinBuffer[8*s+7]=Ie.q2.w}},getBoneIndex:function(e,t){if(null==t&&(t=this.skeletonBones),null==t)return-1;for(var i=0,a=t.length;i<a;){var s=i++;if(t[s]==e)return s}return-1},__class__:Ie});var Se=function(){this.isEmpty=!1,this.culledShadow=!1,this.culledMesh=!1,this.culled=!1,this.visibleShadow=!0,this.visibleMesh=!0,this.visible=!0,this.animation=null,this.lods=null,this.children=[],this.parent=null,this.traits=[],this.constraints=null,this.name="",this.raw=null,this.uid=Se.uidCounter++,this.urandom=Se.seededRandom(),this.transform=new Ve(this),this.isEmpty=qe.getClass(this)==Se,this.isEmpty&&null!=re.active&&re.active.empties.push(this)};s["iron.object.Object"]=Se,Se.__name__=!0,Se.seededRandom=function(){return Se.seed=(9301*Se.seed+49297)%233280,Se.seed/233280},Se.prototype={addChild:function(e,t){null==t&&(t=!1),e.parent!=this&&(this.children.push(e),e.parent=this,t&&e.transform.applyParentInverse())},remove:function(){for(this.isEmpty&&null!=re.active&&l.remove(re.active.empties,this),null!=this.animation&&this.animation.remove();this.children.length>0;)this.children[0].remove();for(;this.traits.length>0;)this.traits[0].remove();null!=this.parent&&(l.remove(this.parent.children,this),this.parent=null)},getChild:function(e){if(this.name==e)return this;for(var t=0,i=this.children;t<i.length;){var a=i[t];++t;var s=a.getChild(e);if(null!=s)return s}return null},addTrait:function(e){if(this.traits.push(e),e.object=this,null!=e._add){for(var t=0,i=e._add;t<i.length;){var a=i[t];++t,a()}e._add=null}},removeTrait:function(e){if(null!=e._init){for(var t=0,i=e._init;t<i.length;){var a=i[t];++t,q.removeInit(a)}e._init=null}if(null!=e._update){for(var s=0,r=e._update;s<r.length;){var n=r[s];++s,q.removeUpdate(n)}e._update=null}if(null!=e._lateUpdate){for(var o=0,h=e._lateUpdate;o<h.length;){var c=h[o];++o,q.removeLateUpdate(c)}e._lateUpdate=null}if(null!=e._render){for(var u=0,d=e._render;u<d.length;){var f=d[u];++u,q.removeRender(f)}e._render=null}if(null!=e._render2D){for(var _=0,v=e._render2D;_<v.length;){var p=v[_];++_,q.removeRender2D(p)}e._render2D=null}if(null!=e._remove){for(var m=0,g=e._remove;m<g.length;){var b=g[m];++m,b()}e._remove=null}l.remove(this.traits,e),e.object=null},setupAnimation:function(e){null!=e&&(this.animation=new Fe(this,e))},__class__:Se};var ke=function(e){if(this.frustumPlanes=null,this.prevV=null,Se.call(this),this.data=e,this.nearPlane=e.raw.near_plane,this.farPlane=e.raw.far_plane,this.buildProjection(),this.V=te.identity(),this.VP=te.identity(),e.raw.frustum_culling){this.frustumPlanes=[];for(var t=0;t<6;){t++;this.frustumPlanes.push(new Ce)}}re.active.cameras.push(this)};s["iron.object.CameraObject"]=ke,ke.__name__=!0,ke.buildViewFrustum=function(e,t){var i=t[0],a=e.self._33+e.self._30;i.normal.set(e.self._03+e.self._00,e.self._13+e.self._10,e.self._23+e.self._20),i.constant=a;var s=t[1],r=e.self._33-e.self._30;s.normal.set(e.self._03-e.self._00,e.self._13-e.self._10,e.self._23-e.self._20),s.constant=r;var n=t[2],l=e.self._33-e.self._31;n.normal.set(e.self._03-e.self._01,e.self._13-e.self._11,e.self._23-e.self._21),n.constant=l;var o=t[3],h=e.self._33+e.self._31;o.normal.set(e.self._03+e.self._01,e.self._13+e.self._11,e.self._23+e.self._21),o.constant=h;var c=t[4],u=e.self._32;c.normal.set(e.self._02,e.self._12,e.self._22),c.constant=u;var d=t[5],f=e.self._33-e.self._32;d.normal.set(e.self._03-e.self._02,e.self._13-e.self._12,e.self._23-e.self._22),d.constant=f;for(var _=0;_<t.length;){var v=t[_];++_,v.normalize()}},ke.sphereInFrustum=function(e,t,i,a,s,r){null==r&&(r=0),null==s&&(s=0),null==a&&(a=0),null==i&&(i=1);for(var n=t.radius*i,l=0;l<e.length;){var o=e[l];if(++l,ke.sphereCenter.set(t.world.self._30+a,t.world.self._31+s,t.world.self._32+r),o.distanceToSphere(ke.sphereCenter,n)+2*n<0)return!1}return!0},ke.__super__=Se,ke.prototype=i(Se.prototype,{buildProjection:function(){if("perspective"==this.data.raw.type){var e=null!=this.data.raw.aspect?this.data.raw.aspect:Bt.windowWidth()/Bt.windowHeight();this.P=te.perspective(this.data.raw.fov,e,this.nearPlane,this.farPlane)}else"orthographic"==this.data.raw.type&&(this.P=te.orthogonal(-10,10,-6,6,-this.farPlane,this.farPlane))},remove:function(){l.remove(re.active.cameras,this),Se.prototype.remove.call(this)},renderFrame:function(e){this.buildMatrix(),null==this.prevV&&(this.prevV=te.identity(),this.prevV.setFrom(this.V)),ie.active.renderFrame(e),this.prevV.setFrom(this.V)},buildMatrix:function(){this.transform.buildMatrix();var e=this.transform.world.getScale();ke.temp.set(1/e.x,1/e.y,1/e.z),this.transform.world.scale(ke.temp),this.V.getInverse(this.transform.world),this.VP.multmats(this.P,this.V),this.data.raw.frustum_culling&&ke.buildViewFrustum(this.VP,this.frustumPlanes)},__class__:ke});var Ce=function(){this.constant=0,this.normal=new ee(1,0,0)};s["iron.object.FrustumPlane"]=Ce,Ce.__name__=!0,Ce.prototype={normalize:function(){var e=this.normal,t=1/Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);this.normal.mult(t),this.constant*=t},distanceToSphere:function(e,t){return this.normal.dot(e)+this.constant-t},__class__:Ce};var Ae=function(e){this.target=null,this.raw=e};s["iron.object.Constraint"]=Ae,Ae.__name__=!0,Ae.prototype={apply:function(e){null==this.target&&null!=this.raw.target&&(this.target=re.active.getChild(this.raw.target).transform),"COPY_LOCATION"==this.raw.type&&(this.raw.use_x&&(e.world.self._30=this.target.loc.x,this.raw.use_offset&&(e.world.self._30+=e.loc.x)),this.raw.use_y&&(e.world.self._31=this.target.loc.y,this.raw.use_offset&&(e.world.self._31+=e.loc.y)),this.raw.use_z&&(e.world.self._32=this.target.loc.z,this.raw.use_offset&&(e.world.self._32+=e.loc.z)))},__class__:Ae};var Me=function(e){Se.call(this),this.material=e,re.active.decals.push(this)};s["iron.object.DecalObject"]=Me,Me.__name__=!0,Me.__super__=Se,Me.prototype=i(Se.prototype,{remove:function(){null!=re.active&&l.remove(re.active.decals,this),Se.prototype.remove.call(this)},__class__:Me});var Ne=function(e){this.frustumPlanes=null,this.VP=te.identity(),this.P=null,this.V=te.identity(),this.camSlicedP=null,Se.call(this),this.data=e;var t=e.raw.type,i=e.raw.fov;if("sun"==t){if(null==Ne.corners){Ne.corners=[];for(var a=0;a<8;){a++;Ne.corners.push(new ee)}}this.P=te.identity()}else"point"==t||"area"==t?this.P=te.perspective(i,1,e.raw.near_plane,e.raw.far_plane):"spot"==t&&(this.P=te.perspective(i,1,e.raw.near_plane,e.raw.far_plane));re.active.lamps.push(this)};s["iron.object.LampObject"]=Ne,Ne.__name__=!0,Ne.setCorners=function(){Ne.corners[0].set(-1,-1,1),Ne.corners[1].set(-1,-1,-1),Ne.corners[2].set(-1,1,1),Ne.corners[3].set(-1,1,-1),Ne.corners[4].set(1,-1,1),Ne.corners[5].set(1,-1,-1),Ne.corners[6].set(1,1,1),Ne.corners[7].set(1,1,-1)},Ne.__super__=Se,Ne.prototype=i(Se.prototype,{remove:function(){null!=re.active&&l.remove(re.active.lamps,this),Se.prototype.remove.call(this)},buildMatrices:function(e){this.transform.buildMatrix(),"sun"==this.data.raw.type?this.setCascade(e,0):(this.V.getInverse(this.transform.world),this.updateViewFrustum(e))},setCascade:function(e,t){if(Ne.m.setFrom(e.V),null==this.camSlicedP){var i=e.data.raw.fov,a=this.data.raw.near_plane,s=this.data.raw.far_plane,r=null!=e.data.raw.aspect?e.data.raw.aspect:Bt.windowWidth()/Bt.windowHeight();this.camSlicedP=te.perspective(i,r,a,s)}Ne.m.multmat2(this.camSlicedP),Ne.m.getInverse(Ne.m),this.V.getInverse(this.transform.world),this.V.toRotation(),Ne.m.multmat2(this.V),Ne.setCorners();for(var n=0,l=Ne.corners;n<l.length;){var o=l[n];++n,o.applymat4(Ne.m),o.set(o.x/o.w,o.y/o.w,o.z/o.w)}for(var h=Ne.corners[0].x,c=Ne.corners[0].y,u=Ne.corners[0].z,d=Ne.corners[0].x,f=Ne.corners[0].y,_=Ne.corners[0].z,v=0,p=Ne.corners;v<p.length;){var m=p[v];++v,m.x<h&&(h=m.x),m.x>d&&(d=m.x),m.y<c&&(c=m.y),m.y>f&&(f=m.y),m.z<u&&(u=m.z),m.z>_&&(_=m.z)}var g=Ne.corners[0],b=Ne.corners[7],w=g.x-b.x,B=g.y-b.y,y=g.z-b.z,x=Math.sqrt(w*w+B*B+y*y),I=.5*(x-(d-h)),S=.5*(x-(f-c));h-=I,d+=I,c-=S,f+=S;var k=this.data.raw.shadowmap_size,C=(d-h)/k,A=(f-c)/k,M=(_-u)/k;h=Math.floor(h/C)*C,c=Math.floor(c/A)*A,u=Math.floor(u/M)*M;var N=((d=Math.floor(d/C)*C)-h)/2,T=((f=Math.floor(f/A)*A)-c)/2,F=((_=Math.floor(_/M)*M)-u)/2;this.V.self._30=-(h+N),this.V.self._31=-(c+T),this.V.self._32=-(u+F),Ne.m=te.orthogonal(-N,N,-T,T,4*-F,F),this.P.setFrom(Ne.m),this.updateViewFrustum(e)},updateViewFrustum:function(e){if(this.VP.multmats(this.P,this.V),e.data.raw.frustum_culling){if(null==this.frustumPlanes){this.frustumPlanes=[];for(var t=0;t<6;){t++;this.frustumPlanes.push(new Ce)}}ke.buildViewFrustum(this.VP,this.frustumPlanes)}},setCubeFace:function(e,t){switch(Ne.p1.set(this.transform.world.self._30,this.transform.world.self._31,this.transform.world.self._32),Ne.p2.setFrom(Ne.p1),e){case 0:Ne.p2.addf(1,0,0),Ne.p3.set(0,-1,0);break;case 1:Ne.p2.addf(-1,0,0),Ne.p3.set(0,-1,0);break;case 2:Ne.p2.addf(0,1,0),Ne.p3.set(0,0,1);break;case 3:Ne.p2.addf(0,-1,0),Ne.p3.set(0,0,-1);break;case 4:Ne.p2.addf(0,0,1),Ne.p3.set(0,-1,0);break;case 5:Ne.p2.addf(0,0,-1),Ne.p3.set(0,-1,0)}this.V.setLookAt(Ne.p1,Ne.p2,Ne.p3),this.updateViewFrustum(t)},__class__:Ne});var Te=function(e,t){this.tilesheet=null,this.frustumCulling=!0,this.screenSize=0,this.particleIndex=-1,this.particleOwner=null,this.particleChildren=null,this.particleSystems=null,this.data=null,Se.call(this),this.setData(e),this.materials=t,re.active.meshes.push(this)};s["iron.object.MeshObject"]=Te,Te.__name__=!0,Te.__super__=Se,Te.prototype=i(Se.prototype,{setData:function(e){this.data=e,e.refcount++;e.geom.build()},remove:function(){if(null!=this.particleSystems){for(var e=0,t=this.particleSystems;e<t.length;){var i=t[e];++e,i.remove()}this.particleSystems=null}null!=this.tilesheet&&this.tilesheet.remove(),null!=re.active&&l.remove(re.active.meshes,this),this.data.refcount--,Se.prototype.remove.call(this)},setupAnimation:function(e){if(null!=this.parent&&null!=this.parent.raw&&null!=this.parent.raw.bone_actions){for(var t=this.parent.name,i=0,a=re.active.animations;i<a.length;){var s=a[i];if(++i,null!=s.armature&&s.armature.name==t){this.animation=s;break}}null==this.animation&&(this.animation=new Ie(t));var r=qe.__cast(this.animation,Ie);this.data.isSkinned?r.setSkin(this):null!=this.raw.parent_bone&&r.addBoneChild(this.raw.parent_bone,this)}Se.prototype.setupAnimation.call(this,e)},setupParticleSystem:function(e,t){null==this.particleSystems&&(this.particleSystems=[]);var i=new De(e,t);this.particleSystems.push(i)},setupTilesheet:function(e,t,i){this.tilesheet=new Ee(e,t,i)},setCulled:function(e,t){return e?this.culledShadow=t:this.culledMesh=t,this.culled=this.culledMesh&&this.culledShadow,t},cullMaterial:function(e,t){var i=this.materials;if((null==this.raw||null==this.raw.lod_material||1!=this.raw.lod_material)&&null==i[0].getContext(e))return!0;var a="shadowmap"==e;return this.visibleMesh||a?!this.visibleShadow&&a?this.setCulled(a,!0):this.skipContext(e)?this.setCulled(a,!0):this.setCulled(a,!1):this.setCulled(a,!0)},cullMesh:function(e,t,i){if(t.data.raw.frustum_culling&&this.frustumCulling){var a=this.data.isSkinned?2:1;null==this.particleSystems&&null==this.particleOwner||(a*=1e3),"voxel"==e&&(a*=100);var s="shadowmap"==e,r=s?i.frustumPlanes:t.frustumPlanes;if(s&&"sun"!=i.data.raw.type&&(i.transform.radius=i.data.raw.far_plane,!ke.sphereInFrustum(t.frustumPlanes,i.transform)))return this.setCulled(s,!0);if(this.data.geom.instanced){for(var n=!1,l=0,o=this.data.geom.offsetVecs;l<o.length;){var h=o[l];if(++l,ke.sphereInFrustum(r,this.transform,a,h.x,h.y,h.z)){n=!0;break}}if(!n)return this.setCulled(s,!0)}else if(!ke.sphereInFrustum(r,this.transform,a))return this.setCulled(s,!0)}return this.culled=!1,this.culled},skipContext:function(e){for(var t=0,i=this.materials;t<i.length;){var a=i[t];if(++t,null!=a.raw.skip_context&&a.raw.skip_context==e)return!0}return!1},getContexts:function(e,t,i,a){for(var s=0;s<t.length;){var r=t[s];++s;for(var n=0,o=r.raw.contexts.length;n<o;){var h=n++;if(l.substr(r.raw.contexts[h].name,0,e.length)==e){i.push(r.contexts[h]),a.push(r.shader.getContext(e));break}}}},render:function(e,t,i,a,s){if(null!=this.data&&this.data.geom.ready&&this.visible&&!this.cullMaterial(t,i)&&!(this.cullMesh(t,i,a)||null!=this.raw&&this.raw.is_particle&&null==this.particleOwner)){var r=null!=this.raw&&"mesh"==t;if(null!=this.particleSystems&&r){if(null==this.particleChildren){this.particleChildren=[];for(var n=0,l=this.particleSystems;n<l.length;){var o=l[n];++n;var h=re.active.getChild(o.data.raw.dupli_object);this.particleChildren.push(h),null!=h&&(h.particleOwner=this,h.particleIndex=this.particleChildren.length-1,h.transform=this.transform)}}for(var c=0,u=this.particleSystems.length;c<u;){var d=c++;this.particleSystems[d].update(this.particleChildren[d],this)}}null!=this.tilesheet&&this.tilesheet.update();var f=this.materials,_=this;if(null!=this.raw&&null!=this.raw.lods&&this.raw.lods.length>0){var v=this.transform,p=v.dim.x*v.scale.x*v.dim.y*v.scale.y*v.dim.z*v.scale.z;if(this.screenSize=p*(1/this.cameraDistance),this.screenSize=this.screenSize>1?1:this.screenSize,null==this.lods){this.lods=[];for(var m=0,g=this.raw.lods;m<g.length;){var b=g[m];++m,""==b.object_ref?this.lods.push(null):this.lods.push(re.active.getChild(b.object_ref))}}for(var w=0,B=this.raw.lods.length;w<B;){var y=w++;if(this.screenSize>this.raw.lods[y].screen_size)break;_=this.lods[y],null!=this.raw&&null!=this.raw.lod_material&&1==this.raw.lod_material&&(f=_.materials)}if(null==_)return}if(null==this.raw||null==this.raw.lod_material||1!=this.raw.lod_material||null!=f[0].getContext(t)){var x=[],I=[];this.getContexts(t,f,x,I),this.transform.update();var S=_.data;S.geom.instanced?e.setVertexBuffers([S.geom.vertexBuffer,S.geom.instancedVB]):e.setVertexBuffer(S.geom.vertexBuffer);for(var k=0,C=S.geom.indexBuffers.length;k<C;){var A=k++,M=S.geom.materialIndices[A];I.length<=M||(e.setIndexBuffer(S.geom.indexBuffers[A]),e.setPipeline(I[M].pipeState),We.setConstants(e,I[M],this,i,a,s),x.length>M&&We.setMaterialConstants(e,I[M],x[M]),S.geom.instanced?e.drawIndexedVerticesInstanced(S.geom.instanceCount):e.drawIndexedVertices())}}}},__class__:Te});var Fe=function(e,t){this.object=e,this.oactions=t,this.isSkinned=!1,xe.call(this)};s["iron.object.ObjectAnimation"]=Fe,Fe.__name__=!0,Fe.__super__=xe,Fe.prototype=i(xe.prototype,{getAction:function(e){for(var t=0,i=this.oactions;t<i.length;){var a=i[t];if(++t,null!=a&&a.objects[0].name==e)return a.objects[0]}return null},play:function(e,t,i,a,s){null==s&&(s=!0),null==a&&(a=1),null==i&&(i=0),null==e&&(e=""),xe.prototype.play.call(this,e,t,i,a,s),""==this.action&&null!=this.oactions[0]&&(this.action=this.oactions[0].objects[0].name),this.oaction=this.getAction(this.action),null!=this.oaction&&(this.isSampled=null!=this.oaction.sampled&&this.oaction.sampled)},update:function(e){this.object.visible&&!this.object.culled&&null!=this.oaction&&(xe.prototype.update.call(this,e),this.paused||this.isSkinned||this.updateObjectAnim())},updateObjectAnim:function(){if(this.isSampled){this.updateTrack(this.oaction.anim),this.updateAnimSampled(this.oaction.anim,this.object.transform.world),this.object.transform.world.decompose(this.object.transform.loc,this.object.transform.rot,this.object.transform.scale);for(var e=0,t=this.object.children;e<t.length;){var i=t[e];++e,i.transform.buildMatrix()}}else this.updateAnimNonSampled(this.oaction.anim,this.object.transform),this.object.transform.buildMatrix()},interpolateLinear:function(e,t,i){return(e-t)/(i-t)},interpolateBezier:function(e,t,i){var a=(e-t)/(i-t);return a=a*a*(3-2*a)},updateAnimNonSampled:function(e,t){if(null!=e){var i=e.end*this.frameTime-e.begin*this.frameTime;if(e.has_delta){var s=t;null==s.dloc&&(s.dloc=new ee,s.drot=new ye,s.dscale=new ee),s.dloc.set(0,0,0),s.dscale.set(0,0,0),s._deulerX=s._deulerY=s._deulerZ=0}for(var r=0,n=e.tracks;r<n.length;){var l=n[r];++r,-1==this.frameIndex&&this.rewind(l);for(var o=this.speed>0?1:-1,h=this.time+e.begin*this.frameTime;;){var c=l.frames;if(!(this.speed>0?this.frameIndex<c.length-2&&h>c[this.frameIndex+1]*this.frameTime:this.frameIndex>1&&h>c[this.frameIndex-1]*this.frameTime))break;this.frameIndex+=o}if(!(this.frameIndex>=l.frames.length)){if(this.time>i&&(null!=this.onComplete&&this.onComplete(),this.rewind(l),this.paused))return;var u=this.frameIndex,d=l.frames[u]*this.frameTime,f=l.frames[u+o]*this.frameTime,_=a(this,this.interpolateLinear);switch(l.curve){case"bezier":_=a(this,this.interpolateBezier);break;case"linear":_=a(this,this.interpolateLinear)}var v=_(h,d,f),p=1-v,m=l.values[u]*p+l.values[u+o]*v;switch(l.target){case"dxloc":t.dloc.x=m;break;case"dxrot":t._deulerX=m;break;case"dxscl":t.dscale.x=m;break;case"dyloc":t.dloc.y=m;break;case"dyrot":t._deulerY=m;break;case"dyscl":t.dscale.y=m;break;case"dzloc":t.dloc.z=m;break;case"dzrot":t._deulerZ=m;break;case"dzscl":t.dscale.z=m;break;case"xloc":t.loc.x=m;break;case"xrot":t.setRotation(m,t._eulerY,t._eulerZ);break;case"xscl":t.scale.x=m;break;case"yloc":t.loc.y=m;break;case"yrot":t.setRotation(t._eulerX,m,t._eulerZ);break;case"yscl":t.scale.y=m;break;case"zloc":t.loc.z=m;break;case"zrot":t.setRotation(t._eulerX,t._eulerY,m);break;case"zscl":t.scale.z=m}}}}},__class__:Fe});var De=function(e,t){this.m=te.identity(),this.lapTime=0,this.lap=0,this.count=0,this.emitFrom=null,this.seed=0,this.spawnRate=0,this.time=0,this.animtime=0,this.lifetime=0,this.frameRate=24;var i=this;this.seed=t.seed,this.particles=[],this.ready=!1,le.getParticle(e,t.particle,function(e){i.data=e,i.r=i.data.raw,i.gx=re.active.raw.gravity[0]*i.r.weight_gravity,i.gy=re.active.raw.gravity[1]*i.r.weight_gravity,i.gz=re.active.raw.gravity[2]*i.r.weight_gravity,i.alignx=i.r.object_align_factor[0]/2,i.aligny=i.r.object_align_factor[1]/2,i.alignz=i.r.object_align_factor[2]/2,i.lifetime=i.r.lifetime/i.frameRate,i.animtime=(i.r.frame_end-i.r.frame_start)/i.frameRate,i.spawnRate=(i.r.frame_end-i.r.frame_start)/i.r.count/i.frameRate;for(var t=0,a=i.r.count;t<a;){var s=t++;i.particles.push(new Re(s))}i.ready=!0})};s["iron.object.ParticleSystem"]=De,De.__name__=!0,De.prototype={getData:function(){return this.m.self._00=this.r.loop?this.animtime:-this.animtime,this.m.self._01=this.spawnRate,this.m.self._02=this.lifetime,this.m.self._03=this.particles.length,this.m.self._10=this.alignx,this.m.self._11=this.aligny,this.m.self._12=this.alignz,this.m.self._13=this.r.factor_random,this.m.self._20=this.gx*this.r.mass,this.m.self._21=this.gy*this.r.mass,this.m.self._22=this.gz*this.r.mass,this.m.self._23=this.r.lifetime_random,this.m.self._30=this.tilesx,this.m.self._31=this.tilesy,this.m.self._32=1/this.tilesFramerate,this.m.self._33=this.lapTime,this.m},update:function(e,t){this.ready&&(this.dimx=e.transform.dim.x,this.dimy=e.transform.dim.y,null!=e.tilesheet&&(this.tilesx=e.tilesheet.raw.tilesx,this.tilesy=e.tilesheet.raw.tilesy,this.tilesFramerate=e.tilesheet.raw.framerate),this.time+=.016666666666666666*Ke.scale,this.lap=this.time/this.animtime|0,this.lapTime=this.time-this.lap*this.animtime,this.count=this.lapTime/this.spawnRate|0,this.r.gpu_sim?this.updateGpu(e,t):this.updateCpu(e,t))},updateGpu:function(e,t){e.data.geom.instanced||this.setupGeomGpu(e,t)},updateCpu:function(e,t){if(e.data.geom.instanced||this.setupGeomCpu(e,t),0==this.r.type)for(var i=0,a=this.particles;i<a.length;){var s=a[i];++i,this.computePos(s,e,this.particles.length,this.lap,this.count)}for(var r=e.data.geom.instancedVB.lock(),n=0,l=this.particles.length;n<l;){var o=n++,h=this.particles[o],c=h.x,u=h.y,d=h.z;c+=this.emitFrom[3*o],u+=this.emitFrom[3*o+1],d+=this.emitFrom[3*o+2],r[3*o]=c,r[3*o+1]=u,r[3*o+2]=d}e.data.geom.instancedVB.unlock()},computePos:function(e,t,i,a,s){var r=e.i,n=this.lapTime-e.i*this.spawnRate;if(n-=n*this.fhash(r)*this.r.lifetime_random,this.r.loop)for(;n<0;)n+=this.animtime;n<0||n>this.lifetime?e.x=e.y=e.z=-99999:1==this.r.physics_type&&this.computeNewton(e,r,n)},computeNewton:function(e,t,i){e.x=this.alignx,e.y=this.aligny,e.z=this.alignz;var a=this.particles.length;e.x+=this.fhash(e.i+0*a)*this.r.factor_random-this.r.factor_random/2,e.y+=this.fhash(e.i+a)*this.r.factor_random-this.r.factor_random/2,e.z+=this.fhash(e.i+2*a)*this.r.factor_random-this.r.factor_random/2,e.x+=this.gx*this.r.mass*i/5,e.y+=this.gy*this.r.mass*i/5,e.z+=this.gz*this.r.mass*i/5,e.x*=i,e.y*=i,e.z*=i},setupGeomGpu:function(e,t){var i=new Ca(3*this.particles.length),a=0;if(0==this.r.emit_from)for(var s=t.data.geom.positions,r=0,n=this.particles;r<n.length;){n[r];++r;var l=this.fhash(a)*(s.length/3)|0;i[a]=s[3*l],i[++a]=s[3*l+1],i[++a]=s[3*l+2],++a}else for(var o=0,h=this.particles;o<h.length;){h[o];++o,i[a]=(2*Math.random()-1)*(e.transform.dim.x/2),i[++a]=(2*Math.random()-1)*(e.transform.dim.y/2),i[++a]=(2*Math.random()-1)*(e.transform.dim.z/2),++a}1!=this.r.particle_size&&e.data.geom.applyScale(this.r.particle_size,this.r.particle_size,this.r.particle_size),e.data.geom.setupInstanced(i,Li.StaticUsage)},setupGeomCpu:function(e,t){for(var i=new Ca(3*this.particles.length),a=0,s=0,r=this.particles;s<r.length;){r[s];++s,i[a]=0,i[++a]=0,i[++a]=0,++a}1!=this.r.particle_size&&e.data.geom.applyScale(this.r.particle_size,this.r.particle_size,this.r.particle_size),e.data.geom.setupInstanced(i,Li.DynamicUsage);var n=new Ca(3*this.particles.length);if(this.emitFrom=n,a=0,0==this.r.emit_from)for(var l=t.data.geom.positions,o=0,h=this.particles;o<h.length;){h[o];++o;var c=this.fhash(a)*(l.length/3)|0;this.emitFrom[a]=l[3*c],++a,this.emitFrom[a]=l[3*c+1],++a,this.emitFrom[a]=l[3*c+2],++a}else for(var u=0,d=this.particles;u<d.length;){d[u];++u,this.emitFrom[a]=(2*Math.random()-1)*(e.transform.dim.x/2),++a,this.emitFrom[a]=(2*Math.random()-1)*(e.transform.dim.y/2),++a,this.emitFrom[a]=(2*Math.random()-1)*(e.transform.dim.z/2),++a}},fhash:function(e){var t=e+1;return t*=9301%t,(t=(9301*t+49297)%233280)/233280},remove:function(){},__class__:De};var Re=function(e){this.z=0,this.y=0,this.x=0,this.i=e};s["iron.object.Particle"]=Re,Re.__name__=!0,Re.prototype={__class__:Re};var Pe=function(e){this.sound=null;var t=this;Se.call(this),this.data=e,re.active.speakers.push(this),""!=e.sound&&le.getSound(e.sound,function(e){t.sound=e,t.visible&&re.active.notifyOnInit(a(t,t.play))})};s["iron.object.SpeakerObject"]=Pe,Pe.__name__=!0,Pe.__super__=Se,Pe.prototype=i(Se.prototype,{play:function(){null==this.sound||this.data.muted||Ze.play(this.sound,this.data.loop)},remove:function(){null!=re.active&&l.remove(re.active.speakers,this),Se.prototype.remove.call(this)},__class__:Pe});var Ee=function(e,t,i){this.onActionComplete=null,this.time=0,this.frame=0,this.paused=!1,this.action=null,this.tileY=0,this.tileX=0;var a=this;this.ready=!1,le.getSceneRaw(e,function(e){for(var s=0,r=e.tilesheet_datas;s<r.length;){var n=r[s];if(++s,n.name==t){a.raw=n,a.play(i),a.ready=!0;break}}})};s["iron.object.Tilesheet"]=Ee,Ee.__name__=!0,Ee.prototype={play:function(e,t){this.onActionComplete=t;for(var i=0,a=this.raw.actions;i<a.length;){var s=a[i];if(++i,s.name==e){this.action=s;break}}this.setFrame(this.action.start),this.paused=!1},remove:function(){},update:function(){!this.ready||this.paused||this.action.start>=this.action.end||(this.time+=.016666666666666666*Ke.scale,this.time>=1/this.raw.framerate&&this.setFrame(this.frame+1))},setFrame:function(e){this.frame=e,this.time=0;var t=this.frame%this.raw.tilesx,i=this.frame/this.raw.tilesx|0;this.tileX=t*(1/this.raw.tilesx),this.tileY=i*(1/this.raw.tilesy),this.frame>=this.action.end&&this.action.start<this.action.end&&(null!=this.onActionComplete&&this.onActionComplete(),this.action.loop?this.setFrame(this.action.start):this.paused=!0)},__class__:Ee};var Ve=function(e){this.dscale=null,this.drot=null,this.dloc=null,this.boneParent=null,this.appendMats=null,this.prependMats=null,this.localOnly=!1,this.object=e,this.reset()};s["iron.object.Transform"]=Ve,Ve.__name__=!0,Ve.prototype={reset:function(){this.world=te.identity(),this.local=te.identity(),this.loc=new ee,this.rot=new ye,this.scale=new ee(1,1,1),this.dim=new ee(2,2,2),this.dirty=!0},update:function(){this.dirty&&(this.dirty=!1,this.buildMatrix())},composeDelta:function(){this.dloc.addvecs(this.loc,this.dloc),this.dscale.addvecs(this.dscale,this.scale),this.drot.fromEuler(this._deulerX,this._deulerY,this._deulerZ),this.drot.multquats(this.rot,this.drot),this.local.compose(this.dloc,this.drot,this.dscale)},buildMatrix:function(){if(null==this.dloc?this.local.compose(this.loc,this.rot,this.scale):this.composeDelta(),null!=this.prependMats){Ve.temp.setIdentity();for(var e=0,t=this.prependMats;e<t.length;){var i=t[e];++e,Ve.temp.multmat2(i)}Ve.temp.multmat2(this.local),this.local.setFrom(Ve.temp)}if(null!=this.appendMats)for(var a=0,s=this.appendMats;a<s.length;){var r=s[a];++a,this.local.multmat2(r)}if(null!=this.boneParent&&this.local.multmats(this.boneParent,this.local),null==this.object.parent||this.localOnly?this.world.setFrom(this.local):this.world.multmat3x4(this.local,this.object.parent.transform.world),null!=this.object.constraints)for(var n=0,l=this.object.constraints;n<l.length;){var o=l[n];++n,o.apply(this)}this.computeDim();for(var h=0,c=this.object.children;h<c.length;){var u=c[h];++h,u.transform.buildMatrix()}},decompose:function(){this.local.decompose(this.loc,this.rot,this.scale)},rotate:function(e,t){var i=new ye;i.fromAxisAngle(e,t),this.rot.multquats(i,this.rot),this.dirty=!0},setRotation:function(e,t,i){this.rot.fromEuler(e,t,i),this.dirty=!0,this._eulerX=e,this._eulerY=t,this._eulerZ=i},computeRadius:function(){this.radius=Math.sqrt(this.dim.x*this.dim.x+this.dim.y*this.dim.y+this.dim.z*this.dim.z)},computeDim:function(){if(null!=this.object.raw){var e=this.object.raw.dimensions;null==e?this.dim.set(2*this.scale.x,2*this.scale.y,2*this.scale.z):this.dim.set(e[0]*this.scale.x,e[1]*this.scale.y,e[2]*this.scale.z),this.computeRadius()}},applyParentInverse:function(){var e=this.object.parent.transform;e.buildMatrix(),Ve.temp.getInverse(e.world),this.local.multmat2(Ve.temp),this.decompose(),this.buildMatrix()},__class__:Ve};var Le=function(e,t,i,a,s,r,n,l,o){this._00=e,this._10=t,this._20=i,this._01=a,this._11=s,this._21=r,this._02=n,this._12=l,this._22=o};s["kha.math.FastMatrix3"]=Le,Le.__name__=!0,Le.prototype={__class__:Le};var We=function(){};s["iron.object.Uniforms"]=We,We.__name__=!0,We.setConstants=function(e,t,i,a,s,r){if(null!=t.raw.constants)for(var n=0,o=t.raw.constants.length;n<o;){var h=n++,c=t.raw.constants[h];We.setConstant(e,i,a,s,t.constants[h],c)}if(null!=r)for(var u=0,d=r.length/2|0;u<d;){var f=2*u++,_=r[f],v=r[f+1],p=!1;if("_"==_.charAt(0)&&(p=!0),p&&(_=l.substr(_,1,null)),"shadowMap"==_&&null!=s&&s.data.raw.shadowmap_cube){var m=ie.active.renderTargets;We.bindRenderTarget(e,null!=Ia.arm_empty?m.getReserved("arm_empty"):m.h.arm_empty,t,v,p),_+="Cube",v+="Cube"}else{var g=ie.active.renderTargets;We.bindRenderTarget(e,null!=Ia.arm_empty_cube?g.getReserved("arm_empty_cube"):g.h.arm_empty_cube,t,v+"Cube",p)}var b;if(p){var w=ie.active.depthToRenderTarget;b=null!=Ia[_]?w.getReserved(_):w.h[_]}else{var B=ie.active.renderTargets;b=null!=Ia[_]?B.getReserved(_):B.h[_]}We.bindRenderTarget(e,b,t,v,p)}if(null!=t.raw.texture_units)for(var y=0,x=t.raw.texture_units.length;y<x;){var I=y++,S=t.raw.texture_units[I].link;if(null!=S){t.raw.texture_units[I].name;if("_envmapRadiance"==S){var k=re.active.world;null!=k&&(e.setTexture(t.textureUnits[I],k.getGlobalProbe().radiance),e.setTextureParameters(t.textureUnits[I],Ri.Repeat,Ri.Repeat,Pi.LinearFilter,Pi.LinearFilter,Ai.LinearMipFilter))}else if("_envmap"==S){var C=re.active.world;null!=C&&e.setTexture(t.textureUnits[I],C.envmap)}else if("_envmapBrdf"==S){var A=re.active.embedded;e.setTexture(t.textureUnits[I],null!=Ia["brdf.png"]?A.getReserved("brdf.png"):A.h["brdf.png"])}else if("_noise8"==S){var M=re.active.embedded;e.setTexture(t.textureUnits[I],null!=Ia["noise8.png"]?M.getReserved("noise8.png"):M.h["noise8.png"]),e.setTextureParameters(t.textureUnits[I],Ri.Repeat,Ri.Repeat,Pi.LinearFilter,Pi.LinearFilter,Ai.NoMipFilter)}else if("_noise64"==S){var N=re.active.embedded;e.setTexture(t.textureUnits[I],null!=Ia["noise64.png"]?N.getReserved("noise64.png"):N.h["noise64.png"]),e.setTextureParameters(t.textureUnits[I],Ri.Repeat,Ri.Repeat,Pi.LinearFilter,Pi.LinearFilter,Ai.NoMipFilter)}else if("_noise256"==S){var T=re.active.embedded;e.setTexture(t.textureUnits[I],null!=Ia["noise256.png"]?T.getReserved("noise256.png"):T.h["noise256.png"]),e.setTextureParameters(t.textureUnits[I],Ri.Repeat,Ri.Repeat,Pi.LinearFilter,Pi.LinearFilter,Ai.NoMipFilter)}else if("_lampColorTexture"==S)null!=s&&(e.setTexture(t.textureUnits[I],s.data.colorTexture),e.setTextureParameters(t.textureUnits[I],Ri.Repeat,Ri.Repeat,Pi.LinearFilter,Pi.LinearFilter,Ai.NoMipFilter));else if("_iesTexture"==S){var F=re.active.embedded;e.setTexture(t.textureUnits[I],null!=Ia["iestexture.png"]?F.getReserved("iestexture.png"):F.h["iestexture.png"]),e.setTextureParameters(t.textureUnits[I],Ri.Repeat,Ri.Repeat,Pi.LinearFilter,Pi.LinearFilter,Ai.NoMipFilter)}else if("_sdfTexture"!=S&&null!=We.externalTextureLinks)for(var D=0,R=We.externalTextureLinks;D<R.length;){var P=R[D];++D;var E=P(S);if(null!=E){e.setTexture(t.textureUnits[I],E);break}}}}},We.bindRenderTarget=function(e,t,i,a,s){if(null!=t)for(var r=i.raw.texture_units,n=0,l=r.length;n<l;){var o=n++;a==r[o].name&&(null!=r[o].is_image&&r[o].is_image||(t.isCubeMap?s?e.setCubeMapDepth(i.textureUnits[o],t.cubeMap):e.setCubeMap(i.textureUnits[o],t.cubeMap):s?e.setTextureDepth(i.textureUnits[o],t.image):e.setTexture(i.textureUnits[o],t.image)),t.raw.mipmaps&&null==r[o].params_set&&(r[o].params_set=!0,e.setTextureParameters(i.textureUnits[o],Ri.Clamp,Ri.Clamp,Pi.LinearFilter,Pi.LinearFilter,Ai.LinearMipFilter)))}},We.setConstant=function(e,t,i,a,s,r){if(null!=r.link)if("mat4"==r.type){var n=null;if("_worldMatrix"==r.link)n=t.transform.world;else if("_inverseWorldMatrix"==r.link)We.helpMat.getInverse(t.transform.world),n=We.helpMat;else if("_viewMatrix"==r.link)n=i.V;else if("_transposeInverseViewMatrix"==r.link)We.helpMat.setFrom(i.V),We.helpMat.getInverse(We.helpMat),We.helpMat.transpose(),n=We.helpMat;else if("_inverseViewMatrix"==r.link)We.helpMat.getInverse(i.V),n=We.helpMat;else if("_transposeViewMatrix"==r.link)We.helpMat.setFrom(i.V),We.helpMat.transpose3x3(),n=We.helpMat;else if("_projectionMatrix"==r.link)n=i.P;else if("_inverseProjectionMatrix"==r.link)We.helpMat.getInverse(i.P),n=We.helpMat;else if("_inverseViewProjectionMatrix"==r.link)We.helpMat.setFrom(i.V),We.helpMat.multmat2(i.P),We.helpMat.getInverse(We.helpMat),n=We.helpMat;else if("_worldViewProjectionMatrix"==r.link)We.helpMat.setFrom(t.transform.world),We.helpMat.multmat2(i.V),We.helpMat.multmat2(i.P),n=We.helpMat;else if("_worldViewProjectionMatrixSphere"==r.link)We.helpMat.setFrom(t.transform.world),We.helpMat.multmat2(i.V),We.helpMat.self._00=1,We.helpMat.self._10=0,We.helpMat.self._20=0,We.helpMat.self._01=0,We.helpMat.self._11=1,We.helpMat.self._21=0,We.helpMat.self._02=0,We.helpMat.self._12=0,We.helpMat.self._22=1,We.helpMat.multmat2(i.P),n=We.helpMat;else if("_worldViewProjectionMatrixCylinder"==r.link)We.helpMat.setFrom(t.transform.world),We.helpMat.multmat2(i.V),We.helpMat.self._00=1,We.helpMat.self._20=0,We.helpMat.self._01=0,We.helpMat.self._21=0,We.helpMat.self._02=0,We.helpMat.self._22=1,We.helpMat.multmat2(i.P),n=We.helpMat;else if("_worldViewMatrix"==r.link)We.helpMat.setFrom(t.transform.world),We.helpMat.multmat2(i.V),n=We.helpMat;else if("_viewProjectionMatrix"==r.link)n=i.VP;else if("_prevViewProjectionMatrix"==r.link)We.helpMat.setFrom(i.prevV),We.helpMat.multmat2(i.P),n=We.helpMat;else if("_lampWorldViewProjectionMatrix"==r.link)null!=a&&(null==t?We.helpMat.setIdentity():We.helpMat.setFrom(t.transform.world),We.helpMat.multmat2(a.VP),n=We.helpMat);else if("_lampWorldViewProjectionMatrixSphere"==r.link)null!=a&&(We.helpMat.setFrom(t.transform.world),We.helpMat.multmat2(i.V),We.helpMat.self._00=1,We.helpMat.self._10=0,We.helpMat.self._20=0,We.helpMat.self._01=0,We.helpMat.self._11=1,We.helpMat.self._21=0,We.helpMat.self._02=0,We.helpMat.self._12=0,We.helpMat.self._22=1,We.helpMat2.getInverse(i.V),We.helpMat.multmat2(We.helpMat2),We.helpMat.multmat2(a.VP),n=We.helpMat);else if("_lampWorldViewProjectionMatrixCylinder"==r.link)null!=a&&(We.helpMat.setFrom(t.transform.world),We.helpMat.multmat2(i.V),We.helpMat.self._00=1,We.helpMat.self._20=0,We.helpMat.self._01=0,We.helpMat.self._21=0,We.helpMat.self._02=0,We.helpMat.self._22=1,We.helpMat2.getInverse(i.V),We.helpMat.multmat2(We.helpMat2),We.helpMat.multmat2(a.VP),n=We.helpMat);else if("_biasLampWorldViewProjectionMatrix"==r.link)null!=a&&(null==t?We.helpMat.setIdentity():We.helpMat.setFrom(t.transform.world),We.helpMat.multmat2(a.VP),We.helpMat.multmat2(We.biasMat),n=We.helpMat);else if("_lampViewProjectionMatrix"==r.link)null!=a&&(n=a.VP);else if("_biasLampViewProjectionMatrix"==r.link)null!=a&&(We.helpMat.setFrom(a.VP),We.helpMat.multmat2(We.biasMat),n=We.helpMat);else if("_lampVolumeWorldViewProjectionMatrix"==r.link){if(null!=a){var l=a.transform,o=a.data.raw.type;"spot"==o?(We.helpVec.set(l.world.self._30,l.world.self._31,l.world.self._32),We.helpVec2.set(a.data.raw.far_plane,2*a.data.raw.far_plane,2*a.data.raw.far_plane),We.helpMat.compose(We.helpVec,We.helpQuat,We.helpVec2)):"point"!=o&&"area"!=o||(We.helpVec.set(l.world.self._30,l.world.self._31,l.world.self._32),We.helpVec2.set(a.data.raw.far_plane,2*a.data.raw.far_plane,2*a.data.raw.far_plane),We.helpMat.compose(We.helpVec,We.helpQuat,We.helpVec2)),We.helpMat.multmat2(i.V),We.helpMat.multmat2(i.P),n=We.helpMat}}else if("_skydomeMatrix"==r.link){var h=i.transform;We.helpVec.set(h.world.self._30,h.world.self._31,h.world.self._32-3.5);var c=.95*i.farPlane;We.helpVec2.set(c,c,c),We.helpMat.compose(We.helpVec,We.helpQuat,We.helpVec2),We.helpMat.multmat2(i.V),We.helpMat.multmat2(i.P),n=We.helpMat}else if("_lampViewMatrix"==r.link)null!=a&&(n=a.V);else if("_lampProjectionMatrix"==r.link)null!=a&&(n=a.P);else if("_particleData"==r.link){var u=qe.__cast(t,Te);null!=u.particleOwner&&(n=u.particleOwner.particleSystems[u.particleIndex].getData())}else if(null!=We.externalMat4Links)for(var d=0,f=We.externalMat4Links;d<f.length;){var _=f[d];if(++d,null!=(n=_(r.link)))break}if(null==n)return;e.setMatrix(s,n.self)}else if("mat3"==r.type){var v=null;if("_normalMatrix"==r.link&&(We.helpMat.setFrom(t.transform.world),We.helpMat.getInverse(We.helpMat),We.helpMat.transpose3x3(),We.helpMat3.setFrom4(We.helpMat),v=We.helpMat3),null==v)return;e.setMatrix3(s,v.self)}else if("vec4"==r.type){var p=null;if(We.helpVec.set(0,0,0),"_input"==r.link)We.helpVec.set(Ue.getMouse().x/Bt.windowWidth(),Ue.getMouse().y/Bt.windowHeight(),Ue.getMouse().down()?1:0,0),p=We.helpVec;else if(null!=We.externalVec4Links)for(var m=0,g=We.externalVec4Links;m<g.length;){var b=g[m];if(++m,null!=(p=b(r.link)))break}if(null==p)return;e.setFloat4(s,p.x,p.y,p.z,p.w)}else if("vec3"==r.type){var w=null;if(We.helpVec.set(0,0,0),"_lampPosition"==r.link)null!=a&&We.helpVec.set(a.transform.world.self._30,a.transform.world.self._31,a.transform.world.self._32),w=We.helpVec;else if("_lampDirection"==r.link)null!=a&&(We.helpVec=new ee(a.V.self._02,a.V.self._12,a.V.self._22)),w=We.helpVec;else if("_lampColor"==r.link){if(null!=a){var B=a.data.raw.strength;We.helpVec.set(a.data.raw.color[0]*B,a.data.raw.color[1]*B,a.data.raw.color[2]*B)}w=We.helpVec}else if("_lampColorVoxel"==r.link){if(null!=a){var y=a.data.raw.strength;We.helpVec.set(a.data.raw.color[0]*y,a.data.raw.color[1]*y,a.data.raw.color[2]*y)}w=We.helpVec}else if("_lampArea0"==r.link){if(null!=a&&null!=a.data.raw.size){var x=a.data.raw.size/2,I=a.data.raw.size_y/2;We.helpVec.set(-x,I,0),We.helpVec.applymat(a.transform.world),w=We.helpVec}}else if("_lampArea1"==r.link){if(null!=a&&null!=a.data.raw.size){var S=a.data.raw.size/2,k=a.data.raw.size_y/2;We.helpVec.set(S,k,0),We.helpVec.applymat(a.transform.world),w=We.helpVec}}else if("_lampArea2"==r.link){if(null!=a&&null!=a.data.raw.size){var C=a.data.raw.size/2,A=a.data.raw.size_y/2;We.helpVec.set(C,-A,0),We.helpVec.applymat(a.transform.world),w=We.helpVec}}else if("_lampArea3"==r.link){if(null!=a&&null!=a.data.raw.size){var M=a.data.raw.size/2,N=a.data.raw.size_y/2;We.helpVec.set(-M,-N,0),We.helpVec.applymat(a.transform.world),w=We.helpVec}}else if("_cameraPosition"==r.link)We.helpVec.set(i.transform.world.self._30,i.transform.world.self._31,i.transform.world.self._32),w=We.helpVec;else if("_cameraPositionSnap"!=r.link)if("_cameraLook"==r.link)We.helpVec=new ee(-i.transform.world.self._20,-i.transform.world.self._21,-i.transform.world.self._22),w=We.helpVec;else if("_cameraUp"==r.link)We.helpVec=new ee(i.transform.world.self._10,i.transform.world.self._11,i.transform.world.self._12),w=We.helpVec;else if("_cameraRight"==r.link)We.helpVec=new ee(i.transform.world.self._00,i.transform.world.self._01,i.transform.world.self._02),w=We.helpVec;else if("_backgroundCol"==r.link)We.helpVec.set(i.data.raw.clear_color[0],i.data.raw.clear_color[1],i.data.raw.clear_color[2]),w=We.helpVec;else if("_probeVolumeCenter"==r.link)w=re.active.world.getProbeVolumeCenter(t.transform);else if("_probeVolumeSize"==r.link)w=re.active.world.getProbeVolumeSize(t.transform);else if("_sunDirection"==r.link){var T=re.active.world;null!=T&&(We.helpVec.set(T.raw.sun_direction[0],T.raw.sun_direction[1],T.raw.sun_direction[2]),w=We.helpVec)}else if(null!=We.externalVec3Links)for(var F=0,D=We.externalVec3Links;F<D.length;){var R=D[F];if(++F,null!=(w=R(r.link)))break}if(null==w)return;e.setFloat3(s,w.x,w.y,w.z)}else if("vec2"==r.type){var P=0,E=0;if("_vec2x"==r.link)P=1;else if("_vec2xInv"==r.link)P=1/ie.active.currentW;else if("_vec2x2"==r.link)P=2;else if("_vec2x2Inv"==r.link)P=2/ie.active.currentW;else if("_vec2y"==r.link)E=1;else if("_vec2yInv"==r.link)E=1/ie.active.currentH;else if("_vec2y2"==r.link)E=2;else if("_vec2y2Inv"==r.link)E=2/ie.active.currentH;else if("_vec2y3"==r.link)E=3;else if("_vec2y3Inv"==r.link)E=3/ie.active.currentH;else if("_windowSize"==r.link)P=Bt.windowWidth(),E=Bt.windowHeight();else if("_windowSizeInv"==r.link)P=1/Bt.windowWidth(),E=1/Bt.windowHeight();else if("_screenSize"==r.link)P=ie.active.currentW,E=ie.active.currentH;else if("_screenSizeInv"==r.link)P=1/ie.active.currentW,E=1/ie.active.currentH;else if("_aspectRatio"==r.link)P=ie.active.currentH/ie.active.currentW,E=ie.active.currentW/ie.active.currentH,P=P>1?1:P,E=E>1?1:E;else if("_cameraPlane"==r.link)P=i.data.raw.near_plane,E=i.data.raw.far_plane;else if("_cameraPlaneProj"==r.link){var V=i.data.raw.near_plane,L=i.data.raw.far_plane;P=L/(L-V),E=-L*V/(L-V)}else if("_lampPlane"==r.link)P=null==a?0:a.data.raw.near_plane,E=null==a?0:a.data.raw.far_plane;else if("_lampPlaneProj"==r.link){if(null!=a){var W=a.data.raw.near_plane,G=a.data.raw.far_plane,Z=G-W;P=(G+W)/Z,E=2*G*W/Z}}else if("_spotlampData"==r.link)P=null==a?0:a.data.raw.spot_size,E=null==a?0:P-a.data.raw.spot_blend;else if("_tilesheetOffset"==r.link){var U=qe.__cast(t,Te).tilesheet;P=U.tileX,E=U.tileY}else if(null!=We.externalVec2Links)for(var z=0,O=We.externalVec2Links;z<O.length;){var H=O[z];++z;var j=H(r.link);if(null!=j){P=j.x,E=j.y;break}}e.setFloat2(s,P,E)}else if("float"==r.type){var X=0;if("_time"==r.link)X=mt.time();else if("_deltaTime"==r.link)X=.016666666666666666*Ke.scale;else if("_lampRadius"==r.link)X=null==a?0:a.data.raw.far_plane;else if("_lampShadowsBias"==r.link)X=null==a?0:a.data.raw.shadows_bias;else if("_lampSize"==r.link)null!=a&&null!=a.data.raw.lamp_size&&(X=a.data.raw.lamp_size);else if("_lampSizeUV"==r.link)null!=a&&null!=a.data.raw.lamp_size&&(X=a.data.raw.lamp_size/a.data.raw.fov);else if("_envmapStrength"==r.link)X=null==re.active.world?0:re.active.world.getGlobalProbe().raw.strength;else if("_probeStrength"==r.link)X=re.active.world.getProbeStrength(t.transform);else if("_probeBlending"==r.link)X=re.active.world.getProbeBlending(t.transform);else if("_aspectRatioF"==r.link)X=ie.active.currentW/ie.active.currentH;else if("_aspectRatioWindowF"==r.link)X=Bt.windowWidth()/Bt.windowHeight();else if("_objectInfoIndex"==r.link)X=t.uid;else if("_objectInfoMaterialIndex"==r.link)X=null!=ie.active.currentMaterial?ie.active.currentMaterial.uid:qe.__cast(t,Te).materials[0].uid;else if("_objectInfoRandom"==r.link)X=t.urandom;else if(null!=We.externalFloatLinks)for(var Y=0,K=We.externalFloatLinks;Y<K.length;){var Q=K[Y];++Y;var J=Q(r.link);if(null!=J){X=J;break}}e.setFloat(s,X)}else if("floats"==r.type){var q=null;if("_skinBones"==r.link)null!=t.animation&&(q=qe.__cast(t.animation,Ie).skinBuffer);else if("_envmapIrradiance"==r.link)q=null==re.active.world?be.getEmptyIrradiance():re.active.world.getSHIrradiance();else if(null!=We.externalFloatsLinks)for(var $=0,te=We.externalFloatsLinks;$<te.length;){var ae=te[$];if(++$,null!=(q=ae(r.link)))break}null!=q&&e.setFloats(s,q)}else if("int"==r.type){var se=0;if("_uid"==r.link&&(se=t.uid),"_lampType"==r.link)if(null==a)se=0;else switch(a.data.raw.type){case"area":se=3;break;case"point":se=1;break;case"spot":se=2;break;case"sun":se=0;break;default:se=0}else if("_lampIndex"==r.link)se=ie.active.currentLampIndex;else if("_lampCastShadow"==r.link)null!=a&&a.data.raw.cast_shadow&&(se=a.data.raw.shadowmap_cube?2:1);else if("_envmapNumMipmaps"==r.link){var ne=re.active.world;se=null!=ne?ne.getGlobalProbe().raw.radiance_mipmaps+1-2:1}else if(null!=We.externalIntLinks)for(var le=0,oe=We.externalIntLinks;le<oe.length;){var he=oe[le];++le;var ce=he(r.link);if(null!=ce){se=ce;break}}e.setInt(s,se)}},We.setMaterialConstants=function(e,t,i){if(null!=i.raw.bind_constants)for(var a=0,s=i.raw.bind_constants.length;a<s;){for(var r=a++,n=i.raw.bind_constants[r],l=-1,o=0,h=t.raw.constants.length;o<h;){var c=o++;if(t.raw.constants[c].name==n.name){l=c;break}}if(-1!=l){var u=t.raw.constants[l];We.setMaterialConstant(e,t.constants[l],u,n)}}if(null!=i.textures)for(var d=0,f=i.textures.length;d<f;)for(var _=d++,v=i.raw.bind_textures[_].name,p=0,m=t.textureUnits.length;p<m;){var g=p++;if(v==t.raw.texture_units[g].name){e.setTexture(t.textureUnits[g],i.textures[_]),i.setTextureParameters(e,_,t,g);break}}},We.setMaterialConstant=function(e,t,i,a){switch(i.type){case"bool":e.setBool(t,a.bool);break;case"float":e.setFloat(t,a.float);break;case"int":e.setInt(t,a.int);break;case"vec2":e.setFloat2(t,a.vec2[0],a.vec2[1]);break;case"vec3":e.setFloat3(t,a.vec3[0],a.vec3[1],a.vec3[2]);break;case"vec4":e.setFloat4(t,a.vec4[0],a.vec4[1],a.vec4[2],a.vec4[3])}};var Ge=function(){};s["iron.system.ArmPack"]=Ge,Ge.__name__=!0,Ge.read=function(e){try{var t=e.readByte();switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return e.read(e.readByte());case 197:return e.read(e.readUInt16());case 198:return e.read(e.readInt32());case 202:return e.readFloat();case 203:return e.readDouble();case 204:return e.readByte();case 205:return e.readUInt16();case 206:return e.readInt32();case 208:return e.readInt8();case 209:return e.readInt16();case 210:return e.readInt32();case 217:return e.readString(e.readByte());case 218:return e.readString(e.readUInt16());case 219:return e.readString(e.readInt32());case 220:return Ge.readArray(e,e.readUInt16());case 221:return Ge.readArray(e,e.readInt32());case 222:return Ge.readMap(e,e.readUInt16());case 223:return Ge.readMap(e,e.readInt32());default:if(t<128)return t;if(t<144)return Ge.readMap(e,15&t);if(t<160)return Ge.readArray(e,15&t);if(t<192)return e.readString(31&t);if(t>223)return-256|t}}catch(e){if(e instanceof Je&&(e=e.val),!qe.__instanceof(e,G))throw e}return null},Ge.readArray=function(e,t){var i=e.readByte(),a=e,s=a.pos;if(a.set_position(s-1),202==i){var r=e,n=r.pos;r.set_position(n+1);for(var l=new Ca(t),o=0,h=t;o<h;)l[o++]=e.readFloat();return l}if(210==i){var c=e,u=c.pos;c.set_position(u+1);for(var d=new Uint32Array(t),f=0,_=t;f<_;)d[f++]=e.readInt32();return d}for(var v=[],p=0,m=t;p<m;){p++;v.push(Ge.read(e))}return v},Ge.readMap=function(e,t){for(var i={},a=0,s=t;a<s;){a++;var r=Ge.read(e),n=Ge.read(e);i[_.string(r)]=n}return i};var Ze=function(){};s["iron.system.Audio"]=Ze,Ze.__name__=!0,Ze.play=function(e,t){null==t&&(t=!1),Ct.play(e,t)};var Ue=function(){};s["iron.system.Input"]=Ue,Ue.__name__=!0,Ue.endFrame=function(){null!=Ue.mouse&&Ue.mouse.endFrame(),null!=Ue.keyboard&&Ue.keyboard.endFrame();for(var e=0,t=Ue.gamepads;e<t.length;){var i=t[e];++e,i.endFrame()}if(null!=Ue.virtualButtons)for(var a=Ue.virtualButtons,s=new D(a,a.arrayKeys());s.hasNext();){var r=s.next();r.started=r.released=!1}},Ue.getMouse=function(){return null==Ue.mouse&&(Ue.mouse=new He),Ue.mouse};var ze=function(){this.down=!1,this.released=!1,this.started=!1};s["iron.system.VirtualButton"]=ze,ze.__name__=!0,ze.prototype={__class__:ze};var Oe=function(){this.virtualButtons=null};s["iron.system.VirtualInput"]=Oe,Oe.__name__=!0,Oe.prototype={downVirtual:function(e){if(null!=this.virtualButtons){var t=this.virtualButtons,i=null!=Ia[e]?t.getReserved(e):t.h[e];null!=i&&(i.down=!0,i.started=!0)}},upVirtual:function(e){if(null!=this.virtualButtons){var t=this.virtualButtons,i=null!=Ia[e]?t.getReserved(e):t.h[e];null!=i&&(i.down=!1,i.released=!0)}},__class__:Oe};var He=function(){this.lastY=-1,this.lastX=-1,this.locked=!1,this.wheelDelta=0,this.movementY=0,this.movementX=0,this.moved=!1,this.y=0,this.x=0,this.buttonsReleased=[!1,!1,!1],this.buttonsStarted=[!1,!1,!1],this.buttonsDown=[!1,!1,!1],Oe.call(this),Xi.get().notify(a(this,this.downListener),a(this,this.upListener),a(this,this.moveListener),a(this,this.wheelListener))};s["iron.system.Mouse"]=He,He.__name__=!0,He.__super__=Oe,He.prototype=i(Oe.prototype,{endFrame:function(){var e=this.buttonsStarted[1]=this.buttonsStarted[2]=!1;this.buttonsStarted[0]=e;var t=this.buttonsReleased[1]=this.buttonsReleased[2]=!1;this.buttonsReleased[0]=t,this.moved=!1,this.movementX=0,this.movementY=0,this.wheelDelta=0},buttonIndex:function(e){return"left"==e?0:"right"==e?1:2},down:function(e){return null==e&&(e="left"),this.buttonsDown[this.buttonIndex(e)]},downListener:function(e,t,i){this.buttonsDown[e]=!0,this.buttonsStarted[e]=!0,this.x=t,this.y=i,this.downVirtual(He.buttons[e])},upListener:function(e,t,i){this.buttonsDown[e]=!1,this.buttonsReleased[e]=!0,this.x=t,this.y=i,this.upVirtual(He.buttons[e])},moveListener:function(e,t,i,a){-1==this.lastX&&-1==this.lastY&&(this.lastX=e,this.lastY=t),this.locked?(this.movementX=i,this.movementY=a):(this.movementX=e-this.lastX,this.movementY=t-this.lastY),this.lastX=e,this.lastY=t,this.x=e,this.y=t,this.moved=!0},wheelListener:function(e){this.wheelDelta=e},__class__:He});var je=function(){this.keysFrame=[],this.keysReleased=new R,this.keysStarted=new R};s["iron.system.Keyboard"]=je,je.__name__=!0,je.__super__=Oe,je.prototype=i(Oe.prototype,{endFrame:function(){if(this.keysFrame.length>0){for(var e=0,t=this.keysFrame;e<t.length;){var i=t[e];++e;var a=this.keysStarted;null!=Ia[i]?a.setReserved(i,!1):a.h[i]=!1;var s=this.keysReleased;null!=Ia[i]?s.setReserved(i,!1):s.h[i]=!1}this.keysFrame.splice(0,this.keysFrame.length)}},__class__:je});var Xe=function(){this.movementY=0,this.movementX=0,this.moved=!1};s["iron.system.GamepadStick"]=Xe,Xe.__name__=!0,Xe.prototype={__class__:Xe};var Ye=function(){this.rightStick=new Xe,this.leftStick=new Xe,this.buttonsFrame=[],this.buttonsReleased=[],this.buttonsStarted=[]};s["iron.system.Gamepad"]=Ye,Ye.__name__=!0,Ye.__super__=Oe,Ye.prototype=i(Oe.prototype,{endFrame:function(){if(this.buttonsFrame.length>0){for(var e=0,t=this.buttonsFrame;e<t.length;){var i=t[e];++e,this.buttonsStarted[i]=!1,this.buttonsReleased[i]=!1}this.buttonsFrame.splice(0,this.buttonsFrame.length)}this.leftStick.moved=!1,this.leftStick.movementX=0,this.leftStick.movementY=0,this.rightStick.moved=!1,this.rightStick.movementX=0,this.rightStick.movementY=0},__class__:Ye});var Ke=function(){};s["iron.system.Time"]=Ke,Ke.__name__=!0,Ke.update=function(){Ke.realDelta=mt.realTime()-Ke.last,Ke.last=mt.realTime()};var Qe=function(){};s["iron.system.Tween"]=Qe,Qe.__name__=!0,Qe.update=function(){for(var e=.016666666666666666*Ke.scale,t=Qe.anims.length;t-- >0&&Qe.anims.length>0;){var i=Qe.anims[t];if(!(i.delay>0&&(i.delay-=e,i.delay>0))){if(i._time+=e,null!=i.target){qe.__instanceof(i.target,Ve)&&(i.target.dirty=!0);for(var a=f.fields(i.props),s=0,r=a.length;s<r;){var n=s++,l=a[n],o=i._time/i.duration;if(o>1&&(o=1),1==i._comps[n]){var h=i._x[n],c=h+(f.getProperty(i.props,l)-h)*Qe.eases[i.ease](o);f.setProperty(i.target,l,c)}else{var u=f.getProperty(i.props,l),d=f.getProperty(u,"x"),_=f.getProperty(u,"y"),v=f.getProperty(u,"z"),p=f.getProperty(u,"w");i._normalize[n]&&i._x[n]*d+i._y[n]*_+i._z[n]*v+i._w[n]*p<0&&(d=-d,_=-_,v=-v,p=-p);var m=i._x[n]+(d-i._x[n])*Qe.eases[i.ease](o),g=i._y[n]+(_-i._y[n])*Qe.eases[i.ease](o),b=i._z[n]+(v-i._z[n])*Qe.eases[i.ease](o),w=i._w[n]+(p-i._w[n])*Qe.eases[i.ease](o);if(i._normalize[n]){var B=Math.sqrt(m*m+g*g+b*b+w*w);B>0&&(m*=B=1/B,g*=B,b*=B,w*=B)}var y=f.getProperty(i.target,l);f.setProperty(y,"x",m),f.setProperty(y,"y",g),f.setProperty(y,"z",b),f.setProperty(y,"w",w)}}}null!=i.tick&&i.tick(),i._time>=i.duration&&(Qe.anims.splice(t,1),--t,null!=i.done&&i.done())}}},Qe.easeLinear=function(e){return e},Qe.easeSineIn=function(e){return 0==e?0:1==e?1:1-Math.cos(e*Math.PI/2)},Qe.easeSineOut=function(e){return 0==e?0:1==e?1:Math.sin(e*(.5*Math.PI))},Qe.easeSineInOut=function(e){return 0==e?0:1==e?1:-.5*(Math.cos(Math.PI*e)-1)},Qe.easeQuadIn=function(e){return e*e},Qe.easeQuadOut=function(e){return-e*(e-2)},Qe.easeQuadInOut=function(e){return e<.5?2*e*e:--e*e*-2+1},Qe.easeCubicIn=function(e){return e*e*e},Qe.easeCubicOut=function(e){return--e*e*e+1},Qe.easeCubicInOut=function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},Qe.easeQuartIn=function(e){return(e*=e)*e},Qe.easeQuartOut=function(e){return 1-(e=--e*e)*e},Qe.easeQuartInOut=function(e){return(e*=2)<1?.5*(e*=e)*e:-.5*((e=(e-=2)*e)*e-2)},Qe.easeQuintIn=function(e){return e*(e*=e)*e},Qe.easeQuintOut=function(e){return--e*(e*=e)*e+1},Qe.easeQuintInOut=function(e){return(e*=2)<1?.5*e*(e*=e)*e:.5*(e-=2)*(e*=e)*e+1},Qe.easeExpoIn=function(e){return 0==e?0:Math.pow(2,10*(e-1))},Qe.easeExpoOut=function(e){return 1==e?1:1-Math.pow(2,-10*e)},Qe.easeExpoInOut=function(e){return 0==e?0:1==e?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*--e))},Qe.easeCircIn=function(e){return-(Math.sqrt(1-e*e)-1)},Qe.easeCircOut=function(e){return Math.sqrt(1-(e-1)*(e-1))},Qe.easeCircInOut=function(e){return e<=.5?(Math.sqrt(1-e*e*4)-1)/-2:(Math.sqrt(1-(2*e-2)*(2*e-2))+1)/2},Qe.easeBackIn=function(e){return 0==e?0:1==e?1:e*e*(2.70158*e-1.70158)},Qe.easeBackOut=function(e){return 0==e?0:1==e?1:--e*e*(2.70158*e+1.70158)+1},Qe.easeBackInOut=function(e){return 0==e?0:1==e?1:(e*=2)<1?e*e*(3.5949095*e-2.5949095)*.5:.5*((e-=2)*e*(3.5949095*e+2.5949095)+2)};var Je=function(e){Error.call(this),this.val=e,this.message=String(e),Error.captureStackTrace&&Error.captureStackTrace(this,Je)};s["js._Boot.HaxeError"]=Je,Je.__name__=!0,Je.wrap=function(e){return e instanceof Error?e:new Je(e)},Je.__super__=Error,Je.prototype=i(Error.prototype,{__class__:Je});var qe=function(){};s["js.Boot"]=qe,qe.__name__=!0,qe.__unhtml=function(e){return e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")},qe.__trace=function(e,t){var i=null!=t?t.fileName+":"+t.lineNumber+": ":"";if(i+=qe.__string_rec(e,""),null!=t&&null!=t.customParams)for(var a=0,s=t.customParams;a<s.length;){var r=s[a];++a,i+=","+qe.__string_rec(r,"")}var n;"undefined"!=typeof document&&null!=(n=document.getElementById("haxe:trace"))?n.innerHTML+=qe.__unhtml(i)+"<br/>":"undefined"!=typeof console&&null!=console.log&&console.log(i)},qe.getClass=function(e){if(e instanceof Array&&null==e.__enum__)return Array;var t=e.__class__;if(null!=t)return t;var i=qe.__nativeClassName(e);return null!=i?qe.__resolveNativeClass(i):null},qe.__string_rec=function(e,t){if(null==e)return"null";if(t.length>=5)return"<...>";var i=typeof e;switch("function"==i&&(e.__name__||e.__ename__)&&(i="object"),i){case"function":return"<function>";case"object":if(e instanceof Array){if(e.__enum__){if(2==e.length)return e[0];var a=e[0]+"(";t+="\t";for(var s=2,r=e.length;s<r;){var n=s++;a+=2!=n?","+qe.__string_rec(e[n],t):qe.__string_rec(e[n],t)}return a+")"}var l="[";t+="\t";for(var o=0,h=e.length;o<h;){var c=o++;l+=(c>0?",":"")+qe.__string_rec(e[c],t)}return l+="]"}var u;try{u=e.toString}catch(e){return"???"}if(null!=u&&u!=Object.toString&&"function"==typeof u){var d=e.toString();if("[object Object]"!=d)return d}var f=null,_="{\n";t+="\t";var v=null!=e.hasOwnProperty;for(var f in e)v&&!e.hasOwnProperty(f)||"prototype"!=f&&"__class__"!=f&&"__super__"!=f&&"__interfaces__"!=f&&"__properties__"!=f&&(2!=_.length&&(_+=", \n"),_+=t+f+" : "+qe.__string_rec(e[f],t));return t=t.substring(1),_+="\n"+t+"}";case"string":return e;default:return String(e)}},qe.__interfLoop=function(e,t){if(null==e)return!1;if(e==t)return!0;var i=e.__interfaces__;if(null!=i)for(var a=0,s=i.length;a<s;){var r=i[a++];if(r==t||qe.__interfLoop(r,t))return!0}return qe.__interfLoop(e.__super__,t)},qe.__instanceof=function(e,t){if(null==t)return!1;switch(t){case Array:return e instanceof Array&&null==e.__enum__;case Ba:return"boolean"==typeof e;case ba:return!0;case wa:return"number"==typeof e;case ga:return"number"==typeof e&&(0|e)===e;case String:return"string"==typeof e;default:if(null==e)return!1;if("function"==typeof t){if(e instanceof t)return!0;if(qe.__interfLoop(qe.getClass(e),t))return!0}else if("object"==typeof t&&qe.__isNativeObj(t)&&e instanceof t)return!0;return t==ya&&null!=e.__name__||(t==xa&&null!=e.__ename__||e.__enum__==t)}},qe.__cast=function(e,t){if(qe.__instanceof(e,t))return e;throw new Je("Cannot cast "+_.string(e)+" to "+_.string(t))},qe.__nativeClassName=function(e){var t=qe.__toStr.call(e).slice(8,-1);return"Object"==t||"Function"==t||"Math"==t||"JSON"==t?null:t},qe.__isNativeObj=function(e){return null!=qe.__nativeClassName(e)},qe.__resolveNativeClass=function(e){return t[e]};var $e=function(e){if(e instanceof Array&&null==e.__enum__)this.a=e,this.byteLength=e.length;else{var t=e;this.a=[];for(var i=0,a=t;i<a;){var s=i++;this.a[s]=0}this.byteLength=t}};s["js.html.compat.ArrayBuffer"]=$e,$e.__name__=!0,$e.sliceImpl=function(e,t){var i=new Aa(this,e,null==t?null:t-e),a=new Sa(i.byteLength);return new Aa(a).set(i),a},$e.prototype={slice:function(e,t){return new $e(this.a.slice(e,t))},__class__:$e};var et=function(e,t,i){if(this.buf=e,this.offset=null==t?0:t,this.length=null==i?e.byteLength-this.offset:i,this.offset<0||this.length<0||this.offset+this.length>e.byteLength)throw new Je(Z.OutsideBounds);this.byteLength=this.length,this.byteOffset=this.offset,this.buffer=this.buf};s["js.html.compat.DataView"]=et,et.__name__=!0,et.prototype={getInt8:function(e){var t=this.buf.a[this.offset+e];return t>=128?t-256:t},getUint8:function(e){return this.buf.a[this.offset+e]},getInt16:function(e,t){var i=this.getUint16(e,t);return i>=32768?i-65536:i},getUint16:function(e,t){return t?this.buf.a[this.offset+e]|this.buf.a[this.offset+e+1]<<8:this.buf.a[this.offset+e]<<8|this.buf.a[this.offset+e+1]},getInt32:function(e,t){var i=this.offset+e,a=this.buf.a[i++],s=this.buf.a[i++],r=this.buf.a[i++],n=this.buf.a[i++];return t?a|s<<8|r<<16|n<<24:n|r<<8|s<<16|a<<24},getUint32:function(e,t){var i=this.getInt32(e,t);return i<0?i+4294967296:i},getFloat32:function(e,t){return U.i32ToFloat(this.getInt32(e,t))},getFloat64:function(e,t){var i=this.getInt32(e,t),a=this.getInt32(e+4,t);return U.i64ToDouble(t?i:a,t?a:i)},setInt8:function(e,t){this.buf.a[e+this.offset]=t<0?t+128&255:255&t},setUint8:function(e,t){this.buf.a[e+this.offset]=255&t},setInt16:function(e,t,i){this.setUint16(e,t<0?t+65536:t,i)},setUint16:function(e,t,i){var a=e+this.offset;i?(this.buf.a[a]=255&t,this.buf.a[a++]=t>>8&255):(this.buf.a[a++]=t>>8&255,this.buf.a[a]=255&t)},setInt32:function(e,t,i){this.setUint32(e,t,i)},setUint32:function(e,t,i){var a=e+this.offset;i?(this.buf.a[a++]=255&t,this.buf.a[a++]=t>>8&255,this.buf.a[a++]=t>>16&255,this.buf.a[a++]=t>>>24):(this.buf.a[a++]=t>>>24,this.buf.a[a++]=t>>16&255,this.buf.a[a++]=t>>8&255,this.buf.a[a++]=255&t)},setFloat32:function(e,t,i){this.setUint32(e,U.floatToI32(t),i)},setFloat64:function(e,t,i){var a=U.doubleToI64(t);i?(this.setUint32(e,a.low),this.setUint32(e,a.high)):(this.setUint32(e,a.high),this.setUint32(e,a.low))},__class__:et};var tt=function(){};s["js.html.compat.Float32Array"]=tt,tt.__name__=!0,tt._new=function(e,t,i){var a;if("number"==typeof e){a=[];for(var s=0,r=e;s<r;)a[s++]=0;a.byteLength=a.length<<2,a.byteOffset=0;for(var n=[],l=0,o=a.length<<2;l<o;){l++;n.push(0)}a.buffer=new $e(n)}else if(qe.__instanceof(e,$e)){var h=e;null==t&&(t=0),null==i&&(i=h.byteLength-t>>2),a=[];for(var c=0,u=i;c<u;){c++;var d=h.a[t++]|h.a[t++]<<8|h.a[t++]<<16|h.a[t++]<<24;a.push(U.i32ToFloat(d))}a.byteLength=a.length<<2,a.byteOffset=t,a.buffer=h}else{if(!(e instanceof Array&&null==e.__enum__))throw new Je("TODO "+_.string(e));a=e.slice();for(var f=[],v=0;v<a.length;){var p=a[v];++v;var m=U.floatToI32(p);f.push(255&m),f.push(m>>8&255),f.push(m>>16&255),f.push(m>>>24)}a.byteLength=a.length<<2,a.byteOffset=0,a.buffer=new $e(f)}return a.subarray=tt._subarray,a.set=tt._set,a},tt._set=function(e,t){if(qe.__instanceof(e.buffer,$e)){var i=e;if(e.byteLength+t>this.byteLength)throw new Je("set() outside of range");for(var a=0,s=e.byteLength;a<s;){var r=a++;this[r+t]=i[r]}}else{if(!(e instanceof Array&&null==e.__enum__))throw new Je("TODO");var n=e;if(n.length+t>this.byteLength)throw new Je("set() outside of range");for(var l=0,o=n.length;l<o;){var h=l++;this[h+t]=n[h]}}},tt._subarray=function(e,t){var i=tt._new(this.slice(e,t));return i.byteOffset=4*e,i};var it=function(){};s["js.html.compat.Uint8Array"]=it,it.__name__=!0,it._new=function(e,t,i){var a;if("number"==typeof e){a=[];for(var s=0,r=e;s<r;)a[s++]=0;a.byteLength=a.length,a.byteOffset=0,a.buffer=new $e(a)}else if(qe.__instanceof(e,$e)){var n=e;null==t&&(t=0),null==i&&(i=n.byteLength-t),(a=0==t?n.a:n.a.slice(t,t+i)).byteLength=a.length,a.byteOffset=t,a.buffer=n}else{if(!(e instanceof Array&&null==e.__enum__))throw new Je("TODO "+_.string(e));(a=e.slice()).byteLength=a.length,a.byteOffset=0,a.buffer=new $e(a)}return a.subarray=it._subarray,a.set=it._set,a},it._set=function(e,t){if(qe.__instanceof(e.buffer,$e)){var i=e;if(e.byteLength+t>this.byteLength)throw new Je("set() outside of range");for(var a=0,s=e.byteLength;a<s;){var r=a++;this[r+t]=i[r]}}else{if(!(e instanceof Array&&null==e.__enum__))throw new Je("TODO");var n=e;if(n.length+t>this.byteLength)throw new Je("set() outside of range");for(var l=0,o=n.length;l<o;){var h=l++;this[h+t]=n[h]}}},it._subarray=function(e,t){var i=it._new(this.slice(e,t));return i.byteOffset=e,i};var at=function(){};s["kha.Canvas"]=at,at.__name__=!0,at.prototype={__class__:at,__properties__:{get_g4:"get_g4",get_height:"get_height",get_width:"get_width"}};var st=function(){};s["kha.Resource"]=st,st.__name__=!0;var rt=function(){};s["kha.Image"]=rt,rt.__name__=!0,rt.__interfaces__=[st,at],rt.__properties__={get_nonPow2Supported:"get_nonPow2Supported"},rt.create=function(e,t,i,a){return null==i&&(i=Ei.RGBA32),null==a&&(a=Li.StaticUsage),null==xt.gl?new nt(e,t,i,!1):new It(e,t,i,!1,0)},rt.create3D=function(e,t,i,a,s){return null},rt.createRenderTarget=function(e,t,i,a,s,r){return null==r&&(r=0),null==s&&(s=1),null==a&&(a=0),null==i&&(i=Ei.RGBA32),null==xt.gl?new nt(e,t,i,!0):new It(e,t,i,!0,a)},rt.fromImage=function(e,t){if(null==xt.gl){var i=new nt(e.width,e.height,Ei.RGBA32,!1);return i.image=e,i.createTexture(),i}var a=new It(e.width,e.height,Ei.RGBA32,!1,0);return a.image=e,a.createTexture(),a},rt.fromBytes=function(e,t,i,a,s){if(null==a&&(a=Ei.RGBA32),null==s&&(s=Li.StaticUsage),null!=xt.gl){var r=new It(t,i,a,!1,0);return r.image=r.bytesToArray(e),r.createTexture(),r}return null},rt.get_nonPow2Supported=function(){return null!=xt.gl},rt.prototype={unload:function(){},lock:function(e){return null==e&&(e=0),null},unlock:function(){},generateMipmaps:function(e){},setMipmaps:function(e){},setDepthStencilFrom:function(e){},get_width:function(){return 0},get_height:function(){return 0},get_depth:function(){return 1},get_g4:function(){return null},__class__:rt,__properties__:{get_g4:"get_g4",get_depth:"get_depth",get_height:"get_height",get_width:"get_width"}};var nt=function(e,t,i,a){this.myWidth=e,this.myHeight=t,this.format=i,this.renderTarget=a,this.image=null,this.video=null,a&&this.createTexture()};s["kha.CanvasImage"]=nt,nt.__name__=!0,nt.init=function(){var e=window.document.createElement("canvas");null!=e&&(nt.context=e.getContext("2d"),e.width=2048,e.height=2048,nt.context.globalCompositeOperation="copy")},nt.__super__=rt,nt.prototype=i(rt.prototype,{get_g4:function(){return null},get_width:function(){return this.myWidth},get_height:function(){return this.myHeight},get_realWidth:function(){return this.myWidth},get_realHeight:function(){return this.myHeight},createTexture:function(){null!=xt.gl&&(this.texture=xt.gl.createTexture(),xt.gl.bindTexture(3553,this.texture),xt.gl.texParameteri(3553,10240,9729),xt.gl.texParameteri(3553,10241,9729),xt.gl.texParameteri(3553,10242,33071),xt.gl.texParameteri(3553,10243,33071),this.renderTarget?(this.frameBuffer=xt.gl.createFramebuffer(),xt.gl.bindFramebuffer(36160,this.frameBuffer),xt.gl.texImage2D(3553,0,6408,this.get_realWidth(),this.get_realHeight(),0,6408,5121,null),xt.gl.framebufferTexture2D(36160,36064,3553,this.texture,0),xt.gl.bindFramebuffer(36160,null)):null!=this.video?xt.gl.texImage2D(3553,0,6408,6408,5121,this.video):xt.gl.texImage2D(3553,0,6408,6408,5121,this.image),xt.gl.bindTexture(3553,null))},lock:function(e){return null==e&&(e=0),this.bytes=new N(new Sa(this.format==Ei.RGBA32?4*this.get_width()*this.get_height():this.get_width()*this.get_height())),this.bytes},unlock:function(){if(null!=xt.gl){if(this.texture=xt.gl.createTexture(),xt.gl.bindTexture(3553,this.texture),xt.gl.texParameteri(3553,10240,9729),xt.gl.texParameteri(3553,10241,9729),xt.gl.texParameteri(3553,10242,33071),xt.gl.texParameteri(3553,10243,33071),xt.gl.texImage2D(3553,0,6409,this.get_width(),this.get_height(),0,6409,5121,new Aa(this.bytes.b.bufferValue)),1282==xt.gl.getError()){for(var e=new N(new Sa(this.get_width()*this.get_height()*4)),t=0,i=this.get_height();t<i;)for(var a=t++,s=0,r=this.get_width();s<r;){var n=s++,l=this.bytes,o=a*this.get_width()+n,h=l.b[o],c=a*this.get_width()*4+4*n;e.b[c]=255&h;var u=a*this.get_width()*4+4*n+1;e.b[u]=255&h;var d=a*this.get_width()*4+4*n+2;e.b[d]=255&h;var f=a*this.get_width()*4+4*n+3;e.b[f]=255}xt.gl.texImage2D(3553,0,6408,this.get_width(),this.get_height(),0,6408,5121,new Aa(e.b.bufferValue))}xt.gl.bindTexture(3553,null),this.bytes=null}},unload:function(){this.image=null,this.video=null,this.data=null},__class__:nt});var lt=e.kha._Color.Color_Impl_={};s["kha._Color.Color_Impl_"]=lt,lt.__name__=!0,lt.fromBytes=function(e,t,i,a){return null==a&&(a=255),lt._new(a<<24|e<<16|t<<8|i)},lt._new=function(e){return e};var ot=function(){};s["kha.CompilerDefines"]=ot,ot.__name__=!0;var ht=function(){};s["kha.DisplayImpl"]=ht,ht.__name__=!0,ht.width=function(e){return window.screen.width},ht.height=function(e){return window.screen.height};var ct=function(){};s["kha.EnvironmentVariables"]=ct,ct.__name__=!0,ct.prototype={__class__:ct};var ut=function(e,t,i,a){this.windowId=e,this.graphics1=t,this.graphics2=i,this.graphics4=a};s["kha.Framebuffer"]=ut,ut.__name__=!0,ut.__interfaces__=[at],ut.prototype={init:function(e,t,i){this.graphics1=e,this.graphics2=t,this.graphics4=i},get_g2:function(){return this.graphics2},get_g4:function(){return this.graphics4},get_width:function(){return Bt.windowWidth(this.windowId)},get_height:function(){return Bt.windowHeight(this.windowId)},__class__:ut,__properties__:{get_height:"get_height",get_width:"get_width",get_g4:"get_g4",get_g2:"get_g2"}};var dt=function(e,t,i,a,s,r,n,l){this.mySize=e,this.width=s,this.height=r,this.chars=n,this.baseline=t;for(var o=0;o<n.length;){var h=n[o];++o,h.yoff+=this.baseline}this.texture=rt.create(s,r,Ei.L8);for(var c=this.texture.lock(),u=0,d=0,f=r;d<f;){d++;for(var _=0,v=s;_<v;){_++;var p=l.readU8(u);c.b[u]=255&p,++u}}this.texture.unlock()};s["kha.KravurImage"]=dt,dt.__name__=!0,dt.prototype={getTexture:function(){return this.texture},getCharWidth:function(e){return e<32?0:e-32>=this.chars.length?0:this.chars[e-32].xadvance},getHeight:function(){return this.mySize},stringWidth:function(e){for(var t=new String(e),i=0,a=0,s=t.length;a<s;){var r=a++;i+=this.getCharWidth(l.cca(t,r))}return i},charactersWidth:function(e,t,i){for(var a=0,s=t,r=t+i;s<r;){var n=s++;a+=this.getCharWidth(e[n])}return a},getBaselinePosition:function(){return this.baseline},__class__:dt};var ft=function(e){this.images=new T,this.blob=e};s["kha.Kravur"]=ft,ft.__name__=!0,ft.__interfaces__=[st],ft.prototype={_get:function(e,t){var i=null==t?e:1e4*e+t.length;if(!this.images.h.hasOwnProperty(i)){if(null==t){t=[];for(var a=32;a<256;){var s=a++;t.push(s)}}for(var r=64,n=32,l=t.length,o=new Array(l),h=0,c=o.length;h<c;)o[h++]=new ni;for(var u=null,d=-1;d<0;)n<r?n*=2:r*=2,u=Qi.alloc(r*n),d=fi.stbtt_BakeFontBitmap(this.blob,0,e,u,r,n,t,o);var f=new li;fi.stbtt_InitFont(f,this.blob,0);var _=fi.stbtt_GetFontVMetrics(f),v=fi.stbtt_ScaleForPixelHeight(f,e),p=Math.round(_.ascent*v),m=Math.round(_.descent*v),g=Math.round(_.lineGap*v),b=new dt(0|e,p,m,g,r,n,o,u);return this.images.h[i]=b,b}return this.images.h[i]},__class__:ft};var _t=function(){};s["kha.LoaderImpl"]=_t,_t.__name__=!0,_t.loadImageFromDescription=function(e,t){var i=Object.prototype.hasOwnProperty.call(e,"readable")&&e.readable;if(v.endsWith(e.files[0],".hdr"))_t.loadBlobFromDescription(e,function(e){var a=Ji.parse(e.toBytes()),s=rt.fromBytes(N.ofData(a.data.buffer),a.width,a.height,Ei.RGBA128,i?Li.DynamicUsage:Li.StaticUsage);t(s)});else{var a=window.document.createElement("img");a.onload=function(e){var s=rt.fromImage(a,i);t(s)},a.src=e.files[0],a.crossOrigin=""}},_t.loadSoundFromDescription=function(e,t){if(xt._hasWebAudio){if(""!=window.document.createElement("audio").canPlayType("audio/mp4"))for(var i=0,a=e.files.length;i<a;){var s=i++,r=e.files[s];if(v.endsWith(r,".mp4"))return void new la(r,t)}for(var n=0,l=e.files.length;n<l;){var o=n++,h=e.files[o];if(v.endsWith(h,".ogg"))return void new la(h,t)}}else if(xt.mobile){if(""!=window.document.createElement("audio").canPlayType("audio/mp4"))for(var c=0,u=e.files.length;c<u;){var d=c++,f=e.files[d];if(v.endsWith(f,".mp4"))return void new ra(f,t)}for(var _=0,p=e.files.length;_<p;){var m=_++,g=e.files[m];if(v.endsWith(g,".ogg"))return void new ra(g,t)}}else new na(e.files,t)},_t.loadBlobFromDescription=function(e,t){var i=new XMLHttpRequest;i.open("GET",e.files[0],!0),i.responseType="arraybuffer",i.onreadystatechange=function(){if(4==i.readyState)if(i.status>=200&&i.status<400||0==i.status&&""==i.statusText){var a=null,s=i.response;if(null!=s){var r=new Aa(s);a=N.ofData(r)}else if(null!=i.responseBody){var n=VBArray(i.responseBody).toArray();a=new N(new Sa(n.length));for(var l=0,o=n.length;l<o;){var h=l++;a.b[h]=255&n[h]}}else k.trace("Error loading "+e.files[0],{fileName:"LoaderImpl.hx",lineNumber:145,className:"kha.LoaderImpl",methodName:"loadBlobFromDescription"}),window.console.log("loadBlob failed");t(new Qi(a))}else k.trace("Error loading "+e.files[0],{fileName:"LoaderImpl.hx",lineNumber:151,className:"kha.LoaderImpl",methodName:"loadBlobFromDescription"}),window.console.log("loadBlob failed")},i.send(null)};var vt=function(){};s["kha.TimeTask"]=vt,vt.__name__=!0,vt.prototype={__class__:vt};var pt=function(){};s["kha.FrameTask"]=pt,pt.__name__=!0,pt.prototype={__class__:pt};var mt=function(){};s["kha.Scheduler"]=mt,mt.__name__=!0,mt.init=function(){mt.deltas=[];for(var e=0,t=mt.DIF_COUNT;e<t;){var i=e++;mt.deltas[i]=0}mt.stopped=!0,mt.frame_tasks_sorted=!0,mt.current=mt.lastTime=mt.realTime(),mt.currentFrameTaskId=0,mt.currentTimeTaskId=0,mt.currentGroupId=0,mt.timeTasks=[],mt.pausedTimeTasks=[],mt.outdatedTimeTasks=[],mt.timeTasksScratchpad=[],mt.frameTasks=[],mt.toDeleteFrame=[]},mt.start=function(e){null==e&&(e=!1),mt.vsync=Bt.get_vsync();var t=Bt.get_refreshRate();t>=57&&t<=63&&(t=60),mt.onedifhz=1/t,mt.stopped=!1,mt.resetTime(),mt.lastTime=mt.realTime()-mt.startTime;for(var i=0,a=mt.DIF_COUNT;i<a;){var s=i++;mt.deltas[s]=0}if(e){for(var r=0,n=mt.timeTasks;r<n.length;){var l=n[r];++r,l.paused=!1}for(var o=0,h=mt.frameTasks;o<h.length;){var c=h[o];++o,c.paused=!1}}},mt.executeFrame=function(){var e=mt.realTime()-mt.startTime-mt.lastTime,t=mt.current;if(!(e<0)){if(e>mt.maxframetime)mt.startTime+=e-mt.maxframetime,t+=e=mt.maxframetime;else if(mt.vsync){for(var i=mt.onedifhz;i<e-mt.onedifhz;)i+=mt.onedifhz;e=i;for(var a=0,s=mt.DIF_COUNT-2;a<s;){var r=a++;e+=mt.deltas[r],mt.deltas[r]=mt.deltas[r+1]}e+=mt.deltas[mt.DIF_COUNT-2],e/=mt.DIF_COUNT,mt.deltas[mt.DIF_COUNT-2]=i,t+=e}else{for(var n=0,o=mt.DIF_COUNT-1;n<o;){var h=n++;mt.deltas[h]=mt.deltas[h+1]}mt.deltas[mt.DIF_COUNT-1]=e;for(var c=0,u=0,d=mt.DIF_COUNT;u<d;){var f=u++;c+=mt.deltas[f]}t+=c/=mt.DIF_COUNT}mt.lastTime=t,mt.stopped||(mt.current=t);for(var _=0,v=mt.pausedTimeTasks;_<v.length;){var p=v[_];++_,p.next+=e}if(mt.stopped)for(var m=0,g=mt.timeTasks;m<g.length;){var b=g[m];++m,b.next+=e}for(;mt.timeTasks.length>0&&(mt.activeTimeTask=mt.timeTasks[0],mt.activeTimeTask.next<=t);)mt.activeTimeTask.next+=mt.activeTimeTask.period,l.remove(mt.timeTasks,mt.activeTimeTask),mt.activeTimeTask.active&&mt.activeTimeTask.task()?mt.activeTimeTask.period>0&&(0==mt.activeTimeTask.duration||mt.activeTimeTask.duration>=mt.activeTimeTask.start+mt.activeTimeTask.next)?mt.insertSorted(mt.timeTasks,mt.activeTimeTask):mt.archiveTimeTask(mt.activeTimeTask,t):(mt.activeTimeTask.active=!1,mt.archiveTimeTask(mt.activeTimeTask,t));mt.activeTimeTask=null,mt.sortFrameTasks();for(var w=0,B=mt.frameTasks;w<B.length;){var y=B[w];++w,mt.stopped||y.paused||!y.active||y.task()||(y.active=!1)}for(var x=0,I=mt.frameTasks;x<I.length;){var S=I[x];++x,S.active||mt.toDeleteFrame.push(S)}for(;mt.toDeleteFrame.length>0;)l.remove(mt.frameTasks,mt.toDeleteFrame.pop())}},mt.archiveTimeTask=function(e,t){},mt.time=function(){return mt.current},mt.realTime=function(){return Bt.get_time()},mt.resetTime=function(){var e=Bt.get_time(),t=e-mt.startTime;mt.startTime=e;for(var i=0,a=mt.timeTasks;i<a.length;){var s=a[i];++i,s.start-=t,s.next-=t}for(var r=0,n=mt.DIF_COUNT;r<n;){var l=r++;mt.deltas[l]=0}mt.current=0,mt.lastTime=0},mt.addBreakableTimeTaskToGroup=function(e,t,i,a,s){null==s&&(s=0),null==a&&(a=0);var r=new vt;return r.active=!0,r.task=t,r.id=++mt.currentTimeTaskId,r.groupId=e,r.start=mt.current+i,r.period=0,0!=a&&(r.period=a),r.duration=0,0!=s&&(r.duration=r.start+s),r.next=r.start,mt.insertSorted(mt.timeTasks,r),r.id},mt.addTimeTaskToGroup=function(e,t,i,a,s){return null==s&&(s=0),null==a&&(a=0),mt.addBreakableTimeTaskToGroup(e,function(){return t(),!0},i,a,s)},mt.addTimeTask=function(e,t,i,a){return null==a&&(a=0),null==i&&(i=0),mt.addTimeTaskToGroup(0,e,t,i,a)},mt.insertSorted=function(e,t){for(var i=0,a=e.length;i<a;){var s=i++;if(e[s].next>t.next)return void e.splice(s,0,t)}e.push(t)},mt.sortFrameTasks=function(){mt.frame_tasks_sorted||(mt.frameTasks.sort(function(e,t){return e.priority>t.priority?1:e.priority<t.priority?-1:0}),mt.frame_tasks_sorted=!0)};var gt=s["kha.ScreenRotation"]={__ename__:!0,__constructs__:["RotationNone","Rotation90","Rotation180","Rotation270"]};gt.RotationNone=["RotationNone",0],gt.RotationNone.toString=r,gt.RotationNone.__enum__=gt,gt.Rotation90=["Rotation90",1],gt.Rotation90.toString=r,gt.Rotation90.__enum__=gt,gt.Rotation180=["Rotation180",2],gt.Rotation180.toString=r,gt.Rotation180.__enum__=gt,gt.Rotation270=["Rotation270",3],gt.Rotation270.toString=r,gt.Rotation270.__enum__=gt;var bt=function(){};s["kha.Shaders"]=bt,bt.__name__=!0,bt.init=function(){for(var e=[],t=0;t<3;){var i=t++,a=f.field(bt,"Baked_mesh_fragData"+i),s=A.run(a);e.push(Qi.fromBytes(s))}bt.Baked_mesh_frag=new wi(e,["Baked_mesh.frag.essl","Baked_mesh-relaxed.frag.essl","Baked_mesh-webgl2.frag.essl"]);for(var r=[],n=0;n<3;){var l=n++,o=f.field(bt,"Baked_mesh_vertData"+l),h=A.run(o);r.push(Qi.fromBytes(h))}bt.Baked_mesh_vert=new Ui(r,["Baked_mesh.vert.essl","Baked_mesh-relaxed.vert.essl","Baked_mesh-webgl2.vert.essl"]);for(var c=[],u=0;u<3;){var d=u++,_=f.field(bt,"painter_image_fragData"+d),v=A.run(_);c.push(Qi.fromBytes(v))}bt.painter_image_frag=new wi(c,["painter-image.frag.essl","painter-image-relaxed.frag.essl","painter-image-webgl2.frag.essl"]);for(var p=[],m=0;m<3;){var g=m++,b=f.field(bt,"painter_colored_vertData"+g),w=A.run(b);p.push(Qi.fromBytes(w))}bt.painter_colored_vert=new Ui(p,["painter-colored.vert.essl","painter-colored-relaxed.vert.essl","painter-colored-webgl2.vert.essl"]);for(var B=[],y=0;y<3;){var x=y++,I=f.field(bt,"painter_text_vertData"+x),S=A.run(I);B.push(Qi.fromBytes(S))}bt.painter_text_vert=new Ui(B,["painter-text.vert.essl","painter-text-relaxed.vert.essl","painter-text-webgl2.vert.essl"]);for(var k=[],C=0;C<3;){var M=C++,N=f.field(bt,"painter_text_fragData"+M),T=A.run(N);k.push(Qi.fromBytes(T))}bt.painter_text_frag=new wi(k,["painter-text.frag.essl","painter-text-relaxed.frag.essl","painter-text-webgl2.frag.essl"]);for(var F=[],D=0;D<3;){var R=D++,P=f.field(bt,"painter_colored_fragData"+R),E=A.run(P);F.push(Qi.fromBytes(E))}bt.painter_colored_frag=new wi(F,["painter-colored.frag.essl","painter-colored-relaxed.frag.essl","painter-colored-webgl2.frag.essl"]);for(var V=[],L=0;L<3;){var W=L++,G=f.field(bt,"painter_image_vertData"+W),Z=A.run(G);V.push(Qi.fromBytes(Z))}bt.painter_image_vert=new Ui(V,["painter-image.vert.essl","painter-image-relaxed.vert.essl","painter-image-webgl2.vert.essl"]);for(var U=[],z=0;z<3;){var O=z++,H=f.field(bt,"painter_video_fragData"+O),j=A.run(H);U.push(Qi.fromBytes(j))}bt.painter_video_frag=new wi(U,["painter-video.frag.essl","painter-video-relaxed.frag.essl","painter-video-webgl2.frag.essl"]);for(var X=[],Y=0;Y<3;){var K=Y++,Q=f.field(bt,"painter_video_vertData"+K),J=A.run(Q);X.push(Qi.fromBytes(J))}bt.painter_video_vert=new Ui(X,["painter-video.vert.essl","painter-video-relaxed.vert.essl","painter-video-webgl2.vert.essl"])};var wt=function(){};s["kha.Sound"]=wt,wt.__name__=!0,wt.__interfaces__=[st],wt.prototype={uncompress:function(e){var t=new W,i=Ft.readAll(this.compressedData,t,!0),a=t.getBytes(),s=a.length/4|0;if(1==i.channel){var r=new Array(2*s);this.uncompressedData=r;for(var n=0,l=s;n<l;){var o=n++;this.uncompressedData[2*o]=a.getFloat(4*o),this.uncompressedData[2*o+1]=a.getFloat(4*o)}}else{var h=new Array(s);this.uncompressedData=h;for(var c=0,u=s;c<u;){var d=c++;this.uncompressedData[d]=a.getFloat(4*d)}}this.compressedData=null,e()},__class__:wt};var Bt=function(){};s["kha.System"]=Bt,Bt.__name__=!0,Bt.__properties__={get_refreshRate:"get_refreshRate",get_vsync:"get_vsync",get_time:"get_time"},Bt.init=function(e,t){null==e.title&&(e.title="Kha"),null==e.width&&(e.width=800),null==e.height&&(e.height=600),null==e.samplesPerPixel&&(e.samplesPerPixel=1),null==e.vSync&&(e.vSync=!0),null==e.windowMode&&(e.windowMode=u.Window),null==e.resizable&&(e.resizable=!1),null==e.maximizable&&(e.maximizable=!1),null==e.minimizable&&(e.minimizable=!0),Bt.theTitle=e.title,xt.init(e,t)},Bt.notifyOnRender=function(e,t){for(null==t&&(t=0);t>=Bt.renderListeners.length;)Bt.renderListeners.push([]);Bt.renderListeners[t].push(e)},Bt.render=function(e,t){if(0!=Bt.renderListeners.length)for(var i=0,a=Bt.renderListeners[e];i<a.length;){var s=a[i];++i,s(t)}},Bt.foreground=function(){for(var e=0,t=Bt.foregroundListeners;e<t.length;){var i=t[e];++e,i()}},Bt.background=function(){for(var e=0,t=Bt.backgroundListeners;e<t.length;){var i=t[e];++e,i()}},Bt.get_time=function(){return xt.getTime()},Bt.windowWidth=function(e){return null==e&&(e=0),xt.windowWidth(e)},Bt.windowHeight=function(e){return null==e&&(e=0),xt.windowHeight(e)},Bt.get_vsync=function(){return xt.getVsync()},Bt.get_refreshRate=function(){return xt.getRefreshRate()};var yt=function(){this.axes=[],this.buttons=[]};s["kha.GamepadStates"]=yt,yt.__name__=!0,yt.prototype={__class__:yt};var xt=function(){};s["kha.SystemImpl"]=xt,xt.__name__=!0,xt.init=function(e,t){xt.options=e,xt.mobile=xt.isMobile(),xt.chrome=xt.isChrome(),xt.firefox=xt.isFirefox(),xt.init2(),t()},xt.isMobile=function(){var e=window.navigator.userAgent;return e.indexOf("Android")>=0||e.indexOf("webOS")>=0||e.indexOf("iPhone")>=0||e.indexOf("iPad")>=0||e.indexOf("iPod")>=0||e.indexOf("BlackBerry")>=0||e.indexOf("Windows Phone")>=0},xt.isChrome=function(){return window.navigator.userAgent.indexOf("Chrome")>=0},xt.isFirefox=function(){return window.navigator.userAgent.indexOf("Firefox")>=0},xt.windowWidth=function(e){return null==e&&(e=0),0==xt.khanvas.width&&null!=xt.options.width?xt.options.width:xt.khanvas.width},xt.windowHeight=function(e){return null==e&&(e=0),0==xt.khanvas.height&&null!=xt.options.height?xt.options.height:xt.khanvas.height},xt.setCanvas=function(e){xt.khanvas=e},xt.getTime=function(){return(window.performance?window.performance:window.Date).now()/1e3},xt.getVsync=function(){return!0},xt.getRefreshRate=function(){return 60},xt.init2=function(e){k.trace=qe.__trace,xt.keyboard=new ji,xt.mouse=new Yi,xt.surface=new Ki,xt.gamepads=[],xt.gamepadStates=[];for(var t=0;t<4;){var i=t++;xt.gamepads[i]=new Oi(i),xt.gamepadStates[i]=new yt}xt.pressedKeys=[];for(var a=0;a<256;){a++;xt.pressedKeys.push(!1)}for(var s=0;s<256;){s++;xt.pressedKeys.push(null)}window.document.addEventListener("copy",function(e){var t=e;if(null!=Bt.copyListener){var i=Bt.copyListener();null!=i&&t.clipboardData.setData("text/plain",i),t.preventDefault()}}),window.document.addEventListener("cut",function(e){var t=e;if(null!=Bt.cutListener){var i=Bt.cutListener();null!=i&&t.clipboardData.setData("text/plain",i),t.preventDefault()}}),window.document.addEventListener("paste",function(e){var t=e;if(null!=Bt.pasteListener){var i=t.clipboardData.getData("text/plain");Bt.pasteListener(i),t.preventDefault()}}),nt.init(),mt.init(),xt.loadFinished(),ct.instance=new ta},xt.getMouse=function(e){return 0!=e?null:xt.mouse},xt.checkGamepad=function(e){for(var t=0,i=e.axes.length;t<i;){var a=t++;if(null!=e.axes[a]&&xt.gamepadStates[e.index].axes[a]!=e.axes[a]){var s=e.axes[a];a%2==1&&(s=-s),xt.gamepadStates[e.index].axes[a]=s,xt.gamepads[e.index].sendAxisEvent(a,s)}}for(var r=0,n=e.buttons.length;r<n;){var l=r++;null!=e.buttons[l]&&xt.gamepadStates[e.index].buttons[l]!=e.buttons[l].value&&(xt.gamepadStates[e.index].buttons[l]=e.buttons[l].value,xt.gamepads[e.index].sendButtonEvent(l,e.buttons[l].value))}e.axes.length<=4&&e.buttons.length>7&&(xt.gamepadStates[e.index].axes[4]=e.buttons[6].value,xt.gamepads[e.index].sendAxisEvent(4,e.buttons[6].value),xt.gamepadStates[e.index].axes[5]=e.buttons[7].value,xt.gamepads[e.index].sendAxisEvent(5,e.buttons[7].value))},xt.loadFinished=function(){var e=xt.khanvas;null==e&&(e=window.document.getElementById(ot.canvas_id)),e.style.cursor="default";var t=!1;try{xt.gl=e.getContext("webgl2",{alpha:!1,antialias:xt.options.samplesPerPixel>1,stencil:!0,preserveDrawingBuffer:!0}),xt.gl.pixelStorei(37441,1),xt.halfFloat={HALF_FLOAT_OES:5131},xt.depthTexture={UNSIGNED_INT_24_8_WEBGL:34042},xt.drawBuffers={COLOR_ATTACHMENT0_WEBGL:36064},xt.elementIndexUint=!0,xt.gl.getExtension("EXT_color_buffer_float"),xt.gl.getExtension("OES_texture_float_linear"),xt.gl.getExtension("OES_texture_half_float_linear"),xt.anisotropicFilter=xt.gl.getExtension("EXT_texture_filter_anisotropic"),null==xt.anisotropicFilter&&(xt.anisotropicFilter=xt.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")),t=!0,xt.gl2=!0,bt.init()}catch(e){k.trace("Could not initialize WebGL 2, falling back to WebGL.",{fileName:"SystemImpl.hx",lineNumber:327,className:"kha.SystemImpl",methodName:"loadFinished"})}if(!xt.gl2)try{xt.gl=e.getContext("experimental-webgl",{alpha:!1,antialias:xt.options.samplesPerPixel>1,stencil:!0,preserveDrawingBuffer:!0}),null!=xt.gl&&(xt.gl.pixelStorei(37441,1),xt.gl.getExtension("OES_texture_float"),xt.gl.getExtension("OES_texture_float_linear"),xt.halfFloat=xt.gl.getExtension("OES_texture_half_float"),xt.gl.getExtension("OES_texture_half_float_linear"),xt.depthTexture=xt.gl.getExtension("WEBGL_depth_texture"),xt.gl.getExtension("EXT_shader_texture_lod"),xt.gl.getExtension("OES_standard_derivatives"),xt.anisotropicFilter=xt.gl.getExtension("EXT_texture_filter_anisotropic"),null==xt.anisotropicFilter&&(xt.anisotropicFilter=xt.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")),xt.drawBuffers=xt.gl.getExtension("WEBGL_draw_buffers"),xt.elementIndexUint=xt.gl.getExtension("OES_element_index_uint"),t=!0,bt.init())}catch(e){k.trace("Could not initialize WebGL, falling back to Canvas.",{fileName:"SystemImpl.hx",lineNumber:351,className:"kha.SystemImpl",methodName:"loadFinished"})}if(xt.setCanvas(e),t){var i=new ha;xt.frame=new ut(0,null,null,i),xt.frame.init(new ei(xt.frame),new ca(xt.frame),i)}else{ft=ia;var a=new ea(e.getContext("2d"));xt.frame=new ut(0,null,a,null),xt.frame.init(new ei(xt.frame),a,null)}!xt.mobile&&kt._init()?(xt._hasWebAudio=!0,Ct._init()):xt.mobile?(xt._hasWebAudio=!1,aa._init(),Ct=aa):(xt._hasWebAudio=!1,$i._compile(),Ct=$i),da.instance=new fa,mt.start();var s=window,r=s.requestAnimationFrame;null==r&&(r=s.mozRequestAnimationFrame),null==r&&(r=s.webkitRequestAnimationFrame),null==r&&(r=s.msRequestAnimationFrame);var n=null,l=n=function(t){var i=window;null==r?i.setTimeout(n,16.666666666666668):r(n);var a=xt.getGamepads();if(null!=a)for(var s=0,l=a.length;s<l;){var o=a[s++];null!=o&&xt.checkGamepad(o)}if(mt.executeFrame(),e.getContext){var h=e.clientWidth,c=e.clientHeight;e.width==h&&e.height==c||(e.width=h,e.height=c),Bt.render(0,xt.frame),null!=xt.gl&&(xt.gl.clearColor(1,1,1,1),xt.gl.colorMask(!1,!1,!1,!0),xt.gl.clear(16384),xt.gl.colorMask(!0,!0,!0,!0))}};null==r?s.setTimeout(l,16.666666666666668):r(l),null==e.getAttribute("tabindex")&&e.setAttribute("tabindex","0"),e.focus(),e.oncontextmenu=function(e){e.stopPropagation(),e.preventDefault()},e.onmousedown=xt.mouseDown,e.onmousemove=xt.mouseMove,null!=xt.keyboard&&(e.onkeydown=xt.keyDown,e.onkeyup=xt.keyUp,e.onkeypress=xt.keyPress),e.onblur=xt.onBlur,e.onfocus=xt.onFocus,e.onmousewheel=e.onwheel=xt.mouseWheel,e.onmouseleave=xt.mouseLeave,e.addEventListener("wheel mousewheel",xt.mouseWheel,!1),e.addEventListener("touchstart",xt.touchDown,!1),e.addEventListener("touchend",xt.touchUp,!1),e.addEventListener("touchmove",xt.touchMove,!1),window.addEventListener("unload",xt.unload)},xt.unload=function(e){},xt.setMouseXY=function(e){var t=xt.khanvas.getBoundingClientRect(),i=xt.khanvas.clientLeft,a=xt.khanvas.clientTop;xt.mouseX=(e.clientX-t.left-i)*xt.khanvas.width/(t.width-2*i)|0,xt.mouseY=(e.clientY-t.top-a)*xt.khanvas.height/(t.height-2*a)|0},xt.unlockSoundOnIOS=function(){if(xt.mobile&&!xt.iosSoundEnabled){var e=aa._context.createBuffer(1,1,22050),t=aa._context.createBufferSource();t.buffer=e,t.connect(aa._context.destination),t.noteOn&&t.noteOn(0),xt.iosSoundEnabled=!0}},xt.mouseLeave=function(){xt.mouse.sendLeaveEvent(0)},xt.mouseWheel=function(e){return xt.insideInputEvent=!0,xt.unlockSoundOnIOS(),e.preventDefault(),0==e.deltaMode?(e.deltaY<0?xt.mouse.sendWheelEvent(0,-1):e.deltaY>0&&xt.mouse.sendWheelEvent(0,1),xt.insideInputEvent=!1,!1):1==e.deltaMode?(xt.minimumScroll=0|Math.min(xt.minimumScroll,Math.abs(e.deltaY)),xt.mouse.sendWheelEvent(0,e.deltaY/xt.minimumScroll|0),xt.insideInputEvent=!1,!1):(xt.insideInputEvent=!1,!1)},xt.mouseDown=function(e){xt.insideInputEvent=!0,xt.unlockSoundOnIOS(),xt.setMouseXY(e),1==e.which?(e.ctrlKey?(xt.leftMouseCtrlDown=!0,xt.mouse.sendDownEvent(0,1,xt.mouseX,xt.mouseY)):(xt.leftMouseCtrlDown=!1,xt.mouse.sendDownEvent(0,0,xt.mouseX,xt.mouseY)),null!=(pa=xt.khanvas,a(pa,pa.setCapture))?xt.khanvas.setCapture():xt.khanvas.ownerDocument.addEventListener("mousemove",xt.documentMouseMove,!0),xt.khanvas.ownerDocument.addEventListener("mouseup",xt.mouseLeftUp)):2==e.which?(xt.mouse.sendDownEvent(0,2,xt.mouseX,xt.mouseY),xt.khanvas.ownerDocument.addEventListener("mouseup",xt.mouseMiddleUp)):3==e.which&&(xt.mouse.sendDownEvent(0,1,xt.mouseX,xt.mouseY),xt.khanvas.ownerDocument.addEventListener("mouseup",xt.mouseRightUp)),xt.insideInputEvent=!1},xt.mouseLeftUp=function(e){xt.unlockSoundOnIOS(),1==e.which&&(xt.insideInputEvent=!0,xt.khanvas.ownerDocument.removeEventListener("mouseup",xt.mouseLeftUp),null!=(pa=xt.khanvas,a(pa,pa.releaseCapture))?xt.khanvas.ownerDocument.releaseCapture():xt.khanvas.ownerDocument.removeEventListener("mousemove",xt.documentMouseMove,!0),xt.leftMouseCtrlDown?xt.mouse.sendUpEvent(0,1,xt.mouseX,xt.mouseY):xt.mouse.sendUpEvent(0,0,xt.mouseX,xt.mouseY),xt.leftMouseCtrlDown=!1,xt.insideInputEvent=!1)},xt.mouseMiddleUp=function(e){xt.unlockSoundOnIOS(),2==e.which&&(xt.insideInputEvent=!0,xt.khanvas.ownerDocument.removeEventListener("mouseup",xt.mouseMiddleUp),xt.mouse.sendUpEvent(0,2,xt.mouseX,xt.mouseY),xt.insideInputEvent=!1)},xt.mouseRightUp=function(e){xt.unlockSoundOnIOS(),3==e.which&&(xt.insideInputEvent=!0,xt.khanvas.ownerDocument.removeEventListener("mouseup",xt.mouseRightUp),xt.mouse.sendUpEvent(0,1,xt.mouseX,xt.mouseY),xt.insideInputEvent=!1)},xt.documentMouseMove=function(e){e.stopPropagation(),xt.mouseMove(e)},xt.mouseMove=function(e){xt.insideInputEvent=!0,xt.unlockSoundOnIOS();var t=xt.mouseX,i=xt.mouseY;xt.setMouseXY(e);var a=e.movementX,s=e.movementY;null==e.movementX&&(a=null!=e.mozMovementX?e.mozMovementX:null!=e.webkitMovementX?e.webkitMovementX:xt.mouseX-t,s=null!=e.mozMovementY?e.mozMovementY:null!=e.webkitMovementY?e.webkitMovementY:xt.mouseY-i),xt.firefox&&(a=a*window.devicePixelRatio|0,s=s*window.devicePixelRatio|0),xt.mouse.sendMoveEvent(0,xt.mouseX,xt.mouseY,a,s),xt.insideInputEvent=!1},xt.setTouchXY=function(e){var t=xt.khanvas.getBoundingClientRect(),i=xt.khanvas.clientLeft,a=xt.khanvas.clientTop;xt.touchX=(e.clientX-t.left-i)*xt.khanvas.width/(t.width-2*i)|0,xt.touchY=(e.clientY-t.top-a)*xt.khanvas.height/(t.height-2*a)|0},xt.touchDown=function(e){xt.insideInputEvent=!0,xt.unlockSoundOnIOS(),e.stopPropagation(),e.preventDefault();for(var t=0,i=e.changedTouches;t<i.length;){var a=i[t];++t,xt.setTouchXY(a),xt.mouse.sendDownEvent(0,0,xt.touchX,xt.touchY),xt.surface.sendTouchStartEvent(a.identifier,xt.touchX,xt.touchY)}xt.insideInputEvent=!1},xt.touchUp=function(e){xt.insideInputEvent=!0,xt.unlockSoundOnIOS();for(var t=0,i=e.changedTouches;t<i.length;){var a=i[t];++t,xt.setTouchXY(a),xt.mouse.sendUpEvent(0,0,xt.touchX,xt.touchY),xt.surface.sendTouchEndEvent(a.identifier,xt.touchX,xt.touchY)}xt.insideInputEvent=!1},xt.touchMove=function(e){xt.insideInputEvent=!0,xt.unlockSoundOnIOS();for(var t=0,i=0,a=e.changedTouches;i<a.length;){var s=a[i];if(++i,xt.setTouchXY(s),0==t){var r=xt.touchX-xt.lastFirstTouchX,n=xt.touchY-xt.lastFirstTouchY;xt.lastFirstTouchX=xt.touchX,xt.lastFirstTouchY=xt.touchY,xt.mouse.sendMoveEvent(0,xt.touchX,xt.touchY,r,n)}xt.surface.sendMoveEvent(s.identifier,xt.touchX,xt.touchY),++t}xt.insideInputEvent=!1},xt.onBlur=function(){Bt.background()},xt.onFocus=function(){Bt.foreground()},xt.keyDown=function(e){e.stopPropagation(),xt.pressedKeys[e.keyCode]?e.preventDefault():(xt.pressedKeys[e.keyCode]=!0,xt.keyboard.sendDownEvent(e.keyCode))},xt.keyUp=function(e){e.preventDefault(),e.stopPropagation(),xt.pressedKeys[e.keyCode]=!1,xt.keyboard.sendUpEvent(e.keyCode)},xt.keyPress=function(e){e.stopPropagation(),(!xt.firefox||0!=e.which&&8!=e.which)&&xt.keyboard.sendPressEvent(String.fromCharCode(e.which))},xt.getGamepads=function(){return xt.chrome&&da.instance.IsVrEnabled()?null:navigator.getGamepads?window.navigator.getGamepads():null};var It=function(e,t,i,a,s){this.depthTexture=null,this.texture=null,this.renderBuffer=null,this.frameBuffer=null,this.myWidth=e,this.myHeight=t,this.format=i,this.renderTarget=a,this.image=null,this.video=null,this.depthStencilFormat=s,It.init(),a&&this.createTexture()};s["kha.WebGLImage"]=It,It.__name__=!0,It.init=function(){if(null==It.context){var e=window.document.createElement("canvas");null!=e&&(It.context=e.getContext("2d"),e.width=2048,e.height=2048,It.context.globalCompositeOperation="copy")}},It.formatByteSize=function(e){switch(e[1]){case 0:return 4;case 1:return 1;case 2:return 16;case 3:return 2;case 4:return 8;case 5:return 4;case 6:return 2}},It.__super__=rt,It.prototype=i(rt.prototype,{get_g4:function(){return null==this.graphics4&&(this.graphics4=new ha(this)),this.graphics4},get_width:function(){return this.myWidth},get_height:function(){return this.myHeight},get_realWidth:function(){return this.myWidth},get_realHeight:function(){return this.myHeight},createTexture:function(){if(null!=xt.gl){if(this.texture=xt.gl.createTexture(),xt.gl.bindTexture(3553,this.texture),xt.gl.texParameteri(3553,10240,9729),xt.gl.texParameteri(3553,10241,9729),xt.gl.texParameteri(3553,10242,33071),xt.gl.texParameteri(3553,10243,33071),this.renderTarget){switch(this.frameBuffer=xt.gl.createFramebuffer(),xt.gl.bindFramebuffer(36160,this.frameBuffer),this.format[1]){case 0:xt.gl.texImage2D(3553,0,6408,this.get_realWidth(),this.get_realHeight(),0,6408,5121,null);break;case 2:xt.gl.texImage2D(3553,0,xt.gl2?34836:6408,this.get_realWidth(),this.get_realHeight(),0,6408,5126,null);break;case 3:xt.gl.texImage2D(3553,0,xt.gl2?33189:6402,this.get_realWidth(),this.get_realHeight(),0,6402,5123,null);break;case 4:xt.gl.texImage2D(3553,0,xt.gl2?34842:6408,this.get_realWidth(),this.get_realHeight(),0,6408,xt.halfFloat.HALF_FLOAT_OES,null);break;case 5:xt.gl.texImage2D(3553,0,xt.gl2?33326:6406,this.get_realWidth(),this.get_realHeight(),0,xt.gl2?6403:6406,5126,null);break;case 6:xt.gl.texImage2D(3553,0,xt.gl2?33325:6406,this.get_realWidth(),this.get_realHeight(),0,xt.gl2?6403:6406,xt.halfFloat.HALF_FLOAT_OES,null);break;default:xt.gl.texImage2D(3553,0,6408,this.get_realWidth(),this.get_realHeight(),0,6408,5121,null)}if(this.format==Ei.DEPTH16){if(xt.gl.texParameteri(3553,10240,9728),xt.gl.texParameteri(3553,10241,9728),xt.gl.framebufferTexture2D(36160,36096,3553,this.texture,0),-1==navigator.appVersion.indexOf("Win")){var e=xt.gl.createTexture();xt.gl.bindTexture(3553,e),xt.gl.texImage2D(3553,0,6408,this.get_realWidth(),this.get_realHeight(),0,6408,5121,null),xt.gl.framebufferTexture2D(36160,36064,3553,e,0),xt.gl.bindTexture(3553,this.texture)}}else xt.gl.framebufferTexture2D(36160,36064,3553,this.texture,0);this.initDepthStencilBuffer(this.depthStencilFormat),36053!=xt.gl.checkFramebufferStatus(36160)&&k.trace("WebGL error: Framebuffer incomplete",{fileName:"WebGLImage.hx",lineNumber:206,className:"kha.WebGLImage",methodName:"createTexture"}),xt.gl.bindRenderbuffer(36161,null),xt.gl.bindFramebuffer(36160,null)}else if(null!=this.video)xt.gl.texImage2D(3553,0,6408,6408,5121,this.video);else switch(this.format[1]){case 0:qe.__instanceof(this.image,Aa)?xt.gl.texImage2D(3553,0,6408,this.myWidth,this.myHeight,0,6408,5121,this.image):xt.gl.texImage2D(3553,0,6408,6408,5121,this.image);break;case 2:xt.gl.texImage2D(3553,0,xt.gl2?34836:6408,this.myWidth,this.myHeight,0,6408,5126,this.image);break;case 4:xt.gl.texImage2D(3553,0,xt.gl2?34842:6408,this.myWidth,this.myHeight,0,6408,xt.halfFloat.HALF_FLOAT_OES,this.image);break;case 5:xt.gl.texImage2D(3553,0,xt.gl2?33326:6406,this.myWidth,this.myHeight,0,xt.gl2?6403:6406,5126,this.image);break;case 6:xt.gl.texImage2D(3553,0,xt.gl2?33325:6406,this.myWidth,this.myHeight,0,xt.gl2?6403:6406,xt.halfFloat.HALF_FLOAT_OES,this.image);break;default:xt.gl.texImage2D(3553,0,6408,6408,5121,this.image)}xt.gl.bindTexture(3553,null)}},initDepthStencilBuffer:function(e){switch(e){case 0:break;case 1:case 5:null==xt.depthTexture?(this.renderBuffer=xt.gl.createRenderbuffer(),xt.gl.bindRenderbuffer(36161,this.renderBuffer),xt.gl.renderbufferStorage(36161,33189,this.get_realWidth(),this.get_realHeight()),xt.gl.framebufferRenderbuffer(36160,36096,36161,this.renderBuffer)):(this.depthTexture=xt.gl.createTexture(),xt.gl.bindTexture(3553,this.depthTexture),1==e?xt.gl.texImage2D(3553,0,xt.gl2?33190:6402,this.get_realWidth(),this.get_realHeight(),0,6402,5125,null):xt.gl.texImage2D(3553,0,xt.gl2?33189:6402,this.get_realWidth(),this.get_realHeight(),0,6402,5123,null),xt.gl.texParameteri(3553,10240,9728),xt.gl.texParameteri(3553,10241,9728),xt.gl.texParameteri(3553,10242,33071),xt.gl.texParameteri(3553,10243,33071),xt.gl.bindFramebuffer(36160,this.frameBuffer),xt.gl.framebufferTexture2D(36160,36096,3553,this.depthTexture,0));break;case 2:case 3:case 4:null==xt.depthTexture?(this.renderBuffer=xt.gl.createRenderbuffer(),xt.gl.bindRenderbuffer(36161,this.renderBuffer),xt.gl.renderbufferStorage(36161,34041,this.get_realWidth(),this.get_realHeight()),xt.gl.framebufferRenderbuffer(36160,33306,36161,this.renderBuffer)):(this.depthTexture=xt.gl.createTexture(),xt.gl.bindTexture(3553,this.depthTexture),xt.gl.texImage2D(3553,0,xt.gl2?35056:34041,this.get_realWidth(),this.get_realHeight(),0,34041,xt.depthTexture.UNSIGNED_INT_24_8_WEBGL,null),xt.gl.texParameteri(3553,10240,9728),xt.gl.texParameteri(3553,10241,9728),xt.gl.texParameteri(3553,10242,33071),xt.gl.texParameteri(3553,10243,33071),xt.gl.bindFramebuffer(36160,this.frameBuffer),xt.gl.framebufferTexture2D(36160,33306,3553,this.depthTexture,0))}},set:function(e){xt.gl.activeTexture(33984+e),xt.gl.bindTexture(3553,this.texture),null!=this.video&&xt.gl.texImage2D(3553,0,6408,6408,5121,this.video)},setDepth:function(e){xt.gl.activeTexture(33984+e),xt.gl.bindTexture(3553,this.depthTexture)},setDepthStencilFrom:function(e){xt.gl.bindFramebuffer(36160,this.frameBuffer),xt.gl.framebufferTexture2D(36160,36096,3553,qe.__cast(e,It).depthTexture,0)},bytesToArray:function(e){switch(this.format[1]){case 0:case 1:return new Aa(e.b.bufferValue);case 2:case 4:case 5:case 6:return new Ca(e.b.bufferValue);default:return new Aa(e.b.bufferValue)}},lock:function(e){return null==e&&(e=0),this.bytes=new N(new Sa(It.formatByteSize(this.format)*this.get_width()*this.get_height())),this.bytes},unlock:function(){if(null!=xt.gl){switch(this.texture=xt.gl.createTexture(),xt.gl.bindTexture(3553,this.texture),xt.gl.texParameteri(3553,10240,9729),xt.gl.texParameteri(3553,10241,9729),xt.gl.texParameteri(3553,10242,33071),xt.gl.texParameteri(3553,10243,33071),this.format[1]){case 0:xt.gl.texImage2D(3553,0,6408,this.get_width(),this.get_height(),0,6408,5121,this.bytesToArray(this.bytes));break;case 1:if(xt.gl.texImage2D(3553,0,6409,this.get_width(),this.get_height(),0,6409,5121,this.bytesToArray(this.bytes)),1282==xt.gl.getError()){for(var e=new N(new Sa(this.get_width()*this.get_height()*4)),t=0,i=this.get_height();t<i;)for(var a=t++,s=0,r=this.get_width();s<r;){var n=s++,l=this.bytes,o=a*this.get_width()+n,h=l.b[o],c=a*this.get_width()*4+4*n;e.b[c]=255&h;var u=a*this.get_width()*4+4*n+1;e.b[u]=255&h;var d=a*this.get_width()*4+4*n+2;e.b[d]=255&h;var f=a*this.get_width()*4+4*n+3;e.b[f]=255}xt.gl.texImage2D(3553,0,6408,this.get_width(),this.get_height(),0,6408,5121,this.bytesToArray(e))}break;case 2:xt.gl.texImage2D(3553,0,xt.gl2?34836:6408,this.get_width(),this.get_height(),0,6408,5126,this.bytesToArray(this.bytes));break;case 4:xt.gl.texImage2D(3553,0,xt.gl2?34842:6408,this.get_width(),this.get_height(),0,6408,xt.halfFloat.HALF_FLOAT_OES,this.bytesToArray(this.bytes));break;case 5:xt.gl.texImage2D(3553,0,xt.gl2?33326:6406,this.get_width(),this.get_height(),0,xt.gl2?6403:6406,5126,this.bytesToArray(this.bytes));break;case 6:xt.gl.texImage2D(3553,0,xt.gl2?33325:6406,this.get_width(),this.get_height(),0,xt.gl2?6403:6406,xt.halfFloat.HALF_FLOAT_OES,this.bytesToArray(this.bytes));break;default:xt.gl.texImage2D(3553,0,6408,this.get_width(),this.get_height(),0,6408,5121,this.bytesToArray(this.bytes))}xt.gl.bindTexture(3553,null),this.bytes=null}},unload:function(){null!=this.texture&&xt.gl.deleteTexture(this.texture),null!=this.depthTexture&&xt.gl.deleteTexture(this.depthTexture),null!=this.frameBuffer&&xt.gl.deleteFramebuffer(this.frameBuffer),null!=this.renderBuffer&&xt.gl.deleteRenderbuffer(this.renderBuffer)},generateMipmaps:function(e){xt.gl.bindTexture(3553,this.texture),xt.gl.generateMipmap(3553)},setMipmaps:function(e){if(xt.gl.bindTexture(3553,this.texture),this.format==Ei.RGBA128)for(var t=0,i=e.length;t<i;){var a=t++;xt.gl.texImage2D(3553,a+1,xt.gl2?34836:6408,e[a].get_width(),e[a].get_height(),0,6408,5126,qe.__cast(e[a],It).image)}else if(this.format==Ei.RGBA64)for(var s=0,r=e.length;s<r;){var n=s++;xt.gl.texImage2D(3553,n+1,xt.gl2?34842:6408,e[n].get_width(),e[n].get_height(),0,6408,xt.halfFloat.HALF_FLOAT_OES,qe.__cast(e[n],It).image)}else for(var l=0,o=e.length;l<o;){var h=l++;xt.gl.texImage2D(3553,h+1,6408,6408,5121,qe.__cast(e[h],It).image)}},__class__:It});var St=function(){};s["kha.audio1.AudioChannel"]=St,St.__name__=!0,St.prototype={__class__:St};var kt=function(){};s["kha.audio2.Audio"]=kt,kt.__name__=!0,kt.initContext=function(){try{return void(kt._context=new AudioContext)}catch(e){}try{return void(this._context=new webkitAudioContext)}catch(e){}},kt._init=function(){if(kt.initContext(),null==kt._context)return!1;return kt.buffer=new Mt(8192,2,0|kt._context.sampleRate),kt.processingNode=kt._context.createScriptProcessor(2048,0,2),kt.processingNode.onaudioprocess=function(e){var t=e.outputBuffer.getChannelData(0),i=e.outputBuffer.getChannelData(1);if(null!=kt.audioCallback){kt.audioCallback(2*e.outputBuffer.length,kt.buffer);for(var a=0,s=e.outputBuffer.length;a<s;){var r=a++;t[r]=kt.buffer.data[kt.buffer.readLocation],kt.buffer.readLocation+=1,i[r]=kt.buffer.data[kt.buffer.readLocation],kt.buffer.readLocation+=1,kt.buffer.readLocation>=kt.buffer.size&&(kt.buffer.readLocation=0)}}else for(var n=0,l=e.outputBuffer.length;n<l;){var o=n++;t[o]=0,i[o]=0}},kt.processingNode.connect(kt._context.destination),!0};var Ct=function(){};s["kha.audio2.Audio1"]=Ct,Ct.__name__=!0,Ct._init=function(){var e=new Array(16);Ct.soundChannels=e;var t=new Array(16);Ct.streamChannels=t;var i=new Array(16);Ct.internalSoundChannels=i;var a=new Array(16);Ct.internalStreamChannels=a;var s=new Array(512);Ct.sampleCache1=s;var r=new Array(512);Ct.sampleCache2=r,kt.audioCallback=Ct.mix},Ct.mix=function(e,t){if(Ct.sampleCache1.length<e){var i=new Array(e);Ct.sampleCache1=i;var a=new Array(e);Ct.sampleCache2=a}for(var s=0,r=e;s<r;){var n=s++;Ct.sampleCache2[n]=0}for(var l=0;l<16;){var o=l++;Ct.internalSoundChannels[o]=Ct.soundChannels[o]}for(var h=0;h<16;){var c=h++;Ct.internalStreamChannels[c]=Ct.streamChannels[c]}for(var u=0,d=Ct.internalSoundChannels;u<d.length;){var f=d[u];if(++u,null!=f&&!f.get_finished()){f.nextSamples(Ct.sampleCache1,e,t.samplesPerSecond);for(var _=0,v=e;_<v;){var p=_++,m=p,g=Ct.sampleCache2,b=Ct.sampleCache1[p]*f.get_volume();g[m]=g[m]+b}}}for(var w=0,B=Ct.internalStreamChannels;w<B.length;){var y=B[w];if(++w,null!=y&&!y.get_finished()){y.nextSamples(Ct.sampleCache1,e,t.samplesPerSecond);for(var x=0,I=e;x<I;){var S=x++,k=S,C=Ct.sampleCache2,A=Ct.sampleCache1[S]*y.get_volume();C[k]=C[k]+A}}}for(var M=0,N=e;M<N;){var T=M++,F=Ct.sampleCache2[T],D=F<1?F:1;t.data[t.writeLocation]=D>-1?D:-1,t.writeLocation+=1,t.writeLocation>=t.size&&(t.writeLocation=0)}},Ct.play=function(e,t){null==t&&(t=!1);for(var i=null,a=0;a<16;){var s=a++;if(null==Ct.soundChannels[s]||Ct.soundChannels[s].get_finished()){(i=new At(t)).data=e.uncompressedData,Ct.soundChannels[s]=i;break}}return i};var At=function(e){this.paused=!1,this.looping=e,this.myVolume=1,this.myPosition=0};s["kha.audio2.AudioChannel"]=At,At.__name__=!0,At.__interfaces__=[St],At.prototype={nextSamples:function(e,t,i){if(this.paused)for(var a=0,s=t;a<s;)e[a++]=0;else{for(var r=0,n=0;r<t;){for(var l=this.data.length-this.myPosition,o=l<t?l:t;n<o;)e[r]=this.data[this.myPosition],++this.myPosition,++n,++r;if(!this.looping)break;n=0,this.myPosition>=this.data.length&&(this.myPosition=0)}for(;r<t;)e[r]=0,++r}},get_volume:function(){return this.myVolume},get_finished:function(){return this.myPosition>=this.data.length},__class__:At,__properties__:{get_finished:"get_finished",get_volume:"get_volume"}};var Mt=function(e,t,i){this.size=e;var a=new Array(e);this.data=a,this.channels=t,this.samplesPerSecond=i,this.readLocation=0,this.writeLocation=0};s["kha.audio2.Buffer"]=Mt,Mt.__name__=!0,Mt.prototype={__class__:Mt};var Nt=function(){this.paused=!1,this.atend=!1};s["kha.audio2.StreamChannel"]=Nt,Nt.__name__=!0,Nt.__interfaces__=[St],Nt.prototype={nextSamples:function(e,t,i){if(this.paused)for(var a=0,s=t;a<s;)e[a++]=0;else{var r=2*this.reader.read(e,t/2|0,2,i,!0);if(r<t){this.loop?this.reader.set_currentMillisecond(0):this.atend=!0;for(var n=r,l=t;n<l;)e[n++]=0}}},get_volume:function(){return this.myVolume},get_finished:function(){return this.atend},__class__:Nt,__properties__:{get_finished:"get_finished",get_volume:"get_volume"}};var Tt=function(){};s["kha.audio2.ogg.tools.Crc32"]=Tt,Tt.__name__=!0,Tt.init=function(){if(null==Tt.table){var e=new Array(256);Tt.table=e;for(var t=0;t<256;){for(var i=t++,a=i<<24,s=0;s<8;){s++;a=a<<1^(m.gte(a,1<<31)?79764919:0)}Tt.table[i]=a}}};var Ft=function(e,t,i){this.seekFunc=t,this.inputLength=i,this.decoder=Pt.start(e),this.decoder.setupSampleNumber(t,i),this.loopStart=this.get_header().comment.get_loopStart(),this.loopLength=this.get_header().comment.get_loopLength()};s["kha.audio2.ogg.vorbis.Reader"]=Ft,Ft.__name__=!0,Ft.openFromBytes=function(e){var t=new V(e),i=t;return new Ft(t,function(e){Ft.seekBytes(i,e)},e.length)},Ft.seekBytes=function(e,t){e.set_position(t)},Ft.readAll=function(e,t,i){null==i&&(i=!1);var a=new V(e),s=Pt.start(a),r=a;s.setupSampleNumber(function(e){Ft.seekBytes(r,e)},e.length);for(var n=s.header,l=0,o=4096*n.channel,h=new Array(o);;){for(var c=s.read(h,4096,n.channel,n.sampleRate,i),u=0,d=c*n.channel;u<d;){var f=u++;t.writeFloat(h[f])}if(0==c)break;l+=c}return s.header},Ft.prototype={get_header:function(){return this.decoder.header},get_currentSample:function(){return this.decoder.currentSample},set_currentSample:function(e){return this.decoder.seek(this.seekFunc,this.inputLength,e),this.decoder.currentSample},get_currentMillisecond:function(){var e=this.get_currentSample(),t=this.get_header().sampleRate;return m.toFloat(e)/m.toFloat(t)*1e3},set_currentMillisecond:function(e){var t=e/1e3,i=this.get_header().sampleRate;return this.set_currentSample(Math.floor(m.toFloat(i)*t)),this.get_currentMillisecond()},read:function(e,t,i,a,s){return null==s&&(s=!1),this.decoder.ensurePosition(this.seekFunc),null==t&&(t=this.decoder.totalSample),null==i&&(i=this.get_header().channel),null==a&&(a=this.get_header().sampleRate),this.decoder.read(e,t,i,a,s)},__class__:Ft,__properties__:{set_currentMillisecond:"set_currentMillisecond",get_currentMillisecond:"get_currentMillisecond",set_currentSample:"set_currentSample",get_currentSample:"get_currentSample",get_header:"get_header"}};var Dt=function(e){this.nextSeg=0,this.firstDecode=!1,this.bytesInSeg=0,this.validBits=0,this.input=e,this.inputPosition=0,this.page=new Xt,Tt.init()};s["kha.audio2.ogg.vorbis.VorbisDecodeState"]=Dt,Dt.__name__=!0,Dt.prototype={setup:function(e,t){this.inputPosition+=1;var i=this.input.readByte();this.inputPosition+=i;for(var a=new Array(i),s=0,r=i;s<r;)a[s++]=this.input.readByte();if(this.segments=a,this.endSegWithKnownLoc=-2,-1!=e||-1!=t)for(var n=i-1;n>=0&&!(this.segments[n]<255);)n>=0&&(this.endSegWithKnownLoc=n,this.knownLocForPacket=e),--n;if(this.firstDecode){for(var l=0,o=new Yt,h=0,c=i;h<c;){var u=h++;l+=this.segments[u]}l+=27+i,o.pageStart=this.firstAudioPageOffset,o.pageEnd=o.pageStart+l,o.firstDecodedSample=0,o.lastDecodedSample=e,this.pFirst=o}this.nextSeg=0},clone:function(e){var t=p.createEmptyInstance(Dt);return e(this.inputPosition),t.input=this.input,t.eof=this.eof,t.validBits=this.validBits,t.discardSamplesDeferred=this.discardSamplesDeferred,t.firstDecode=this.firstDecode,t.nextSeg=this.nextSeg,t.bytesInSeg=this.bytesInSeg,t.acc=t.acc,t.lastSeg=this.lastSeg,t.lastSegWhich=this.lastSegWhich,t.currentLoc=this.currentLoc,t.currentLocValid=this.currentLocValid,t.inputPosition=this.inputPosition,t.firstAudioPageOffset=this.firstAudioPageOffset,t.error=this.error,t.segments=this.segments,t.pFirst=this.pFirst,t.pLast=this.pLast,t.page=this.page.clone(),t},next:function(){if(this.lastSeg)return 0;if(-1==this.nextSeg){this.lastSegWhich=this.segments.length-1;try{this.page.start(this)}catch(e){if(e instanceof Je&&(e=e.val),qe.__instanceof(e,Kt))return this.lastSeg=!0,this.error=e,0;throw e}if(0==(1&this.page.flag))throw new Je(new Kt(Qt.CONTINUED_PACKET_FLAG_INVALID,null,{fileName:"VorbisDecodeState.hx",lineNumber:171,className:"kha.audio2.ogg.vorbis.VorbisDecodeState",methodName:"next"}))}var e=this.segments[this.nextSeg++];e<255&&(this.lastSeg=!0,this.lastSegWhich=this.nextSeg-1),this.nextSeg>=this.segments.length&&(this.nextSeg=-1);this.bytesInSeg;return this.bytesInSeg=e,e},startPacket:function(){for(;-1==this.nextSeg;)if(this.page.start(this),0!=(1&this.page.flag))throw new Je(new Kt(Qt.MISSING_CAPTURE_PATTERN,null,{fileName:"VorbisDecodeState.hx",lineNumber:193,className:"kha.audio2.ogg.vorbis.VorbisDecodeState",methodName:"startPacket"}));this.lastSeg=!1,this.validBits=0,this.bytesInSeg=0},maybeStartPacket:function(){if(-1==this.nextSeg){var e,t=!1;try{this.inputPosition+=1,e=this.input.readByte()}catch(i){if(i instanceof Je&&(i=i.val),!qe.__instanceof(i,G))throw i;t=!0,e=0}if(t)return!1;var i,a,s;if(79==e?(this.inputPosition+=1,s=103!=this.input.readByte()):s=!0,s?a=!0:(this.inputPosition+=1,a=103!=this.input.readByte()),a?i=!0:(this.inputPosition+=1,i=83!=this.input.readByte()),i)throw new Je(new Kt(Qt.MISSING_CAPTURE_PATTERN,null,{fileName:"VorbisDecodeState.hx",lineNumber:218,className:"kha.audio2.ogg.vorbis.VorbisDecodeState",methodName:"maybeStartPacket"}));this.page.startWithoutCapturePattern(this)}return this.startPacket(),!0},readBits:function(e){if(this.validBits<0)return 0;if(this.validBits<e){if(e>24)return this.readBits(24)+(this.readBits(e-24)<<24);for(0==this.validBits&&(this.acc=0);;){if(0==this.bytesInSeg&&(this.lastSeg||0==this.next())){this.validBits=-1;break}if(this.bytesInSeg--,this.inputPosition+=1,this.acc=this.acc+(this.input.readByte()<<this.validBits),this.validBits+=8,!(this.validBits<e))break}if(this.validBits<0)return 0;var t=this.acc&(1<<e)-1;return this.acc=this.acc>>>e,this.validBits-=e,t}var i=this.acc&(1<<e)-1;return this.acc=this.acc>>>e,this.validBits-=e,i},firstPageValidate:function(){if(1!=this.segments.length)throw new Je(new Kt(Qt.INVALID_FIRST_PAGE,"segmentCount",{fileName:"VorbisDecodeState.hx",lineNumber:307,className:"kha.audio2.ogg.vorbis.VorbisDecodeState",methodName:"firstPageValidate"}));if(30!=this.segments[0])throw new Je(new Kt(Qt.INVALID_FIRST_PAGE,"decodeState head",{fileName:"VorbisDecodeState.hx",lineNumber:310,className:"kha.audio2.ogg.vorbis.VorbisDecodeState",methodName:"firstPageValidate"}))},startFirstDecode:function(){this.firstAudioPageOffset=this.inputPosition,this.firstDecode=!0},prepHuffman:function(){if(this.validBits<=24)for(0==this.validBits&&(this.acc=0);;){if(0==this.bytesInSeg&&(this.lastSeg||0==this.next()))return;if(this.bytesInSeg--,this.inputPosition+=1,this.acc=this.acc+(this.input.readByte()<<this.validBits),this.validBits+=8,!(this.validBits<=24))break}},finishDecodePacket:function(e,t,i){var a=i.left.start,s=!1,r=t>>1;if(this.firstDecode)this.currentLoc=-r,this.discardSamplesDeferred=t-i.right.end,s=!0,this.firstDecode=!1;else if(0!=this.discardSamplesDeferred)i.left.start+=this.discardSamplesDeferred,a=i.left.start,this.discardSamplesDeferred=0;else;if(this.lastSegWhich==this.endSegWithKnownLoc){if(s&&0!=(4&this.page.flag)){var n=this.knownLocForPacket-(t-i.right.end);if(n<this.currentLoc+i.right.end){var l=n<this.currentLoc?0:n-this.currentLoc;return l+=i.left.start,this.currentLoc+=l,{len:l,left:a,right:i.right.start}}}this.currentLoc=this.knownLocForPacket-(r-i.left.start),s=!0}return s&&(this.currentLoc+=i.right.start-i.left.start),{len:i.right.end,left:a,right:i.right.start}},getSampleNumber:function(e,t){var i=this.inputPosition,a=m.gte(t,65536)&&m.gte(t-65536,this.firstAudioPageOffset)?t-65536:this.firstAudioPageOffset;e(this.inputPosition=a);var s=0,r=!1,n=this.findPage(e,t);switch(n[1]){case 0:var l=n[3];s=n[2],r=l;break;case 1:throw new Je(new Kt(Qt.CANT_FIND_LAST_PAGE,null,{fileName:"VorbisDecodeState.hx",lineNumber:518,className:"kha.audio2.ogg.vorbis.VorbisDecodeState",methodName:"getSampleNumber"}))}var o=this.inputPosition;try{for(;!r;){e(this.inputPosition=s);var h=this.findPage(e,t);switch(h[1]){case 0:var c=h[3];s=h[2],r=c;break;case 1:throw"__break__"}a=o+1,o=this.inputPosition}}catch(e){if("__break__"!=e)throw e}e(this.inputPosition=o),this.inputPosition+=6;for(var u=new Array(6),d=0;d<6;)u[d++]=this.input.readByte();this.inputPosition+=4;var f=this.input.readInt32();this.inputPosition+=4;var _=this.input.readInt32();if(-1==f&&-1==_||_>0)throw new Je(new Kt(Qt.CANT_FIND_LAST_PAGE,null,{fileName:"VorbisDecodeState.hx",lineNumber:552,className:"kha.audio2.ogg.vorbis.VorbisDecodeState",methodName:"getSampleNumber"}));return this.pLast=new Yt,this.pLast.pageStart=o,this.pLast.pageEnd=s,this.pLast.lastDecodedSample=f,this.pLast.firstDecodedSample=null,this.pLast.afterPreviousPageStart=a,e(this.inputPosition=i),f},findPage:function(e,t){try{for(;;)if(this.inputPosition+=1,79==this.input.readByte()){var i=this.inputPosition;if(i-25>t)return Rt.NotFound;var a,s;if(this.inputPosition+=1,103==this.input.readByte()?(this.inputPosition+=1,s=103!=this.input.readByte()):s=!0,s?a=!0:(this.inputPosition+=1,a=83!=this.input.readByte()),a)continue;var r=new Array(27);r[0]=79,r[1]=103,r[2]=103,r[3]=83;for(var n=4;n<27;){var l=n++;this.inputPosition+=1,r[l]=this.input.readByte()}if(0!=r[4]){e(this.inputPosition=i);continue}for(var o=r[22]+(r[23]<<8)+(r[24]<<16)+(r[25]<<24),h=22;h<26;)r[h++]=0;for(var c=0,u=0;u<27;){var d=u++;c=c<<8^Tt.table[r[d]^c>>>24]}var f=0;try{for(var _=0,v=r[26];_<v;){_++;this.inputPosition+=1;var p=this.input.readByte();c=c<<8^Tt.table[p^c>>>24],f+=p}for(var m=0,g=f;m<g;){m++;this.inputPosition+=1;var b=this.input.readByte();c=c<<8^Tt.table[b^c>>>24]}}catch(e){if(e instanceof Je&&(e=e.val),qe.__instanceof(e,G))return Rt.NotFound;throw e}if(c==o){var w=this.inputPosition;return e(this.inputPosition=i-1),Rt.Found(w,0!=(4&r[5]))}}}catch(e){if(e instanceof Je&&(e=e.val),qe.__instanceof(e,G))return Rt.NotFound;throw e}},analyzePage:function(e,t){var i=new Yt,a=new Array(255);i.pageStart=this.inputPosition,this.inputPosition+=27;for(var s=new Array(27),r=0;r<27;)s[r++]=this.input.readByte();var n=s,l=n[26];this.inputPosition+=l;for(var o=new Array(l),h=0,c=l;h<c;)o[h++]=this.input.readByte();for(var u=o,d=0,f=0,_=n[26];f<_;)d+=u[f++];if(i.pageEnd=i.pageStart+27+n[26]+d,i.lastDecodedSample=n[6]+(n[7]<<8)+(n[8]<<16)+(n[9]<<16),0!=(4&n[5]))return i.firstDecodedSample=null,e(this.inputPosition=i.pageStart),i;for(var v=0,p=0==(1&n[5]),m=t.modes.length,g=0,b=n[26];g<b;){var w=g++;if(p){if(0==u[w])return e(this.inputPosition=i.pageStart),null;this.inputPosition+=1;var B=this.input.readByte();if(0!=(1&B))return e(this.inputPosition=i.pageStart),null;B>>=1;var y=m-1,x=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];if((B&=(1<<(y<16384?y<16?x[y]:y<512?5+x[y>>5]:10+x[y>>10]:y<16777216?y<524288?15+x[y>>15]:20+x[y>>20]:y<536870912?25+x[y>>25]:y<-2147483648?30+x[y>>30]:0))-1)>=m)return e(this.inputPosition=i.pageStart),null;a[v++]=t.modes[B].blockflag;var I=u[w]-1;this.inputPosition+=I;for(var S=new Array(I),k=0,C=I;k<C;)S[k++]=this.input.readByte()}else{var A=u[w];this.inputPosition+=A;for(var M=new Array(A),N=0,T=A;N<T;)M[N++]=this.input.readByte()}p=u[w]<255}var F=0;v>1&&(F+=a[v-1]?t.blocksize1:t.blocksize0);for(var D=v-2;D>=1;)a[--D]?a[D+1]?F+=t.blocksize1>>1:F+=(t.blocksize1-t.blocksize0>>2)+(t.blocksize0>>1):F+=t.blocksize0>>1,--D;return i.firstDecodedSample=i.lastDecodedSample-F,e(this.inputPosition=i.pageStart),i},decodeScalarRaw:function(e){this.prepHuffman();null!=e.sortedCodewords||e.codewords;var t=e.codewordLengths,i=e.codewords,a=e.sortedCodewords;if(e.entries>8?null!=a:null!=i){for(var s=this.acc,r=(s=(-16711936&(s=(-252645136&(s=(-858993460&(s=(-1431655766&s)>>>1|(1431655765&s)<<1))>>>2|(858993459&s)<<2))>>>4|(252645135&s)<<4))>>>8|(16711935&s)<<8)>>>16|s<<16,n=0,l=e.sortedEntries;l>1;){var o=n+(l>>1);m.gte(r,a[o])?(n=o,l-=l>>1):l>>=1}e.sparse||(n=e.sortedValues[n]);var h=t[n];return this.validBits>=h?(this.acc=this.acc>>>h,this.validBits-=h,n):(this.validBits=0,-1)}e.sparse;for(var c=0,u=e.entries;c<u;){var d=c++,f=t[d];if(255!=f&&i[d]==(this.acc&(1<<f)-1))return this.validBits>=f?(this.acc=this.acc>>>f,this.validBits-=f,d):(this.validBits=0,-1)}return this.error=new Kt(Qt.INVALID_STREAM,null,{fileName:"VorbisDecodeState.hx",lineNumber:846,className:"kha.audio2.ogg.vorbis.VorbisDecodeState",methodName:"decodeScalarRaw"}),this.validBits=0,-1},__class__:Dt};var Rt=s["kha.audio2.ogg.vorbis._VorbisDecodeState.FindPageResult"]={__ename__:!0,__constructs__:["Found","NotFound"]};Rt.Found=function(e,t){var i=["Found",0,e,t];return i.__enum__=Rt,i.toString=r,i},Rt.NotFound=["NotFound",1],Rt.NotFound.toString=r,Rt.NotFound.__enum__=Rt;var Pt=function(e,t){this.header=e,this.decodeState=t,this.totalSample=null,this.currentSample=0,this.previousLength=0;var i=e.channel,a=new Array(i);this.channelBuffers=a;var s=e.channel,r=new Array(s);this.previousWindow=r;var n=e.channel,l=new Array(n);this.finalY=l;for(var o=0,h=e.channel;o<h;){var c=o++,u=this.channelBuffers,d=e.blocksize1,f=new Array(d);u[c]=f;var _=this.previousWindow,v=e.blocksize1/2|0,p=new Array(v);_[c]=p,this.finalY[c]=[]}var m=new Array(2);this.a=m;var g=new Array(2);this.b=g;var b=new Array(2);this.c=b;var w=new Array(2);this.window=w;var B=new Array(2);this.bitReverseData=B,this.initBlocksize(0,e.blocksize0),this.initBlocksize(1,e.blocksize1)};s["kha.audio2.ogg.vorbis.VorbisDecoder"]=Pt,Pt.__name__=!0,Pt.start=function(e){var t=new Dt(e),i=Ut.read(t),a=new Pt(i,t);return t.startFirstDecode(),a.pumpFirstFrame(),a},Pt.prototype={read:function(e,t,i,a,s){var r=this.header.sampleRate;if(0!=(m.toFloat(a)%m.toFloat(r)|0))throw new Je("Unsupported sampleRate : can't convert "+_.string(m.toFloat(this.header.sampleRate))+" to "+a);if(i%this.header.channel!=0)throw new Je("Unsupported channels : can't convert "+this.header.channel+" to "+i);var n=this.header.sampleRate,l=m.toFloat(a)/m.toFloat(n)|0,o=i/this.header.channel|0,h=0,c=Math.floor(t/l);null!=this.totalSample&&c>this.totalSample-this.currentSample&&(c=this.totalSample-this.currentSample);for(var u=0;h<c;){var d=this.channelBufferEnd-this.channelBufferStart;d>=c-h&&(d=c-h);for(var f=this.channelBufferStart,v=this.channelBufferStart+d;f<v;)for(var p=f++,g=0,b=l;g<b;){g++;for(var w=0,B=this.header.channel;w<B;)for(var y=w++,x=0,I=o;x<I;){x++;var S=this.channelBuffers[y][p];S>1?S=1:S<-1&&(S=-1),s&&(e[u]=S,++u)}}if(h+=d,this.channelBufferStart+=d,h==c||0==this.getFrameFloat())break}for(var k=h,C=c;k<C;){k++;for(var A=0,M=l;A<M;){A++;for(var N=0,T=this.header.channel;N<T;){N++;for(var F=0,D=o;F<D;){F++;s&&(e[u]=0,++u)}}}}return this.currentSample+=c,c*l},skipSamples:function(e){var t=0;for(null!=this.totalSample&&e>this.totalSample-this.currentSample&&(e=this.totalSample-this.currentSample);t<e;){var i=this.channelBufferEnd-this.channelBufferStart;if(i>=e-t&&(i=e-t),t+=i,this.channelBufferStart+=i,t==e||0==this.getFrameFloat())break}return this.currentSample+=e,e},setupSampleNumber:function(e,t){null==this.totalSample&&(this.totalSample=this.decodeState.getSampleNumber(e,t))},seek:function(e,t,i){if(this.currentSample!=i){if(null==this.totalSample&&(this.setupSampleNumber(e,t),0==this.totalSample))throw new Je(new Kt(Qt.CANT_FIND_LAST_PAGE,null,{fileName:"VorbisDecoder.hx",lineNumber:187,className:"kha.audio2.ogg.vorbis.VorbisDecoder",methodName:"seek"}));i<0&&(i=0);var a=this.decodeState.pFirst,s=this.decodeState.pLast;if(i>=s.lastDecodedSample&&(i=s.lastDecodedSample-1),i<a.lastDecodedSample)this.seekFrameFromPage(e,a.pageStart,0,i);else{for(var r=0;a.pageEnd<s.pageStart;){var n=a.pageEnd,l=s.afterPreviousPageStart,o=a.lastDecodedSample,h=s.lastDecodedSample;if(null==o||null==h)throw new Je(new Kt(Qt.SEEK_FAILED,null,{fileName:"VorbisDecoder.hx",lineNumber:219,className:"kha.audio2.ogg.vorbis.VorbisDecoder",methodName:"seek"}));m.gt(l,n+4e3)&&(l-=4e3);var c=n+Math.floor(m.toFloat(l-n)/m.toFloat(h-o)*(i-o));if(r>=4){var u=n+(l-n>>>1);r>=8?c=u:m.gt(u,c)?c+=u-c>>>1:c=u+(c-u>>>1)}switch(++r,e(this.decodeState.inputPosition=c),this.decodeState.findPage(e,t)[1]){case 0:break;case 1:throw new Je(new Kt(Qt.SEEK_FAILED,null,{fileName:"VorbisDecoder.hx",lineNumber:249,className:"kha.audio2.ogg.vorbis.VorbisDecoder",methodName:"seek"}))}var d=this.decodeState.analyzePage(e,this.header);if(null==d)throw new Je(new Kt(Qt.SEEK_FAILED,null,{fileName:"VorbisDecoder.hx",lineNumber:255,className:"kha.audio2.ogg.vorbis.VorbisDecoder",methodName:"seek"}));d.afterPreviousPageStart=c,d.pageStart!=s.pageStart?i<d.lastDecodedSample?s=d:a=d:s=d}if(!(a.lastDecodedSample<=i&&i<s.lastDecodedSample))throw new Je(new Kt(Qt.SEEK_FAILED,null,{fileName:"VorbisDecoder.hx",lineNumber:275,className:"kha.audio2.ogg.vorbis.VorbisDecoder",methodName:"seek"}));this.seekFrameFromPage(e,s.pageStart,a.lastDecodedSample,i)}}},seekFrameFromPage:function(e,t,i,a){var s=0,r=i;e(this.decodeState.inputPosition=t),this.decodeState.nextSeg=-1;for(var n=0,l=0,o=null,h=null;;){o=h,h=this.decodeState.clone(e);var c=this.decodeInitial();if(null==c){h=o;break}l=c.left.start,n=c.left.end;var u=0==s?n:l;if(a<r+c.right.start-u)break;for(var d=this.decodeState;0!=d.bytesInSeg||!d.lastSeg&&0!=d.next();)d.bytesInSeg--,d.inputPosition+=1,d.input.readByte();r+=c.right.start-u,++s}this.decodeState=h,e(this.decodeState.inputPosition),this.previousLength=0,this.pumpFirstFrame(),this.currentSample=r,this.skipSamples(a-r)},ensurePosition:function(e){e(this.decodeState.inputPosition)},getFrameFloat:function(){var e=this.decodePacket();if(null==e)return this.channelBufferStart=this.channelBufferEnd=0,0;var t=this.finishFrame(e);return this.channelBufferStart=e.left,this.channelBufferEnd=e.left+t,t},pumpFirstFrame:function(){this.finishFrame(this.decodePacket())},finishFrame:function(e){var t=e.len,i=e.right,a=e.left;if(0!=this.previousLength)for(var s=this.previousLength,r=this.getWindow(s),n=0,l=this.header.channel;n<l;)for(var o=n++,h=this.channelBuffers[o],c=this.previousWindow[o],u=0,d=s;u<d;){var f=u++;h[a+f]=h[a+f]*r[f]+c[f]*r[s-1-f]}var _=this.previousLength;this.previousLength=t-i;for(var v=0,p=this.header.channel;v<p;)for(var m=v++,g=this.previousWindow[m],b=this.channelBuffers[m],w=0,B=t-i;w<B;){var y=w++;g[y]=b[i+y]}return 0==_?0:(t<i&&(i=t),i-a)},getWindow:function(e){return e<<=1,e==this.header.blocksize0?this.window[0]:e==this.header.blocksize1?this.window[1]:null},initBlocksize:function(e,t){var i=t>>1,a=t>>2,s=t>>3,r=this.a,n=new Array(i);r[e]=n;var l=this.b,o=new Array(i);l[e]=o;var h=this.c,c=new Array(a);h[e]=c;var u=this.window,d=new Array(i);u[e]=d;var f=this.bitReverseData,_=new Array(s);f[e]=_,Et.computeTwiddleFactors(t,this.a[e],this.b[e],this.c[e]),Et.computeWindow(t,this.window[e]),Et.computeBitReverse(t,this.bitReverseData[e])},inverseMdct:function(e,t,i){for(var a=i?1:0,s=this.a[a],r=this.b[a],n=this.c[a],l=this.bitReverseData[a],o=t>>1,h=t>>2,c=t>>3,u=new Array(o),d=o-2,f=0,_=0,v=o;_!=v;)u[d+1]=e[_]*s[f]-e[_+2]*s[f+1],u[d]=e[_]*s[f+1]+e[_+2]*s[f],d-=2,f+=2,_+=4;for(_=o-3;d>=0;)u[d+1]=-e[_+2]*s[f]- -e[_]*s[f+1],u[d]=-e[_+2]*s[f+1]+-e[_]*s[f],d-=2,f+=2,_-=4;for(var p=e,m=u,g=o-8,b=h,w=0,B=h,y=0;g>=0;){var x=m[b+1]-m[w+1],I=m[b]-m[w];p[B+1]=m[b+1]+m[w+1],p[B]=m[b]+m[w],p[y+1]=x*s[g+4]-I*s[g+5],p[y]=I*s[g+4]+x*s[g+5],x=m[b+3]-m[w+3],I=m[b+2]-m[w+2],p[B+3]=m[b+3]+m[w+3],p[B+2]=m[b+2]+m[w+2],p[y+3]=x*s[g]-I*s[g+1],p[y+2]=I*s[g]+x*s[g+1],g-=8,B+=4,y+=4,b+=4,w+=4}for(var S=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4],k=(t<16384?t<16?S[t]:t<512?5+S[t>>5]:10+S[t>>10]:t<16777216?t<524288?15+S[t>>15]:20+S[t>>20]:t<536870912?25+S[t>>25]:t<-2147483648?30+S[t>>30]:0)-1,C=o-1-0*h,A=C,M=C+-(t>>3),N=0,T=1+(t>>4>>2);--T>0;){var F=p[A]-p[M],D=p[A+-1]-p[M+-1],R=A,P=p;P[R]=P[R]+p[M];var E=A+-1,V=p;V[E]=V[E]+p[M+-1],p[M]=F*s[N]-D*s[N+1],p[M+-1]=D*s[N]+F*s[N+1],N+=8,F=p[A+-2]-p[M+-2],D=p[A+-3]-p[M+-3];var L=A+-2,W=p;W[L]=W[L]+p[M+-2];var G=A+-3,Z=p;Z[G]=Z[G]+p[M+-3],p[M+-2]=F*s[N]-D*s[N+1],p[M+-3]=D*s[N]+F*s[N+1],N+=8,F=p[A+-4]-p[M+-4],D=p[A+-5]-p[M+-5];var U=A+-4,z=p;z[U]=z[U]+p[M+-4];var O=A+-5,H=p;H[O]=H[O]+p[M+-5],p[M+-4]=F*s[N]-D*s[N+1],p[M+-5]=D*s[N]+F*s[N+1],N+=8,F=p[A+-6]-p[M+-6],D=p[A+-7]-p[M+-7];var j=A+-6,X=p;X[j]=X[j]+p[M+-6];var Y=A+-7,K=p;K[Y]=K[Y]+p[M+-7],p[M+-6]=F*s[N]-D*s[N+1],p[M+-7]=D*s[N]+F*s[N+1],N+=8,A-=8,M-=8}for(var Q=o-1-h,J=Q,q=Q+-(t>>3),$=0,ee=1+(t>>4>>2);--ee>0;){var te=p[J]-p[q],ie=p[J+-1]-p[q+-1],ae=J,se=p;se[ae]=se[ae]+p[q];var re=J+-1,ne=p;ne[re]=ne[re]+p[q+-1],p[q]=te*s[$]-ie*s[$+1],p[q+-1]=ie*s[$]+te*s[$+1],$+=8,te=p[J+-2]-p[q+-2],ie=p[J+-3]-p[q+-3];var le=J+-2,oe=p;oe[le]=oe[le]+p[q+-2];var he=J+-3,ce=p;ce[he]=ce[he]+p[q+-3],p[q+-2]=te*s[$]-ie*s[$+1],p[q+-3]=ie*s[$]+te*s[$+1],$+=8,te=p[J+-4]-p[q+-4],ie=p[J+-5]-p[q+-5];var ue=J+-4,de=p;de[ue]=de[ue]+p[q+-4];var fe=J+-5,_e=p;_e[fe]=_e[fe]+p[q+-5],p[q+-4]=te*s[$]-ie*s[$+1],p[q+-5]=ie*s[$]+te*s[$+1],$+=8,te=p[J+-6]-p[q+-6],ie=p[J+-7]-p[q+-7];var ve=J+-6,pe=p;pe[ve]=pe[ve]+p[q+-6];var me=J+-7,ge=p;ge[me]=ge[me]+p[q+-7],p[q+-6]=te*s[$]-ie*s[$+1],p[q+-7]=ie*s[$]+te*s[$+1],$+=8,J-=8,q-=8}for(var be=o-1-0*c,we=0,Be=be,ye=be+-(t>>4),xe=1+(t>>5>>2);--xe>0;){var Ie=p[Be]-p[ye],Se=p[Be+-1]-p[ye+-1],ke=Be,Ce=p;Ce[ke]=Ce[ke]+p[ye];var Ae=Be+-1,Me=p;Me[Ae]=Me[Ae]+p[ye+-1],p[ye]=Ie*s[we]-Se*s[we+1],p[ye+-1]=Se*s[we]+Ie*s[we+1],we+=16,Ie=p[Be+-2]-p[ye+-2],Se=p[Be+-3]-p[ye+-3];var Ne=Be+-2,Te=p;Te[Ne]=Te[Ne]+p[ye+-2];var Fe=Be+-3,De=p;De[Fe]=De[Fe]+p[ye+-3],p[ye+-2]=Ie*s[we]-Se*s[we+1],p[ye+-3]=Se*s[we]+Ie*s[we+1],we+=16,Ie=p[Be+-4]-p[ye+-4],Se=p[Be+-5]-p[ye+-5];var Re=Be+-4,Pe=p;Pe[Re]=Pe[Re]+p[ye+-4];var Ee=Be+-5,Ve=p;Ve[Ee]=Ve[Ee]+p[ye+-5],p[ye+-4]=Ie*s[we]-Se*s[we+1],p[ye+-5]=Se*s[we]+Ie*s[we+1],we+=16,Ie=p[Be+-6]-p[ye+-6],Se=p[Be+-7]-p[ye+-7];var Le=Be+-6,We=p;We[Le]=We[Le]+p[ye+-6];var Ge=Be+-7,Ze=p;Ze[Ge]=Ze[Ge]+p[ye+-7],p[ye+-6]=Ie*s[we]-Se*s[we+1],p[ye+-7]=Se*s[we]+Ie*s[we+1],Be-=8,ye-=8,we+=16}for(var Ue=o-1-c,ze=0,Oe=Ue,He=Ue+-(t>>4),je=1+(t>>5>>2);--je>0;){var Xe=p[Oe]-p[He],Ye=p[Oe+-1]-p[He+-1],Ke=Oe,Qe=p;Qe[Ke]=Qe[Ke]+p[He];var Je=Oe+-1,qe=p;qe[Je]=qe[Je]+p[He+-1],p[He]=Xe*s[ze]-Ye*s[ze+1],p[He+-1]=Ye*s[ze]+Xe*s[ze+1],ze+=16,Xe=p[Oe+-2]-p[He+-2],Ye=p[Oe+-3]-p[He+-3];var $e=Oe+-2,et=p;et[$e]=et[$e]+p[He+-2];var tt=Oe+-3,it=p;it[tt]=it[tt]+p[He+-3],p[He+-2]=Xe*s[ze]-Ye*s[ze+1],p[He+-3]=Ye*s[ze]+Xe*s[ze+1],ze+=16,Xe=p[Oe+-4]-p[He+-4],Ye=p[Oe+-5]-p[He+-5];var at=Oe+-4,st=p;st[at]=st[at]+p[He+-4];var rt=Oe+-5,nt=p;nt[rt]=nt[rt]+p[He+-5],p[He+-4]=Xe*s[ze]-Ye*s[ze+1],p[He+-5]=Ye*s[ze]+Xe*s[ze+1],ze+=16,Xe=p[Oe+-6]-p[He+-6],Ye=p[Oe+-7]-p[He+-7];var lt=Oe+-6,ot=p;ot[lt]=ot[lt]+p[He+-6];var ht=Oe+-7,ct=p;ct[ht]=ct[ht]+p[He+-7],p[He+-6]=Xe*s[ze]-Ye*s[ze+1],p[He+-7]=Ye*s[ze]+Xe*s[ze+1],Oe-=8,He-=8,ze+=16}for(var ut=o-1-2*c,dt=0,ft=ut,_t=ut+-(t>>4),vt=1+(t>>5>>2);--vt>0;){var pt=p[ft]-p[_t],mt=p[ft+-1]-p[_t+-1],gt=ft,bt=p;bt[gt]=bt[gt]+p[_t];var wt=ft+-1,Bt=p;Bt[wt]=Bt[wt]+p[_t+-1],p[_t]=pt*s[dt]-mt*s[dt+1],p[_t+-1]=mt*s[dt]+pt*s[dt+1],dt+=16,pt=p[ft+-2]-p[_t+-2],mt=p[ft+-3]-p[_t+-3];var yt=ft+-2,xt=p;xt[yt]=xt[yt]+p[_t+-2];var It=ft+-3,St=p;St[It]=St[It]+p[_t+-3],p[_t+-2]=pt*s[dt]-mt*s[dt+1],p[_t+-3]=mt*s[dt]+pt*s[dt+1],dt+=16,pt=p[ft+-4]-p[_t+-4],mt=p[ft+-5]-p[_t+-5];var kt=ft+-4,Ct=p;Ct[kt]=Ct[kt]+p[_t+-4];var At=ft+-5,Mt=p;Mt[At]=Mt[At]+p[_t+-5],p[_t+-4]=pt*s[dt]-mt*s[dt+1],p[_t+-5]=mt*s[dt]+pt*s[dt+1],dt+=16,pt=p[ft+-6]-p[_t+-6],mt=p[ft+-7]-p[_t+-7];var Nt=ft+-6,Tt=p;Tt[Nt]=Tt[Nt]+p[_t+-6];var Ft=ft+-7,Dt=p;Dt[Ft]=Dt[Ft]+p[_t+-7],p[_t+-6]=pt*s[dt]-mt*s[dt+1],p[_t+-7]=mt*s[dt]+pt*s[dt+1],ft-=8,_t-=8,dt+=16}for(var Rt=o-1-3*c,Pt=0,Et=Rt,Vt=Rt+-(t>>4),Lt=1+(t>>5>>2);--Lt>0;){var Wt=p[Et]-p[Vt],Gt=p[Et+-1]-p[Vt+-1],Zt=Et,Ut=p;Ut[Zt]=Ut[Zt]+p[Vt];var zt=Et+-1,Ot=p;Ot[zt]=Ot[zt]+p[Vt+-1],p[Vt]=Wt*s[Pt]-Gt*s[Pt+1],p[Vt+-1]=Gt*s[Pt]+Wt*s[Pt+1],Pt+=16,Wt=p[Et+-2]-p[Vt+-2],Gt=p[Et+-3]-p[Vt+-3];var Ht=Et+-2,jt=p;jt[Ht]=jt[Ht]+p[Vt+-2];var Xt=Et+-3,Yt=p;Yt[Xt]=Yt[Xt]+p[Vt+-3],p[Vt+-2]=Wt*s[Pt]-Gt*s[Pt+1],p[Vt+-3]=Gt*s[Pt]+Wt*s[Pt+1],Pt+=16,Wt=p[Et+-4]-p[Vt+-4],Gt=p[Et+-5]-p[Vt+-5];var Kt=Et+-4,Qt=p;Qt[Kt]=Qt[Kt]+p[Vt+-4];var Jt=Et+-5,qt=p;qt[Jt]=qt[Jt]+p[Vt+-5],p[Vt+-4]=Wt*s[Pt]-Gt*s[Pt+1],p[Vt+-5]=Gt*s[Pt]+Wt*s[Pt+1],Pt+=16,Wt=p[Et+-6]-p[Vt+-6],Gt=p[Et+-7]-p[Vt+-7];var $t=Et+-6,ei=p;ei[$t]=ei[$t]+p[Vt+-6];var ti=Et+-7,ii=p;ii[ti]=ii[ti]+p[Vt+-7],p[Vt+-6]=Wt*s[Pt]-Gt*s[Pt+1],p[Vt+-7]=Gt*s[Pt]+Wt*s[Pt+1],Et-=8,Vt-=8,Pt+=16}for(var ai=2,si=k-3>>1;ai<si;)for(var ri=ai++,ni=t>>ri+2,li=ni>>1,oi=0,hi=1<<ri+1;oi<hi;)for(var ci=o-1-ni*oi++,ui=1<<ri+3,di=0,fi=ci,_i=ci+-li,vi=1+(t>>ri+4>>2);--vi>0;){var pi=p[fi]-p[_i],mi=p[fi+-1]-p[_i+-1],gi=fi,bi=p;bi[gi]=bi[gi]+p[_i];var wi=fi+-1,Bi=p;Bi[wi]=Bi[wi]+p[_i+-1],p[_i]=pi*s[di]-mi*s[di+1],p[_i+-1]=mi*s[di]+pi*s[di+1],di+=ui,pi=p[fi+-2]-p[_i+-2],mi=p[fi+-3]-p[_i+-3];var yi=fi+-2,xi=p;xi[yi]=xi[yi]+p[_i+-2];var Ii=fi+-3,Si=p;Si[Ii]=Si[Ii]+p[_i+-3],p[_i+-2]=pi*s[di]-mi*s[di+1],p[_i+-3]=mi*s[di]+pi*s[di+1],di+=ui,pi=p[fi+-4]-p[_i+-4],mi=p[fi+-5]-p[_i+-5];var ki=fi+-4,Ci=p;Ci[ki]=Ci[ki]+p[_i+-4];var Ai=fi+-5,Mi=p;Mi[Ai]=Mi[Ai]+p[_i+-5],p[_i+-4]=pi*s[di]-mi*s[di+1],p[_i+-5]=mi*s[di]+pi*s[di+1],di+=ui,pi=p[fi+-6]-p[_i+-6],mi=p[fi+-7]-p[_i+-7];var Ni=fi+-6,Ti=p;Ti[Ni]=Ti[Ni]+p[_i+-6];var Fi=fi+-7,Di=p;Di[Fi]=Di[Fi]+p[_i+-7],p[_i+-6]=pi*s[di]-mi*s[di+1],p[_i+-7]=mi*s[di]+pi*s[di+1],fi-=8,_i-=8,di+=ui}for(var Ri=k-3>>1,Pi=k-6;Ri<Pi;)for(var Ei=Ri++,Vi=t>>Ei+2,Li=1<<Ei+3,Wi=Vi>>1,Gi=1<<Ei+1,Zi=0,Ui=o-1,zi=(t>>Ei+6)+1;--zi>0;){for(var Oi=s[Zi],Hi=s[Zi+1],ji=s[Zi+Li],Xi=s[Zi+Li+1],Yi=s[Zi+2*Li],Ki=s[Zi+2*Li+1],Qi=s[Zi+3*Li],Ji=s[Zi+3*Li+1],qi=Ui,$i=Ui+-Wi,ea=Gi+1;--ea>0;){var ta=p[qi]-p[$i],ia=p[qi+-1]-p[$i+-1];p[qi]=p[qi]+p[$i],p[qi+-1]=p[qi+-1]+p[$i+-1],p[$i]=ta*Oi-ia*Hi,p[$i+-1]=ia*Oi+ta*Hi,ta=p[qi+-2]-p[$i+-2],ia=p[qi+-3]-p[$i+-3],p[qi+-2]=p[qi+-2]+p[$i+-2],p[qi+-3]=p[qi+-3]+p[$i+-3],p[$i+-2]=ta*ji-ia*Xi,p[$i+-3]=ia*ji+ta*Xi,ta=p[qi+-4]-p[$i+-4],ia=p[qi+-5]-p[$i+-5],p[qi+-4]=p[qi+-4]+p[$i+-4],p[qi+-5]=p[qi+-5]+p[$i+-5],p[$i+-4]=ta*Yi-ia*Ki,p[$i+-5]=ia*Yi+ta*Ki,ta=p[qi+-6]-p[$i+-6],ia=p[qi+-7]-p[$i+-7],p[qi+-6]=p[qi+-6]+p[$i+-6],p[qi+-7]=p[qi+-7]+p[$i+-7],p[$i+-6]=ta*Qi-ia*Ji,p[$i+-7]=ia*Qi+ta*Ji,qi-=Vi,$i-=Vi}Zi+=4*Li,Ui-=8}for(var aa=o-1,sa=s[t>>3],ra=aa,na=aa-16*(t>>5);ra>na;){var la=p[ra],oa=p[ra+-8];p[ra+-8]=la-oa,p[ra]=la+oa,la=p[ra+-1],oa=p[ra+-9],p[ra+-9]=la-oa,p[ra+-1]=la+oa;var ha=(la=p[ra+-2])-(oa=p[ra+-10]);p[ra+-2]=la+oa;var ca=(la=p[ra+-3])-(oa=p[ra+-11]);p[ra+-3]=la+oa,p[ra+-10]=(ha+ca)*sa,p[ra+-11]=(ca-ha)*sa,la=p[ra+-4],ha=(oa=p[ra+-12])-la,p[ra+-4]=la+oa,ca=(la=p[ra+-5])-(oa=p[ra+-13]),p[ra+-5]=la+oa,p[ra+-12]=ca,p[ra+-13]=ha,la=p[ra+-6],ha=(oa=p[ra+-14])-la,p[ra+-6]=la+oa,ca=(la=p[ra+-7])-(oa=p[ra+-15]),p[ra+-7]=la+oa,p[ra+-14]=(ha+ca)*sa,p[ra+-15]=(ha-ca)*sa;var ua=p[ra],da=p[ra+-4],fa=ua-da,_a=ua+da,va=(ua=p[ra+-2])+(da=p[ra+-6]),pa=ua-da;p[ra]=_a+va,p[ra+-2]=_a-va;var ma=p[ra+-3]-p[ra+-7];p[ra+-4]=fa+ma,p[ra+-6]=fa-ma;var ga=(ua=p[ra+-1])-(da=p[ra+-5]),ba=ua+da,wa=p[ra+-3]+p[ra+-7];p[ra+-1]=ba+wa,p[ra+-3]=ba-wa,p[ra+-5]=ga-pa,p[ra+-7]=ga+pa;var Ba=ra-8,ya=p[Ba],xa=p[Ba+-4],Ia=ya-xa,Sa=ya+xa,ka=(ya=p[Ba+-2])+(xa=p[Ba+-6]),Ca=ya-xa;p[Ba]=Sa+ka,p[Ba+-2]=Sa-ka;var Aa=p[Ba+-3]-p[Ba+-7];p[Ba+-4]=Ia+Aa,p[Ba+-6]=Ia-Aa;var Ma=(ya=p[Ba+-1])-(xa=p[Ba+-5]),Na=ya+xa,Ta=p[Ba+-3]+p[Ba+-7];p[Ba+-1]=Na+Ta,p[Ba+-3]=Na-Ta,p[Ba+-5]=Ma-Ca,p[Ba+-7]=Ma+Ca,ra-=16}for(var Fa=0,Da=h-4,Ra=o-4;Da>=0;){var Pa=l[Fa];m[Ra+3]=p[Pa],m[Ra+2]=p[Pa+1],m[Da+3]=p[Pa+2],m[Da+2]=p[Pa+3],Pa=l[Fa+1],m[Ra+1]=p[Pa],m[Ra]=p[Pa+1],m[Da+1]=p[Pa+2],m[Da]=p[Pa+3],Da-=4,Ra-=4,Fa+=2}for(var Ea=0,Va=0,La=o-4;Va<La;){var Wa=m[Va]-m[La+2],Ga=m[Va+1]+m[La+3],Za=n[Ea+1]*Wa+n[Ea]*Ga,Ua=n[Ea+1]*Ga-n[Ea]*Wa,za=m[Va]+m[La+2],Oa=m[Va+1]-m[La+3];m[Va]=za+Za,m[Va+1]=Oa+Ua,m[La+2]=za-Za,m[La+3]=Ua-Oa,Wa=m[Va+2]-m[La],Ga=m[Va+3]+m[La+1],Za=n[Ea+3]*Wa+n[Ea+2]*Ga,Ua=n[Ea+3]*Ga-n[Ea+2]*Wa,za=m[Va+2]+m[La],Oa=m[Va+3]-m[La+1],m[Va+2]=za+Za,m[Va+3]=Oa+Ua,m[La]=za-Za,m[La+1]=Ua-Oa,Ea+=4,Va+=4,La-=4}for(var Ha=o-8,ja=o-8,Xa=0,Ya=o-4,Ka=o,Qa=t-4;ja>=0;){var Ja=u[ja+6]*r[Ha+7]-u[ja+7]*r[Ha+6],qa=-u[ja+6]*r[Ha+6]-u[ja+7]*r[Ha+7];e[Xa]=Ja,e[Ya+3]=-Ja,e[Ka]=qa,e[Qa+3]=qa;var $a=u[ja+4]*r[Ha+5]-u[ja+5]*r[Ha+4],es=-u[ja+4]*r[Ha+4]-u[ja+5]*r[Ha+5];e[Xa+1]=$a,e[Ya+2]=-$a,e[Ka+1]=es,e[Qa+2]=es,Ja=u[ja+2]*r[Ha+3]-u[ja+3]*r[Ha+2],qa=-u[ja+2]*r[Ha+2]-u[ja+3]*r[Ha+3],e[Xa+2]=Ja,e[Ya+1]=-Ja,e[Ka+2]=qa,e[Qa+1]=qa,$a=u[ja]*r[Ha+1]-u[ja+1]*r[Ha],es=-u[ja]*r[Ha]-u[ja+1]*r[Ha+1],e[Xa+3]=$a,e[Ya]=-$a,e[Ka+3]=es,e[Qa]=es,Ha-=8,ja-=8,Xa+=4,Ka+=4,Ya-=4,Qa-=4}},decodePacket:function(){var e=this.decodeInitial();return null==e?null:this.decodePacketRest(e)},decodeInitial:function(){for(this.channelBufferStart=this.channelBufferEnd=0;;){if(!this.decodeState.maybeStartPacket())return null;var e,t=this.decodeState;if(t.validBits<0)e=0;else if(t.validBits<1){for(0==t.validBits&&(t.acc=0);;){if(0==t.bytesInSeg&&(t.lastSeg||0==t.next())){t.validBits=-1;break}if(t.bytesInSeg--,t.inputPosition+=1,t.acc=t.acc+(t.input.readByte()<<t.validBits),t.validBits+=8,!(t.validBits<1))break}if(t.validBits<0)e=0;else{var i=1&t.acc;t.acc=t.acc>>>1,t.validBits-=1,e=i}}else{var a=1&t.acc;t.acc=t.acc>>>1,t.validBits-=1,e=a}if(0==e)break;for(;;){var s,r=this.decodeState;if(0!=r.bytesInSeg||!r.lastSeg&&0!=r.next()?(r.bytesInSeg--,r.inputPosition+=1,s=r.input.readByte()):s=-1,r.validBits=0,-1==s)break}}var n,l=this.decodeState,o=this.header.modes.length-1,h=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4],c=o<16384?o<16?h[o]:o<512?5+h[o>>5]:10+h[o>>10]:o<16777216?o<524288?15+h[o>>15]:20+h[o>>20]:o<536870912?25+h[o>>25]:o<-2147483648?30+h[o>>30]:0;if(l.validBits<0)n=0;else if(l.validBits<c)if(c>24)n=l.readBits(24)+(l.readBits(c-24)<<24);else{for(0==l.validBits&&(l.acc=0);;){if(0==l.bytesInSeg&&(l.lastSeg||0==l.next())){l.validBits=-1;break}if(l.bytesInSeg--,l.inputPosition+=1,l.acc=l.acc+(l.input.readByte()<<l.validBits),l.validBits+=8,!(l.validBits<c))break}if(l.validBits<0)n=0;else{var u=l.acc&(1<<c)-1;l.acc=l.acc>>>c,l.validBits-=c,n=u}}else{var d=l.acc&(1<<c)-1;l.acc=l.acc>>>c,l.validBits-=c,n=d}if(-1==n||n>=this.header.modes.length)throw new Je(new Kt(Qt.SEEK_FAILED,null,{fileName:"VorbisDecoder.hx",lineNumber:519,className:"kha.audio2.ogg.vorbis.VorbisDecoder",methodName:"decodeInitial"}));var f,_,v,p=this.header.modes[n];if(p.blockflag){f=this.header.blocksize1;var m=this.decodeState;if(m.validBits<0)_=0;else if(m.validBits<1){for(0==m.validBits&&(m.acc=0);;){if(0==m.bytesInSeg&&(m.lastSeg||0==m.next())){m.validBits=-1;break}if(m.bytesInSeg--,m.inputPosition+=1,m.acc=m.acc+(m.input.readByte()<<m.validBits),m.validBits+=8,!(m.validBits<1))break}if(m.validBits<0)_=0;else{var g=1&m.acc;m.acc=m.acc>>>1,m.validBits-=1,_=g}}else{var b=1&m.acc;m.acc=m.acc>>>1,m.validBits-=1,_=b}var w=this.decodeState;if(w.validBits<0)v=0;else if(w.validBits<1){for(0==w.validBits&&(w.acc=0);;){if(0==w.bytesInSeg&&(w.lastSeg||0==w.next())){w.validBits=-1;break}if(w.bytesInSeg--,w.inputPosition+=1,w.acc=w.acc+(w.input.readByte()<<w.validBits),w.validBits+=8,!(w.validBits<1))break}if(w.validBits<0)v=0;else{var B=1&w.acc;w.acc=w.acc>>>1,w.validBits-=1,v=B}}else{var y=1&w.acc;w.acc=w.acc>>>1,w.validBits-=1,v=y}}else _=v=0,f=this.header.blocksize0;var x=f>>1;return{mode:n,left:p.blockflag&&0==_?{start:f-this.header.blocksize0>>2,end:f+this.header.blocksize0>>2}:{start:0,end:x},right:p.blockflag&&0==v?{start:3*f-this.header.blocksize0>>2,end:3*f+this.header.blocksize0>>2}:{start:x,end:f}}},decodePacketRest:function(e){for(var t=this.header.modes[e.mode],i=new Array(256),a=new Array(256),s=t.blockflag?this.header.blocksize1:this.header.blocksize0,r=this.header.mapping[t.mapping],n=s>>1,l=[256,128,86,64],o=this.header.codebooks,h=0,c=this.header.channel;h<c;){var u=h++,d=r.chan[u].mux;i[u]=!1;var f=this.header.floorConfig[r.submapFloor[d]];if(0==f.type)throw new Je(new Kt(Qt.INVALID_STREAM,null,{fileName:"VorbisDecoder.hx",lineNumber:581,className:"kha.audio2.ogg.vorbis.VorbisDecoder",methodName:"decodePacketRest"}));var _,v=f.floor1,p=this.decodeState;if(p.validBits<0)_=0;else if(p.validBits<1){for(0==p.validBits&&(p.acc=0);;){if(0==p.bytesInSeg&&(p.lastSeg||0==p.next())){p.validBits=-1;break}if(p.bytesInSeg--,p.inputPosition+=1,p.acc=p.acc+(p.input.readByte()<<p.validBits),p.validBits+=8,!(p.validBits<1))break}if(p.validBits<0)_=0;else{var m=1&p.acc;p.acc=p.acc>>>1,p.validBits-=1,_=m}}else{var g=1&p.acc;p.acc=p.acc>>>1,p.validBits-=1,_=g}if(0!=_){var b=[],w=new Array(256),B=l[v.floor1Multiplier-1],y=2;b=this.finalY[u];var x,I=this.decodeState,S=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4],k=(B<16384?B<16?S[B]:B<512?5+S[B>>5]:10+S[B>>10]:B<16777216?B<524288?15+S[B>>15]:20+S[B>>20]:B<536870912?25+S[B>>25]:B<-2147483648?30+S[B>>30]:0)-1;if(I.validBits<0)x=0;else if(I.validBits<k)if(k>24)x=I.readBits(24)+(I.readBits(k-24)<<24);else{for(0==I.validBits&&(I.acc=0);;){if(0==I.bytesInSeg&&(I.lastSeg||0==I.next())){I.validBits=-1;break}if(I.bytesInSeg--,I.inputPosition+=1,I.acc=I.acc+(I.input.readByte()<<I.validBits),I.validBits+=8,!(I.validBits<k))break}if(I.validBits<0)x=0;else{var C=I.acc&(1<<k)-1;I.acc=I.acc>>>k,I.validBits-=k,x=C}}else{var A=I.acc&(1<<k)-1;I.acc=I.acc>>>k,I.validBits-=k,x=A}b[0]=x;var M,N=this.decodeState,T=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4],F=(B<16384?B<16?T[B]:B<512?5+T[B>>5]:10+T[B>>10]:B<16777216?B<524288?15+T[B>>15]:20+T[B>>20]:B<536870912?25+T[B>>25]:B<-2147483648?30+T[B>>30]:0)-1;if(N.validBits<0)M=0;else if(N.validBits<F)if(F>24)M=N.readBits(24)+(N.readBits(F-24)<<24);else{for(0==N.validBits&&(N.acc=0);;){if(0==N.bytesInSeg&&(N.lastSeg||0==N.next())){N.validBits=-1;break}if(N.bytesInSeg--,N.inputPosition+=1,N.acc=N.acc+(N.input.readByte()<<N.validBits),N.validBits+=8,!(N.validBits<F))break}if(N.validBits<0)M=0;else{var D=N.acc&(1<<F)-1;N.acc=N.acc>>>F,N.validBits-=F,M=D}}else{var R=N.acc&(1<<F)-1;N.acc=N.acc>>>F,N.validBits-=F,M=R}b[1]=M;for(var P=0,E=v.partitions;P<E;){var V=P++,L=v.partitionClassList[V],W=v.classDimensions[L],G=v.classSubclasses[L],Z=(1<<G)-1,U=0;if(0!=G){var z=o[v.classMasterbooks[L]],O=this.decodeState;O.validBits<10&&O.prepHuffman();var H,j=z.fastHuffman[1023&O.acc];if(j>=0){var X=z.codewordLengths[j];O.acc=O.acc>>>X,O.validBits-=X,O.validBits<0?(O.validBits=0,H=-1):H=j}else H=O.decodeScalarRaw(z);z.sparse&&(H=z.sortedValues[H]),U=H}for(var Y=v.subclassBooks[L],K=0,Q=W;K<Q;){K++;var J=Y[U&Z];U>>=G;var q,$=y++;if(J>=0){var ee=this.decodeState,te=o[J];ee.validBits<10&&ee.prepHuffman();var ie,ae=te.fastHuffman[1023&ee.acc];if(ae>=0){var se=te.codewordLengths[ae];ee.acc=ee.acc>>>se,ee.validBits-=se,ee.validBits<0?(ee.validBits=0,ie=-1):ie=ae}else ie=ee.decodeScalarRaw(te);te.sparse&&(ie=te.sortedValues[ie]),q=ie}else q=0;b[$]=q}}if(-1==this.decodeState.validBits){i[u]=!0;continue}w[0]=w[1]=!0;for(var re=v.neighbors,ne=v.xlist,le=2,oe=v.values;le<oe;){var he=le++,ce=re[he][0],ue=re[he][1],de=ne[ce],fe=b[ce],_e=b[ue]-fe,ve=ne[ue]-de,pe=Math.abs(_e)*(ne[he]-de)/ve|0,me=_e<0?fe-pe:fe+pe,ge=b[he],be=B-me,we=be<me?2*be:2*me;0!=ge?(w[ce]=w[ue]=!0,w[he]=!0,b[he]=ge>=we?be>me?ge-me+me:me-ge+be-1:0!=(1&ge)?me-(ge+1>>1):me+(ge>>1)):(w[he]=!1,b[he]=me)}for(var Be=0,ye=v.values;Be<ye;){var xe=Be++;w[xe]||(b[xe]=-1)}}else i[u]=!0}for(var Ie=0,Se=this.header.channel;Ie<Se;){var ke=Ie++;a[ke]=i[ke]}for(var Ce=0,Ae=r.couplingSteps;Ce<Ae;){var Me=Ce++;i[r.chan[Me].magnitude]&&i[r.chan[Me].angle]||(i[r.chan[Me].magnitude]=i[r.chan[Me].angle]=!1)}for(var Ne=0,Te=r.submaps;Ne<Te;){for(var Fe=Ne++,De=this.header.channel,Re=new Array(De),Pe=new Array(256),Ee=0,Ve=0,Le=this.header.channel;Ve<Le;){var We=Ve++;r.chan[We].mux==Fe&&(i[We]?(Pe[Ee]=!0,Re[Ee]=null):(Pe[Ee]=!1,Re[Ee]=this.channelBuffers[We]),++Ee)}var Ge=r.submapResidue[Fe];this.header.residueConfig[Ge].decode(this.decodeState,this.header,Re,Ee,n,Pe,this.channelBuffers)}for(var Ze=r.couplingSteps,Ue=s>>1;--Ze>=0;)for(var ze=this.channelBuffers[r.chan[Ze].magnitude],Oe=this.channelBuffers[r.chan[Ze].angle],He=0,je=Ue;He<je;){var Xe,Ye,Ke=He++;ze[Ke]>0?Oe[Ke]>0?(Ye=ze[Ke],Xe=ze[Ke]-Oe[Ke]):(Xe=ze[Ke],Ye=ze[Ke]+Oe[Ke]):Oe[Ke]>0?(Ye=ze[Ke],Xe=ze[Ke]+Oe[Ke]):(Xe=ze[Ke],Ye=ze[Ke]-Oe[Ke]),ze[Ke]=Ye,Oe[Ke]=Xe}for(var Qe=0,qe=this.header.channel;Qe<qe;){var $e=Qe++;if(a[$e])for(var et=0,tt=Ue;et<tt;){var it=et++;this.channelBuffers[$e][it]=0}else r.doFloor(this.header.floorConfig,$e,s,this.channelBuffers[$e],this.finalY[$e],null)}for(var at=0,st=this.header.channel;at<st;){var rt=at++;this.inverseMdct(this.channelBuffers[rt],s,t.blockflag)}for(var nt=this.decodeState;0!=nt.bytesInSeg||!nt.lastSeg&&0!=nt.next();)nt.bytesInSeg--,nt.inputPosition+=1,nt.input.readByte();return this.decodeState.finishDecodePacket(this.previousLength,s,e)},__class__:Pt};var Et=function(){};s["kha.audio2.ogg.vorbis.VorbisTools"]=Et,Et.__name__=!0,Et.pointCompare=function(e,t){return e.x<t.x?-1:e.x>t.x?1:0},Et.uintAsc=function(e,t){return m.gt(t,e)?-1:e==t?0:1},Et.lookup1Values=function(e,t){var i=0|Math.exp(Math.log(e)/t);(0|Math.pow(i+1,t))<=e&&++i;Math.pow(i+1,t),Math.pow(i,t);return i},Et.computeWindow=function(e,t){for(var i=e>>1,a=0,s=i;a<s;){var r=a++;t[r]=Math.sin(1.5707963267948966*Et.square(Math.sin((r+.5)/i*.5*3.141592653589793)))}},Et.square=function(e){return e*e},Et.computeBitReverse=function(e,t){for(var i=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4],a=(e<16384?e<16?i[e]:e<512?5+i[e>>5]:10+i[e>>10]:e<16777216?e<524288?15+i[e>>15]:20+i[e>>20]:e<536870912?25+i[e>>25]:e<-2147483648?30+i[e>>30]:0)-1,s=0,r=e>>3;s<r;){var n=s++,l=n;l=(-16711936&(l=(-252645136&(l=(-858993460&(l=(-1431655766&l)>>>1|(1431655765&l)<<1))>>>2|(858993459&l)<<2))>>>4|(252645135&l)<<4))>>>8|(16711935&l)<<8,t[n]=(l>>>16|l<<16)>>>32-a+3<<2}},Et.computeTwiddleFactors=function(e,t,i,a){for(var s=e>>3,r=0,n=0,l=e>>2;n<l;){var o=n++;t[r]=Math.cos(4*o*3.141592653589793/e),t[r+1]=-Math.sin(4*o*3.141592653589793/e),i[r]=.5*Math.cos(3.141592653589793*(r+1)/e/2),i[r+1]=.5*Math.sin(3.141592653589793*(r+1)/e/2),r+=2}for(var h=0,c=0,u=s;c<u;){c++;a[h]=Math.cos(2*(h+1)*3.141592653589793/e),a[h+1]=-Math.sin(2*(h+1)*3.141592653589793/e),h+=2}},Et.drawLine=function(e,t,i,a,s,r){if(null==Et.integerDivideTable){var n=new Array(32);Et.integerDivideTable=n;for(var l=0;l<32;){var o=l++,h=Et.integerDivideTable,c=new Array(64);h[o]=c;for(var u=1;u<64;){var d=u++;Et.integerDivideTable[o][d]=o/d|0}}}var f,_,v=s-i,p=a-t,m=v<0?-v:v,g=t,b=i,w=0;p<64&&m<32?_=v<0?(f=-Et.integerDivideTable[m][p])-1:(f=Et.integerDivideTable[m][p])+1:(f=v/p|0,_=v<0?f-1:f+1),m-=(f<0?-f:f)*p,a>r&&(a=r);var B=g,y=e;y[B]=y[B]*Et.INVERSE_DB_TABLE[b];for(var x=g+1,I=a;x<I;){var S=x++;(w+=m)>=p?(w-=p,b+=_):b+=f;var k=S,C=e;C[k]=C[k]*Et.INVERSE_DB_TABLE[b]}};var Vt=function(){};s["kha.audio2.ogg.vorbis.data.Codebook"]=Vt,Vt.__name__=!0,Vt.read=function(e){var t,i,a,s=new Vt;if(e.validBits<0)a=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)a=0;else{var r=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,a=r}}else{var n=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,a=n}if(66==a){var l;if(e.validBits<0)l=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)l=0;else{var o=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,l=o}}else{var h=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,l=h}i=67!=l}else i=!0;if(i)t=!0;else{var c;if(e.validBits<0)c=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)c=0;else{var u=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,c=u}}else{var d=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,c=d}t=86!=c}if(t)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Codebook.hx",lineNumber:40,className:"kha.audio2.ogg.vorbis.data.Codebook",methodName:"read"}));var f;if(e.validBits<0)f=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)f=0;else{var _=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,f=_}}else{var v=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,f=v}var p;if(e.validBits<0)p=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)p=0;else{var g=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,p=g}}else{var b=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,p=b}s.dimensions=(p<<8)+f;var w;if(e.validBits<0)w=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)w=0;else{var B=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,w=B}}else{var y=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,w=y}var x;if(e.validBits<0)x=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)x=0;else{var I=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,x=I}}else{var S=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,x=S}var k;if(e.validBits<0)k=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)k=0;else{var C=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,k=C}}else{var A=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,k=A}s.entries=(k<<16)+(x<<8)+w;var M;if(e.validBits<0)M=0;else if(e.validBits<1){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<1))break}if(e.validBits<0)M=0;else{var N=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,M=N}}else{var T=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,M=T}var F;if(0!=M)F=!1;else{var D;if(e.validBits<0)D=0;else if(e.validBits<1){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<1))break}if(e.validBits<0)D=0;else{var R=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,D=R}}else{var P=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,D=P}F=0!=D}s.sparse=F;var E=s.entries,V=new Array(E);s.sparse||(s.codewordLengths=V);var L=0;if(0!=M){var W,G=0;if(e.validBits<0)W=0;else if(e.validBits<5){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<5))break}if(e.validBits<0)W=0;else{var Z=31&e.acc;e.acc=e.acc>>>5,e.validBits-=5,W=Z}}else{var U=31&e.acc;e.acc=e.acc>>>5,e.validBits-=5,W=U}for(var z=W+1;G<s.entries;){var O,H=s.entries-G,j=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4],X=H<16384?H<16?j[H]:H<512?5+j[H>>5]:10+j[H>>10]:H<16777216?H<524288?15+j[H>>15]:20+j[H>>20]:H<536870912?25+j[H>>25]:H<-2147483648?30+j[H>>30]:0;if(e.validBits<0)O=0;else if(e.validBits<X)if(X>24)O=e.readBits(24)+(e.readBits(X-24)<<24);else{for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<X))break}if(e.validBits<0)O=0;else{var Y=e.acc&(1<<X)-1;e.acc=e.acc>>>X,e.validBits-=X,O=Y}}else{var K=e.acc&(1<<X)-1;e.acc=e.acc>>>X,e.validBits-=X,O=K}if(G+O>s.entries)throw new Je(new Kt(Qt.INVALID_SETUP,"codebook entrys",{fileName:"Codebook.hx",lineNumber:67,className:"kha.audio2.ogg.vorbis.data.Codebook",methodName:"read"}));for(var Q=0,J=O;Q<J;)V[G+Q++]=z;G+=O,++z}}else for(var q=0,$=s.entries;q<$;){var ee,te=q++;if(s.sparse)if(e.validBits<0)ee=0;else if(e.validBits<1){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<1))break}if(e.validBits<0)ee=0;else{var ie=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,ee=ie}}else{var ae=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,ee=ae}else ee=1;if(0!=ee){var se;if(e.validBits<0)se=0;else if(e.validBits<5){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<5))break}if(e.validBits<0)se=0;else{var re=31&e.acc;e.acc=e.acc>>>5,e.validBits-=5,se=re}}else{var ne=31&e.acc;e.acc=e.acc>>>5,e.validBits-=5,se=ne}V[te]=se+1,++L}else V[te]=255}s.sparse&&L>=s.entries>>2&&(s.codewordLengths=V,s.sparse=!1);var le;if(s.sparse)le=L;else{for(var oe=0,he=0,ce=s.entries;he<ce;){var ue=V[he++];ue>10&&255!=ue&&++oe}le=oe}s.sortedEntries=le;var de=null;if(s.sparse){if(0!=s.sortedEntries){var fe=s.sortedEntries,_e=new Array(fe);s.codewordLengths=_e;var ve=s.entries,pe=new Array(ve);s.codewords=pe;var me=s.entries;de=new Array(me)}s.entries,s.sortedEntries}else{var ge=s.entries,be=new Array(ge);s.codewords=be}if(!s.computeCodewords(V,s.entries,de))throw new Je(new Kt(Qt.INVALID_SETUP,"compute codewords",{fileName:"Codebook.hx",lineNumber:120,className:"kha.audio2.ogg.vorbis.data.Codebook",methodName:"read"}));if(0!=s.sortedEntries){s.sortedCodewords=[];var we=s.sortedEntries,Be=new Array(we);s.sortedValues=Be,s.computeSortedHuffman(V,de)}s.sparse&&(de=null,s.codewords=null,V=null),s.computeAcceleratedHuffman();var ye;if(e.validBits<0)ye=0;else if(e.validBits<4){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<4))break}if(e.validBits<0)ye=0;else{var xe=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,ye=xe}}else{var Ie=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,ye=Ie}if(s.lookupType=ye,s.lookupType>2)throw new Je(new Kt(Qt.INVALID_SETUP,"codebook lookup type",{fileName:"Codebook.hx",lineNumber:143,className:"kha.audio2.ogg.vorbis.data.Codebook",methodName:"read"}));if(s.lookupType>0){var Se;if(e.validBits<0)Se=0;else if(e.validBits<32)Se=e.readBits(24)+(e.readBits(8)<<24);else{var ke=0&e.acc;e.acc=e.acc>>>32,e.validBits-=32,Se=ke}var Ce=m.toFloat(2097151&Se),Ae=(2145386496&Se)>>>21,Me=0!=(-2147483648&Se)?-Ce:Ce;s.minimumValue=Me*Math.pow(2,Ae-788);var Ne;if(e.validBits<0)Ne=0;else if(e.validBits<32)Ne=e.readBits(24)+(e.readBits(8)<<24);else{var Te=0&e.acc;e.acc=e.acc>>>32,e.validBits-=32,Ne=Te}var Fe=m.toFloat(2097151&Ne),De=(2145386496&Ne)>>>21,Re=0!=(-2147483648&Ne)?-Fe:Fe;s.deltaValue=Re*Math.pow(2,De-788);var Pe;if(e.validBits<0)Pe=0;else if(e.validBits<4){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<4))break}if(e.validBits<0)Pe=0;else{var Ee=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,Pe=Ee}}else{var Ve=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,Pe=Ve}s.valueBits=Pe+1;var Le;if(e.validBits<0)Le=0;else if(e.validBits<1){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<1))break}if(e.validBits<0)Le=0;else{var We=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,Le=We}}else{var Ge=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,Le=Ge}s.sequenceP=0!=Le,1==s.lookupType?s.lookupValues=Et.lookup1Values(s.entries,s.dimensions):s.lookupValues=s.entries*s.dimensions;for(var Ze=s.lookupValues,Ue=new Array(Ze),ze=0,Oe=s.lookupValues;ze<Oe;){var He,je=ze++,Xe=s.valueBits;if(e.validBits<0)He=0;else if(e.validBits<Xe)if(Xe>24)He=e.readBits(24)+(e.readBits(Xe-24)<<24);else{for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<Xe))break}if(e.validBits<0)He=0;else{var Ye=e.acc&(1<<Xe)-1;e.acc=e.acc>>>Xe,e.validBits-=Xe,He=Ye}}else{var Ke=e.acc&(1<<Xe)-1;e.acc=e.acc>>>Xe,e.validBits-=Xe,He=Ke}if(-1==He)throw new Je(new Kt(Qt.INVALID_SETUP,"fail lookup",{fileName:"Codebook.hx",lineNumber:161,className:"kha.audio2.ogg.vorbis.data.Codebook",methodName:"read"}));Ue[je]=He}var Qe=s.lookupValues,qe=new Array(Qe);s.multiplicands=qe;for(var $e=0,et=s.lookupValues;$e<et;){var tt=$e++;s.multiplicands[tt]=Ue[tt]*s.deltaValue+s.minimumValue}if(2==s.lookupType&&s.sequenceP){for(var it=1,at=s.lookupValues;it<at;){var st=it++;s.multiplicands[st]=s.multiplicands[st-1]}s.sequenceP=!1}}return s},Vt.prototype={computeCodewords:function(e,t,i){for(var a=new Array(32),s=0;s<32;)a[s++]=0;for(var r=0;r<t&&!(e[r]<255);)++r;if(r==t){this.sortedEntries;return!0}var n=0,l=n++;this.sparse?(this.codewords[l]=0,this.codewordLengths[l]=e[r],i[l]=r):this.codewords[r]=0;for(var o=0;++o<=e[r];)a[o]=1<<32-o;for(o=r;++o<t;){var h=e[o];if(255!=h){for(;h>0&&0==a[h];)--h;if(0==h)return!1;var c=a[h];a[h]=0;var u=c,d=(u=(-16711936&(u=(-252645136&(u=(-858993460&(u=(-1431655766&u)>>>1|(1431655765&u)<<1))>>>2|(858993459&u)<<2))>>>4|(252645135&u)<<4))>>>8|(16711935&u)<<8)>>>16|u<<16,f=n++;if(this.sparse?(this.codewords[f]=d,this.codewordLengths[f]=e[o],i[f]=o):this.codewords[o]=d,h!=e[o])for(var _=e[o];_>h;)a[_]=c+(1<<32-_),--_}}return!0},computeSortedHuffman:function(e,t){if(this.sparse)for(var i=0,a=this.sortedEntries;i<a;){var s=i++,r=this.codewords[s];r=(-16711936&(r=(-252645136&(r=(-858993460&(r=(-1431655766&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,this.sortedCodewords[s]=r>>>16|r<<16}else{for(var n=0,l=0,o=this.entries;l<o;){var h=l++,c=e[h];if(this.sparse||255!=c&&c>10){var u=this.codewords[h];u=(-16711936&(u=(-252645136&(u=(-858993460&(u=(-1431655766&u)>>>1|(1431655765&u)<<1))>>>2|(858993459&u)<<2))>>>4|(252645135&u)<<4))>>>8|(16711935&u)<<8,this.sortedCodewords[n++]=u>>>16|u<<16}}this.sortedEntries}this.sortedCodewords[this.sortedEntries]=-1,this.sortedCodewords.sort(Et.uintAsc);for(var d=0,f=this.sparse?this.sortedEntries:this.entries;d<f;){var _=d++,v=this.sparse?e[t[_]]:e[_];if(this.sparse||255!=v&&v>10){for(var p=this.codewords[_],g=(p=(-16711936&(p=(-252645136&(p=(-858993460&(p=(-1431655766&p)>>>1|(1431655765&p)<<1))>>>2|(858993459&p)<<2))>>>4|(252645135&p)<<4))>>>8|(16711935&p)<<8)>>>16|p<<16,b=0,w=this.sortedEntries;w>1;){var B=b+(w>>1);m.gte(g,this.sortedCodewords[B])?(b=B,w-=w>>1):w>>=1}this.sparse?(this.sortedValues[b]=t[_],this.codewordLengths[b]=v):this.sortedValues[b]=_}}},computeAcceleratedHuffman:function(){var e=new Array(1024);this.fastHuffman=e,this.fastHuffman[0]=-1;for(var t=0;t<1024;){var i=t++;this.fastHuffman[i]=-1}for(var a=0,s=this.sparse?this.sortedEntries:this.entries;a<s;){var r=a++;if(this.codewordLengths[r]<=10){var n;if(this.sparse){var l=this.sortedCodewords[r];n=(l=(-16711936&(l=(-252645136&(l=(-858993460&(l=(-1431655766&l)>>>1|(1431655765&l)<<1))>>>2|(858993459&l)<<2))>>>4|(252645135&l)<<4))>>>8|(16711935&l)<<8)>>>16|l<<16}else n=this.codewords[r];for(;n<1024;)this.fastHuffman[n]=r,n+=1<<this.codewordLengths[r]}}},codebookDecode:function(e,t,i,a){e.validBits<10&&e.prepHuffman();var s,r=this.fastHuffman[1023&e.acc];if(r>=0){var n=this.codewordLengths[r];e.acc=e.acc>>>n,e.validBits-=n,e.validBits<0?(e.validBits=0,s=-1):s=r}else s=e.decodeScalarRaw(this);this.sparse&&(s=this.sortedValues[s]);var l=s,o=this.lookupValues,h=this.sequenceP,c=this.multiplicands,u=this.minimumValue;if(l<0)return!1;if(a>this.dimensions&&(a=this.dimensions),1==this.lookupType){for(var d=1,f=0,_=0,v=a;_<v;){var p=_++,g=c[m.toFloat(l/d|0)%m.toFloat(o)|0]+f,b=i+p,w=t;w[b]=w[b]+g,h&&(f=g+u),d*=o}return!0}if(l*=this.dimensions,h)for(var B=0,y=0,x=a;y<x;){var I=y++,S=c[l+I]+B,k=i+I,C=t;C[k]=C[k]+S,B=S+u}else for(var A=0,M=a;A<M;){var N=A++,T=i+N,F=t;F[T]=F[T]+(c[l+N]+0)}return!0},codebookDecodeStep:function(e,t,i,a,s){e.validBits<10&&e.prepHuffman();var r,n=this.fastHuffman[1023&e.acc];if(n>=0){var l=this.codewordLengths[n];e.acc=e.acc>>>l,e.validBits-=l,e.validBits<0?(e.validBits=0,r=-1):r=n}else r=e.decodeScalarRaw(this);this.sparse&&(r=this.sortedValues[r]);var o=r,h=0;if(o<0)return!1;a>this.dimensions&&(a=this.dimensions);var c=this.lookupValues,u=this.sequenceP,d=this.multiplicands;if(1==this.lookupType){for(var f=1,_=0,v=a;_<v;){var p=_++,g=d[m.toFloat(o/f|0)%m.toFloat(c)|0]+h,b=i+p*s,w=t;w[b]=w[b]+g,u&&(h=g),f*=c}return!0}o*=this.dimensions;for(var B=0,y=a;B<y;){var x=B++,I=d[o+x]+h,S=i+x*s,k=t;k[S]=k[S]+I,u&&(h=I)}return!0},decodeDeinterleaveRepeat:function(e,t,i,a,s,r,n){var l=this.dimensions;if(0==this.lookupType)throw new Je(new Kt(Qt.INVALID_STREAM,null,{fileName:"Codebook.hx",lineNumber:488,className:"kha.audio2.ogg.vorbis.data.Codebook",methodName:"decodeDeinterleaveRepeat"}));for(var o=this.multiplicands,h=this.sequenceP,c=this.lookupValues;n>0;){var u=0;e.validBits<10&&e.prepHuffman();var d,f=this.fastHuffman[1023&e.acc];if(f>=0){var _=this.codewordLengths[f];e.acc=e.acc>>>_,e.validBits-=_,e.validBits<0?(e.validBits=0,d=-1):d=f}else d=e.decodeScalarRaw(this);this.sparse&&(d=this.sortedValues[d]);var v=d;if(v<0){if(0==e.bytesInSeg&&e.lastSeg)return null;throw new Je(new Kt(Qt.INVALID_STREAM,null,{fileName:"Codebook.hx",lineNumber:503,className:"kha.audio2.ogg.vorbis.data.Codebook",methodName:"decodeDeinterleaveRepeat"}))}if(a+s*i+l>r*i&&(l=r*i-(s*i-a)),1==this.lookupType){var p=1;if(h)for(var g=0,b=l;g<b;){g++;var w=o[m.toFloat(v/p|0)%m.toFloat(c)|0]+u,B=s,y=t[a];y[B]=y[B]+w,++a==i&&(a=0,++s),u=w,p*=c}else for(var x=0,I=l;x<I;){x++;var S=o[m.toFloat(v/p|0)%m.toFloat(c)|0]+u,k=s,C=t[a];C[k]=C[k]+S,++a==i&&(a=0,++s),p*=c}}else if(v*=this.dimensions,h)for(var A=0,M=l;A<M;){var N=o[v+A++]+u,T=s,F=t[a];F[T]=F[T]+N,++a==i&&(a=0,++s),u=N}else for(var D=0,R=l;D<R;){var P=o[v+D++]+u,E=s,V=t[a];V[E]=V[E]+P,++a==i&&(a=0,++s)}n-=l}return{cInter:a,pInter:s}},residueDecode:function(e,t,i,a,s){if(0==s)for(var r=a/this.dimensions|0,n=0,l=r;n<l;){var o=n++;if(!this.codebookDecodeStep(e,t,i+o,a-i-o,r))return!1}else for(var h=0;h<a;){if(!this.codebookDecode(e,t,i,a-h))return!1;h+=this.dimensions,i+=this.dimensions}return!0},__class__:Vt};var Lt=function(){this.data=new R};s["kha.audio2.ogg.vorbis.data.Comment"]=Lt,Lt.__name__=!0,Lt.prototype={get_loopStart:function(){return _.parseInt(this.getString("loopstart"))},get_loopLength:function(){return _.parseInt(this.getString("looplength"))},add:function(e,t){e=e.toLowerCase();var i=this.data;if(null!=Ia[e]?i.existsReserved(e):i.h.hasOwnProperty(e)){var a=this.data;(null!=Ia[e]?a.getReserved(e):a.h[e]).push(t)}else{var s=[t],r=this.data;null!=Ia[e]?r.setReserved(e,s):r.h[e]=s}},getString:function(e){e=e.toLowerCase();var t=this.data;if(null!=Ia[e]?t.existsReserved(e):t.h.hasOwnProperty(e)){var i=this.data;return(null!=Ia[e]?i.getReserved(e):i.h[e])[0]}return null},__class__:Lt,__properties__:{get_loopLength:"get_loopLength",get_loopStart:"get_loopStart"}};var Wt=function(){};s["kha.audio2.ogg.vorbis.data.Floor"]=Wt,Wt.__name__=!0,Wt.read=function(e,t){var i,a=new Wt;if(e.validBits<0)i=0;else if(e.validBits<16){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<16))break}if(e.validBits<0)i=0;else{var s=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,i=s}}else{var r=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,i=r}if(a.type=i,a.type>1)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Floor.hx",lineNumber:28,className:"kha.audio2.ogg.vorbis.data.Floor",methodName:"read"}));if(0==a.type){var n,l=a.floor0=new Gt;if(e.validBits<0)n=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)n=0;else{var o=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,n=o}}else{var h=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,n=h}l.order=n;var c;if(e.validBits<0)c=0;else if(e.validBits<16){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<16))break}if(e.validBits<0)c=0;else{var u=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,c=u}}else{var d=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,c=d}l.rate=c;var f;if(e.validBits<0)f=0;else if(e.validBits<16){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<16))break}if(e.validBits<0)f=0;else{var _=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,f=_}}else{var v=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,f=v}l.barkMapSize=f;var p;if(e.validBits<0)p=0;else if(e.validBits<6){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<6))break}if(e.validBits<0)p=0;else{var m=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,p=m}}else{var g=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,p=g}l.amplitudeBits=p;var b;if(e.validBits<0)b=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)b=0;else{var w=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,b=w}}else{var B=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,b=B}l.amplitudeOffset=b;var y;if(e.validBits<0)y=0;else if(e.validBits<4){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<4))break}if(e.validBits<0)y=0;else{var x=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,y=x}}else{var I=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,y=I}l.numberOfBooks=y+1;for(var S=0,k=l.numberOfBooks;S<k;){var C,A=S++,M=l.bookList;if(e.validBits<0)C=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)C=0;else{var N=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,C=N}}else{var T=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,C=T}M[A]=C}throw new Je(new Kt(Qt.FEATURE_NOT_SUPPORTED,null,{fileName:"Floor.hx",lineNumber:41,className:"kha.audio2.ogg.vorbis.data.Floor",methodName:"read"}))}var F,D=[],R=a.floor1=new Zt,P=-1;if(e.validBits<0)F=0;else if(e.validBits<5){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<5))break}if(e.validBits<0)F=0;else{var E=31&e.acc;e.acc=e.acc>>>5,e.validBits-=5,F=E}}else{var V=31&e.acc;e.acc=e.acc>>>5,e.validBits-=5,F=V}R.partitions=F;var L=R.partitions,W=new Array(L);R.partitionClassList=W;for(var G=0,Z=R.partitions;G<Z;){var U,z=G++,O=R.partitionClassList;if(e.validBits<0)U=0;else if(e.validBits<4){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<4))break}if(e.validBits<0)U=0;else{var H=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,U=H}}else{var j=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,U=j}O[z]=U,R.partitionClassList[z]>P&&(P=R.partitionClassList[z])}var X=new Array(P+1);R.classDimensions=X;var Y=new Array(P+1);R.classMasterbooks=Y;var K=new Array(P+1);R.classSubclasses=K;var Q=new Array(P+1);R.subclassBooks=Q;for(var J=0,q=P+1;J<q;){var $,ee=J++,te=R.classDimensions;if(e.validBits<0)$=0;else if(e.validBits<3){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<3))break}if(e.validBits<0)$=0;else{var ie=7&e.acc;e.acc=e.acc>>>3,e.validBits-=3,$=ie}}else{var ae=7&e.acc;e.acc=e.acc>>>3,e.validBits-=3,$=ae}te[ee]=$+1;var se,re=R.classSubclasses;if(e.validBits<0)se=0;else if(e.validBits<2){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<2))break}if(e.validBits<0)se=0;else{var ne=3&e.acc;e.acc=e.acc>>>2,e.validBits-=2,se=ne}}else{var le=3&e.acc;e.acc=e.acc>>>2,e.validBits-=2,se=le}if(re[ee]=se,0!=R.classSubclasses[ee]){var oe,he=R.classMasterbooks;if(e.validBits<0)oe=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)oe=0;else{var ce=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,oe=ce}}else{var ue=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,oe=ue}if(he[ee]=oe,R.classMasterbooks[ee]>=t.length)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Floor.hx",lineNumber:64,className:"kha.audio2.ogg.vorbis.data.Floor",methodName:"read"}))}var de=1<<R.classSubclasses[ee],fe=R.subclassBooks,_e=new Array(de);fe[ee]=_e;for(var ve=0,pe=de;ve<pe;){var me,ge=ve++,be=R.subclassBooks[ee];if(e.validBits<0)me=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)me=0;else{var we=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,me=we}}else{var Be=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,me=Be}if(be[ge]=me-1,R.subclassBooks[ee][ge]>=t.length)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Floor.hx",lineNumber:73,className:"kha.audio2.ogg.vorbis.data.Floor",methodName:"read"}))}}var ye;if(e.validBits<0)ye=0;else if(e.validBits<2){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<2))break}if(e.validBits<0)ye=0;else{var xe=3&e.acc;e.acc=e.acc>>>2,e.validBits-=2,ye=xe}}else{var Ie=3&e.acc;e.acc=e.acc>>>2,e.validBits-=2,ye=Ie}R.floor1Multiplier=ye+1;var Se;if(e.validBits<0)Se=0;else if(e.validBits<4){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<4))break}if(e.validBits<0)Se=0;else{var ke=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,Se=ke}}else{var Ce=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,Se=Ce}R.rangebits=Se;var Ae=new Array(250);R.xlist=Ae,R.xlist[0]=0,R.xlist[1]=1<<R.rangebits,R.values=2;for(var Me=0,Ne=R.partitions;Me<Ne;)for(var Te=Me++,Fe=R.partitionClassList[Te],De=0,Re=R.classDimensions[Fe];De<Re;){De++;var Pe,Ee=R.xlist,Ve=R.values,Le=R.rangebits;if(e.validBits<0)Pe=0;else if(e.validBits<Le)if(Le>24)Pe=e.readBits(24)+(e.readBits(Le-24)<<24);else{for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<Le))break}if(e.validBits<0)Pe=0;else{var We=e.acc&(1<<Le)-1;e.acc=e.acc>>>Le,e.validBits-=Le,Pe=We}}else{var Ge=e.acc&(1<<Le)-1;e.acc=e.acc>>>Le,e.validBits-=Le,Pe=Ge}Ee[Ve]=Pe,R.values++}for(var Ze=0,Ue=R.values;Ze<Ue;){var ze=Ze++;D.push(new zt),D[ze].x=R.xlist[ze],D[ze].y=ze}D.sort(Et.pointCompare);var Oe=R.values,He=new Array(Oe);R.sortedOrder=He;for(var je=0,Xe=R.values;je<Xe;){var Ye=je++;R.sortedOrder[Ye]=D[Ye].y}var Ke=R.values,Qe=new Array(Ke);R.neighbors=Qe;for(var qe=2,$e=R.values;qe<$e;){for(var et,tt,it=qe++,at=R.xlist,st=-1,rt=65536,nt=0,lt=0,ot=0,ht=it;ot<ht;){var ct=ot++;at[ct]>st&&at[ct]<at[it]&&(nt=ct,st=at[ct]),at[ct]<rt&&at[ct]>at[it]&&(lt=ct,rt=at[ct])}et=nt,tt=lt;var ut=R.neighbors,dt=R.values,ft=new Array(dt);ut[it]=ft,R.neighbors[it][0]=et,R.neighbors[it][1]=tt}return a},Wt.prototype={__class__:Wt};var Gt=function(){};s["kha.audio2.ogg.vorbis.data.Floor0"]=Gt,Gt.__name__=!0,Gt.prototype={__class__:Gt};var Zt=function(){};s["kha.audio2.ogg.vorbis.data.Floor1"]=Zt,Zt.__name__=!0,Zt.prototype={__class__:Zt};var Ut=function(){};s["kha.audio2.ogg.vorbis.data.Header"]=Ut,Ut.__name__=!0,Ut.read=function(e){var t=e.page;if(t.start(e),0==(2&t.flag))throw new Je(new Kt(Qt.INVALID_FIRST_PAGE,"not firstPage",{fileName:"Header.hx",lineNumber:46,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));if(0!=(4&t.flag))throw new Je(new Kt(Qt.INVALID_FIRST_PAGE,"lastPage",{fileName:"Header.hx",lineNumber:49,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));if(0!=(1&t.flag))throw new Je(new Kt(Qt.INVALID_FIRST_PAGE,"continuedPacket",{fileName:"Header.hx",lineNumber:52,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));if(e.firstPageValidate(),e.inputPosition+=1,1!=e.input.readByte())throw new Je(new Kt(Qt.INVALID_FIRST_PAGE,"decodeState head",{fileName:"Header.hx",lineNumber:57,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));for(var i=new N(new Sa(6)),a=0;a<6;){var s,r=a++;0!=e.bytesInSeg||!e.lastSeg&&0!=e.next()?(e.bytesInSeg--,e.inputPosition+=1,s=e.input.readByte()):s=-1,e.validBits=0,i.b[r]=255&s}if("vorbis"!=i.toString())throw new Je(new Kt(Qt.INVALID_SETUP,"vorbis header",{fileName:"VorbisDecodeState.hx",lineNumber:300,className:"kha.audio2.ogg.vorbis.VorbisDecodeState",methodName:"vorbisValidate"}));e.inputPosition+=4;var n=e.input.readInt32();if(0!=n)throw new Je(new Kt(Qt.INVALID_FIRST_PAGE,"vorbis version : "+n,{fileName:"Header.hx",lineNumber:66,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));var l=new Ut;if(e.inputPosition+=1,l.channel=e.input.readByte(),0==l.channel)throw new Je(new Kt(Qt.INVALID_FIRST_PAGE,"no channel",{fileName:"Header.hx",lineNumber:73,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));if(l.channel>16)throw new Je(new Kt(Qt.TOO_MANY_CHANNELS,"too many channels",{fileName:"Header.hx",lineNumber:75,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));if(e.inputPosition+=4,l.sampleRate=e.input.readInt32(),0==l.sampleRate)throw new Je(new Kt(Qt.INVALID_FIRST_PAGE,"no sampling rate",{fileName:"Header.hx",lineNumber:80,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));e.inputPosition+=4,l.maximumBitRate=e.input.readInt32(),e.inputPosition+=4,l.nominalBitRate=e.input.readInt32(),e.inputPosition+=4,l.minimumBitRate=e.input.readInt32(),e.inputPosition+=1;var o=e.input.readByte(),h=15&o,c=o>>4;if(l.blocksize0=1<<h,l.blocksize1=1<<c,h<6||h>13)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Header.hx",lineNumber:93,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));if(c<6||c>13)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Header.hx",lineNumber:96,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));if(h>c)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Header.hx",lineNumber:99,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));e.inputPosition+=1;var u=e.input.readByte();if(0==(1&u))throw new Je(new Kt(Qt.INVALID_FIRST_PAGE,null,{fileName:"Header.hx",lineNumber:105,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));e.page.start(e),e.startPacket();for(var d=0,f=new W;;){if(0==(d=e.next()))break;e.inputPosition+=d,f.write(e.input.read(d)),e.bytesInSeg=0}var _=new V(f.getBytes());_.readByte(),_.read(6);var v=_.readInt32();l.vendor=_.readString(v),l.comment=new Lt;for(var p=0,m=_.readInt32();p<m;){p++;var g=_.readInt32(),b=_.readString(g),w=b.indexOf("=");-1!=w&&l.comment.add(b.substring(0,w),b.substring(w+1))}if(0==(1&_.readByte()))throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Header.hx",lineNumber:141,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));e.startPacket();var B;if(0!=e.bytesInSeg||!e.lastSeg&&0!=e.next()?(e.bytesInSeg--,e.inputPosition+=1,B=e.input.readByte()):B=-1,e.validBits=0,5!=B)throw new Je(new Kt(Qt.INVALID_SETUP,"setup packet",{fileName:"Header.hx",lineNumber:149,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));for(var y=new N(new Sa(6)),x=0;x<6;){var I,S=x++;0!=e.bytesInSeg||!e.lastSeg&&0!=e.next()?(e.bytesInSeg--,e.inputPosition+=1,I=e.input.readByte()):I=-1,e.validBits=0,y.b[S]=255&I}if("vorbis"!=y.toString())throw new Je(new Kt(Qt.INVALID_SETUP,"vorbis header",{fileName:"VorbisDecodeState.hx",lineNumber:300,className:"kha.audio2.ogg.vorbis.VorbisDecodeState",methodName:"vorbisValidate"}));var k;if(e.validBits<0)k=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)k=0;else{var C=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,k=C}}else{var A=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,k=A}var M=k+1,T=new Array(M);l.codebooks=T;for(var F=0,D=M;F<D;){var R=F++;l.codebooks[R]=Vt.read(e)}var P;if(e.validBits<0)P=0;else if(e.validBits<6){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<6))break}if(e.validBits<0)P=0;else{var E=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,P=E}}else{var L=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,P=L}for(var G=0,Z=u=P+1;G<Z;){var U;G++;if(e.validBits<0)U=0;else if(e.validBits<16){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<16))break}if(e.validBits<0)U=0;else{var z=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,U=z}}else{var O=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,U=O}if(0!=U)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Header.hx",lineNumber:165,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}))}var H;if(e.validBits<0)H=0;else if(e.validBits<6){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<6))break}if(e.validBits<0)H=0;else{var j=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,H=j}}else{var X=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,H=X}var Y=H+1,K=new Array(Y);l.floorConfig=K;for(var Q=0,J=Y;Q<J;){var q=Q++;l.floorConfig[q]=Wt.read(e,l.codebooks)}var $;if(e.validBits<0)$=0;else if(e.validBits<6){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<6))break}if(e.validBits<0)$=0;else{var ee=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,$=ee}}else{var te=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,$=te}var ie=$+1,ae=new Array(ie);l.residueConfig=ae;for(var se=0,re=ie;se<re;){var ne=se++;l.residueConfig[ne]=Jt.read(e,l.codebooks)}var le;if(e.validBits<0)le=0;else if(e.validBits<6){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<6))break}if(e.validBits<0)le=0;else{var oe=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,le=oe}}else{var he=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,le=he}var ce=le+1,ue=new Array(ce);l.mapping=ue;for(var de=0,fe=ce;de<fe;){var _e=de++,ve=Ot.read(e,l.channel);l.mapping[_e]=ve;for(var pe=0,me=ve.submaps;pe<me;){var ge=pe++;if(ve.submapFloor[ge]>=l.floorConfig.length)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Header.hx",lineNumber:191,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}));if(ve.submapResidue[ge]>=l.residueConfig.length)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Header.hx",lineNumber:194,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}))}}var be;if(e.validBits<0)be=0;else if(e.validBits<6){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<6))break}if(e.validBits<0)be=0;else{var we=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,be=we}}else{var Be=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,be=Be}var ye=be+1,xe=new Array(ye);l.modes=xe;for(var Ie=0,Se=ye;Ie<Se;){var ke=Ie++,Ce=jt.read(e);if(l.modes[ke]=Ce,Ce.mapping>=l.mapping.length)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Header.hx",lineNumber:205,className:"kha.audio2.ogg.vorbis.data.Header",methodName:"read"}))}for(;0!=e.bytesInSeg||!e.lastSeg&&0!=e.next();)e.bytesInSeg--,e.inputPosition+=1,e.input.readByte();return l},Ut.prototype={__class__:Ut};var zt=function(){};s["kha.audio2.ogg.vorbis.data.IntPoint"]=zt,zt.__name__=!0,zt.prototype={__class__:zt};var Ot=function(){};s["kha.audio2.ogg.vorbis.data.Mapping"]=Ot,Ot.__name__=!0,Ot.read=function(e,t){var i,a=new Ot;if(e.validBits<0)i=0;else if(e.validBits<16){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<16))break}if(e.validBits<0)i=0;else{var s=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,i=s}}else{var r=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,i=r}if(0!=i)throw new Je(new Kt(Qt.INVALID_SETUP,"mapping type "+i,{fileName:"Mapping.hx",lineNumber:22,className:"kha.audio2.ogg.vorbis.data.Mapping",methodName:"read"}));var n=new Array(t);a.chan=n;for(var l=0,o=t;l<o;){var h=l++;a.chan[h]=new Ht}var c;if(e.validBits<0)c=0;else if(e.validBits<1){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<1))break}if(e.validBits<0)c=0;else{var u=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,c=u}}else{var d=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,c=d}if(0!=c){var f;if(e.validBits<0)f=0;else if(e.validBits<4){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<4))break}if(e.validBits<0)f=0;else{var _=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,f=_}}else{var v=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,f=v}a.submaps=f+1}else a.submaps=1;var p;if(e.validBits<0)p=0;else if(e.validBits<1){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<1))break}if(e.validBits<0)p=0;else{var m=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,p=m}}else{var g=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,p=g}if(0!=p){var b;if(e.validBits<0)b=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)b=0;else{var w=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,b=w}}else{var B=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,b=B}a.couplingSteps=b+1;for(var y=0,x=a.couplingSteps;y<x;){var I,S=y++,k=a.chan[S],C=t-1,A=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4],M=C<16384?C<16?A[C]:C<512?5+A[C>>5]:10+A[C>>10]:C<16777216?C<524288?15+A[C>>15]:20+A[C>>20]:C<536870912?25+A[C>>25]:C<-2147483648?30+A[C>>30]:0;if(e.validBits<0)I=0;else if(e.validBits<M)if(M>24)I=e.readBits(24)+(e.readBits(M-24)<<24);else{for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<M))break}if(e.validBits<0)I=0;else{var N=e.acc&(1<<M)-1;e.acc=e.acc>>>M,e.validBits-=M,I=N}}else{var T=e.acc&(1<<M)-1;e.acc=e.acc>>>M,e.validBits-=M,I=T}k.magnitude=I;var F,D=a.chan[S],R=t-1,P=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4],E=R<16384?R<16?P[R]:R<512?5+P[R>>5]:10+P[R>>10]:R<16777216?R<524288?15+P[R>>15]:20+P[R>>20]:R<536870912?25+P[R>>25]:R<-2147483648?30+P[R>>30]:0;if(e.validBits<0)F=0;else if(e.validBits<E)if(E>24)F=e.readBits(24)+(e.readBits(E-24)<<24);else{for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<E))break}if(e.validBits<0)F=0;else{var V=e.acc&(1<<E)-1;e.acc=e.acc>>>E,e.validBits-=E,F=V}}else{var L=e.acc&(1<<E)-1;e.acc=e.acc>>>E,e.validBits-=E,F=L}if(D.angle=F,a.chan[S].magnitude>=t)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Mapping.hx",lineNumber:46,className:"kha.audio2.ogg.vorbis.data.Mapping",methodName:"read"}));if(a.chan[S].angle>=t)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Mapping.hx",lineNumber:49,className:"kha.audio2.ogg.vorbis.data.Mapping",methodName:"read"}));if(a.chan[S].magnitude==a.chan[S].angle)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Mapping.hx",lineNumber:52,className:"kha.audio2.ogg.vorbis.data.Mapping",methodName:"read"}))}}else a.couplingSteps=0;var W;if(e.validBits<0)W=0;else if(e.validBits<2){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<2))break}if(e.validBits<0)W=0;else{var G=3&e.acc;e.acc=e.acc>>>2,e.validBits-=2,W=G}}else{var Z=3&e.acc;e.acc=e.acc>>>2,e.validBits-=2,W=Z}if(0!=W)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Mapping.hx",lineNumber:61,className:"kha.audio2.ogg.vorbis.data.Mapping",methodName:"read"}));if(a.submaps>1)for(var U=0,z=t;U<z;){var O,H=U++,j=a.chan[H];if(e.validBits<0)O=0;else if(e.validBits<4){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<4))break}if(e.validBits<0)O=0;else{var X=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,O=X}}else{var Y=15&e.acc;e.acc=e.acc>>>4,e.validBits-=4,O=Y}if(j.mux=O,a.chan[H].mux>=a.submaps)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Mapping.hx",lineNumber:67,className:"kha.audio2.ogg.vorbis.data.Mapping",methodName:"read"}))}else for(var K=0,Q=t;K<Q;){var J=K++;a.chan[J].mux=0}var q=a.submaps,$=new Array(q);a.submapFloor=$;var ee=a.submaps,te=new Array(ee);a.submapResidue=te;for(var ie=0,ae=a.submaps;ie<ae;){var se=ie++;if(e.validBits>=0)if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits>=0){e.acc;e.acc=e.acc>>>8,e.validBits-=8}}else{e.acc;e.acc=e.acc>>>8,e.validBits-=8}var re,ne=a.submapFloor;if(e.validBits<0)re=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)re=0;else{var le=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,re=le}}else{var oe=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,re=oe}ne[se]=re;var he,ce=a.submapResidue;if(e.validBits<0)he=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)he=0;else{var ue=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,he=ue}}else{var de=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,he=de}ce[se]=he}return a},Ot.prototype={doFloor:function(e,t,i,a,s,r){var n=i>>1,l=this.chan[t].mux,o=e[this.submapFloor[l]];if(0==o.type)throw new Je(new Kt(Qt.INVALID_STREAM,null,{fileName:"Mapping.hx",lineNumber:94,className:"kha.audio2.ogg.vorbis.data.Mapping",methodName:"doFloor"}));for(var h=o.floor1,c=0,u=s[0]*h.floor1Multiplier,d=1,f=h.values;d<f;){var _=d++,v=h.sortedOrder[_];if(s[v]>=0){var p=s[v]*h.floor1Multiplier,m=h.xlist[v];Et.drawLine(a,c,u,m,p,n),c=m,u=p}}if(c<n)for(var g=c,b=n;g<b;){var w=g++,B=a;B[w]=B[w]*Et.INVERSE_DB_TABLE[u]}},__class__:Ot};var Ht=function(){};s["kha.audio2.ogg.vorbis.data.MappingChannel"]=Ht,Ht.__name__=!0,Ht.prototype={__class__:Ht};var jt=function(){};s["kha.audio2.ogg.vorbis.data.Mode"]=jt,jt.__name__=!0,jt.read=function(e){var t,i=new jt;if(e.validBits<0)t=0;else if(e.validBits<1){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<1))break}if(e.validBits<0)t=0;else{var a=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,t=a}}else{var s=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,t=s}i.blockflag=0!=t;var r;if(e.validBits<0)r=0;else if(e.validBits<16){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<16))break}if(e.validBits<0)r=0;else{var n=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,r=n}}else{var l=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,r=l}i.windowtype=r;var o;if(e.validBits<0)o=0;else if(e.validBits<16){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<16))break}if(e.validBits<0)o=0;else{var h=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,o=h}}else{var c=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,o=c}i.transformtype=o;var u;if(e.validBits<0)u=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)u=0;else{var d=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,u=d}}else{var f=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,u=f}if(i.mapping=u,0!=i.windowtype)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Mode.hx",lineNumber:22,className:"kha.audio2.ogg.vorbis.data.Mode",methodName:"read"}));if(0!=i.transformtype)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Mode.hx",lineNumber:25,className:"kha.audio2.ogg.vorbis.data.Mode",methodName:"read"}));return i},jt.prototype={__class__:jt};var Xt=function(){};s["kha.audio2.ogg.vorbis.data.Page"]=Xt,Xt.__name__=!0,Xt.prototype={clone:function(){var e=new Xt;return e.flag=this.flag,e},start:function(e){var t,i,a;if(e.inputPosition+=1,79==e.input.readByte()?(e.inputPosition+=1,a=103!=e.input.readByte()):a=!0,a?i=!0:(e.inputPosition+=1,i=103!=e.input.readByte()),i?t=!0:(e.inputPosition+=1,t=83!=e.input.readByte()),t)throw new Je(new Kt(Qt.MISSING_CAPTURE_PATTERN,null,{fileName:"VorbisDecodeState.hx",lineNumber:323,className:"kha.audio2.ogg.vorbis.VorbisDecodeState",methodName:"capturePattern"}));this.startWithoutCapturePattern(e)},startWithoutCapturePattern:function(e){e.inputPosition+=1;var t=e.input.readByte();if(0!=t)throw new Je(new Kt(Qt.INVALID_STREAM_STRUCTURE_VERSION,""+t,{fileName:"Page.hx",lineNumber:34,className:"kha.audio2.ogg.vorbis.data.Page",methodName:"startWithoutCapturePattern"}));e.inputPosition+=1,this.flag=e.input.readByte(),e.inputPosition+=4;var i=e.input.readInt32();e.inputPosition+=4;var a=e.input.readInt32();e.inputPosition+=4,e.input.readInt32(),e.inputPosition+=4,e.input.readInt32(),e.inputPosition+=4,e.input.readInt32(),e.setup(i,a)},__class__:Xt};var Yt=function(){};s["kha.audio2.ogg.vorbis.data.ProbedPage"]=Yt,Yt.__name__=!0,Yt.prototype={__class__:Yt};var Kt=function(e,t,i){null==t&&(t=""),this.type=e,this.message=t,this.posInfos=i};s["kha.audio2.ogg.vorbis.data.ReaderError"]=Kt,Kt.__name__=!0,Kt.prototype={__class__:Kt};var Qt=s["kha.audio2.ogg.vorbis.data.ReaderErrorType"]={__ename__:!0,__constructs__:["NEED_MORE_DATA","INVALID_API_MIXING","OUTOFMEM","FEATURE_NOT_SUPPORTED","TOO_MANY_CHANNELS","FILE_OPEN_FAILURE","SEEK_WITHOUT_LENGTH","UNEXPECTED_EOF","SEEK_INVALID","INVALID_SETUP","INVALID_STREAM","MISSING_CAPTURE_PATTERN","INVALID_STREAM_STRUCTURE_VERSION","CONTINUED_PACKET_FLAG_INVALID","INCORRECT_STREAM_SERIAL_NUMBER","INVALID_FIRST_PAGE","BAD_PACKET_TYPE","CANT_FIND_LAST_PAGE","SEEK_FAILED","OTHER"]};Qt.NEED_MORE_DATA=["NEED_MORE_DATA",0],Qt.NEED_MORE_DATA.toString=r,Qt.NEED_MORE_DATA.__enum__=Qt,Qt.INVALID_API_MIXING=["INVALID_API_MIXING",1],Qt.INVALID_API_MIXING.toString=r,Qt.INVALID_API_MIXING.__enum__=Qt,Qt.OUTOFMEM=["OUTOFMEM",2],Qt.OUTOFMEM.toString=r,Qt.OUTOFMEM.__enum__=Qt,Qt.FEATURE_NOT_SUPPORTED=["FEATURE_NOT_SUPPORTED",3],Qt.FEATURE_NOT_SUPPORTED.toString=r,Qt.FEATURE_NOT_SUPPORTED.__enum__=Qt,Qt.TOO_MANY_CHANNELS=["TOO_MANY_CHANNELS",4],Qt.TOO_MANY_CHANNELS.toString=r,Qt.TOO_MANY_CHANNELS.__enum__=Qt,Qt.FILE_OPEN_FAILURE=["FILE_OPEN_FAILURE",5],Qt.FILE_OPEN_FAILURE.toString=r,Qt.FILE_OPEN_FAILURE.__enum__=Qt,Qt.SEEK_WITHOUT_LENGTH=["SEEK_WITHOUT_LENGTH",6],Qt.SEEK_WITHOUT_LENGTH.toString=r,Qt.SEEK_WITHOUT_LENGTH.__enum__=Qt,Qt.UNEXPECTED_EOF=["UNEXPECTED_EOF",7],Qt.UNEXPECTED_EOF.toString=r,Qt.UNEXPECTED_EOF.__enum__=Qt,Qt.SEEK_INVALID=["SEEK_INVALID",8],Qt.SEEK_INVALID.toString=r,Qt.SEEK_INVALID.__enum__=Qt,Qt.INVALID_SETUP=["INVALID_SETUP",9],Qt.INVALID_SETUP.toString=r,Qt.INVALID_SETUP.__enum__=Qt,Qt.INVALID_STREAM=["INVALID_STREAM",10],Qt.INVALID_STREAM.toString=r,Qt.INVALID_STREAM.__enum__=Qt,Qt.MISSING_CAPTURE_PATTERN=["MISSING_CAPTURE_PATTERN",11],Qt.MISSING_CAPTURE_PATTERN.toString=r,Qt.MISSING_CAPTURE_PATTERN.__enum__=Qt,Qt.INVALID_STREAM_STRUCTURE_VERSION=["INVALID_STREAM_STRUCTURE_VERSION",12],Qt.INVALID_STREAM_STRUCTURE_VERSION.toString=r,Qt.INVALID_STREAM_STRUCTURE_VERSION.__enum__=Qt,Qt.CONTINUED_PACKET_FLAG_INVALID=["CONTINUED_PACKET_FLAG_INVALID",13],Qt.CONTINUED_PACKET_FLAG_INVALID.toString=r,Qt.CONTINUED_PACKET_FLAG_INVALID.__enum__=Qt,Qt.INCORRECT_STREAM_SERIAL_NUMBER=["INCORRECT_STREAM_SERIAL_NUMBER",14],Qt.INCORRECT_STREAM_SERIAL_NUMBER.toString=r,Qt.INCORRECT_STREAM_SERIAL_NUMBER.__enum__=Qt,Qt.INVALID_FIRST_PAGE=["INVALID_FIRST_PAGE",15],Qt.INVALID_FIRST_PAGE.toString=r,Qt.INVALID_FIRST_PAGE.__enum__=Qt,Qt.BAD_PACKET_TYPE=["BAD_PACKET_TYPE",16],Qt.BAD_PACKET_TYPE.toString=r,Qt.BAD_PACKET_TYPE.__enum__=Qt,Qt.CANT_FIND_LAST_PAGE=["CANT_FIND_LAST_PAGE",17],Qt.CANT_FIND_LAST_PAGE.toString=r,Qt.CANT_FIND_LAST_PAGE.__enum__=Qt,Qt.SEEK_FAILED=["SEEK_FAILED",18],Qt.SEEK_FAILED.toString=r,Qt.SEEK_FAILED.__enum__=Qt,Qt.OTHER=["OTHER",19],Qt.OTHER.toString=r,Qt.OTHER.__enum__=Qt;var Jt=function(){};s["kha.audio2.ogg.vorbis.data.Residue"]=Jt,Jt.__name__=!0,Jt.read=function(e,t){var i,a=new Jt;if(e.validBits<0)i=0;else if(e.validBits<16){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<16))break}if(e.validBits<0)i=0;else{var s=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,i=s}}else{var r=65535&e.acc;e.acc=e.acc>>>16,e.validBits-=16,i=r}if(a.type=i,a.type>2)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Residue.hx",lineNumber:29,className:"kha.audio2.ogg.vorbis.data.Residue",methodName:"read"}));var n,l=new Array(64);if(e.validBits<0)n=0;else if(e.validBits<24){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<24))break}if(e.validBits<0)n=0;else{var o=16777215&e.acc;e.acc=e.acc>>>24,e.validBits-=24,n=o}}else{var h=16777215&e.acc;e.acc=e.acc>>>24,e.validBits-=24,n=h}a.begin=n;var c;if(e.validBits<0)c=0;else if(e.validBits<24){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<24))break}if(e.validBits<0)c=0;else{var u=16777215&e.acc;e.acc=e.acc>>>24,e.validBits-=24,c=u}}else{var d=16777215&e.acc;e.acc=e.acc>>>24,e.validBits-=24,c=d}a.end=c;var f;if(e.validBits<0)f=0;else if(e.validBits<24){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<24))break}if(e.validBits<0)f=0;else{var _=16777215&e.acc;e.acc=e.acc>>>24,e.validBits-=24,f=_}}else{var v=16777215&e.acc;e.acc=e.acc>>>24,e.validBits-=24,f=v}a.partSize=f+1;var p;if(e.validBits<0)p=0;else if(e.validBits<6){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<6))break}if(e.validBits<0)p=0;else{var m=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,p=m}}else{var g=63&e.acc;e.acc=e.acc>>>6,e.validBits-=6,p=g}var b,w=a.classifications=p+1;if(e.validBits<0)b=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)b=0;else{var B=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,b=B}}else{var y=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,b=y}a.classbook=b;for(var x=0,I=a.classifications;x<I;){var S,k=x++,C=0;if(e.validBits<0)S=0;else if(e.validBits<3){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<3))break}if(e.validBits<0)S=0;else{var A=7&e.acc;e.acc=e.acc>>>3,e.validBits-=3,S=A}}else{var M=7&e.acc;e.acc=e.acc>>>3,e.validBits-=3,S=M}var N;if(e.validBits<0)N=0;else if(e.validBits<1){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<1))break}if(e.validBits<0)N=0;else{var T=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,N=T}}else{var F=1&e.acc;e.acc=e.acc>>>1,e.validBits-=1,N=F}if(0!=N)if(e.validBits<0)C=0;else if(e.validBits<5){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<5))break}if(e.validBits<0)C=0;else{var D=31&e.acc;e.acc=e.acc>>>5,e.validBits-=5,C=D}}else{var R=31&e.acc;e.acc=e.acc>>>5,e.validBits-=5,C=R}l[k]=8*C+S}var P=a.classifications,E=new Array(P);a.residueBooks=E;for(var V=0,L=a.classifications;V<L;){var W=V++,G=a.residueBooks,Z=new Array(8);G[W]=Z;for(var U=0;U<8;){var z=U++;if(0!=(l[W]&1<<z)){var O,H=a.residueBooks[W];if(e.validBits<0)O=0;else if(e.validBits<8){for(0==e.validBits&&(e.acc=0);;){if(0==e.bytesInSeg&&(e.lastSeg||0==e.next())){e.validBits=-1;break}if(e.bytesInSeg--,e.inputPosition+=1,e.acc=e.acc+(e.input.readByte()<<e.validBits),e.validBits+=8,!(e.validBits<8))break}if(e.validBits<0)O=0;else{var j=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,O=j}}else{var X=255&e.acc;e.acc=e.acc>>>8,e.validBits-=8,O=X}if(H[z]=O,a.residueBooks[W][z]>=t.length)throw new Je(new Kt(Qt.INVALID_SETUP,null,{fileName:"Residue.hx",lineNumber:55,className:"kha.audio2.ogg.vorbis.data.Residue",methodName:"read"}))}else a.residueBooks[W][z]=-1}}var Y=t[a.classbook].entries,K=t[a.classbook].dimensions,Q=new Array(Y);a.classdata=Q;for(var J=0,q=Y;J<q;)for(var $=J++,ee=$,te=K,ie=a.classdata,ae=new Array(K),se=ie[$]=ae;--te>=0;)se[te]=ee%w,ee=ee/w|0;return a},Jt.prototype={decode:function(e,t,i,a,s,r,n){for(var l=t.codebooks,o=l[this.classbook].dimensions,h=this.end-this.begin,c=this.partSize,u=m.toFloat(h)/m.toFloat(c)|0,d=t.channel*u+1,f=new Array(d),_=0,v=a;_<v;){var p=_++;if(!r[p])for(var g=i[p],b=0,w=g.length;b<w;)g[b++]=0}if(2!=this.type||1==a)for(var B=0;B<8;)for(var y=B++,x=0;x<u;){if(0==y)for(var I=0,S=a;I<S;){var k=I++;if(!r[k]){var C=l[this.classbook];e.validBits<10&&e.prepHuffman();var A,M=C.fastHuffman[1023&e.acc];if(M>=0){var N=C.codewordLengths[M];e.acc=e.acc>>>N,e.validBits-=N,e.validBits<0?(e.validBits=0,A=-1):A=M}else A=e.decodeScalarRaw(C);C.sparse&&(A=C.sortedValues[A]);var T=A;if(-1==T)return;for(var F=o;--F>=0;)f[k*u+F+x]=T%this.classifications,T=T/this.classifications|0}}for(var D=0,R=o;D<R;){D++;if(x>=u)break;for(var P=0,E=a;P<E;){var V=P++;if(!r[V]){var L=f[V*u+x],W=this.residueBooks[L][y];if(W>=0){var G=i[V],Z=this.begin+x*c,U=c;if(!l[W].residueDecode(e,G,Z,U,this.type))return}}}++x}}else{for(var z=0,O=a;z<O;){var H=z++;if(!r[H])break;if(H==a-1)return}for(var j=0;j<8;){var X=j++,Y=0;if(2==a)for(;Y<u;){var K=this.begin+Y*c,Q=1&K,J=K>>>1;if(0==X){var q=l[this.classbook];e.validBits<10&&e.prepHuffman();var $,ee=q.fastHuffman[1023&e.acc];if(ee>=0){var te=q.codewordLengths[ee];e.acc=e.acc>>>te,e.validBits-=te,e.validBits<0?(e.validBits=0,$=-1):$=ee}else $=e.decodeScalarRaw(q);q.sparse&&($=q.sortedValues[$]);var ie=$;if(-1==ie)return;for(var ae=o;--ae>=0;)f[ae+Y]=ie%this.classifications,ie=ie/this.classifications|0}for(var se=0,re=o;se<re;){se++;if(Y>=u)break;var ne=this.begin+Y*c,le=f[Y],oe=this.residueBooks[le][X];if(oe>=0){var he=l[oe].decodeDeinterleaveRepeat(e,i,a,Q,J,s,c);if(null==he)return;Q=he.cInter,J=he.pInter}else Q=1&(ne+=c),J=ne>>>1;++Y}}else if(1==a)for(;Y<u;){var ce=0,ue=this.begin+Y*c;if(0==X){var de=l[this.classbook];e.validBits<10&&e.prepHuffman();var fe,_e=de.fastHuffman[1023&e.acc];if(_e>=0){var ve=de.codewordLengths[_e];e.acc=e.acc>>>ve,e.validBits-=ve,e.validBits<0?(e.validBits=0,fe=-1):fe=_e}else fe=e.decodeScalarRaw(de);de.sparse&&(fe=de.sortedValues[fe]);var pe=fe;if(-1==pe)return;for(var me=o;--me>=0;)f[me+Y]=pe%this.classifications,pe=pe/this.classifications|0}for(var ge=0,be=o;ge<be;){ge++;if(Y>=u)break;var we=this.begin+Y*c,Be=this.residueBooks[f[Y]][X];if(Be>=0){var ye=l[Be].decodeDeinterleaveRepeat(e,i,a,ce,ue,s,c);if(null==ye)return;ce=ye.cInter,ue=ye.pInter}else ce=0,ue=we+=c;++Y}}else for(;Y<u;){var xe=this.begin+Y*c,Ie=m.toFloat(xe)%m.toFloat(a)|0,Se=m.toFloat(xe)/m.toFloat(a)|0;if(0==X){var ke=l[this.classbook];e.validBits<10&&e.prepHuffman();var Ce,Ae=ke.fastHuffman[1023&e.acc];if(Ae>=0){var Me=ke.codewordLengths[Ae];e.acc=e.acc>>>Me,e.validBits-=Me,e.validBits<0?(e.validBits=0,Ce=-1):Ce=Ae}else Ce=e.decodeScalarRaw(ke);ke.sparse&&(Ce=ke.sortedValues[Ce]);var Ne=Ce;if(-1==Ne)return;for(var Te=o;--Te>=0;)f[Te+Y]=Ne%this.classifications,Ne=Ne/this.classifications|0}for(var Fe=0,De=o;Fe<De;){Fe++;if(Y>=u)break;var Re=this.begin+Y*c,Pe=this.residueBooks[f[Y]][X];if(Pe>=0){var Ee=l[Pe].decodeDeinterleaveRepeat(e,i,a,Ie,Se,s,c);if(null==Ee)return;Ie=Ee.cInter,Se=Ee.pInter}else Re+=c,Ie=m.toFloat(Re)%m.toFloat(a)|0,Se=m.toFloat(Re)/m.toFloat(a)|0;++Y}}}}},__class__:Jt};var qt=function(){};s["kha.graphics1.Graphics"]=qt,qt.__name__=!0;var $t=function(){this.transformations=[],this.transformations.push(new Le(1,0,0,0,1,0,0,0,1)),this.opacities=[],this.opacities.push(1),this.myFontSize=12,this.myFontGlyphs=[];for(var e=32;e<256;){var t=e++;this.myFontGlyphs.push(t)}this.pipe=null};s["kha.graphics2.Graphics"]=$t,$t.__name__=!0,$t.prototype={begin:function(e,t){null==e&&(e=!0)},end:function(){},fillRect:function(e,t,i,a){},set_color:function(e){return-16777216},get_fontSize:function(){return this.myFontSize},get_opacity:function(){return this.opacities[this.opacities.length-1]},__class__:$t,__properties__:{get_opacity:"get_opacity",get_fontSize:"get_fontSize",set_color:"set_color"}};var ei=function(e){this.canvas=e};s["kha.graphics2.Graphics1"]=ei,ei.__name__=!0,ei.__interfaces__=[qt],ei.prototype={__class__:ei};var ti=s["kha.graphics2.ImageScaleQuality"]={__ename__:!0,__constructs__:["Low","High"]};ti.Low=["Low",0],ti.Low.toString=r,ti.Low.__enum__=ti,ti.High=["High",1],ti.High.toString=r,ti.High.__enum__=ti;var ii=function(){};s["kha.graphics2.truetype.VectorOfIntPointer"]=ii,ii.__name__=!0,ii.prototype={__class__:ii};var ai=function(){};s["kha.graphics2.truetype.Stbtt_temp_rect"]=ai,ai.__name__=!0,ai.prototype={__class__:ai};var si=function(){};s["kha.graphics2.truetype.Stbtt_temp_glyph_h_metrics"]=si,si.__name__=!0,si.prototype={__class__:si};var ri=function(){};s["kha.graphics2.truetype.Stbtt_temp_font_v_metrics"]=ri,ri.__name__=!0,ri.prototype={__class__:ri};var ni=function(){};s["kha.graphics2.truetype.Stbtt_bakedchar"]=ni,ni.__name__=!0,ni.prototype={__class__:ni};var li=function(){};s["kha.graphics2.truetype.Stbtt_fontinfo"]=li,li.__name__=!0,li.prototype={__class__:li};var oi=function(){};s["kha.graphics2.truetype.Stbtt_vertex"]=oi,oi.__name__=!0,oi.prototype={__class__:oi};var hi=function(){};s["kha.graphics2.truetype.Stbtt__bitmap"]=hi,hi.__name__=!0,hi.prototype={__class__:hi};var ci=function(){};s["kha.graphics2.truetype.Stbtt__edge"]=ci,ci.__name__=!0,ci.prototype={__class__:ci};var ui=function(){};s["kha.graphics2.truetype.Stbtt__active_edge"]=ui,ui.__name__=!0,ui.prototype={__class__:ui};var di=function(){};s["kha.graphics2.truetype.Stbtt__point"]=di,di.__name__=!0,di.prototype={__class__:di};var fi=function(){};s["kha.graphics2.truetype.StbTruetype"]=fi,fi.__name__=!0,fi.stbtt__find_table=function(e,t,i){for(var a=t+4,s=e.readU8(a),r=t+12,n=0,o=e.readU8(a+1)|s<<8;n<o;){var h=r+16*n++,c=l.cca(i,0),u=l.cca(i,1),d=l.cca(i,2),f=l.cca(i,3);if(e.readU8(h)==c&&e.readU8(h+1)==u&&e.readU8(h+2)==d&&e.readU8(h+3)==f){var _=h+8,v=e.readU8(_),p=e.readU8(_+1),m=e.readU8(_+2);return e.readU8(_+3)|m<<8|p<<16|v<<24}}return 0},fi.stbtt_InitFont=function(e,t,i){var a,s,r;if(e.data=t,e.fontstart=i,a=fi.stbtt__find_table(t,i,"cmap"),e.loca=fi.stbtt__find_table(t,i,"loca"),e.head=fi.stbtt__find_table(t,i,"head"),e.glyf=fi.stbtt__find_table(t,i,"glyf"),e.hhea=fi.stbtt__find_table(t,i,"hhea"),e.hmtx=fi.stbtt__find_table(t,i,"hmtx"),e.kern=fi.stbtt__find_table(t,i,"kern"),0==a||0==e.loca||0==e.head||0==e.glyf||0==e.hhea||0==e.hmtx)return!1;if(0!=(s=fi.stbtt__find_table(t,i,"maxp"))){var n=s+4,l=t.readU8(n),o=t.readU8(n+1);e.numGlyphs=o|l<<8}else e.numGlyphs=65535;var h=a+2,c=t.readU8(h);r=t.readU8(h+1)|c<<8,e.index_map=0;for(var u=0,d=r;u<d;){var f=a+4+8*u++,_=t.readU8(f);switch(t.readU8(f+1)|_<<8){case 0:var v=f+4,p=t.readU8(v),m=t.readU8(v+1),g=t.readU8(v+2),b=t.readU8(v+3);e.index_map=a+(b|g<<8|m<<16|p<<24);break;case 3:var w=f+2,B=t.readU8(w);switch(t.readU8(w+1)|B<<8){case 1:case 10:var y=f+4,x=t.readU8(y),I=t.readU8(y+1),S=t.readU8(y+2),k=t.readU8(y+3);e.index_map=a+(k|S<<8|I<<16|x<<24)}}}if(0==e.index_map)return!1;var C=e.head+50,A=t.readU8(C),M=t.readU8(C+1);return e.indexToLocFormat=M|A<<8,!0},fi.stbtt_FindGlyphIndex=function(e,t){var i=e.data,a=e.index_map,s=i.readU8(a),r=i.readU8(a+1)|s<<8;if(0==r){var n=a+2,l=i.readU8(n);return t<(i.readU8(n+1)|l<<8)-6?i.readU8(a+6+t):0}if(6==r){var o=a+6,h=i.readU8(o),c=i.readU8(o+1)|h<<8,u=a+8,d=i.readU8(u),f=i.readU8(u+1)|d<<8;if(t>=c&&t<c+f){var _=a+10+2*(t-c),v=i.readU8(_);return i.readU8(_+1)|v<<8}return 0}if(2==r)throw new Je("Error");if(4==r){var p=a+6,m=i.readU8(p),g=(i.readU8(p+1)|m<<8)>>1,b=a+8,w=i.readU8(b),B=(i.readU8(b+1)|w<<8)>>1,y=a+10,x=i.readU8(y),I=i.readU8(y+1)|x<<8,S=a+12,k=i.readU8(S),C=(i.readU8(S+1)|k<<8)>>1,A=a+14,M=A;if(t>65535)return 0;var N=M+2*C,T=i.readU8(N);for(t>=(i.readU8(N+1)|T<<8)&&(M+=2*C),M-=2;0!=I;){var F=M+2*(B>>=1),D=i.readU8(F);t>(i.readU8(F+1)|D<<8)&&(M+=2*B),--I}var R,P,E=(M+=2)-A>>1,V=A+2*E,L=i.readU8(V);if(t>(i.readU8(V+1)|L<<8))throw new Je("Error");var W=a+14+2*g+2+2*E,G=i.readU8(W);if(P=i.readU8(W+1)|G<<8,t<P)return 0;var Z=a+14+6*g+2+2*E,U=i.readU8(Z);if(0==(R=i.readU8(Z+1)|U<<8)){var z=a+14+4*g+2+2*E,O=i.readU8(z),H=i.readU8(z+1)|O<<8;return t+(0!=(32768&H)?H-65536:H)}var j=R+2*(t-P)+a+14+6*g+2+2*E,X=i.readU8(j);return i.readU8(j+1)|X<<8}if(12==r||13==r){var Y,K,Q=a+12,J=i.readU8(Q),q=i.readU8(Q+1),$=i.readU8(Q+2);for(Y=0,K=i.readU8(Q+3)|$<<8|q<<16|J<<24;Y<K;){var ee=Y+(K-Y>>1),te=a+16+12*ee,ie=i.readU8(te),ae=i.readU8(te+1),se=i.readU8(te+2),re=i.readU8(te+3)|se<<8|ae<<16|ie<<24,ne=a+16+12*ee+4,le=i.readU8(ne),oe=i.readU8(ne+1),he=i.readU8(ne+2),ce=i.readU8(ne+3)|he<<8|oe<<16|le<<24;if(t<re)K=ee;else{if(!(t>ce)){var ue=a+16+12*ee+8,de=i.readU8(ue),fe=i.readU8(ue+1),_e=i.readU8(ue+2),ve=i.readU8(ue+3)|_e<<8|fe<<16|de<<24;return 12==r?ve+t-re:ve}Y=ee+1}}return 0}throw new Je("Error")},fi.stbtt_setvertex=function(e,t,i,a,s,r){e.type=t,e.x=i,e.y=a,e.cx=s,e.cy=r},fi.stbtt__GetGlyfOffset=function(e,t){var i,a;if(t>=e.numGlyphs)return-1;if(e.indexToLocFormat>=2)return-1;if(0==e.indexToLocFormat){var s=e.glyf,r=e.data,n=e.loca+2*t,l=r.readU8(n);i=s+2*(r.readU8(n+1)|l<<8);var o=e.glyf,h=e.data,c=e.loca+2*t+2,u=h.readU8(c);a=o+2*(h.readU8(c+1)|u<<8)}else{var d=e.glyf,f=e.data,_=e.loca+4*t,v=f.readU8(_),p=f.readU8(_+1),m=f.readU8(_+2);i=d+(f.readU8(_+3)|m<<8|p<<16|v<<24);var g=e.glyf,b=e.data,w=e.loca+4*t+4,B=b.readU8(w),y=b.readU8(w+1),x=b.readU8(w+2);a=g+(b.readU8(w+3)|x<<8|y<<16|B<<24)}return i==a?-1:i},fi.stbtt_GetGlyphBox=function(e,t,i){var a=fi.stbtt__GetGlyfOffset(e,t);if(a<0)return!1;var s=e.data,r=a+2,n=s.readU8(r),l=s.readU8(r+1)|n<<8;i.x0=0!=(32768&l)?l-65536:l;var o=e.data,h=a+4,c=o.readU8(h),u=o.readU8(h+1)|c<<8;i.y0=0!=(32768&u)?u-65536:u;var d=e.data,f=a+6,_=d.readU8(f),v=d.readU8(f+1)|_<<8;i.x1=0!=(32768&v)?v-65536:v;var p=e.data,m=a+8,g=p.readU8(m),b=p.readU8(m+1)|g<<8;return i.y1=0!=(32768&b)?b-65536:b,!0},fi.stbtt__close_shape=function(e,t,i,a,s,r,n,l,o,h){return a?(i&&fi.stbtt_setvertex(e[t++],3,o+n>>1,h+l>>1,o,h),fi.stbtt_setvertex(e[t++],3,s,r,n,l)):i?fi.stbtt_setvertex(e[t++],3,s,r,o,h):fi.stbtt_setvertex(e[t++],2,s,r,0,0),t},fi.copyVertices=function(e,t,i,a){for(var s=0,r=a;s<r;){var n=s++;t[i+n]=e[n]}},fi.stbtt_GetGlyphShape=function(e,t){var i,a,s=e.data,r=null,n=0,l=fi.stbtt__GetGlyfOffset(e,t);if(l<0)return null;var o=s.readU8(l),h=s.readU8(l+1)|o<<8;if((i=0!=(32768&h)?h-65536:h)>0){var c,u,d,f,_,v,p,m,g,b,w,B,y,x=0,I=0,S=0,k=0,C=!1,A=!1,M=0;a=s.sub(l+10,s.get_length()-(l+10));var N=l+10+2*i,T=s.readU8(N);u=s.readU8(N+1)|T<<8,y=s.sub(l+10+2*i+2+u,s.get_length()-(l+10+2*i+2+u));var F=2*i-2,D=a.readU8(F);if(d=(f=1+(a.readU8(F+1)|D<<8))+2*i,null==(r=new Array(d)))return null;for(var R=0,P=r.length;R<P;)r[R++]=new oi;S=0,c=0,k=d-f;for(var E=0,V=f;E<V;){var L=E++;0==c?0!=(8&(x=y.readU8(M++)))&&(c=y.readU8(M++)):--c,r[k+L].type=x}_=0;for(var W=0,G=f;W<G;){var Z=W++;if(0!=(2&(x=r[k+Z].type))){var U=y.readU8(M++);_+=0!=(16&x)?U:-U}else if(0==(16&x)){var z=y.readU8(M),O=y.readU8(M+1)|z<<8;_+=0!=(32768&O)?O-65536:O,M+=2}r[k+Z].x=_}v=0;for(var H=0,j=f;H<j;){var X=H++;if(0!=(4&(x=r[k+X].type))){var Y=y.readU8(M++);v+=0!=(32&x)?Y:-Y}else if(0==(32&x)){var K=y.readU8(M),Q=y.readU8(M+1)|K<<8;v+=0!=(32768&Q)?Q-65536:Q,M+=2}r[k+X].y=v}n=0,g=b=p=m=w=B=0;for(var J=0;J<f;){if(x=r[k+J].type,_=r[k+J].x,v=r[k+J].y,S==J){0!=J&&(n=fi.stbtt__close_shape(r,n,C,A,g,b,w,B,p,m)),(A=0==(1&x))?(w=_,B=v,0==(1&r[k+J+1].type)?(g=_+r[k+J+1].x>>1,b=v+r[k+J+1].y>>1):(g=r[k+J+1].x,b=r[k+J+1].y,++J)):(g=_,b=v),fi.stbtt_setvertex(r[n++],1,g,b,0,0),C=!1;var q=2*I,$=a.readU8(q);S=1+(a.readU8(q+1)|$<<8),++I}else 0==(1&x)?(C&&fi.stbtt_setvertex(r[n++],3,p+_>>1,m+v>>1,p,m),p=_,m=v,C=!0):(C?fi.stbtt_setvertex(r[n++],3,_,v,p,m):fi.stbtt_setvertex(r[n++],2,_,v,0,0),C=!1);++J}n=fi.stbtt__close_shape(r,n,C,A,g,b,w,B,p,m)}else if(-1==i){var ee=1,te=s.sub(l+10,s.get_length()-(l+10)),ie=0;for(n=0,r=null;0!=ee;){var ae,se,re,ne,le=0,oe=null,he=null,ce=1,ue=0,de=0,fe=1,_e=0,ve=0,pe=te.readU8(ie),me=te.readU8(ie+1)|pe<<8;ae=0!=(32768&me)?me-65536:me,ie+=2;var ge=te.readU8(ie),be=te.readU8(ie+1)|ge<<8;if(se=0!=(32768&be)?be-65536:be,ie+=2,0==(2&ae))throw new Je("Error");if(0!=(1&ae)){var we=te.readU8(ie),Be=te.readU8(ie+1)|we<<8;_e=0!=(32768&Be)?Be-65536:Be,ie+=2;var ye=te.readU8(ie),xe=te.readU8(ie+1)|ye<<8;ve=0!=(32768&xe)?xe-65536:xe,ie+=2}else{var Ie=te.readU8(ie);_e=Ie>=128?Ie-256:Ie,++ie;var Se=te.readU8(ie);ve=Se>=128?Se-256:Se,++ie}if(0!=(8&ae)){var ke=te.readU8(ie),Ce=te.readU8(ie+1)|ke<<8;ce=fe=(0!=(32768&Ce)?Ce-65536:Ce)/16384,ie+=2,ue=de=0}else if(0!=(64&ae)){var Ae=te.readU8(ie),Me=te.readU8(ie+1)|Ae<<8;ce=(0!=(32768&Me)?Me-65536:Me)/16384,ie+=2,ue=de=0;var Ne=te.readU8(ie),Te=te.readU8(ie+1)|Ne<<8;fe=(0!=(32768&Te)?Te-65536:Te)/16384,ie+=2}else if(0!=(128&ae)){var Fe=te.readU8(ie),De=te.readU8(ie+1)|Fe<<8;ce=(0!=(32768&De)?De-65536:De)/16384,ie+=2;var Re=te.readU8(ie),Pe=te.readU8(ie+1)|Re<<8;ue=(0!=(32768&Pe)?Pe-65536:Pe)/16384,ie+=2;var Ee=te.readU8(ie),Ve=te.readU8(ie+1)|Ee<<8;de=(0!=(32768&Ve)?Ve-65536:Ve)/16384,ie+=2;var Le=te.readU8(ie),We=te.readU8(ie+1)|Le<<8;fe=(0!=(32768&We)?We-65536:We)/16384,ie+=2}if(re=Math.sqrt(ce*ce+ue*ue),ne=Math.sqrt(de*de+fe*fe),oe=fi.stbtt_GetGlyphShape(e,se),(le=null==oe?0:oe.length)>0){for(var Ge=0,Ze=le;Ge<Ze;){var Ue,ze,Oe=oe[Ge++];Ue=Oe.x,ze=Oe.y,Oe.x=re*(ce*Ue+de*ze+_e)|0,Oe.y=ne*(ue*Ue+fe*ze+ve)|0,Ue=Oe.cx,ze=Oe.cy,Oe.cx=re*(ce*Ue+de*ze+_e)|0,Oe.cy=ne*(ue*Ue+fe*ze+ve)|0}if(null==(he=new Array(n+le)))return null;n>0&&fi.copyVertices(r,he,0,n),fi.copyVertices(oe,he,n,le),r=he,n+=le}ee=32&ae}}else if(i<0)throw new Je("Error");if(null==r)return null;if(r.length<n)throw new Je("Error");if(n<r.length){var He=new Array(n);return fi.copyVertices(r,He,0,n),He}return r},fi.stbtt_GetGlyphHMetrics=function(e,t){var i=e.data,a=e.hhea+34,s=i.readU8(a),r=i.readU8(a+1)|s<<8,n=new si;if(t<r){var l=e.data,o=e.hmtx+4*t,h=l.readU8(o),c=l.readU8(o+1)|h<<8;n.advanceWidth=0!=(32768&c)?c-65536:c;var u=e.data,d=e.hmtx+4*t+2,f=u.readU8(d),_=u.readU8(d+1)|f<<8;n.leftSideBearing=0!=(32768&_)?_-65536:_}else{var v=e.data,p=e.hmtx+4*(r-1),m=v.readU8(p),g=v.readU8(p+1)|m<<8;n.advanceWidth=0!=(32768&g)?g-65536:g;var b=e.data,w=e.hmtx+4*r+2*(t-r),B=b.readU8(w),y=b.readU8(w+1)|B<<8;n.leftSideBearing=0!=(32768&y)?y-65536:y}return n},fi.stbtt_GetFontVMetrics=function(e){var t=new ri,i=e.data,a=e.hhea+4,s=i.readU8(a),r=i.readU8(a+1)|s<<8;t.ascent=0!=(32768&r)?r-65536:r;var n=e.data,l=e.hhea+6,o=n.readU8(l),h=n.readU8(l+1)|o<<8;t.descent=0!=(32768&h)?h-65536:h;var c=e.data,u=e.hhea+8,d=c.readU8(u),f=c.readU8(u+1)|d<<8;return t.lineGap=0!=(32768&f)?f-65536:f,t},fi.stbtt_ScaleForPixelHeight=function(e,t){var i=e.data,a=e.hhea+4,s=i.readU8(a),r=i.readU8(a+1)|s<<8,n=e.data,l=e.hhea+6,o=n.readU8(l),h=n.readU8(l+1)|o<<8;return t/((0!=(32768&r)?r-65536:r)-(0!=(32768&h)?h-65536:h))},fi.stbtt_GetGlyphBitmapBoxSubpixel=function(e,t,i,a,s,r){var n=new ai;if(fi.stbtt_GetGlyphBox(e,t,n)){var l=n.x0,o=n.x1,h=n.y0,c=n.y1;n.x0=Math.floor(l*i+s),n.y0=Math.floor(-c*a+r),n.x1=Math.ceil(o*i+s),n.y1=Math.ceil(-h*a+r)}else n.x0=0,n.y0=0,n.x1=0,n.y1=0;return n},fi.stbtt_GetGlyphBitmapBox=function(e,t,i,a){return fi.stbtt_GetGlyphBitmapBoxSubpixel(e,t,i,a,0,0)},fi.stbtt__new_active=function(e,t,i,a){var s=new ui,r=(e[t].x1-e[t].x0)/(e[t].y1-e[t].y0);return null==s?s:(s.fdx=r,s.fdy=0!=r?1/r:0,s.fx=e[t].x0+r*(a-e[t].y0),s.fx-=i,s.direction=e[t].invert?1:-1,s.sy=e[t].y0,s.ey=e[t].y1,s.next=null,s)},fi.stbtt__handle_clipped_edge=function(e,t,i,a,s,r,n,l){if(r!=l){if(!(r<l))throw new Je("Error");if(!(a.sy<=a.ey))throw new Je("Error");if(!(r>a.ey||l<a.sy)){if(r<a.sy&&(s+=(n-s)*(a.sy-r)/(l-r),r=a.sy),l>a.ey&&(n+=(n-s)*(a.ey-l)/(l-r),l=a.ey),s==i){if(!(n<=i+1))throw new Je("Error")}else if(s==i+1){if(!(n>=i))throw new Je("Error")}else if(s<=i){if(!(n<=i))throw new Je("Error")}else if(s>=i+1){if(!(n>=i+1))throw new Je("Error")}else if(!(n>=i&&n<=i+1))throw new Je("Error");if(s<=i&&n<=i){var o=t+i,h=e;h[o]=h[o]+a.direction*(l-r)}else if(!(s>=i+1&&n>=i+1)){if(!(s>=i&&s<=i+1&&n>=i&&n<=i+1))throw new Je("Error");var c=t+i,u=e;u[c]=u[c]+a.direction*(l-r)*(1-(s-i+(n-i))/2)}}}},fi.stbtt__fill_active_edges_new=function(e,t,i,a,s,r){for(var n=r+1;null!=s;){if(!(s.ey>=r))throw new Je("Error");if(0==s.fdx){var l=s.fx;l<a&&(l>=0?(fi.stbtt__handle_clipped_edge(e,0,0|l,s,l,r,l,n),fi.stbtt__handle_clipped_edge(t,i-1,l+1|0,s,l,r,l,n)):fi.stbtt__handle_clipped_edge(t,i-1,0,s,l,r,l,n))}else{var o,h,c,u,d=s.fx,f=s.fdx,_=d+f,v=s.fdy;if(!(s.sy<=n&&s.ey>=r))throw new Je("Error");if(s.sy>r?(o=d+f*(s.sy-r),c=s.sy):(o=d,c=r),s.ey<n?(h=d+f*(s.ey-r),u=s.ey):(h=_,u=n),o>=0&&h>=0&&o<a&&h<a)if((0|o)==(0|h)){var p,m=0|o;if(p=u-c,!(m>=0&&m<a))throw new Je("Error");var g=m,b=e;b[g]=b[g]+s.direction*(1-(o-m+(h-m))/2)*p;var w=i+m,B=t;B[w]=B[w]+s.direction*p}else{var y,x,I,S,k,C;if(o>h){var A;A=c=n-(c-r),c=u=n-(u-r),u=A,A=h,h=o,o=A,f=-f,v=-v,A=d,d=_,_=A}x=0|h,I=((y=0|o)+1-d)*v+r,C=(k=s.direction)*(I-c);var M=y,N=e;N[M]=N[M]+C*(1-(o-y+(y+1-y))/2),S=k*v;for(var T=y+1,F=x;T<F;){var D=T++,R=e;R[D]=R[D]+(C+S/2),C+=S}if(I+=v*(x-(y+1)),!(Math.abs(C)<=1.01))throw new Je("Error");var P=x,E=e;E[P]=E[P]+(C+k*(1-(x-x+(h-x))/2)*(u-I));var V=i+x,L=t;L[V]=L[V]+k*(u-c)}else for(var W=0,G=a;W<G;){var Z,U,z=W++,O=r,H=z,j=z+1,X=_,Y=n;Z=(z-d)/f+r,U=(z+1-d)/f+r,d<H&&X>j?(fi.stbtt__handle_clipped_edge(e,0,z,s,d,O,H,Z),fi.stbtt__handle_clipped_edge(e,0,z,s,H,Z,j,U),fi.stbtt__handle_clipped_edge(e,0,z,s,j,U,X,Y)):X<H&&d>j?(fi.stbtt__handle_clipped_edge(e,0,z,s,d,O,j,U),fi.stbtt__handle_clipped_edge(e,0,z,s,j,U,H,Z),fi.stbtt__handle_clipped_edge(e,0,z,s,H,Z,X,Y)):d<H&&X>H?(fi.stbtt__handle_clipped_edge(e,0,z,s,d,O,H,Z),fi.stbtt__handle_clipped_edge(e,0,z,s,H,Z,X,Y)):X<H&&d>H?(fi.stbtt__handle_clipped_edge(e,0,z,s,d,O,H,Z),fi.stbtt__handle_clipped_edge(e,0,z,s,H,Z,X,Y)):d<j&&X>j?(fi.stbtt__handle_clipped_edge(e,0,z,s,d,O,j,U),fi.stbtt__handle_clipped_edge(e,0,z,s,j,U,X,Y)):X<j&&d>j?(fi.stbtt__handle_clipped_edge(e,0,z,s,d,O,j,U),fi.stbtt__handle_clipped_edge(e,0,z,s,j,U,X,Y)):fi.stbtt__handle_clipped_edge(e,0,z,s,d,O,X,Y)}}s=s.next}},fi.stbtt__rasterize_sorted_edges=function(e,t,i,a,s,r){var n,l,o,h=null,c=0,u=0,d=0;if(e.w>64){var f=2*e.w+1;l=new Array(f)}else l=new Array(129);for(o=l,u=e.w,n=r,t[d+i].y0=r+e.h+1;c<e.h;){var _,v,p=n+0,m=n+1;_=h,v=null;for(var g=0,b=e.w;g<b;)l[g++]=0;for(var w=0,B=e.w+1;w<B;)o[u+w++]=0;for(;null!=_;){var y=_;if(y.ey<=p){if(null==v?(h=y.next,_=y.next):(v.next=y.next,_=y.next),0==y.direction)throw new Je("Error");y.direction=0}else v=_,_=_.next}for(;t[d].y0<=m;){if(t[d].y0!=t[d].y1){var x=fi.stbtt__new_active(t,d,s,p);if(!(x.ey>=p))throw new Je("Error");x.next=h,h=x}++d}null!=h&&fi.stbtt__fill_active_edges_new(l,o,u+1,e.w,h,p);for(var I=0,S=0,k=e.w;S<k;){var C,A,M=S++;I+=o[u+M],C=l[M]+I,(A=0|(C=255*Math.abs(C)+.5))>255&&(A=255),e.pixels.writeU8(e.pixels_offset+c*e.stride+M,A)}for(v=null,_=h;null!=_;){var N=_;N.fx+=N.fdx,v=_,_=_.next}++n,++c}},fi.STBTT__COMPARE=function(e,t){return e.y0<t.y0},fi.stbtt__sort_edges_ins_sort=function(e,t){for(var i,a=1,s=t;a<s;){var r=a++,n=e[r],l=n;for(i=r;i>0;){var o=e[i-1];if(!fi.STBTT__COMPARE(l,o))break;e[i]=e[i-1],--i}r!=i&&(e[i]=n)}},fi.stbtt__sort_edges_quicksort=function(e,t,i){for(;i>12;){var a,s,r,n,l,o;if(n=i>>1,s=fi.STBTT__COMPARE(e[t],e[t+n]),r=fi.STBTT__COMPARE(e[t+n],e[t+i-1]),s!=r){var h;a=e[t+(h=fi.STBTT__COMPARE(e[t],e[t+i-1])==r?0:i-1)],e[t+h]=e[t+n],e[t+n]=a}for(a=e[t],e[t]=e[t+n],e[t+n]=a,l=1,o=i-1;;){for(;fi.STBTT__COMPARE(e[t+l],e[t]);)++l;for(;fi.STBTT__COMPARE(e[t],e[t+o]);)--o;if(l>=o)break;a=e[t+l],e[t+l]=e[t+o],e[t+o]=a,++l,--o}o<i-l?(fi.stbtt__sort_edges_quicksort(e,t,o),t+=l,i-=l):(fi.stbtt__sort_edges_quicksort(e,t+l,i-l),i=o)}},fi.stbtt__sort_edges=function(e,t){fi.stbtt__sort_edges_quicksort(e,0,t),fi.stbtt__sort_edges_ins_sort(e,t)},fi.stbtt__rasterize=function(e,t,i,a,s,r,n,l,o,h,c){var u,d,f,_,v=c?-r:r;d=0;for(var p=0,m=a;p<m;)d+=i[p++];if(null!=(u=new Array(d+1))){for(var g=0,b=u.length;g<b;)u[g++]=new ci;d=0,_=0;for(var w=0,B=a;w<B;){var y=w++,x=t,I=0+_;_+=i[y],f=i[y]-1;for(var S=0,k=i[y];S<k;){var C=S++,A=C,M=f;x[I+f].y!=x[I+C].y?(u[d].invert=!1,(c?x[I+f].y>x[I+C].y:x[I+f].y<x[I+C].y)&&(u[d].invert=!0,A=f,M=C),u[d].x0=x[I+A].x*s+n,u[d].y0=1*(x[I+A].y*v+l),u[d].x1=x[I+M].x*s+n,u[d].y1=1*(x[I+M].y*v+l),++d,f=C):f=C}}fi.stbtt__sort_edges(u,d),fi.stbtt__rasterize_sorted_edges(e,u,d,1,o,h)}},fi.stbtt__add_point=function(e,t,i,a){null!=e&&(e[t].x=i,e[t].y=a)},fi.stbtt__tesselate_curve=function(e,t,i,a,s,r,n,l,o,h){var c=(i+2*s+n)/4,u=(a+2*r+l)/4,d=(i+n)/2-c,f=(a+l)/2-u;return h>16?1:(d*d+f*f>o?(fi.stbtt__tesselate_curve(e,t,i,a,(i+s)/2,(a+r)/2,c,u,o,h+1),fi.stbtt__tesselate_curve(e,t,c,u,(s+n)/2,(r+l)/2,n,l,o,h+1)):(fi.stbtt__add_point(e,t.value,n,l),t.value+=1),1)},fi.stbtt_FlattenCurves=function(e,t,i,a,s){for(var r=null,n=0,l=i*i,o=0,h=0,c=0,u=t;c<u;)1==e[c++].type&&++o;if(s.value=o,0==o)return null;var d=new Array(o);if(a.value=d,null==a.value)return s.value=0,null;for(var f=0;f<2;){var _=0,v=0;if(1==f++){if(null==(r=new Array(n)))return a.value=null,s.value=0,null;for(var p=0,m=r.length;p<m;)r[p++]=new di}n=0,o=-1;for(var g=0,b=t;g<b;){var w=g++;switch(e[w].type){case 1:o>=0&&(a.value[o]=n-h),++o,h=n,_=e[w].x,v=e[w].y,fi.stbtt__add_point(r,n++,_,v);break;case 2:_=e[w].x,v=e[w].y,fi.stbtt__add_point(r,n++,_,v);break;case 3:var B={value:n};fi.stbtt__tesselate_curve(r,B,_,v,e[w].cx,e[w].cy,e[w].x,e[w].y,l,0),n=B.value,_=e[w].x,v=e[w].y}}a.value[o]=n-h}return r},fi.stbtt_Rasterize=function(e,t,i,a,s,r,n,l,o,h,c){var u=s>r?r:s,d=0,f=null,_={value:d},v=new ii,p=fi.stbtt_FlattenCurves(i,a,t/u,v,_);d=_.value,f=v.value,null!=p&&fi.stbtt__rasterize(e,p,f,d,s,r,n,l,o,h,c)},fi.stbtt_MakeGlyphBitmapSubpixel=function(e,t,i,a,s,r,n,l,o,h,c){var u=0,d=0,f=fi.stbtt_GetGlyphShape(e,c),_=null==f?0:f.length,v=new hi,p=fi.stbtt_GetGlyphBitmapBoxSubpixel(e,c,n,l,o,h);u=p.x0,d=p.y0,v.pixels=t,v.pixels_offset=i,v.w=a,v.h=s,v.stride=r,0!=v.w&&0!=v.h&&fi.stbtt_Rasterize(v,.35,f,_,n,l,o,h,u,d,!0)},fi.stbtt_MakeGlyphBitmap=function(e,t,i,a,s,r,n,l,o){fi.stbtt_MakeGlyphBitmapSubpixel(e,t,i,a,s,r,n,l,0,0,o)},fi.stbtt_BakeFontBitmap=function(e,t,i,a,s,r,n,l){var o,h,c,u,d=new li;if(!fi.stbtt_InitFont(d,e,t))return-1;for(var f=0,_=s*r;f<_;){var v=f++;a.writeU8(v,0)}h=c=1,u=1,o=fi.stbtt_ScaleForPixelHeight(d,i);for(var p=0,m=0;m<n.length;){var g=n[m];++m;var b,w,B,y,x,I,S,k=fi.stbtt_FindGlyphIndex(d,g),C=fi.stbtt_GetGlyphHMetrics(d,k);b=C.advanceWidth,C.leftSideBearing;var A=fi.stbtt_GetGlyphBitmapBox(d,k,o,o);if(w=A.x0,B=A.y0,y=A.x1,x=A.y1,I=y-w,S=x-B,h+I+1>=s&&(c=u,h=1),c+S+1>=r)return-p;if(h+I>=s)throw new Je("Error");if(c+S>=r)throw new Je("Error");fi.stbtt_MakeGlyphBitmap(d,a,h+c*s,I,S,s,o,o,k),l[p].x0=h,l[p].y0=c,l[p].x1=h+I,l[p].y1=c+S,l[p].xadvance=o*b,l[p].xoff=w,l[p].yoff=B,h=h+I+1,c+S+1>u&&(u=c+S+1),++p}return u};var _i=s["kha.graphics4.BlendingFactor"]={__ename__:!0,__constructs__:["Undefined","BlendOne","BlendZero","SourceAlpha","DestinationAlpha","InverseSourceAlpha","InverseDestinationAlpha","SourceColor","DestinationColor","InverseSourceColor","InverseDestinationColor"]};_i.Undefined=["Undefined",0],_i.Undefined.toString=r,_i.Undefined.__enum__=_i,_i.BlendOne=["BlendOne",1],_i.BlendOne.toString=r,_i.BlendOne.__enum__=_i,_i.BlendZero=["BlendZero",2],_i.BlendZero.toString=r,_i.BlendZero.__enum__=_i,_i.SourceAlpha=["SourceAlpha",3],_i.SourceAlpha.toString=r,_i.SourceAlpha.__enum__=_i,_i.DestinationAlpha=["DestinationAlpha",4],_i.DestinationAlpha.toString=r,_i.DestinationAlpha.__enum__=_i,_i.InverseSourceAlpha=["InverseSourceAlpha",5],_i.InverseSourceAlpha.toString=r,_i.InverseSourceAlpha.__enum__=_i,_i.InverseDestinationAlpha=["InverseDestinationAlpha",6],_i.InverseDestinationAlpha.toString=r,_i.InverseDestinationAlpha.__enum__=_i,_i.SourceColor=["SourceColor",7],_i.SourceColor.toString=r,_i.SourceColor.__enum__=_i,_i.DestinationColor=["DestinationColor",8],_i.DestinationColor.toString=r,_i.DestinationColor.__enum__=_i,_i.InverseSourceColor=["InverseSourceColor",9],_i.InverseSourceColor.toString=r,_i.InverseSourceColor.__enum__=_i,_i.InverseDestinationColor=["InverseDestinationColor",10],_i.InverseDestinationColor.toString=r,_i.InverseDestinationColor.__enum__=_i;var vi=s["kha.graphics4.BlendingOperation"]={__ename__:!0,__constructs__:["Add","Subtract","ReverseSubtract","Min","Max"]};vi.Add=["Add",0],vi.Add.toString=r,vi.Add.__enum__=vi,vi.Subtract=["Subtract",1],vi.Subtract.toString=r,vi.Subtract.__enum__=vi,vi.ReverseSubtract=["ReverseSubtract",2],vi.ReverseSubtract.toString=r,vi.ReverseSubtract.__enum__=vi,vi.Min=["Min",3],vi.Min.toString=r,vi.Min.__enum__=vi,vi.Max=["Max",4],vi.Max.toString=r,vi.Max.__enum__=vi;var pi=s["kha.graphics4.CompareMode"]={__ename__:!0,__constructs__:["Always","Never","Equal","NotEqual","Less","LessEqual","Greater","GreaterEqual"]};pi.Always=["Always",0],pi.Always.toString=r,pi.Always.__enum__=pi,pi.Never=["Never",1],pi.Never.toString=r,pi.Never.__enum__=pi,pi.Equal=["Equal",2],pi.Equal.toString=r,pi.Equal.__enum__=pi,pi.NotEqual=["NotEqual",3],pi.NotEqual.toString=r,pi.NotEqual.__enum__=pi,pi.Less=["Less",4],pi.Less.toString=r,pi.Less.__enum__=pi,pi.LessEqual=["LessEqual",5],pi.LessEqual.toString=r,pi.LessEqual.__enum__=pi,pi.Greater=["Greater",6],pi.Greater.toString=r,pi.Greater.__enum__=pi,pi.GreaterEqual=["GreaterEqual",7],pi.GreaterEqual.toString=r,pi.GreaterEqual.__enum__=pi;var mi=function(){};s["kha.graphics4.ConstantLocation"]=mi,mi.__name__=!0;var gi=function(e,t,i,a){this.isDepthAttachment=!1,this.depthTexture=null,this.texture=null,this.frameBuffer=null,this.myWidth=e,this.myHeight=e,this.format=t,this.renderTarget=i,this.depthStencilFormat=a,i&&this.createTexture()};s["kha.graphics4.CubeMap"]=gi,gi.__name__=!0,gi.__interfaces__=[st,at],gi.createRenderTarget=function(e,t,i,a){return null==a&&(a=0),null==t&&(t=Ei.RGBA32),null==i&&(i=0),new gi(e,t,!0,i)},gi.prototype={createTexture:function(){if(null!=xt.gl){if(this.texture=xt.gl.createTexture(),xt.gl.bindTexture(34067,this.texture),xt.gl.texParameteri(34067,10240,9729),xt.gl.texParameteri(34067,10241,9729),xt.gl.texParameteri(34067,10242,33071),xt.gl.texParameteri(34067,10243,33071),this.renderTarget){switch(this.frameBuffer=xt.gl.createFramebuffer(),xt.gl.bindFramebuffer(36160,this.frameBuffer),this.format[1]){case 0:for(var e=0;e<6;){var t=e++;xt.gl.texImage2D(34069+t,0,6408,this.myWidth,this.myHeight,0,6408,5121,null)}break;case 2:for(var i=0;i<6;){var a=i++;xt.gl.texImage2D(34069+a,0,xt.gl2?34836:6408,this.myWidth,this.myHeight,0,6408,5126,null)}break;case 3:for(var s=0;s<6;){var r=s++;xt.gl.texImage2D(34069+r,0,xt.gl2?33189:6402,this.myWidth,this.myHeight,0,6402,5123,null)}break;case 4:for(var n=0;n<6;){var l=n++;xt.gl.texImage2D(34069+l,0,xt.gl2?34842:6408,this.myWidth,this.myHeight,0,6408,xt.halfFloat.HALF_FLOAT_OES,null)}break;case 5:for(var o=0;o<6;){var h=o++;xt.gl.texImage2D(34069+h,0,xt.gl2?33326:6406,this.myWidth,this.myHeight,0,6406,5126,null)}break;case 6:for(var c=0;c<6;){var u=c++;xt.gl.texImage2D(34069+u,0,xt.gl2?33325:6406,this.myWidth,this.myHeight,0,6406,xt.halfFloat.HALF_FLOAT_OES,null)}break;default:for(var d=0;d<6;){var f=d++;xt.gl.texImage2D(34069+f,0,6408,this.myWidth,this.myHeight,0,6408,5121,null)}}if(this.format==Ei.DEPTH16&&(xt.gl.texParameteri(34067,10240,9728),xt.gl.texParameteri(34067,10241,9728),this.isDepthAttachment=!0,-1==navigator.appVersion.indexOf("Win"))){var _=xt.gl.createTexture();xt.gl.bindTexture(34067,_);for(var v=0;v<6;){var p=v++;xt.gl.texImage2D(34069+p,0,6408,this.myWidth,this.myHeight,0,6408,5121,null),xt.gl.framebufferTexture2D(36160,36064,34069+p,_,0)}xt.gl.bindTexture(34067,this.texture)}this.initDepthStencilBuffer(this.depthStencilFormat),xt.gl.bindFramebuffer(36160,null)}xt.gl.bindTexture(34067,null)}},initDepthStencilBuffer:function(e){switch(e){case 0:break;case 1:case 5:this.depthTexture=xt.gl.createTexture(),xt.gl.bindTexture(34067,this.depthTexture),1==e?xt.gl.texImage2D(34067,0,xt.gl2?33190:6402,this.myWidth,this.myHeight,0,6402,5125,null):xt.gl.texImage2D(34067,0,xt.gl2?33189:6402,this.myWidth,this.myHeight,0,6402,5123,null),xt.gl.texParameteri(34067,10240,9728),xt.gl.texParameteri(34067,10241,9728),xt.gl.texParameteri(34067,10242,33071),xt.gl.texParameteri(34067,10243,33071),xt.gl.bindFramebuffer(36160,this.frameBuffer),xt.gl.framebufferTexture2D(36160,36096,34067,this.depthTexture,0);break;case 2:case 3:case 4:this.depthTexture=xt.gl.createTexture(),xt.gl.bindTexture(34067,this.depthTexture),xt.gl.texImage2D(34067,0,xt.gl2?35056:34041,this.myWidth,this.myHeight,0,34041,xt.depthTexture.UNSIGNED_INT_24_8_WEBGL,null),xt.gl.texParameteri(34067,10240,9728),xt.gl.texParameteri(34067,10241,9728),xt.gl.texParameteri(34067,10242,33071),xt.gl.texParameteri(34067,10243,33071),xt.gl.bindFramebuffer(36160,this.frameBuffer),xt.gl.framebufferTexture2D(36160,33306,34067,this.depthTexture,0)}},set:function(e){xt.gl.activeTexture(33984+e),xt.gl.bindTexture(34067,this.texture)},setDepth:function(e){xt.gl.activeTexture(33984+e),xt.gl.bindTexture(34067,this.depthTexture)},get_width:function(){return this.myWidth},get_height:function(){return this.myHeight},get_g4:function(){return null==this.graphics4&&(this.graphics4=new ha(this)),this.graphics4},__class__:gi,__properties__:{get_g4:"get_g4",get_height:"get_height",get_width:"get_width"}};var bi=s["kha.graphics4.CullMode"]={__ename__:!0,__constructs__:["Clockwise","CounterClockwise","None"]};bi.Clockwise=["Clockwise",0],bi.Clockwise.toString=r,bi.Clockwise.__enum__=bi,bi.CounterClockwise=["CounterClockwise",1],bi.CounterClockwise.toString=r,bi.CounterClockwise.__enum__=bi,bi.None=["None",2],bi.None.toString=r,bi.None.__enum__=bi;var wi=function(e,t){this.sources=[];for(var i=0;i<e.length;){var a=e[i];++i,this.sources.push(a.toString())}this.type=35632,this.shader=null,this.files=t};s["kha.graphics4.FragmentShader"]=wi,wi.__name__=!0,wi.fromSource=function(e){var t=new wi([],["runtime-string"]);return t.sources.push(e),t},wi.prototype={__class__:wi};var Bi=function(){};s["kha.graphics4.GeometryShader"]=Bi,Bi.__name__=!0;var yi=function(){};s["kha.graphics4.Graphics"]=yi,yi.__name__=!0,yi.prototype={__class__:yi};var xi=function(e){this.myPipeline=null,this.bilinearMipmaps=!1,this.bilinear=!1,this.g=e,this.bufferIndex=0,xi.initShaders(),this.initBuffers(),this.projectionLocation=xi.shaderPipeline.getConstantLocation("projectionMatrix"),this.textureLocation=xi.shaderPipeline.getTextureUnit("tex")};s["kha.graphics4.ImageShaderPainter"]=xi,xi.__name__=!0,xi.initShaders=function(){null==xi.shaderPipeline&&(xi.shaderPipeline=new Ni,xi.shaderPipeline.fragmentShader=bt.painter_image_frag,xi.shaderPipeline.vertexShader=bt.painter_image_vert,xi.structure=new zi,xi.structure.add("vertexPosition",Gi.Float3),xi.structure.add("texPosition",Gi.Float2),xi.structure.add("vertexColor",Gi.Float4),xi.shaderPipeline.inputLayout=[xi.structure],xi.shaderPipeline.blendSource=_i.BlendOne,xi.shaderPipeline.blendDestination=_i.InverseSourceAlpha,xi.shaderPipeline.alphaBlendSource=_i.SourceAlpha,xi.shaderPipeline.alphaBlendDestination=_i.InverseSourceAlpha,xi.shaderPipeline.compile())},xi.prototype={get_pipeline:function(){return this.myPipeline},setProjection:function(e){this.projectionMatrix=e},initBuffers:function(){this.rectVertexBuffer=new Wi(4*xi.bufferSize,xi.structure,Li.DynamicUsage),this.rectVertices=this.rectVertexBuffer.lock(),this.indexBuffer=new Ci(3*xi.bufferSize*2,Li.StaticUsage);for(var e=this.indexBuffer.lock(),t=0,i=xi.bufferSize;t<i;){var a=t++;e[3*a*2]=4*a,e[3*a*2+1]=4*a+1,e[3*a*2+2]=4*a+2,e[3*a*2+3]=4*a,e[3*a*2+4]=4*a+2,e[3*a*2+5]=4*a+3}this.indexBuffer.unlock()},drawBuffer:function(){this.rectVertexBuffer.unlock(),this.g.setVertexBuffer(this.rectVertexBuffer),this.g.setIndexBuffer(this.indexBuffer),this.g.setPipeline(null==this.get_pipeline()?xi.shaderPipeline:this.get_pipeline()),this.g.setTexture(this.textureLocation,this.lastTexture),this.g.setTextureParameters(this.textureLocation,Ri.Clamp,Ri.Clamp,this.bilinear?Pi.LinearFilter:Pi.PointFilter,this.bilinear?Pi.LinearFilter:Pi.PointFilter,this.bilinearMipmaps?Ai.LinearMipFilter:Ai.NoMipFilter),this.g.setMatrix(this.projectionLocation,this.projectionMatrix),this.g.drawIndexedVertices(0,2*this.bufferIndex*3),this.g.setTexture(this.textureLocation,null),this.bufferIndex=0,this.rectVertices=this.rectVertexBuffer.lock()},end:function(){this.bufferIndex>0&&this.drawBuffer(),this.lastTexture=null},__class__:xi,__properties__:{get_pipeline:"get_pipeline"}};var Ii=function(e){this.myPipeline=null,this.g=e,this.bufferIndex=0,this.triangleBufferIndex=0,Ii.initShaders(),this.initBuffers(),this.projectionLocation=Ii.shaderPipeline.getConstantLocation("projectionMatrix")};s["kha.graphics4.ColoredShaderPainter"]=Ii,Ii.__name__=!0,Ii.initShaders=function(){null==Ii.shaderPipeline&&(Ii.shaderPipeline=new Ni,Ii.shaderPipeline.fragmentShader=bt.painter_colored_frag,Ii.shaderPipeline.vertexShader=bt.painter_colored_vert,Ii.structure=new zi,Ii.structure.add("vertexPosition",Gi.Float3),Ii.structure.add("vertexColor",Gi.Float4),Ii.shaderPipeline.inputLayout=[Ii.structure],Ii.shaderPipeline.blendSource=_i.SourceAlpha,Ii.shaderPipeline.blendDestination=_i.InverseSourceAlpha,Ii.shaderPipeline.alphaBlendSource=_i.SourceAlpha,Ii.shaderPipeline.alphaBlendDestination=_i.InverseSourceAlpha,Ii.shaderPipeline.compile())},Ii.prototype={get_pipeline:function(){return this.myPipeline},setProjection:function(e){this.projectionMatrix=e},initBuffers:function(){this.rectVertexBuffer=new Wi(4*Ii.bufferSize,Ii.structure,Li.DynamicUsage),this.rectVertices=this.rectVertexBuffer.lock(),this.indexBuffer=new Ci(3*Ii.bufferSize*2,Li.StaticUsage);for(var e=this.indexBuffer.lock(),t=0,i=Ii.bufferSize;t<i;){var a=t++;e[3*a*2]=4*a,e[3*a*2+1]=4*a+1,e[3*a*2+2]=4*a+2,e[3*a*2+3]=4*a,e[3*a*2+4]=4*a+2,e[3*a*2+5]=4*a+3}this.indexBuffer.unlock(),this.triangleVertexBuffer=new Wi(3*Ii.triangleBufferSize,Ii.structure,Li.DynamicUsage),this.triangleVertices=this.triangleVertexBuffer.lock(),this.triangleIndexBuffer=new Ci(3*Ii.triangleBufferSize,Li.StaticUsage);for(var s=this.triangleIndexBuffer.lock(),r=0,n=Ii.bufferSize;r<n;){var l=r++;s[3*l]=3*l,s[3*l+1]=3*l+1,s[3*l+2]=3*l+2}this.triangleIndexBuffer.unlock()},setRectVertices:function(e,t,i,a,s,r,n,l){var o=7*this.bufferIndex*4;this.rectVertices[o]=e,this.rectVertices[o+1]=t,this.rectVertices[o+2]=-5,this.rectVertices[o+7]=i,this.rectVertices[o+8]=a,this.rectVertices[o+9]=-5,this.rectVertices[o+14]=s,this.rectVertices[o+15]=r,this.rectVertices[o+16]=-5,this.rectVertices[o+21]=n,this.rectVertices[o+22]=l,this.rectVertices[o+23]=-5},setRectColors:function(e,t){var i=7*this.bufferIndex*4,a=e*(.00392156862745098*(t>>>24));this.rectVertices[i+3]=.00392156862745098*((16711680&t)>>>16),this.rectVertices[i+4]=.00392156862745098*((65280&t)>>>8),this.rectVertices[i+5]=.00392156862745098*(255&t),this.rectVertices[i+6]=a,this.rectVertices[i+10]=.00392156862745098*((16711680&t)>>>16),this.rectVertices[i+11]=.00392156862745098*((65280&t)>>>8),this.rectVertices[i+12]=.00392156862745098*(255&t),this.rectVertices[i+13]=a,this.rectVertices[i+17]=.00392156862745098*((16711680&t)>>>16),this.rectVertices[i+18]=.00392156862745098*((65280&t)>>>8),this.rectVertices[i+19]=.00392156862745098*(255&t),this.rectVertices[i+20]=a,this.rectVertices[i+24]=.00392156862745098*((16711680&t)>>>16),this.rectVertices[i+25]=.00392156862745098*((65280&t)>>>8),this.rectVertices[i+26]=.00392156862745098*(255&t),this.rectVertices[i+27]=a},drawBuffer:function(e){e||this.triangleBufferIndex>0&&this.drawTriBuffer(!0),this.rectVertexBuffer.unlock(),this.g.setVertexBuffer(this.rectVertexBuffer),this.g.setIndexBuffer(this.indexBuffer),this.g.setPipeline(null==this.get_pipeline()?Ii.shaderPipeline:this.get_pipeline()),this.g.setMatrix(this.projectionLocation,this.projectionMatrix),this.g.drawIndexedVertices(0,2*this.bufferIndex*3),this.bufferIndex=0,this.rectVertices=this.rectVertexBuffer.lock()},drawTriBuffer:function(e){e||this.bufferIndex>0&&this.drawBuffer(!0),this.triangleVertexBuffer.unlock(),this.g.setVertexBuffer(this.triangleVertexBuffer),this.g.setIndexBuffer(this.triangleIndexBuffer),this.g.setPipeline(null==this.get_pipeline()?Ii.shaderPipeline:this.get_pipeline()),this.g.setMatrix(this.projectionLocation,this.projectionMatrix),this.g.drawIndexedVertices(0,3*this.triangleBufferIndex),this.triangleBufferIndex=0,this.triangleVertices=this.triangleVertexBuffer.lock()},fillRect:function(e,t,i,a,s,r,n,l,o,h){this.triangleBufferIndex>0&&this.drawTriBuffer(!0),this.bufferIndex+1>=Ii.bufferSize&&this.drawBuffer(!1),this.setRectColors(e,t),this.setRectVertices(i,a,s,r,n,l,o,h),++this.bufferIndex},__class__:Ii,__properties__:{get_pipeline:"get_pipeline"}};var Si=function(e){this.bilinear=!1,this.myPipeline=null,this.g=e,this.bufferIndex=0,Si.initShaders(),this.initBuffers(),this.projectionLocation=Si.shaderPipeline.getConstantLocation("projectionMatrix"),this.textureLocation=Si.shaderPipeline.getTextureUnit("tex")};s["kha.graphics4.TextShaderPainter"]=Si,Si.__name__=!0,Si.initShaders=function(){null==Si.shaderPipeline&&(Si.shaderPipeline=new Ni,Si.shaderPipeline.fragmentShader=bt.painter_text_frag,Si.shaderPipeline.vertexShader=bt.painter_text_vert,Si.structure=new zi,Si.structure.add("vertexPosition",Gi.Float3),Si.structure.add("texPosition",Gi.Float2),Si.structure.add("vertexColor",Gi.Float4),Si.shaderPipeline.inputLayout=[Si.structure],Si.shaderPipeline.blendSource=_i.SourceAlpha,Si.shaderPipeline.blendDestination=_i.InverseSourceAlpha,Si.shaderPipeline.alphaBlendSource=_i.SourceAlpha,Si.shaderPipeline.alphaBlendDestination=_i.InverseSourceAlpha,Si.shaderPipeline.compile())},Si.prototype={get_pipeline:function(){return this.myPipeline},setProjection:function(e){this.projectionMatrix=e},initBuffers:function(){this.rectVertexBuffer=new Wi(4*Si.bufferSize,Si.structure,Li.DynamicUsage),this.rectVertices=this.rectVertexBuffer.lock(),this.indexBuffer=new Ci(3*Si.bufferSize*2,Li.StaticUsage);for(var e=this.indexBuffer.lock(),t=0,i=Si.bufferSize;t<i;){var a=t++;e[3*a*2]=4*a,e[3*a*2+1]=4*a+1,e[3*a*2+2]=4*a+2,e[3*a*2+3]=4*a,e[3*a*2+4]=4*a+2,e[3*a*2+5]=4*a+3}this.indexBuffer.unlock()},drawBuffer:function(){this.rectVertexBuffer.unlock(),this.g.setVertexBuffer(this.rectVertexBuffer),this.g.setIndexBuffer(this.indexBuffer),this.g.setPipeline(null==this.get_pipeline()?Si.shaderPipeline:this.get_pipeline()),this.g.setTexture(this.textureLocation,this.lastTexture),this.g.setMatrix(this.projectionLocation,this.projectionMatrix),this.g.setTextureParameters(this.textureLocation,Ri.Clamp,Ri.Clamp,this.bilinear?Pi.LinearFilter:Pi.PointFilter,this.bilinear?Pi.LinearFilter:Pi.PointFilter,Ai.NoMipFilter),this.g.drawIndexedVertices(0,2*this.bufferIndex*3),this.g.setTexture(this.textureLocation,null),this.bufferIndex=0,this.rectVertices=this.rectVertexBuffer.lock()},end:function(){this.bufferIndex>0&&this.drawBuffer(),this.lastTexture=null},__class__:Si,__properties__:{get_pipeline:"get_pipeline"}};var ki=function(e){if($t.call(this),this.set_color(-1),this.canvas=e,this.g=e.get_g4(),this.imagePainter=new xi(this.g),this.coloredPainter=new Ii(this.g),this.textPainter=new Si(this.g),this.textPainter.fontSize=this.get_fontSize(),this.setProjection(),null==ki.videoPipeline){ki.videoPipeline=new Ni,ki.videoPipeline.fragmentShader=bt.painter_video_frag,ki.videoPipeline.vertexShader=bt.painter_video_vert;var t=new zi;t.add("vertexPosition",Gi.Float3),t.add("texPosition",Gi.Float2),t.add("vertexColor",Gi.Float4),ki.videoPipeline.inputLayout=[t],ki.videoPipeline.compile()}};s["kha.graphics4.Graphics2"]=ki,ki.__name__=!0,ki.upperPowerOfTwo=function(e){return--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,++e},ki.__super__=$t,ki.prototype=i($t.prototype,{setProjection:function(){var e=this.canvas.get_width(),t=this.canvas.get_height();qe.__instanceof(this.canvas,ut)?this.projectionMatrix=$.orthogonalProjection(0,e,t,0,.1,1e3):(rt.get_nonPow2Supported()||(e=ki.upperPowerOfTwo(e),t=ki.upperPowerOfTwo(t)),this.g.renderTargetsInvertedY()?this.projectionMatrix=$.orthogonalProjection(0,e,0,t,.1,1e3):this.projectionMatrix=$.orthogonalProjection(0,e,t,0,.1,1e3)),this.imagePainter.setProjection(this.projectionMatrix),this.coloredPainter.setProjection(this.projectionMatrix),this.textPainter.setProjection(this.projectionMatrix)},get_color:function(){return this.myColor},set_color:function(e){return this.myColor=e},fillRect:function(e,t,i,a){this.imagePainter.end(),this.textPainter.end();var s,r,n,l=this.transformations[this.transformations.length-1],o=e;n=t+a;var h=l._02*o+l._12*n+l._22;r=(l._00*o+l._10*n+l._20)/h,s=(l._01*o+l._11*n+l._21)/h;var c,u,d,f=this.transformations[this.transformations.length-1],_=e;d=t;var v=f._02*_+f._12*d+f._22;u=(f._00*_+f._10*d+f._20)/v,c=(f._01*_+f._11*d+f._21)/v;var p,m,g,b=this.transformations[this.transformations.length-1],w=e+i;g=t;var B=b._02*w+b._12*g+b._22;m=(b._00*w+b._10*g+b._20)/B,p=(b._01*w+b._11*g+b._21)/B;var y,x,I,S=this.transformations[this.transformations.length-1],k=e+i;I=t+a;var C=S._02*k+S._12*I+S._22;x=(S._00*k+S._10*I+S._20)/C,y=(S._01*k+S._11*I+S._21)/C,this.coloredPainter.fillRect(this.get_opacity(),this.get_color(),r,s,u,c,m,p,x,y)},begin:function(e,t){null==e&&(e=!0),this.g.begin(),e&&this.clear(t),this.setProjection()},clear:function(e){this.flush(),this.g.clear(null==e?-16777216:e)},flush:function(){this.imagePainter.end(),this.textPainter.end();var e=this.coloredPainter;e.triangleBufferIndex>0&&e.drawTriBuffer(!1),e.bufferIndex>0&&e.drawBuffer(!1)},end:function(){this.flush(),this.g.end()},__class__:ki});var Ci=function(e,t,i){null==i&&(i=!1),this.usage=t,this.mySize=e,this.buffer=xt.gl.createBuffer();var a=new Uint32Array(e);this._data=a};s["kha.graphics4.IndexBuffer"]=Ci,Ci.__name__=!0,Ci.prototype={lock:function(e,t){return null==e&&(e=0),null==t&&(t=this.mySize),this._data.subarray(e,e+t)},unlock:function(){xt.gl.bindBuffer(34963,this.buffer);var e=null==xt.elementIndexUint?new Uint16Array(this._data):this._data;xt.gl.bufferData(34963,e,this.usage==Li.DynamicUsage?35048:35044)},set:function(){xt.gl.bindBuffer(34963,this.buffer)},count:function(){return this.mySize},__class__:Ci};var Ai=s["kha.graphics4.MipMapFilter"]={__ename__:!0,__constructs__:["NoMipFilter","PointMipFilter","LinearMipFilter"]};Ai.NoMipFilter=["NoMipFilter",0],Ai.NoMipFilter.toString=r,Ai.NoMipFilter.__enum__=Ai,Ai.PointMipFilter=["PointMipFilter",1],Ai.PointMipFilter.toString=r,Ai.PointMipFilter.__enum__=Ai,Ai.LinearMipFilter=["LinearMipFilter",2],Ai.LinearMipFilter.toString=r,Ai.LinearMipFilter.__enum__=Ai;var Mi=function(){this.inputLayout=null,this.vertexShader=null,this.fragmentShader=null,this.geometryShader=null,this.tessellationControlShader=null,this.tessellationEvaluationShader=null,this.cullMode=bi.None,this.depthWrite=!1,this.depthMode=pi.Always,this.stencilMode=pi.Always,this.stencilBothPass=Ti.Keep,this.stencilDepthFail=Ti.Keep,this.stencilFail=Ti.Keep,this.stencilReferenceValue=0,this.stencilReadMask=255,this.stencilWriteMask=255,this.blendSource=_i.BlendOne,this.blendDestination=_i.BlendZero,this.blendOperation=vi.Add,this.alphaBlendSource=_i.BlendOne,this.alphaBlendDestination=_i.BlendZero,this.alphaBlendOperation=vi.Add,this.colorWriteMaskRed=this.colorWriteMaskBlue=this.colorWriteMaskGreen=this.colorWriteMaskAlpha=!0,this.conservativeRasterization=!1};s["kha.graphics4.PipelineStateBase"]=Mi,Mi.__name__=!0,Mi.prototype={__class__:Mi};var Ni=function(){this.program=null,Mi.call(this),this.textures=[],this.textureValues=[]};s["kha.graphics4.PipelineState"]=Ni,Ni.__name__=!0,Ni.__super__=Mi,Ni.prototype=i(Mi.prototype,{delete:function(){null!=this.program&&xt.gl.deleteProgram(this.program)},compile:function(){null!=this.program&&xt.gl.deleteProgram(this.program),this.program=xt.gl.createProgram(),this.compileShader(this.vertexShader),this.compileShader(this.fragmentShader),xt.gl.attachShader(this.program,this.vertexShader.shader),xt.gl.attachShader(this.program,this.fragmentShader.shader);for(var e=0,t=0,i=this.inputLayout;t<i.length;){var a=i[t];++t;for(var s=0,r=a.elements;s<r.length;){var n=r[s];++s,xt.gl.bindAttribLocation(this.program,e,n.name),n.data==Gi.Float4x4?e+=4:++e}}if(xt.gl.linkProgram(this.program),!xt.gl.getProgramParameter(this.program,35714))throw new Je("Could not link the shader program:\n"+xt.gl.getProgramInfoLog(this.program))},set:function(){xt.gl.useProgram(this.program);for(var e=0,t=this.textureValues.length;e<t;){var i=e++;xt.gl.uniform1i(this.textureValues[i],i)}xt.gl.colorMask(this.colorWriteMaskRed,this.colorWriteMaskGreen,this.colorWriteMaskBlue,this.colorWriteMaskAlpha)},compileShader:function(e){if(null==e.shader){for(var t=xt.gl.createShader(e.type),i=0!=xt.gl.getShaderPrecisionFormat(35632,36338).precision,a=e.files,s=0,r=a.length;s<r;){var n=s++;if(xt.gl2){if(a[n].indexOf("-webgl2")>=0||a[n].indexOf("runtime-string")>=0){xt.gl.shaderSource(t,e.sources[n]);break}}else{if(!i&&(a[n].indexOf("-relaxed")>=0||a[n].indexOf("runtime-string")>=0)){xt.gl.shaderSource(t,e.sources[n]);break}if(i&&(a[n].indexOf("-relaxed")<0||a[n].indexOf("runtime-string")>=0)){xt.gl.shaderSource(t,e.sources[n]);break}}}if(xt.gl.compileShader(t),!xt.gl.getShaderParameter(t,35713))throw new Je("Could not compile shader:\n"+xt.gl.getShaderInfoLog(t));e.shader=t}},getConstantLocation:function(e){for(var t=xt.gl.getUniformLocation(this.program,e),i=5126,a=0,s=xt.gl.getProgramParameter(this.program,35718);a<s;){var r=a++,n=xt.gl.getActiveUniform(this.program,r);if(n.name==e||n.name==e+"[0]"){i=n.type;break}}return new oa(t,i)},getTextureUnit:function(e){var t=this.findTexture(e);if(t<0){var i=xt.gl.getUniformLocation(this.program,e);t=this.textures.length,this.textureValues.push(i),this.textures.push(e)}return new ua(t)},findTexture:function(e){for(var t=0,i=this.textures.length;t<i;){var a=t++;if(this.textures[a]==e)return a}return-1},__class__:Ni});var Ti=s["kha.graphics4.StencilAction"]={__ename__:!0,__constructs__:["Keep","Zero","Replace","Increment","IncrementWrap","Decrement","DecrementWrap","Invert"]};Ti.Keep=["Keep",0],Ti.Keep.toString=r,Ti.Keep.__enum__=Ti,Ti.Zero=["Zero",1],Ti.Zero.toString=r,Ti.Zero.__enum__=Ti,Ti.Replace=["Replace",2],Ti.Replace.toString=r,Ti.Replace.__enum__=Ti,Ti.Increment=["Increment",3],Ti.Increment.toString=r,Ti.Increment.__enum__=Ti,Ti.IncrementWrap=["IncrementWrap",4],Ti.IncrementWrap.toString=r,Ti.IncrementWrap.__enum__=Ti,Ti.Decrement=["Decrement",5],Ti.Decrement.toString=r,Ti.Decrement.__enum__=Ti,Ti.DecrementWrap=["DecrementWrap",6],Ti.DecrementWrap.toString=r,Ti.DecrementWrap.__enum__=Ti,Ti.Invert=["Invert",7],Ti.Invert.toString=r,Ti.Invert.__enum__=Ti;var Fi=function(){};s["kha.graphics4.TessellationControlShader"]=Fi,Fi.__name__=!0;var Di=function(){};s["kha.graphics4.TessellationEvaluationShader"]=Di,Di.__name__=!0;var Ri=s["kha.graphics4.TextureAddressing"]={__ename__:!0,__constructs__:["Repeat","Mirror","Clamp"]};Ri.Repeat=["Repeat",0],Ri.Repeat.toString=r,Ri.Repeat.__enum__=Ri,Ri.Mirror=["Mirror",1],Ri.Mirror.toString=r,Ri.Mirror.__enum__=Ri,Ri.Clamp=["Clamp",2],Ri.Clamp.toString=r,Ri.Clamp.__enum__=Ri;var Pi=s["kha.graphics4.TextureFilter"]={__ename__:!0,__constructs__:["PointFilter","LinearFilter","AnisotropicFilter"]};Pi.PointFilter=["PointFilter",0],Pi.PointFilter.toString=r,Pi.PointFilter.__enum__=Pi,Pi.LinearFilter=["LinearFilter",1],Pi.LinearFilter.toString=r,Pi.LinearFilter.__enum__=Pi,Pi.AnisotropicFilter=["AnisotropicFilter",2],Pi.AnisotropicFilter.toString=r,Pi.AnisotropicFilter.__enum__=Pi;var Ei=s["kha.graphics4.TextureFormat"]={__ename__:!0,__constructs__:["RGBA32","L8","RGBA128","DEPTH16","RGBA64","A32","A16"]};Ei.RGBA32=["RGBA32",0],Ei.RGBA32.toString=r,Ei.RGBA32.__enum__=Ei,Ei.L8=["L8",1],Ei.L8.toString=r,Ei.L8.__enum__=Ei,Ei.RGBA128=["RGBA128",2],Ei.RGBA128.toString=r,Ei.RGBA128.__enum__=Ei,Ei.DEPTH16=["DEPTH16",3],Ei.DEPTH16.toString=r,Ei.DEPTH16.__enum__=Ei,Ei.RGBA64=["RGBA64",4],Ei.RGBA64.toString=r,Ei.RGBA64.__enum__=Ei,Ei.A32=["A32",5],Ei.A32.toString=r,Ei.A32.__enum__=Ei,Ei.A16=["A16",6],Ei.A16.toString=r,Ei.A16.__enum__=Ei;var Vi=function(){};s["kha.graphics4.TextureUnit"]=Vi,Vi.__name__=!0;var Li=s["kha.graphics4.Usage"]={__ename__:!0,__constructs__:["StaticUsage","DynamicUsage","ReadableUsage"]};Li.StaticUsage=["StaticUsage",0],Li.StaticUsage.toString=r,Li.StaticUsage.__enum__=Li,Li.DynamicUsage=["DynamicUsage",1],Li.DynamicUsage.toString=r,Li.DynamicUsage.__enum__=Li,Li.ReadableUsage=["ReadableUsage",2],Li.ReadableUsage.toString=r,Li.ReadableUsage.__enum__=Li;var Wi=function(e,t,i,a,s){null==s&&(s=!1),null==a&&(a=0),this.usage=i,this.instanceDataStepRate=a,this.mySize=e,this.myStride=0;for(var r=0,n=t.elements;r<n.length;){var l=n[r];switch(++r,l.data[1]){case 0:this.myStride+=4;break;case 1:this.myStride+=8;break;case 2:this.myStride+=12;break;case 3:this.myStride+=16;break;case 4:this.myStride+=64}}this.buffer=xt.gl.createBuffer();var o=new Ca(e*this.myStride/4|0);this._data=o,this.sizes=[],this.offsets=[],this.sizes[t.elements.length-1]=0,this.offsets[t.elements.length-1]=0;for(var h=0,c=0,u=0,d=t.elements;u<d.length;){var f=d[u];++u;var _;switch(f.data[1]){case 0:_=1;break;case 1:_=2;break;case 2:_=3;break;case 3:_=4;break;case 4:_=16}switch(this.sizes[c]=_,this.offsets[c]=h,f.data[1]){case 0:h+=4;break;case 1:h+=8;break;case 2:h+=12;break;case 3:h+=16;break;case 4:h+=64}++c}};s["kha.graphics4.VertexBuffer"]=Wi,Wi.__name__=!0,Wi.prototype={lock:function(e,t){return null==e&&(e=0),null==t&&(t=this.mySize),this._data.subarray(e*this.stride(),(e+t)*this.stride())},unlock:function(){xt.gl.bindBuffer(34962,this.buffer),xt.gl.bufferData(34962,this._data,this.usage==Li.DynamicUsage?35048:35044)},stride:function(){return this.myStride},set:function(e){var t=!!xt.gl2||xt.gl.getExtension("ANGLE_instanced_arrays");xt.gl.bindBuffer(34962,this.buffer);for(var i=0,a=0,s=this.sizes.length;a<s;){var r=a++;if(this.sizes[r]>4)for(var n=this.sizes[r],l=0;n>0;)xt.gl.enableVertexAttribArray(e+i),xt.gl.vertexAttribPointer(e+i,4,5126,!1,this.myStride,this.offsets[r]+l),t&&(xt.gl2?xt.gl.vertexAttribDivisor(e+i,this.instanceDataStepRate):t.vertexAttribDivisorANGLE(e+i,this.instanceDataStepRate)),n-=4,l+=16,++i;else xt.gl.enableVertexAttribArray(e+i),xt.gl.vertexAttribPointer(e+i,this.sizes[r],5126,!1,this.myStride,this.offsets[r]),t&&(xt.gl2?xt.gl.vertexAttribDivisor(e+i,this.instanceDataStepRate):t.vertexAttribDivisorANGLE(e+i,this.instanceDataStepRate)),++i}return i},__class__:Wi};var Gi=s["kha.graphics4.VertexData"]={__ename__:!0,__constructs__:["Float1","Float2","Float3","Float4","Float4x4"]};Gi.Float1=["Float1",0],Gi.Float1.toString=r,Gi.Float1.__enum__=Gi,Gi.Float2=["Float2",1],Gi.Float2.toString=r,Gi.Float2.__enum__=Gi,Gi.Float3=["Float3",2],Gi.Float3.toString=r,Gi.Float3.__enum__=Gi,Gi.Float4=["Float4",3],Gi.Float4.toString=r,Gi.Float4.__enum__=Gi,Gi.Float4x4=["Float4x4",4],Gi.Float4x4.toString=r,Gi.Float4x4.__enum__=Gi;var Zi=function(e,t){this.name=e,this.data=t};s["kha.graphics4.VertexElement"]=Zi,Zi.__name__=!0,Zi.prototype={__class__:Zi};var Ui=function(e,t){this.sources=[];for(var i=0;i<e.length;){var a=e[i];++i,this.sources.push(a.toString())}this.type=35633,this.shader=null,this.files=t};s["kha.graphics4.VertexShader"]=Ui,Ui.__name__=!0,Ui.fromSource=function(e){var t=new Ui([],["runtime-string"]);return t.sources.push(e),t},Ui.prototype={__class__:Ui};var zi=function(){this.elements=[],this.instanced=!1};s["kha.graphics4.VertexStructure"]=zi,zi.__name__=!0,zi.prototype={add:function(e,t){this.elements.push(new Zi(e,t))},size:function(){return this.elements.length},byteSize:function(){for(var e=0,t=0,i=this.elements.length;t<i;){var a=t++;e+=this.dataByteSize(this.elements[a].data)}return e},dataByteSize:function(e){switch(e[1]){case 0:return 4;case 1:return 8;case 2:return 12;case 3:return 16;case 4:return 64}},get:function(e){return this.elements[e]},__class__:zi};var Oi=e.kha.input.Gamepad=function(e,t){null==t&&(t="unknown"),null==e&&(e=0),this.index=e,this.axisListeners=[],this.buttonListeners=[],Oi.instances[e]=this};s["kha.input.Gamepad"]=Oi,Oi.__name__=!0,Oi.prototype={sendAxisEvent:function(e,t){for(var i=0,a=this.axisListeners;i<a.length;){var s=a[i];++i,s(e,t)}},sendButtonEvent:function(e,t){for(var i=0,a=this.buttonListeners;i<a.length;){var s=a[i];++i,s(e,t)}},__class__:Oi};var Hi=function(){this.__id=_a.nextId++,this._inputBuffer=new N(new Sa(1))};s["kha.network.Controller"]=Hi,Hi.__name__=!0,Hi.prototype={_id:function(){return this.__id},__class__:Hi};var ji=e.kha.input.Keyboard=function(){Hi.call(this),this.downListeners=[],this.upListeners=[],this.pressListeners=[],ji.instance=this};s["kha.input.Keyboard"]=ji,ji.__name__=!0,ji.__super__=Hi,ji.prototype=i(Hi.prototype,{sendDownEvent:function(e){if(null!=va.the()){var t=new N(new Sa(4));t.setInt32(0,0),va.the().sendControllerUpdate(this._id(),t)}for(var i=0,a=this.downListeners;i<a.length;){var s=a[i];++i,s(e)}},sendUpEvent:function(e){if(null!=va.the()){var t=new N(new Sa(4));t.setInt32(0,1),va.the().sendControllerUpdate(this._id(),t)}for(var i=0,a=this.upListeners;i<a.length;){var s=a[i];++i,s(e)}},sendPressEvent:function(e){if(null!=va.the()){var t=new N(new Sa(5));t.setInt32(0,2);var i=l.cca(e,0);t.b[4]=255&i,va.the().sendControllerUpdate(this._id(),t)}for(var a=0,s=this.pressListeners;a<s.length;){var r=s[a];++a,r(e)}},__class__:ji});var Xi=e.kha.input.Mouse=function(){Hi.call(this),Xi.instance=this};s["kha.input.Mouse"]=Xi,Xi.__name__=!0,Xi.get=function(e){return null==e&&(e=0),xt.getMouse(e)},Xi.__super__=Hi,Xi.prototype=i(Hi.prototype,{notify:function(e,t,i,a,s){this.notifyWindowed(0,e,t,i,a,s)},notifyWindowed:function(e,t,i,a,s,r){if(null!=t){for(null==this.windowDownListeners&&(this.windowDownListeners=[]);this.windowDownListeners.length<=e;)this.windowDownListeners.push([]);this.windowDownListeners[e].push(t)}if(null!=i){for(null==this.windowUpListeners&&(this.windowUpListeners=[]);this.windowUpListeners.length<=e;)this.windowUpListeners.push([]);this.windowUpListeners[e].push(i)}if(null!=a){for(null==this.windowMoveListeners&&(this.windowMoveListeners=[]);this.windowMoveListeners.length<=e;)this.windowMoveListeners.push([]);this.windowMoveListeners[e].push(a)}if(null!=s){for(null==this.windowWheelListeners&&(this.windowWheelListeners=[]);this.windowWheelListeners.length<=e;)this.windowWheelListeners.push([]);this.windowWheelListeners[e].push(s)}if(null!=r){for(null==this.windowLeaveListeners&&(this.windowLeaveListeners=[]);this.windowLeaveListeners.length<=e;)this.windowLeaveListeners.push([]);this.windowLeaveListeners[e].push(r)}},sendLeaveEvent:function(e){if(null!=va.the()){var t=new N(new Sa(8));t.setInt32(0,0),t.setInt32(4,e),va.the().sendControllerUpdate(this._id(),t)}if(null!=this.windowLeaveListeners)for(var i=0,a=this.windowLeaveListeners[e];i<a.length;){var s=a[i];++i,s()}},sendDownEvent:function(e,t,i,a){if(null!=va.the()){var s=new N(new Sa(20));s.setInt32(0,1),s.setInt32(4,e),s.setInt32(8,t),s.setInt32(12,i),s.setInt32(16,a),va.the().sendControllerUpdate(this._id(),s)}if(null!=this.windowDownListeners)for(var r=0,n=this.windowDownListeners[e];r<n.length;){var l=n[r];++r,l(t,i,a)}},sendUpEvent:function(e,t,i,a){if(null!=va.the()){var s=new N(new Sa(20));s.setInt32(0,2),s.setInt32(4,e),s.setInt32(8,t),s.setInt32(12,i),s.setInt32(16,a),va.the().sendControllerUpdate(this._id(),s)}if(null!=this.windowUpListeners)for(var r=0,n=this.windowUpListeners[e];r<n.length;){var l=n[r];++r,l(t,i,a)}},sendMoveEvent:function(e,t,i,a,s){if(null!=va.the()){var r=new N(new Sa(24));r.setInt32(0,3),r.setInt32(4,e),r.setInt32(8,t),r.setInt32(12,i),r.setInt32(16,a),r.setInt32(20,s),va.the().sendControllerUpdate(this._id(),r)}if(null!=this.windowMoveListeners)for(var n=0,l=this.windowMoveListeners[e];n<l.length;){var o=l[n];++n,o(t,i,a,s)}},sendWheelEvent:function(e,t){if(null!=va.the()){var i=new N(new Sa(12));i.setInt32(0,4),i.setInt32(4,e),i.setInt32(8,t),va.the().sendControllerUpdate(this._id(),i)}if(null!=this.windowWheelListeners)for(var a=0,s=this.windowWheelListeners[e];a<s.length;){var r=s[a];++a,r(t)}},__class__:Xi});var Yi=function(){Xi.call(this)};s["kha.input.MouseImpl"]=Yi,Yi.__name__=!0,Yi.__super__=Xi,Yi.prototype=i(Xi.prototype,{__class__:Yi});var Ki=e.kha.input.Surface=function(){this.touchStartListeners=[],this.touchEndListeners=[],this.moveListeners=[],Ki.instance=this};s["kha.input.Surface"]=Ki,Ki.__name__=!0,Ki.prototype={sendTouchStartEvent:function(e,t,i){for(var a=0,s=this.touchStartListeners;a<s.length;){var r=s[a];++a,r(e,t,i)}},sendTouchEndEvent:function(e,t,i){for(var a=0,s=this.touchEndListeners;a<s.length;){var r=s[a];++a,r(e,t,i)}},sendMoveEvent:function(e,t,i){for(var a=0,s=this.moveListeners;a<s.length;){var r=s[a];++a,r(e,t,i)}},__class__:Ki};var Qi=function(e){this.bytes=e};s["kha.internal.BytesBlob"]=Qi,Qi.__name__=!0,Qi.__interfaces__=[st],Qi.fromBytes=function(e){return new Qi(e)},Qi.alloc=function(e){return new Qi(new N(new Sa(e)))},Qi.readF32=function(e){var t=0==(-2147483648&e)?1:-1,i=e>>23&255,a=8388607&e;switch(i){case 0:return 0;case 255:return 0!=a?NaN:t>0?1/0:-1/0;default:return t*((a+8388608)/8388608)*Math.pow(2,i-127)}},Qi.bit=function(e,t){if(1==(e>>>t&1)){var i=3;return++i,!0}var a=4;return--a,!1},Qi.toText=function(e,t){for(var i="",a=0,s=t;a<s;){var r=a++;i+=String.fromCharCode(e[r])}return i},Qi.prototype={sub:function(e,t){return new Qi(this.bytes.sub(e,t))},get_length:function(){return this.bytes.length},writeU8:function(e,t){this.bytes.b[e]=255&t},readU8:function(e){var t=this.bytes.b[e];return++e,t},readS8:function(e){var t=this.bytes.b[e];++e;var i=0==(128&t)?1:-1;return t&=127,i*t},readU16BE:function(e){var t=this.bytes.b[e],i=this.bytes.b[e+1];return e+=2,256*t+i},readU16LE:function(e){var t=this.bytes.b[e],i=this.bytes.b[e+1];return e+=2,256*i+t},readU32LE:function(e){var t=this.bytes.b[e],i=this.bytes.b[e+1],a=this.bytes.b[e+2],s=this.bytes.b[e+3];return e+=4,t+256*i+256*a*256+256*s*256*256},readU32BE:function(e){var t=this.bytes.b[e],i=this.bytes.b[e+1],a=this.bytes.b[e+2],s=this.bytes.b[e+3];return e+=4,s+256*a+256*i*256+256*t*256*256},readS16BE:function(e){var t=this.bytes.b[e],i=this.bytes.b[e+1];e+=2;var a=0==(128&t)?1:-1;return t&=127,-1==a?256*t-32767+i:256*t+i},readS16LE:function(e){var t=this.bytes.b[e],i=this.bytes.b[e+1],a=0==(128&i)?1:-1;return i&=127,e+=2,-1==a?256*i-32767+t:256*i+t},readS32LE:function(e){var t=this.bytes.b[e],i=this.bytes.b[e+1],a=this.bytes.b[e+2],s=this.bytes.b[e+3],r=0==(128&s)?1:-1;return s&=127,e+=4,-1==r?-2147483647+t+256*i+256*a*256+256*s*256*256:t+256*i+256*a*256+256*s*256*256},readS32BE:function(e){var t=this.bytes.b[e],i=this.bytes.b[e+1],a=this.bytes.b[e+2],s=this.bytes.b[e+3],r=0==(128&t)?1:-1;return t&=127,e+=4,-1==r?-2147483647+s+256*a+256*i*256+256*t*256*256:s+256*a+256*i*256+256*t*256*256},readF32LE:function(e){return Qi.readF32(this.readS32LE(e))},readF32BE:function(e){return Qi.readF32(this.readS32BE(e))},toString:function(){return this.bytes.toString()},readUtf8Char:function(e){if(e.value>=this.get_length())return-1;var t=this.readU8(e.value);++e.value;var i=0;if(Qi.bit(t,7))if(Qi.bit(t,7)&&Qi.bit(t,6)&&!Qi.bit(t,5)){var a=31&t,s=this.readU8(e.value);++e.value,i=a<<6|63&s}else Qi.bit(t,7)&&Qi.bit(t,6)&&Qi.bit(t,5)&&!Qi.bit(t,4)?e.value+=2:Qi.bit(t,7)&&Qi.bit(t,6)&&Qi.bit(t,5)&&Qi.bit(t,4)&&!Qi.bit(t,3)&&(e.value+=3);else i=t;return i},readUtf8Block:function(e,t){var i=0;if(t.value>=this.get_length())return"";for(;i<2e3;){var a=this.readUtf8Char(t);if(a<0)break;e[i]=a,++i}return Qi.toText(e,i)},readUtf8String:function(){var e=new Array(2e3),t="",i=0;this.get_length()>=3&&239==this.bytes.b[0]&&187==this.bytes.b[1]&&191==this.bytes.b[2]&&(i=3);for(var a={value:i};a.value<this.get_length();)t+=this.readUtf8Block(e,a);return t},toBytes:function(){return this.bytes},unload:function(){this.bytes=null},__class__:Qi,__properties__:{get_length:"get_length"}};var Ji=function(){};s["kha.internal.HdrFormat"]=Ji,Ji.__name__=!0,Ji.readBuf=function(e){for(var t=0;;)if(e[t++]=255&Ji.buffer[Ji.fileOffset],!(++Ji.fileOffset<Ji.bufferLength&&t<e.length))break;return t},Ji.readBufOffset=function(e,t,i){for(var a=0;;)if(e[t+a++]=255&Ji.buffer[Ji.fileOffset],!(++Ji.fileOffset<Ji.bufferLength&&a<i))break;return a},Ji.readPixelsRaw=function(e,t,i,a){var s=4*a,r=Ji.readBufOffset(t,i,s);r<s&&k.trace("Error reading raw pixels: got "+r+" bytes, expected "+s,{fileName:"HdrFormat.hx",lineNumber:43,className:"kha.internal.HdrFormat",methodName:"readPixelsRaw"})},Ji.readPixelsRawRLE=function(e,t,i,a,s){var r,n,l,o=new Aa(4),h=null,c=new Aa(2);for(e.length;s>0;){if(Ji.readBuf(o)<o.length)return void k.trace("Error reading bytes: expected "+o.length,{fileName:"HdrFormat.hx",lineNumber:59,className:"kha.internal.HdrFormat",methodName:"readPixelsRawRLE"});if(2!=o[0]||2!=o[1]||0!=(128&o[2]))return t[i++]=255&o[0],t[i++]=255&o[1],t[i++]=255&o[2],t[i++]=255&o[3],void Ji.readPixelsRaw(e,t,i,a*s-1);if(((255&o[2])<<8|255&o[3])!=a)return void k.trace("Wrong scanline width "+((255&o[2])<<8|255&o[3])+", expected "+a,{fileName:"HdrFormat.hx",lineNumber:74,className:"kha.internal.HdrFormat",methodName:"readPixelsRawRLE"});null==h&&(h=new Aa(4*a)),r=0;for(var u=0;u<4;)for(n=(u+++1)*a;r<n;){if(Ji.readBuf(c)<c.length)return void k.trace("Error reading 2-byte buffer",{fileName:"HdrFormat.hx",lineNumber:88,className:"kha.internal.HdrFormat",methodName:"readPixelsRawRLE"});if((255&c[0])>128){if(0==(l=(255&c[0])-128)||l>n-r)return void k.trace("Bad scanline data",{fileName:"HdrFormat.hx",lineNumber:95,className:"kha.internal.HdrFormat",methodName:"readPixelsRawRLE"});for(;l-- >0;)h[r++]=255&c[1]}else{if(0==(l=255&c[0])||l>n-r)return void k.trace("Bad scanline data",{fileName:"HdrFormat.hx",lineNumber:106,className:"kha.internal.HdrFormat",methodName:"readPixelsRawRLE"});if(h[r++]=255&c[1],--l>0){if(Ji.readBufOffset(h,r,l)<l)return void k.trace("Error reading non-run data",{fileName:"HdrFormat.hx",lineNumber:112,className:"kha.internal.HdrFormat",methodName:"readPixelsRawRLE"});r+=l}}}for(var d=0,f=a;d<f;){var _=d++;t[i]=255&h[_],t[i+1]=255&h[_+a],t[i+2]=255&h[_+2*a],t[i+3]=255&h[_+3*a],i+=4}--s}},Ji.readLine=function(){for(var e="";;){var t=Ji.buffer[Ji.fileOffset];if(10==t){++Ji.fileOffset;break}if(e+=String.fromCharCode(t),!(++Ji.fileOffset<Ji.bufferLength))break}return e},Ji.parse=function(e){Ji.buffer=z.fromBytes(e),Ji.bufferLength=Ji.buffer.length,Ji.fileOffset=0;for(var t=0,i=0,a=!1,s=0;s<20;){s++;var r=Ji.readLine();if(Ji.formatPattern.match(r))a=!0;else if(Ji.exposurePattern.match(r))parseFloat(Ji.exposurePattern.matched(1));else if(Ji.widthHeightPattern.match(r)){i=_.parseInt(Ji.widthHeightPattern.matched(1)),t=_.parseInt(Ji.widthHeightPattern.matched(2));break}}if(!a)return k.trace("File is not run length encoded!",{fileName:"HdrFormat.hx",lineNumber:175,className:"kha.internal.HdrFormat",methodName:"parse"}),null;var n=new Aa(t*i*4),l=t,o=i;Ji.readPixelsRawRLE(Ji.buffer,n,0,l,o);for(var h=new Ca(t*i*4),c=0;c<n.length;){var u=n[c]/255,d=n[c+1]/255,f=n[c+2]/255,v=n[c+3],p=Math.pow(2,v-128);u*=p,d*=p,f*=p,h[c]=u,h[c+1]=d,h[c+2]=f,h[c+3]=1,c+=4}return{width:t,height:i,data:h}};var qi=function(e){this.stopped=!1,this.element=e};s["kha.js.AEAudioChannel"]=qi,qi.__name__=!0,qi.__interfaces__=[St],qi.prototype={play:function(){this.stopped=!1,xt.mobile?xt.insideInputEvent?(this.element.play(),xt.mobileAudioPlaying=!0):xt.mobileAudioPlaying?this.element.play():qi.todo.push(this):this.element.play()},__class__:qi};var $i=function(){};s["kha.js.AudioElementAudio"]=$i,$i.__name__=!0,$i._compile=function(){},$i.play=function(e,t){return null==t&&(t=!1),$i.stream(e,t)},$i.stream=function(e,t){null==t&&(t=!1),e.element.loop=t;var i=new qi(e.element);return i.play(),i};var ea=function(e){$t.call(this),this.canvas=e,ea.instance=this,this.myColor=lt.fromBytes(0,0,0),e.save()};s["kha.js.CanvasGraphics"]=ea,ea.__name__=!0,ea.__super__=$t,ea.prototype=i($t.prototype,{begin:function(e,t){null==e&&(e=!0),e&&this.clear(t)},clear:function(e){null==e&&(e=0),this.canvas.strokeStyle="rgba("+((16711680&e)>>>16)+","+((65280&e)>>>8)+","+(255&e)+","+.00392156862745098*(e>>>24)+")",this.canvas.fillStyle="rgba("+((16711680&e)>>>16)+","+((65280&e)>>>8)+","+(255&e)+","+.00392156862745098*(e>>>24)+")",.00392156862745098*(e>>>24)==0?this.canvas.clearRect(0,0,this.canvas.canvas.width,this.canvas.canvas.height):this.canvas.fillRect(0,0,this.canvas.canvas.width,this.canvas.canvas.height),this.set_color(this.myColor)},end:function(){},set_color:function(e){return this.myColor=e,this.canvas.strokeStyle="rgba("+((16711680&e)>>>16)+","+((65280&e)>>>8)+","+(255&e)+","+.00392156862745098*(e>>>24)+")",this.canvas.fillStyle="rgba("+((16711680&e)>>>16)+","+((65280&e)>>>8)+","+(255&e)+","+.00392156862745098*(e>>>24)+")",e},fillRect:function(e,t,i,a){var s=this.get_opacity();this.canvas.globalAlpha=s*(.00392156862745098*(this.myColor>>>24)),this.canvas.fillRect(e,t,i,a),this.canvas.globalAlpha=this.get_opacity()},__class__:ea});var ta=function(){ct.call(this)};s["kha.js.EnvironmentVariables"]=ta,ta.__name__=!0,ta.__super__=ct,ta.prototype=i(ct.prototype,{__class__:ta});var ia=function(e){this.images=new T,this.kravur=new ft(e)};s["kha.js.Font"]=ia,ia.__name__=!0,ia.__interfaces__=[st],ia.fromBytes=function(e){return new ia(Qi.fromBytes(e))},ia.prototype={height:function(e){return this.kravur._get(e).getHeight()},width:function(e,t){return this.kravur._get(e).stringWidth(t)},widthOfCharacters:function(e,t,i,a){return this.kravur._get(e).charactersWidth(t,i,a)},baseline:function(e){return this.kravur._get(e).getBaselinePosition()},getImage:function(e,t,i){var a=null==i?e:1e4*e+i.length;if(!this.images.h.hasOwnProperty(a)){var s=this.images,r=new T;s.h[a]=r}if(!this.images.h[a].h.hasOwnProperty(t)){var n=this.kravur._get(e,i),l=window.document.createElement("canvas");l.width=n.width,l.height=n.height;var o=l.getContext("2d");o.fillStyle="black",o.fillRect(0,0,n.width,n.height);for(var h=o.getImageData(0,0,n.width,n.height),c=qe.__cast(n.getTexture(),nt).bytes,u=0,d=c.length;u<d;){var f=u++;h.data[4*f]=(16711680&t)>>>16,h.data[4*f+1]=(65280&t)>>>8,h.data[4*f+2]=255&t,h.data[4*f+3]=c.b[f]}o.putImageData(h,0,0);var _=window.document.createElement("img");return _.src=l.toDataURL("image/png"),this.images.h[a].h[t]=_,_}return this.images.h[a].h[t]},unload:function(){this.kravur=null,this.images=null},__class__:ia};var aa=function(){};s["kha.js.MobileWebAudio"]=aa,aa.__name__=!0,aa._init=function(){try{return void(aa._context=new AudioContext)}catch(e){}try{return void(this._context=new webkitAudioContext)}catch(e){}},aa.play=function(e,t){null==t&&(t=!1);var i=new sa(e,t);return i.play(),i},aa.stream=function(e,t){return null==t&&(t=!1),aa.play(e,t)};var sa=function(e,t){this.stopped=!1,this.paused=!1,this.buffer=e._buffer,this.loop=t,this.createSource()};s["kha.js.MobileWebAudioChannel"]=sa,sa.__name__=!0,sa.__interfaces__=[St],sa.prototype={createSource:function(){var e=this;this.source=aa._context.createBufferSource(),this.source.loop=this.loop,this.source.buffer=this.buffer,this.source.onended=function(){e.stopped=!0},this.gain=aa._context.createGain(),this.source.connect(this.gain),this.gain.connect(aa._context.destination)},play:function(){(this.paused||this.stopped)&&this.createSource(),this.stopped=!1,this.paused?(this.paused=!1,this.startTime=aa._context.currentTime-this.pauseTime,this.source.start(0,this.pauseTime)):(this.startTime=aa._context.currentTime,this.source.start())},__class__:sa};var ra=function(e,t){var i=this;wt.call(this);var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onerror=function(){k.trace("Error loading "+e,{fileName:"MobileWebAudioSound.hx",lineNumber:25,className:"kha.js.MobileWebAudioSound",methodName:"new"})},a.onload=function(){i.compressedData=N.ofData(a.response),i.uncompressedData=null,aa._context.decodeAudioData(i.compressedData.b.bufferValue,function(e){i._buffer=e,t(i)},function(){throw new Je("Audio format not supported")})},a.send(null)};s["kha.js.MobileWebAudioSound"]=ra,ra.__name__=!0,ra.__super__=wt,ra.prototype=i(wt.prototype,{uncompress:function(e){e()},__class__:ra});var na=function(e,t){wt.call(this),this.done=t,na.loading.push(this),this.element=window.document.createElement("audio"),this.filenames=[];for(var i=0;i<e.length;){var s=e[i];++i,""!=this.element.canPlayType("audio/ogg")&&v.endsWith(s,".ogg")&&this.filenames.push(s),""!=this.element.canPlayType("audio/mp4")&&v.endsWith(s,".mp4")&&this.filenames.push(s)}this.element.addEventListener("error",a(this,this.errorListener),!1),this.element.addEventListener("canplay",a(this,this.canPlayThroughListener),!1),this.element.src=this.filenames[0],this.element.preload="auto",this.element.load()};s["kha.js.Sound"]=na,na.__name__=!0,na.__super__=wt,na.prototype=i(wt.prototype,{errorListener:function(e){if(4==this.element.error.code)for(var t=0,i=this.filenames.length-1;t<i;){var a=t++;if(this.element.src==this.filenames[a])return void(this.element.src=this.filenames[a+1])}k.trace("Error loading "+this.element.src,{fileName:"Sound.hx",lineNumber:108,className:"kha.js.Sound",methodName:"errorListener"}),window.console.log("loadSound failed"),this.finishAsset()},canPlayThroughListener:function(e){this.finishAsset()},finishAsset:function(){this.element.removeEventListener("error",a(this,this.errorListener),!1),this.element.removeEventListener("canplaythrough",a(this,this.canPlayThroughListener),!1),this.done(this),l.remove(na.loading,this)},uncompress:function(e){e()},__class__:na});var la=function(e,t){var i=this;wt.call(this);var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onerror=function(){k.trace("Error loading "+e,{fileName:"WebAudioSound.hx",lineNumber:76,className:"kha.js.WebAudioSound",methodName:"new"})},a.onload=function(){i.compressedData=N.ofData(a.response),i.uncompressedData=null,t(i)},a.send(null)};s["kha.js.WebAudioSound"]=la,la.__name__=!0,la.__super__=wt,la.prototype=i(wt.prototype,{superUncompress:function(e){wt.prototype.uncompress.call(this,e)},uncompress:function(e){var t=this;kt._context.decodeAudioData(this.compressedData.b.bufferValue,function(i){var a=2*i.getChannelData(0).length,s=new Array(a);if(t.uncompressedData=s,1==i.numberOfChannels)for(var r=0,n=i.getChannelData(0).length;r<n;){var l=r++;t.uncompressedData[2*l]=i.getChannelData(0)[l],t.uncompressedData[2*l+1]=i.getChannelData(0)[l]}else for(var o=0,h=i.getChannelData(0).length;o<h;){var c=o++;t.uncompressedData[2*c]=i.getChannelData(0)[c],t.uncompressedData[2*c+1]=i.getChannelData(1)[c]}t.compressedData=null,e()},function(){t.superUncompress(e)})},__class__:la});var oa=function(e,t){this.value=e,this.type=t};s["kha.js.graphics4.ConstantLocation"]=oa,oa.__name__=!0,oa.__interfaces__=[mi],oa.prototype={__class__:oa};var ha=function(e){var t=new Array(9);this.matrix3Cache=t;var i=new Array(16);this.matrixCache=i,this.isDepthAttachment=!1,this.isCubeMap=!1,this.colorMaskAlpha=!0,this.colorMaskBlue=!0,this.colorMaskGreen=!0,this.colorMaskRed=!0,this.depthMask=!1,this.depthTest=!1,this.renderTarget=e,this.init(),xt.gl2?this.instancedExtension=!0:(this.instancedExtension=xt.gl.getExtension("ANGLE_instanced_arrays"),this.blendMinMaxExtension=xt.gl.getExtension("EXT_blend_minmax"))};s["kha.js.graphics4.Graphics"]=ha,ha.__name__=!0,ha.__interfaces__=[yi],ha.getBlendFunc=function(e){switch(e[1]){case 0:case 2:return 0;case 1:return 1;case 3:return 770;case 4:return 772;case 5:return 771;case 6:return 773;case 7:return 768;case 8:return 774;case 9:return 769;case 10:return 775}},ha.getBlendOp=function(e){switch(e[1]){case 0:return 32774;case 1:return 32778;case 2:return 32779;case 3:return 32775;case 4:return 32776}},ha.prototype={init:function(){if(null!=this.renderTarget)if(this.isCubeMap=qe.__instanceof(this.renderTarget,gi),this.isCubeMap){var e=qe.__cast(this.renderTarget,gi);this.renderTargetFrameBuffer=e.frameBuffer,this.renderTargetTexture=e.texture,this.isDepthAttachment=e.isDepthAttachment}else{var t=qe.__cast(this.renderTarget,It);this.renderTargetFrameBuffer=t.frameBuffer,this.renderTargetTexture=t.texture}},begin:function(e){if(xt.gl.enable(3042),xt.gl.blendFunc(770,771),null==this.renderTarget)xt.gl.bindFramebuffer(36160,null),xt.gl.viewport(0,0,Bt.windowWidth(),Bt.windowHeight());else if(xt.gl.bindFramebuffer(36160,this.renderTargetFrameBuffer),xt.gl.viewport(0,0,this.renderTarget.get_width(),this.renderTarget.get_height()),null!=e){xt.gl.framebufferTexture2D(36160,xt.drawBuffers.COLOR_ATTACHMENT0_WEBGL,3553,this.renderTargetTexture,0);for(var t=0,i=e.length;t<i;){var a=t++;xt.gl.framebufferTexture2D(36160,xt.drawBuffers.COLOR_ATTACHMENT0_WEBGL+a+1,3553,qe.__cast(e[a],It).texture,0)}for(var s=[xt.drawBuffers.COLOR_ATTACHMENT0_WEBGL],r=0,n=e.length;r<n;){var l=r++;s.push(xt.drawBuffers.COLOR_ATTACHMENT0_WEBGL+l+1)}xt.gl2?xt.gl.drawBuffers(s):xt.drawBuffers.drawBuffersWEBGL(s)}},beginFace:function(e){xt.gl.enable(3042),xt.gl.blendFunc(770,771),xt.gl.bindFramebuffer(36160,this.renderTargetFrameBuffer),xt.gl.framebufferTexture2D(36160,this.isDepthAttachment?36096:36064,34069+e,this.renderTargetTexture,0),xt.gl.viewport(0,0,this.renderTarget.get_width(),this.renderTarget.get_height())},end:function(){switch(xt.gl.getError()){case 0:break;case 1280:k.trace("WebGL error: Invalid enum",{fileName:"Graphics.hx",lineNumber:130,className:"kha.js.graphics4.Graphics",methodName:"end"});break;case 1281:k.trace("WebGL error: Invalid value",{fileName:"Graphics.hx",lineNumber:132,className:"kha.js.graphics4.Graphics",methodName:"end"});break;case 1282:k.trace("WebGL error: Invalid operation",{fileName:"Graphics.hx",lineNumber:134,className:"kha.js.graphics4.Graphics",methodName:"end"});break;case 1285:k.trace("WebGL error: Out of memory",{fileName:"Graphics.hx",lineNumber:138,className:"kha.js.graphics4.Graphics",methodName:"end"});break;case 1286:k.trace("WebGL error: Invalid framebuffer operation",{fileName:"Graphics.hx",lineNumber:136,className:"kha.js.graphics4.Graphics",methodName:"end"});break;case 37442:k.trace("WebGL error: Context lost",{fileName:"Graphics.hx",lineNumber:140,className:"kha.js.graphics4.Graphics",methodName:"end"});break;default:k.trace("Unknown WebGL error",{fileName:"Graphics.hx",lineNumber:142,className:"kha.js.graphics4.Graphics",methodName:"end"})}},clear:function(e,t,i){var a=0;null!=e&&(a|=16384,xt.gl.colorMask(!0,!0,!0,!0),xt.gl.clearColor(.00392156862745098*((16711680&e)>>>16),.00392156862745098*((65280&e)>>>8),.00392156862745098*(255&e),.00392156862745098*(e>>>24))),null!=t&&(a|=256,xt.gl.enable(2929),xt.gl.depthMask(!0),xt.gl.clearDepth(t)),null!=i&&(a|=1024,xt.gl.enable(2960),xt.gl.stencilMask(255),xt.gl.clearStencil(i)),xt.gl.clear(a),xt.gl.colorMask(this.colorMaskRed,this.colorMaskGreen,this.colorMaskBlue,this.colorMaskAlpha),this.depthTest?xt.gl.enable(2929):xt.gl.disable(2929),xt.gl.depthMask(this.depthMask)},viewport:function(e,t,i,a){var s=null==this.renderTarget?Bt.windowHeight(0):this.renderTarget.get_height();xt.gl.viewport(e,s-t-a,i,a)},setDepthMode:function(e,t){switch(t[1]){case 0:e?xt.gl.enable(2929):xt.gl.disable(2929),this.depthTest=e,xt.gl.depthFunc(519);break;case 1:xt.gl.enable(2929),this.depthTest=!0,xt.gl.depthFunc(512);break;case 2:xt.gl.enable(2929),this.depthTest=!0,xt.gl.depthFunc(514);break;case 3:xt.gl.enable(2929),this.depthTest=!0,xt.gl.depthFunc(517);break;case 4:xt.gl.enable(2929),this.depthTest=!0,xt.gl.depthFunc(513);break;case 5:xt.gl.enable(2929),this.depthTest=!0,xt.gl.depthFunc(515);break;case 6:xt.gl.enable(2929),this.depthTest=!0,xt.gl.depthFunc(516);break;case 7:xt.gl.enable(2929),this.depthTest=!0,xt.gl.depthFunc(518)}xt.gl.depthMask(e),this.depthMask=e},setBlendingMode:function(e,t,i,a,s,r){e==_i.BlendOne&&t==_i.BlendZero?xt.gl.disable(3042):(xt.gl.enable(3042),xt.gl.blendFuncSeparate(ha.getBlendFunc(e),ha.getBlendFunc(t),ha.getBlendFunc(a),ha.getBlendFunc(s)),xt.gl.blendEquationSeparate(ha.getBlendOp(i),ha.getBlendOp(r)))},setVertexBuffer:function(e){qe.__cast(e,Wi).set(0)},setVertexBuffers:function(e){for(var t=0,i=0;i<e.length;){var a=e[i];++i,t+=qe.__cast(a,Wi).set(t)}},setIndexBuffer:function(e){this.indicesCount=e.count(),qe.__cast(e,Ci).set()},setTexture:function(e,t){null==t?(xt.gl.activeTexture(33984+qe.__cast(e,ua).value),xt.gl.bindTexture(3553,null)):qe.__cast(t,It).set(qe.__cast(e,ua).value)},setTextureDepth:function(e,t){qe.__cast(t,It).setDepth(qe.__cast(e,ua).value)},setTextureParameters:function(e,t,i,a,s,r){switch(xt.gl.activeTexture(33984+qe.__cast(e,ua).value),t[1]){case 0:xt.gl.texParameteri(3553,10242,10497);break;case 1:xt.gl.texParameteri(3553,10242,33648);break;case 2:xt.gl.texParameteri(3553,10242,33071)}switch(i[1]){case 0:xt.gl.texParameteri(3553,10243,10497);break;case 1:xt.gl.texParameteri(3553,10243,33648);break;case 2:xt.gl.texParameteri(3553,10243,33071)}switch(a[1]){case 0:switch(r[1]){case 0:xt.gl.texParameteri(3553,10241,9728);break;case 1:xt.gl.texParameteri(3553,10241,9984);break;case 2:xt.gl.texParameteri(3553,10241,9986)}break;case 1:case 2:switch(r[1]){case 0:xt.gl.texParameteri(3553,10241,9729);break;case 1:xt.gl.texParameteri(3553,10241,9985);break;case 2:xt.gl.texParameteri(3553,10241,9987)}a==Pi.AnisotropicFilter&&xt.gl.texParameteri(3553,xt.anisotropicFilter.TEXTURE_MAX_ANISOTROPY_EXT,4)}switch(s[1]){case 0:xt.gl.texParameteri(3553,10240,9728);break;case 1:case 2:xt.gl.texParameteri(3553,10240,9729)}},setCubeMap:function(e,t){null==t?(xt.gl.activeTexture(33984+qe.__cast(e,ua).value),xt.gl.bindTexture(34067,null)):t.set(qe.__cast(e,ua).value)},setCubeMapDepth:function(e,t){t.setDepth(qe.__cast(e,ua).value)},setCullMode:function(e){switch(e[1]){case 0:xt.gl.enable(2884),xt.gl.cullFace(1029);break;case 1:xt.gl.enable(2884),xt.gl.cullFace(1028);break;case 2:xt.gl.disable(2884)}},setPipeline:function(e){this.setCullMode(e.cullMode),this.setDepthMode(e.depthWrite,e.depthMode),this.setStencilParameters(e.stencilMode,e.stencilBothPass,e.stencilDepthFail,e.stencilFail,e.stencilReferenceValue,e.stencilReadMask,e.stencilWriteMask),this.setBlendingMode(e.blendSource,e.blendDestination,e.blendOperation,e.alphaBlendSource,e.alphaBlendDestination,e.alphaBlendOperation),e.set(),this.colorMaskRed=e.colorWriteMaskRed,this.colorMaskGreen=e.colorWriteMaskGreen,this.colorMaskBlue=e.colorWriteMaskBlue,this.colorMaskAlpha=e.colorWriteMaskAlpha},setBool:function(e,t){xt.gl.uniform1i(qe.__cast(e,oa).value,t?1:0)},setInt:function(e,t){xt.gl.uniform1i(qe.__cast(e,oa).value,t)},setFloat:function(e,t){xt.gl.uniform1f(qe.__cast(e,oa).value,t)},setFloat2:function(e,t,i){xt.gl.uniform2f(qe.__cast(e,oa).value,t,i)},setFloat3:function(e,t,i,a){xt.gl.uniform3f(qe.__cast(e,oa).value,t,i,a)},setFloat4:function(e,t,i,a,s){xt.gl.uniform4f(qe.__cast(e,oa).value,t,i,a,s)},setFloats:function(e,t){var i=qe.__cast(e,oa);switch(i.type){case 35664:xt.gl.uniform2fv(i.value,t);break;case 35665:xt.gl.uniform3fv(i.value,t);break;case 35666:xt.gl.uniform4fv(i.value,t);break;default:xt.gl.uniform1fv(i.value,t)}},setMatrix:function(e,t){this.matrixCache[0]=t._00,this.matrixCache[1]=t._01,this.matrixCache[2]=t._02,this.matrixCache[3]=t._03,this.matrixCache[4]=t._10,this.matrixCache[5]=t._11,this.matrixCache[6]=t._12,this.matrixCache[7]=t._13,this.matrixCache[8]=t._20,this.matrixCache[9]=t._21,this.matrixCache[10]=t._22,this.matrixCache[11]=t._23,this.matrixCache[12]=t._30,this.matrixCache[13]=t._31,this.matrixCache[14]=t._32,this.matrixCache[15]=t._33,xt.gl.uniformMatrix4fv(qe.__cast(e,oa).value,!1,this.matrixCache)},setMatrix3:function(e,t){this.matrix3Cache[0]=t._00,this.matrix3Cache[1]=t._01,this.matrix3Cache[2]=t._02,this.matrix3Cache[3]=t._10,this.matrix3Cache[4]=t._11,this.matrix3Cache[5]=t._12,this.matrix3Cache[6]=t._20,this.matrix3Cache[7]=t._21,this.matrix3Cache[8]=t._22,xt.gl.uniformMatrix3fv(qe.__cast(e,oa).value,!1,this.matrix3Cache)},drawIndexedVertices:function(e,t){null==t&&(t=-1),null==e&&(e=0);var i=null==xt.elementIndexUint?5123:5125,a=5123==i?2:4;xt.gl.drawElements(4,-1==t?this.indicesCount:t,i,e*a)},convertStencilAction:function(e){switch(e[1]){case 0:return 7680;case 1:return 0;case 2:return 7681;case 3:return 7682;case 4:return 34055;case 5:return 7683;case 6:return 34056;case 7:return 5386}},setStencilParameters:function(e,t,i,a,s,r,n){if(null==n&&(n=255),null==r&&(r=255),e==pi.Always&&t==Ti.Keep&&i==Ti.Keep&&a==Ti.Keep)xt.gl.disable(2960);else{xt.gl.enable(2960);var l=0;switch(e[1]){case 0:l=519;break;case 1:l=512;break;case 2:l=514;break;case 3:l=517;break;case 4:l=513;break;case 5:l=515;break;case 6:l=516;break;case 7:l=518}xt.gl.stencilMask(n),xt.gl.stencilOp(this.convertStencilAction(a),this.convertStencilAction(i),this.convertStencilAction(t)),xt.gl.stencilFunc(l,s,r)}},scissor:function(e,t,i,a){xt.gl.enable(3089),null==this.renderTarget?xt.gl.scissor(e,Bt.windowHeight(0)-t-a,i,a):xt.gl.scissor(e,t,i,a)},disableScissor:function(){xt.gl.disable(3089)},renderTargetsInvertedY:function(){return!0},drawIndexedVerticesInstanced:function(e,t,i){if(null==i&&(i=-1),null==t&&(t=0),this.instancedRenderingAvailable()){var a=null==xt.elementIndexUint?5123:5125,s=null==xt.elementIndexUint?2:4;xt.gl2?xt.gl.drawElementsInstanced(4,-1==i?this.indicesCount:i,a,t*s,e):this.instancedExtension.drawElementsInstancedANGLE(4,-1==i?this.indicesCount:i,a,t*s,e)}},instancedRenderingAvailable:function(){return this.instancedExtension},__class__:ha};var ca=function(e){ki.call(this,e)};s["kha.js.graphics4.Graphics2"]=ca,ca.__name__=!0,ca.__super__=ki,ca.prototype=i(ki.prototype,{begin:function(e,t){null==e&&(e=!0),xt.gl.colorMask(!0,!0,!0,!0),xt.gl.disable(2929),xt.gl.depthFunc(519),ki.prototype.begin.call(this,e,t)},__class__:ca});var ua=function(e){this.value=e};s["kha.js.graphics4.TextureUnit"]=ua,ua.__name__=!0,ua.__interfaces__=[Vi],ua.prototype={__class__:ua};var da=function(){};s["kha.vr.VrInterface"]=da,da.__name__=!0,da.prototype={IsVrEnabled:function(){return!1},__class__:da};var fa=function(){this.vrHeight=0,this.vrWidth=0,this.height=0,this.width=0,this.vrEnabled=!1,da.call(this),navigator.getVRDisplays&&(this.vrEnabled=!0,this.getVRDisplays(),k.trace("Display enabled.",{fileName:"VrInterface.hx",lineNumber:36,className:"kha.js.vr.VrInterface",methodName:"new"}))};s["kha.js.vr.VrInterface"]=fa,fa.__name__=!0,fa.__super__=da,fa.prototype=i(da.prototype,{getVRDisplays:function(){var e=this;navigator.getVRDisplays().then(function(t){if(t.length>0){e.frameData=new VRFrameData,e.vrDisplay=t[0],e.vrDisplay.depthNear=.1,e.vrDisplay.depthFar=1024;var i=e.vrDisplay.getEyeParameters("left"),a=e.vrDisplay.getEyeParameters("right");e.width=xt.khanvas.width,e.height=xt.khanvas.height,e.vrWidth=2*Math.max(i.renderWidth,a.renderWidth)|0,e.vrHeight=0|Math.max(i.renderHeight,a.renderHeight)}else k.trace("There are no VR displays connected.",{fileName:"VrInterface.hx",lineNumber:56,className:"kha.js.vr.VrInterface",methodName:"getVRDisplays"})})},IsVrEnabled:function(){return this.vrEnabled},__class__:fa});var _a=function(){};s["kha.network.ControllerBuilder"]=_a,_a.__name__=!0;var va=function(){this.controllers=new T};s["kha.network.Session"]=va,va.__name__=!0,va.the=function(){return va.instance},va.prototype={sendControllerUpdate:function(e,t){if(this.controllers.h.hasOwnProperty(e)){if(this.controllers.h[e]._inputBuffer.length<this.controllers.h[e]._inputBufferIndex+4+t.length){var i=new N(new Sa(this.controllers.h[e]._inputBufferIndex+4+t.length));i.blit(0,this.controllers.h[e]._inputBuffer,0,this.controllers.h[e]._inputBufferIndex),this.controllers.h[e]._inputBuffer=i}this.controllers.h[e]._inputBuffer.setInt32(this.controllers.h[e]._inputBufferIndex,t.length),this.controllers.h[e]._inputBuffer.blit(this.controllers.h[e]._inputBufferIndex+4,t,0,t.length),this.controllers.h[e]._inputBufferIndex+=4+t.length}},__class__:va};var pa,ma=0;s.Math=Math,String.prototype.__class__=s.String=String,String.__name__=!0,s.Array=Array,Array.__name__=!0,Date.prototype.__class__=s.Date=Date,Date.__name__=["Date"];var ga=s.Int={__name__:["Int"]},ba=s.Dynamic={__name__:["Dynamic"]},wa=s.Float=Number;wa.__name__=["Float"];var Ba=s.Bool=Boolean;Ba.__ename__=["Bool"];var ya=s.Class={__name__:["Class"]},xa={},Ia={},Sa=t.ArrayBuffer||$e;null==Sa.prototype.slice&&(Sa.prototype.slice=$e.sliceImpl);var ka=t.DataView||et,Ca=t.Float32Array||tt._new,Aa=t.Uint8Array||it._new;d.projectWindowMode=u.Fullscreen,d.projectWidth=960,d.projectHeight=540,B.dynamicScale=1,A.DEFAULT_RESOLVER=new C,A.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",F.count=0,U.i64tmp=new S(0,0),K.LEN_EXTRA_BITS_TBL=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,-1,-1],K.LEN_BASE_VAL_TBL=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],K.DIST_EXTRA_BITS_TBL=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,-1,-1],K.DIST_BASE_VAL_TBL=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],K.CODE_LENGTHS_POS=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q.traitInits=[],q.traitUpdates=[],q.traitLateUpdates=[],q.traitRenders=[],q.traitRenders2D=[],q.pauseUpdates=!1,q.lastw=-1,q.lasth=-1,te.helpVec=new ee,te.helpMat=te.identity(),re.framePassed=!0,le.cachedSceneRaws=new R,le.cachedMeshes=new R,le.cachedLamps=new R,le.cachedCameras=new R,le.cachedMaterials=new R,le.cachedParticles=new R,le.cachedWorlds=new R,le.cachedShaders=new R,le.cachedBlobs=new R,le.cachedImages=new R,le.cachedSounds=new R,le.loadingMeshes=new R,le.loadingLamps=new R,le.loadingCameras=new R,le.loadingMaterials=new R,le.loadingParticles=new R,le.loadingWorlds=new R,le.loadingShaders=new R,le.loadingSceneRaws=new R,le.assetsLoaded=0,le.loadingBlobs=new R,le.loadingImages=new R,le.loadingSounds=new R,ue.uidCounter=0,de.num=0,ye.helpVec0=new ee,ye.helpVec1=new ee,ye.helpVec2=new ee,xe.m1=te.identity(),xe.m2=te.identity(),xe.vpos=new ee,xe.vpos2=new ee,xe.vscl=new ee,xe.vscl2=new ee,xe.q1=new ye,xe.q2=new ye,Ie.skinMaxBones=50,Ie.vpos=new ee,Ie.vscl=new ee,Ie.q1=new ye,Ie.q2=new ye,Ie.vpos2=new ee,Ie.vscl2=new ee,Se.uidCounter=0,Se.seed=1,ke.temp=new ee,ke.sphereCenter=new ee,Ne.m=te.identity(),Ne.p1=new ee,Ne.p2=new ee,Ne.p3=new ee,Ve.temp=te.identity(),We.biasMat=new te(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),We.helpMat=te.identity(),We.helpMat2=te.identity(),We.helpMat3=Be.identity(),We.helpVec=new ee,We.helpVec2=new ee,We.helpQuat=new ye,Ue.occupied=!1,Ue.gamepads=[],He.buttons=["left","right","middle"],Ke.scale=1,Ke.last=0,Ke.realDelta=0,Qe.eases=[Qe.easeLinear,Qe.easeSineIn,Qe.easeSineOut,Qe.easeSineInOut,Qe.easeQuadIn,Qe.easeQuadOut,Qe.easeQuadInOut,Qe.easeCubicIn,Qe.easeCubicOut,Qe.easeCubicInOut,Qe.easeQuartIn,Qe.easeQuartOut,Qe.easeQuartInOut,Qe.easeQuintIn,Qe.easeQuintOut,Qe.easeQuintInOut,Qe.easeExpoIn,Qe.easeExpoOut,Qe.easeExpoInOut,Qe.easeCircIn,Qe.easeCircOut,Qe.easeCircInOut,Qe.easeBackIn,Qe.easeBackOut,Qe.easeBackInOut],Qe.anims=[],qe.__toStr={}.toString,tt.BYTES_PER_ELEMENT=4,it.BYTES_PER_ELEMENT=1,ot.canvas_id="khanvas",mt.DIF_COUNT=3,mt.maxframetime=.5,mt.startTime=0,bt.Baked_mesh_fragData0="s1030:I3ZlcnNpb24gMTAwCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gaGlnaHAgaW50OwoKdW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgSW1hZ2VUZXh0dXJlOwoKdmFyeWluZyBoaWdocCB2ZWMyIHRleENvb3JkOwoKdm9pZCBtYWluKCkKewogICAgaGlnaHAgdmVjNCBJbWFnZVRleHR1cmVfc3RvcmUgPSB0ZXh0dXJlMkQoSW1hZ2VUZXh0dXJlLCB0ZXhDb29yZCk7CiAgICBoaWdocCB2ZWMzIF8yNSA9IHBvdyhJbWFnZVRleHR1cmVfc3RvcmUueHl6LCB2ZWMzKDIuMjAwMDAwMDQ3NjgzNzE1ODIwMzEyNSkpOwogICAgSW1hZ2VUZXh0dXJlX3N0b3JlID0gdmVjNChfMjUueCwgXzI1LnksIF8yNS56LCBJbWFnZVRleHR1cmVfc3RvcmUudyk7CiAgICBoaWdocCB2ZWMzIEltYWdlVGV4dHVyZV9Db2xvcl9yZXMgPSBJbWFnZVRleHR1cmVfc3RvcmUueHl6OwogICAgaGlnaHAgdmVjMyBiYXNlY29sID0gSW1hZ2VUZXh0dXJlX0NvbG9yX3JlczsKICAgIGhpZ2hwIGZsb2F0IHJvdWdobmVzcyA9IDAuMDsKICAgIGhpZ2hwIGZsb2F0IG1ldGFsbGljID0gMC4wOwogICAgaGlnaHAgZmxvYXQgb2NjbHVzaW9uID0gMS4wOwogICAgZ2xfRnJhZ0RhdGFbMF0gPSB2ZWM0KGJhc2Vjb2wsIDEuMCk7CiAgICBoaWdocCB2ZWMzIF81MSA9IHBvdyhnbF9GcmFnRGF0YVswXS54eXosIHZlYzMoMC40NTQ1NDU0NjgwOTE5NjQ3MjE2Nzk2ODc1KSk7CiAgICBnbF9GcmFnRGF0YVswXSA9IHZlYzQoXzUxLngsIF81MS55LCBfNTEueiwgZ2xfRnJhZ0RhdGFbMF0udyk7Cn0KCg",bt.Baked_mesh_fragData1="s963:I3ZlcnNpb24gMTAwCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gbWVkaXVtcCBpbnQ7Cgp1bmlmb3JtIG1lZGl1bXAgc2FtcGxlcjJEIEltYWdlVGV4dHVyZTsKCnZhcnlpbmcgdmVjMiB0ZXhDb29yZDsKCnZvaWQgbWFpbigpCnsKICAgIHZlYzQgSW1hZ2VUZXh0dXJlX3N0b3JlID0gdGV4dHVyZTJEKEltYWdlVGV4dHVyZSwgdGV4Q29vcmQpOwogICAgdmVjMyBfMjUgPSBwb3coSW1hZ2VUZXh0dXJlX3N0b3JlLnh5eiwgdmVjMygyLjIwMDAwMDA0NzY4MzcxNTgyMDMxMjUpKTsKICAgIEltYWdlVGV4dHVyZV9zdG9yZSA9IHZlYzQoXzI1LngsIF8yNS55LCBfMjUueiwgSW1hZ2VUZXh0dXJlX3N0b3JlLncpOwogICAgdmVjMyBJbWFnZVRleHR1cmVfQ29sb3JfcmVzID0gSW1hZ2VUZXh0dXJlX3N0b3JlLnh5ejsKICAgIHZlYzMgYmFzZWNvbCA9IEltYWdlVGV4dHVyZV9Db2xvcl9yZXM7CiAgICBmbG9hdCByb3VnaG5lc3MgPSAwLjA7CiAgICBmbG9hdCBtZXRhbGxpYyA9IDAuMDsKICAgIGZsb2F0IG9jY2x1c2lvbiA9IDEuMDsKICAgIGdsX0ZyYWdEYXRhWzBdID0gdmVjNChiYXNlY29sLCAxLjApOwogICAgdmVjMyBfNTEgPSBwb3coZ2xfRnJhZ0RhdGFbMF0ueHl6LCB2ZWMzKDAuNDU0NTQ1NDY4MDkxOTY0NzIxNjc5Njg3NSkpOwogICAgZ2xfRnJhZ0RhdGFbMF0gPSB2ZWM0KF81MS54LCBfNTEueSwgXzUxLnosIGdsX0ZyYWdEYXRhWzBdLncpOwp9Cgo",bt.Baked_mesh_fragData2="s958:I3ZlcnNpb24gMzAwIGVzCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gbWVkaXVtcCBpbnQ7Cgp1bmlmb3JtIG1lZGl1bXAgc2FtcGxlcjJEIEltYWdlVGV4dHVyZTsKCmluIHZlYzIgdGV4Q29vcmQ7Cm91dCB2ZWM0IGZyYWdDb2xvcjsKCnZvaWQgbWFpbigpCnsKICAgIHZlYzQgSW1hZ2VUZXh0dXJlX3N0b3JlID0gdGV4dHVyZShJbWFnZVRleHR1cmUsIHRleENvb3JkKTsKICAgIHZlYzMgXzI1ID0gcG93KEltYWdlVGV4dHVyZV9zdG9yZS54eXosIHZlYzMoMi4yMDAwMDAwNDc2ODM3MTU4MjAzMTI1KSk7CiAgICBJbWFnZVRleHR1cmVfc3RvcmUgPSB2ZWM0KF8yNS54LCBfMjUueSwgXzI1LnosIEltYWdlVGV4dHVyZV9zdG9yZS53KTsKICAgIHZlYzMgSW1hZ2VUZXh0dXJlX0NvbG9yX3JlcyA9IEltYWdlVGV4dHVyZV9zdG9yZS54eXo7CiAgICB2ZWMzIGJhc2Vjb2wgPSBJbWFnZVRleHR1cmVfQ29sb3JfcmVzOwogICAgZmxvYXQgcm91Z2huZXNzID0gMC4wOwogICAgZmxvYXQgbWV0YWxsaWMgPSAwLjA7CiAgICBmbG9hdCBvY2NsdXNpb24gPSAxLjA7CiAgICBmcmFnQ29sb3IgPSB2ZWM0KGJhc2Vjb2wsIDEuMCk7CiAgICB2ZWMzIF81MSA9IHBvdyhmcmFnQ29sb3IueHl6LCB2ZWMzKDAuNDU0NTQ1NDY4MDkxOTY0NzIxNjc5Njg3NSkpOwogICAgZnJhZ0NvbG9yID0gdmVjNChfNTEueCwgXzUxLnksIF81MS56LCBmcmFnQ29sb3Iudyk7Cn0KCg",bt.Baked_mesh_vertData0="s288:I3ZlcnNpb24gMTAwCgp1bmlmb3JtIG1hdDQgV1ZQOwoKYXR0cmlidXRlIHZlYzMgcG9zOwp2YXJ5aW5nIHZlYzIgdGV4Q29vcmQ7CmF0dHJpYnV0ZSB2ZWMyIHRleDsKYXR0cmlidXRlIHZlYzMgbm9yOwoKdm9pZCBtYWluKCkKewogICAgdmVjNCBzcG9zID0gdmVjNChwb3MsIDEuMCk7CiAgICBnbF9Qb3NpdGlvbiA9IFdWUCAqIHNwb3M7CiAgICB0ZXhDb29yZCA9IHRleDsKfQoK",bt.Baked_mesh_vertData1="s352:I3ZlcnNpb24gMTAwCgp1bmlmb3JtIG1lZGl1bXAgbWF0NCBXVlA7CgphdHRyaWJ1dGUgbWVkaXVtcCB2ZWMzIHBvczsKdmFyeWluZyBtZWRpdW1wIHZlYzIgdGV4Q29vcmQ7CmF0dHJpYnV0ZSBtZWRpdW1wIHZlYzIgdGV4OwphdHRyaWJ1dGUgbWVkaXVtcCB2ZWMzIG5vcjsKCnZvaWQgbWFpbigpCnsKICAgIG1lZGl1bXAgdmVjNCBzcG9zID0gdmVjNChwb3MsIDEuMCk7CiAgICBnbF9Qb3NpdGlvbiA9IFdWUCAqIHNwb3M7CiAgICB0ZXhDb29yZCA9IHRleDsKfQoK",bt.Baked_mesh_vertData2="s323:I3ZlcnNpb24gMzAwIGVzCgp1bmlmb3JtIG1lZGl1bXAgbWF0NCBXVlA7CgppbiBtZWRpdW1wIHZlYzMgcG9zOwpvdXQgbWVkaXVtcCB2ZWMyIHRleENvb3JkOwppbiBtZWRpdW1wIHZlYzIgdGV4OwppbiBtZWRpdW1wIHZlYzMgbm9yOwoKdm9pZCBtYWluKCkKewogICAgbWVkaXVtcCB2ZWM0IHNwb3MgPSB2ZWM0KHBvcywgMS4wKTsKICAgIGdsX1Bvc2l0aW9uID0gV1ZQICogc3BvczsKICAgIHRleENvb3JkID0gdGV4Owp9Cgo",bt.painter_image_fragData0="s471:I3ZlcnNpb24gMTAwCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gaGlnaHAgaW50OwoKdW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgdGV4OwoKdmFyeWluZyBoaWdocCB2ZWMyIHRleENvb3JkOwp2YXJ5aW5nIGhpZ2hwIHZlYzQgY29sb3I7Cgp2b2lkIG1haW4oKQp7CiAgICBoaWdocCB2ZWM0IHRleGNvbG9yID0gdGV4dHVyZTJEKHRleCwgdGV4Q29vcmQpICogY29sb3I7CiAgICBoaWdocCB2ZWMzIF8zMiA9IHRleGNvbG9yLnh5eiAqIGNvbG9yLnc7CiAgICB0ZXhjb2xvciA9IHZlYzQoXzMyLngsIF8zMi55LCBfMzIueiwgdGV4Y29sb3Iudyk7CiAgICBnbF9GcmFnRGF0YVswXSA9IHRleGNvbG9yOwp9Cgo",bt.painter_image_fragData1="s444:I3ZlcnNpb24gMTAwCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gbWVkaXVtcCBpbnQ7Cgp1bmlmb3JtIG1lZGl1bXAgc2FtcGxlcjJEIHRleDsKCnZhcnlpbmcgdmVjMiB0ZXhDb29yZDsKdmFyeWluZyB2ZWM0IGNvbG9yOwoKdm9pZCBtYWluKCkKewogICAgdmVjNCB0ZXhjb2xvciA9IHRleHR1cmUyRCh0ZXgsIHRleENvb3JkKSAqIGNvbG9yOwogICAgdmVjMyBfMzIgPSB0ZXhjb2xvci54eXogKiBjb2xvci53OwogICAgdGV4Y29sb3IgPSB2ZWM0KF8zMi54LCBfMzIueSwgXzMyLnosIHRleGNvbG9yLncpOwogICAgZ2xfRnJhZ0RhdGFbMF0gPSB0ZXhjb2xvcjsKfQoK",bt.painter_image_fragData2="s452:I3ZlcnNpb24gMzAwIGVzCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gbWVkaXVtcCBpbnQ7Cgp1bmlmb3JtIG1lZGl1bXAgc2FtcGxlcjJEIHRleDsKCmluIHZlYzIgdGV4Q29vcmQ7CmluIHZlYzQgY29sb3I7Cm91dCB2ZWM0IEZyYWdDb2xvcjsKCnZvaWQgbWFpbigpCnsKICAgIHZlYzQgdGV4Y29sb3IgPSB0ZXh0dXJlKHRleCwgdGV4Q29vcmQpICogY29sb3I7CiAgICB2ZWMzIF8zMiA9IHRleGNvbG9yLnh5eiAqIGNvbG9yLnc7CiAgICB0ZXhjb2xvciA9IHZlYzQoXzMyLngsIF8zMi55LCBfMzIueiwgdGV4Y29sb3Iudyk7CiAgICBGcmFnQ29sb3IgPSB0ZXhjb2xvcjsKfQoK",bt.painter_colored_vertData0="s331:I3ZlcnNpb24gMTAwCgp1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeDsKCmF0dHJpYnV0ZSB2ZWMzIHZlcnRleFBvc2l0aW9uOwp2YXJ5aW5nIHZlYzQgZnJhZ21lbnRDb2xvcjsKYXR0cmlidXRlIHZlYzQgdmVydGV4Q29sb3I7Cgp2b2lkIG1haW4oKQp7CiAgICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiB2ZWM0KHZlcnRleFBvc2l0aW9uLCAxLjApOwogICAgZnJhZ21lbnRDb2xvciA9IHZlcnRleENvbG9yOwp9Cgo",bt.painter_colored_vertData1="s374:I3ZlcnNpb24gMTAwCgp1bmlmb3JtIG1lZGl1bXAgbWF0NCBwcm9qZWN0aW9uTWF0cml4OwoKYXR0cmlidXRlIG1lZGl1bXAgdmVjMyB2ZXJ0ZXhQb3NpdGlvbjsKdmFyeWluZyBtZWRpdW1wIHZlYzQgZnJhZ21lbnRDb2xvcjsKYXR0cmlidXRlIG1lZGl1bXAgdmVjNCB2ZXJ0ZXhDb2xvcjsKCnZvaWQgbWFpbigpCnsKICAgIGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIHZlYzQodmVydGV4UG9zaXRpb24sIDEuMCk7CiAgICBmcmFnbWVudENvbG9yID0gdmVydGV4Q29sb3I7Cn0KCg",bt.painter_colored_vertData2="s354:I3ZlcnNpb24gMzAwIGVzCgp1bmlmb3JtIG1lZGl1bXAgbWF0NCBwcm9qZWN0aW9uTWF0cml4OwoKaW4gbWVkaXVtcCB2ZWMzIHZlcnRleFBvc2l0aW9uOwpvdXQgbWVkaXVtcCB2ZWM0IGZyYWdtZW50Q29sb3I7CmluIG1lZGl1bXAgdmVjNCB2ZXJ0ZXhDb2xvcjsKCnZvaWQgbWFpbigpCnsKICAgIGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIHZlYzQodmVydGV4UG9zaXRpb24sIDEuMCk7CiAgICBmcmFnbWVudENvbG9yID0gdmVydGV4Q29sb3I7Cn0KCg",bt.painter_text_vertData0="s436:I3ZlcnNpb24gMTAwCgp1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeDsKCmF0dHJpYnV0ZSB2ZWMzIHZlcnRleFBvc2l0aW9uOwp2YXJ5aW5nIHZlYzIgdGV4Q29vcmQ7CmF0dHJpYnV0ZSB2ZWMyIHRleFBvc2l0aW9uOwp2YXJ5aW5nIHZlYzQgZnJhZ21lbnRDb2xvcjsKYXR0cmlidXRlIHZlYzQgdmVydGV4Q29sb3I7Cgp2b2lkIG1haW4oKQp7CiAgICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiB2ZWM0KHZlcnRleFBvc2l0aW9uLCAxLjApOwogICAgdGV4Q29vcmQgPSB0ZXhQb3NpdGlvbjsKICAgIGZyYWdtZW50Q29sb3IgPSB2ZXJ0ZXhDb2xvcjsKfQoK",bt.painter_text_vertData1="s500:I3ZlcnNpb24gMTAwCgp1bmlmb3JtIG1lZGl1bXAgbWF0NCBwcm9qZWN0aW9uTWF0cml4OwoKYXR0cmlidXRlIG1lZGl1bXAgdmVjMyB2ZXJ0ZXhQb3NpdGlvbjsKdmFyeWluZyBtZWRpdW1wIHZlYzIgdGV4Q29vcmQ7CmF0dHJpYnV0ZSBtZWRpdW1wIHZlYzIgdGV4UG9zaXRpb247CnZhcnlpbmcgbWVkaXVtcCB2ZWM0IGZyYWdtZW50Q29sb3I7CmF0dHJpYnV0ZSBtZWRpdW1wIHZlYzQgdmVydGV4Q29sb3I7Cgp2b2lkIG1haW4oKQp7CiAgICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiB2ZWM0KHZlcnRleFBvc2l0aW9uLCAxLjApOwogICAgdGV4Q29vcmQgPSB0ZXhQb3NpdGlvbjsKICAgIGZyYWdtZW50Q29sb3IgPSB2ZXJ0ZXhDb2xvcjsKfQoK",bt.painter_text_vertData2="s466:I3ZlcnNpb24gMzAwIGVzCgp1bmlmb3JtIG1lZGl1bXAgbWF0NCBwcm9qZWN0aW9uTWF0cml4OwoKaW4gbWVkaXVtcCB2ZWMzIHZlcnRleFBvc2l0aW9uOwpvdXQgbWVkaXVtcCB2ZWMyIHRleENvb3JkOwppbiBtZWRpdW1wIHZlYzIgdGV4UG9zaXRpb247Cm91dCBtZWRpdW1wIHZlYzQgZnJhZ21lbnRDb2xvcjsKaW4gbWVkaXVtcCB2ZWM0IHZlcnRleENvbG9yOwoKdm9pZCBtYWluKCkKewogICAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogdmVjNCh2ZXJ0ZXhQb3NpdGlvbiwgMS4wKTsKICAgIHRleENvb3JkID0gdGV4UG9zaXRpb247CiAgICBmcmFnbWVudENvbG9yID0gdmVydGV4Q29sb3I7Cn0KCg",bt.painter_text_fragData0="s351:I3ZlcnNpb24gMTAwCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gaGlnaHAgaW50OwoKdW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgdGV4OwoKdmFyeWluZyBoaWdocCB2ZWM0IGZyYWdtZW50Q29sb3I7CnZhcnlpbmcgaGlnaHAgdmVjMiB0ZXhDb29yZDsKCnZvaWQgbWFpbigpCnsKICAgIGdsX0ZyYWdEYXRhWzBdID0gdmVjNChmcmFnbWVudENvbG9yLnh5eiwgdGV4dHVyZTJEKHRleCwgdGV4Q29vcmQpLnggKiBmcmFnbWVudENvbG9yLncpOwp9Cgo",bt.painter_text_fragData1="s340:I3ZlcnNpb24gMTAwCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gbWVkaXVtcCBpbnQ7Cgp1bmlmb3JtIG1lZGl1bXAgc2FtcGxlcjJEIHRleDsKCnZhcnlpbmcgdmVjNCBmcmFnbWVudENvbG9yOwp2YXJ5aW5nIHZlYzIgdGV4Q29vcmQ7Cgp2b2lkIG1haW4oKQp7CiAgICBnbF9GcmFnRGF0YVswXSA9IHZlYzQoZnJhZ21lbnRDb2xvci54eXosIHRleHR1cmUyRCh0ZXgsIHRleENvb3JkKS54ICogZnJhZ21lbnRDb2xvci53KTsKfQoK",bt.painter_text_fragData2="s348:I3ZlcnNpb24gMzAwIGVzCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gbWVkaXVtcCBpbnQ7Cgp1bmlmb3JtIG1lZGl1bXAgc2FtcGxlcjJEIHRleDsKCm91dCB2ZWM0IEZyYWdDb2xvcjsKaW4gdmVjNCBmcmFnbWVudENvbG9yOwppbiB2ZWMyIHRleENvb3JkOwoKdm9pZCBtYWluKCkKewogICAgRnJhZ0NvbG9yID0gdmVjNChmcmFnbWVudENvbG9yLnh5eiwgdGV4dHVyZSh0ZXgsIHRleENvb3JkKS54ICogZnJhZ21lbnRDb2xvci53KTsKfQoK",bt.painter_colored_fragData0="s198:I3ZlcnNpb24gMTAwCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gaGlnaHAgaW50OwoKdmFyeWluZyBoaWdocCB2ZWM0IGZyYWdtZW50Q29sb3I7Cgp2b2lkIG1haW4oKQp7CiAgICBnbF9GcmFnRGF0YVswXSA9IGZyYWdtZW50Q29sb3I7Cn0KCg",bt.painter_colored_fragData1="s192:I3ZlcnNpb24gMTAwCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gbWVkaXVtcCBpbnQ7Cgp2YXJ5aW5nIHZlYzQgZnJhZ21lbnRDb2xvcjsKCnZvaWQgbWFpbigpCnsKICAgIGdsX0ZyYWdEYXRhWzBdID0gZnJhZ21lbnRDb2xvcjsKfQoK",bt.painter_colored_fragData2="s210:I3ZlcnNpb24gMzAwIGVzCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gbWVkaXVtcCBpbnQ7CgpvdXQgdmVjNCBGcmFnQ29sb3I7CmluIHZlYzQgZnJhZ21lbnRDb2xvcjsKCnZvaWQgbWFpbigpCnsKICAgIEZyYWdDb2xvciA9IGZyYWdtZW50Q29sb3I7Cn0KCg",bt.painter_image_vertData0="s415:I3ZlcnNpb24gMTAwCgp1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeDsKCmF0dHJpYnV0ZSB2ZWMzIHZlcnRleFBvc2l0aW9uOwp2YXJ5aW5nIHZlYzIgdGV4Q29vcmQ7CmF0dHJpYnV0ZSB2ZWMyIHRleFBvc2l0aW9uOwp2YXJ5aW5nIHZlYzQgY29sb3I7CmF0dHJpYnV0ZSB2ZWM0IHZlcnRleENvbG9yOwoKdm9pZCBtYWluKCkKewogICAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogdmVjNCh2ZXJ0ZXhQb3NpdGlvbiwgMS4wKTsKICAgIHRleENvb3JkID0gdGV4UG9zaXRpb247CiAgICBjb2xvciA9IHZlcnRleENvbG9yOwp9Cgo",bt.painter_image_vertData1="s479:I3ZlcnNpb24gMTAwCgp1bmlmb3JtIG1lZGl1bXAgbWF0NCBwcm9qZWN0aW9uTWF0cml4OwoKYXR0cmlidXRlIG1lZGl1bXAgdmVjMyB2ZXJ0ZXhQb3NpdGlvbjsKdmFyeWluZyBtZWRpdW1wIHZlYzIgdGV4Q29vcmQ7CmF0dHJpYnV0ZSBtZWRpdW1wIHZlYzIgdGV4UG9zaXRpb247CnZhcnlpbmcgbWVkaXVtcCB2ZWM0IGNvbG9yOwphdHRyaWJ1dGUgbWVkaXVtcCB2ZWM0IHZlcnRleENvbG9yOwoKdm9pZCBtYWluKCkKewogICAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogdmVjNCh2ZXJ0ZXhQb3NpdGlvbiwgMS4wKTsKICAgIHRleENvb3JkID0gdGV4UG9zaXRpb247CiAgICBjb2xvciA9IHZlcnRleENvbG9yOwp9Cgo",bt.painter_image_vertData2="s444:I3ZlcnNpb24gMzAwIGVzCgp1bmlmb3JtIG1lZGl1bXAgbWF0NCBwcm9qZWN0aW9uTWF0cml4OwoKaW4gbWVkaXVtcCB2ZWMzIHZlcnRleFBvc2l0aW9uOwpvdXQgbWVkaXVtcCB2ZWMyIHRleENvb3JkOwppbiBtZWRpdW1wIHZlYzIgdGV4UG9zaXRpb247Cm91dCBtZWRpdW1wIHZlYzQgY29sb3I7CmluIG1lZGl1bXAgdmVjNCB2ZXJ0ZXhDb2xvcjsKCnZvaWQgbWFpbigpCnsKICAgIGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIHZlYzQodmVydGV4UG9zaXRpb24sIDEuMCk7CiAgICB0ZXhDb29yZCA9IHRleFBvc2l0aW9uOwogICAgY29sb3IgPSB2ZXJ0ZXhDb2xvcjsKfQoK",bt.painter_video_fragData0="s471:I3ZlcnNpb24gMTAwCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gaGlnaHAgaW50OwoKdW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgdGV4OwoKdmFyeWluZyBoaWdocCB2ZWMyIHRleENvb3JkOwp2YXJ5aW5nIGhpZ2hwIHZlYzQgY29sb3I7Cgp2b2lkIG1haW4oKQp7CiAgICBoaWdocCB2ZWM0IHRleGNvbG9yID0gdGV4dHVyZTJEKHRleCwgdGV4Q29vcmQpICogY29sb3I7CiAgICBoaWdocCB2ZWMzIF8zMiA9IHRleGNvbG9yLnh5eiAqIGNvbG9yLnc7CiAgICB0ZXhjb2xvciA9IHZlYzQoXzMyLngsIF8zMi55LCBfMzIueiwgdGV4Y29sb3Iudyk7CiAgICBnbF9GcmFnRGF0YVswXSA9IHRleGNvbG9yOwp9Cgo",bt.painter_video_fragData1="s444:I3ZlcnNpb24gMTAwCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gbWVkaXVtcCBpbnQ7Cgp1bmlmb3JtIG1lZGl1bXAgc2FtcGxlcjJEIHRleDsKCnZhcnlpbmcgdmVjMiB0ZXhDb29yZDsKdmFyeWluZyB2ZWM0IGNvbG9yOwoKdm9pZCBtYWluKCkKewogICAgdmVjNCB0ZXhjb2xvciA9IHRleHR1cmUyRCh0ZXgsIHRleENvb3JkKSAqIGNvbG9yOwogICAgdmVjMyBfMzIgPSB0ZXhjb2xvci54eXogKiBjb2xvci53OwogICAgdGV4Y29sb3IgPSB2ZWM0KF8zMi54LCBfMzIueSwgXzMyLnosIHRleGNvbG9yLncpOwogICAgZ2xfRnJhZ0RhdGFbMF0gPSB0ZXhjb2xvcjsKfQoK",bt.painter_video_fragData2="s452:I3ZlcnNpb24gMzAwIGVzCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gbWVkaXVtcCBpbnQ7Cgp1bmlmb3JtIG1lZGl1bXAgc2FtcGxlcjJEIHRleDsKCmluIHZlYzIgdGV4Q29vcmQ7CmluIHZlYzQgY29sb3I7Cm91dCB2ZWM0IEZyYWdDb2xvcjsKCnZvaWQgbWFpbigpCnsKICAgIHZlYzQgdGV4Y29sb3IgPSB0ZXh0dXJlKHRleCwgdGV4Q29vcmQpICogY29sb3I7CiAgICB2ZWMzIF8zMiA9IHRleGNvbG9yLnh5eiAqIGNvbG9yLnc7CiAgICB0ZXhjb2xvciA9IHZlYzQoXzMyLngsIF8zMi55LCBfMzIueiwgdGV4Y29sb3Iudyk7CiAgICBGcmFnQ29sb3IgPSB0ZXhjb2xvcjsKfQoK",bt.painter_video_vertData0="s415:I3ZlcnNpb24gMTAwCgp1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeDsKCmF0dHJpYnV0ZSB2ZWMzIHZlcnRleFBvc2l0aW9uOwp2YXJ5aW5nIHZlYzIgdGV4Q29vcmQ7CmF0dHJpYnV0ZSB2ZWMyIHRleFBvc2l0aW9uOwp2YXJ5aW5nIHZlYzQgY29sb3I7CmF0dHJpYnV0ZSB2ZWM0IHZlcnRleENvbG9yOwoKdm9pZCBtYWluKCkKewogICAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogdmVjNCh2ZXJ0ZXhQb3NpdGlvbiwgMS4wKTsKICAgIHRleENvb3JkID0gdGV4UG9zaXRpb247CiAgICBjb2xvciA9IHZlcnRleENvbG9yOwp9Cgo",bt.painter_video_vertData1="s479:I3ZlcnNpb24gMTAwCgp1bmlmb3JtIG1lZGl1bXAgbWF0NCBwcm9qZWN0aW9uTWF0cml4OwoKYXR0cmlidXRlIG1lZGl1bXAgdmVjMyB2ZXJ0ZXhQb3NpdGlvbjsKdmFyeWluZyBtZWRpdW1wIHZlYzIgdGV4Q29vcmQ7CmF0dHJpYnV0ZSBtZWRpdW1wIHZlYzIgdGV4UG9zaXRpb247CnZhcnlpbmcgbWVkaXVtcCB2ZWM0IGNvbG9yOwphdHRyaWJ1dGUgbWVkaXVtcCB2ZWM0IHZlcnRleENvbG9yOwoKdm9pZCBtYWluKCkKewogICAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogdmVjNCh2ZXJ0ZXhQb3NpdGlvbiwgMS4wKTsKICAgIHRleENvb3JkID0gdGV4UG9zaXRpb247CiAgICBjb2xvciA9IHZlcnRleENvbG9yOwp9Cgo",bt.painter_video_vertData2="s444:I3ZlcnNpb24gMzAwIGVzCgp1bmlmb3JtIG1lZGl1bXAgbWF0NCBwcm9qZWN0aW9uTWF0cml4OwoKaW4gbWVkaXVtcCB2ZWMzIHZlcnRleFBvc2l0aW9uOwpvdXQgbWVkaXVtcCB2ZWMyIHRleENvb3JkOwppbiBtZWRpdW1wIHZlYzIgdGV4UG9zaXRpb247Cm91dCBtZWRpdW1wIHZlYzQgY29sb3I7CmluIG1lZGl1bXAgdmVjNCB2ZXJ0ZXhDb2xvcjsKCnZvaWQgbWFpbigpCnsKICAgIGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIHZlYzQodmVydGV4UG9zaXRpb24sIDEuMCk7CiAgICB0ZXhDb29yZCA9IHRleFBvc2l0aW9uOwogICAgY29sb3IgPSB2ZXJ0ZXhDb2xvcjsKfQoK",Bt.renderListeners=[],Bt.foregroundListeners=[],Bt.backgroundListeners=[],xt.mobile=!1,xt.mobileAudioPlaying=!1,xt.chrome=!1,xt.firefox=!1,xt.insideInputEvent=!1,xt.leftMouseCtrlDown=!1,xt.minimumScroll=999,xt.lastFirstTouchX=0,xt.lastFirstTouchY=0,xt.iosSoundEnabled=!1,Dt.INVALID_BITS=-1,Et.INVERSE_DB_TABLE=[1.0649863e-7,1.1341951e-7,1.2079015e-7,1.2863978e-7,1.3699951e-7,1.4590251e-7,1.5538408e-7,1.6548181e-7,1.7623575e-7,1.8768855e-7,1.9988561e-7,2.128753e-7,2.2670913e-7,2.4144197e-7,2.5713223e-7,2.7384213e-7,2.9163793e-7,3.1059021e-7,3.3077411e-7,3.5226968e-7,3.7516214e-7,3.9954229e-7,4.255068e-7,4.5315863e-7,4.8260743e-7,5.1396998e-7,5.4737065e-7,5.8294187e-7,6.2082472e-7,6.6116941e-7,7.0413592e-7,7.4989464e-7,7.9862701e-7,8.505263e-7,9.0579828e-7,9.6466216e-7,10273513e-13,10941144e-13,11652161e-13,12409384e-13,13215816e-13,14074654e-13,14989305e-13,15963394e-13,17000785e-13,18105592e-13,19282195e-13,20535261e-13,21869758e-13,23290978e-13,24804557e-13,26416497e-13,2813319e-12,29961443e-13,31908506e-13,33982101e-13,36190449e-13,38542308e-13,41047004e-13,4371447e-12,46555282e-13,49580707e-13,5280274e-12,5623416e-12,59888572e-13,63780469e-13,67925283e-13,72339451e-13,77040476e-13,82047e-10,87378876e-13,93057248e-13,99104632e-13,10554501e-12,11240392e-12,11970856e-12,12748789e-12,13577278e-12,14459606e-12,15399272e-12,16400004e-12,17465768e-12,18600792e-12,19809576e-12,21096914e-12,22467911e-12,23928002e-12,25482978e-12,27139006e-12,28902651e-12,30780908e-12,32781225e-12,34911534e-12,37180282e-12,39596466e-12,42169667e-12,4491009e-11,47828601e-12,50936773e-12,54246931e-12,57772202e-12,61526565e-12,65524908e-12,69783085e-12,74317983e-12,79147585e-12,8429104e-11,89768747e-12,95602426e-12,.00010181521,.00010843174,.00011547824,.00012298267,.00013097477,.00013948625,.00014855085,.00015820453,.00016848555,.00017943469,.00019109536,.00020351382,.00021673929,.00023082423,.00024582449,.00026179955,.00027881276,.00029693158,.00031622787,.00033677814,.00035866388,.00038197188,.00040679456,.00043323036,.00046138411,.00049136745,.00052329927,.00055730621,.00059352311,.00063209358,.00067317058,716917e-9,.0007635063,.00081312324,.00086596457,.00092223983,.00098217216,.0010459992,.0011139742,.0011863665,.0012634633,.0013455702,.0014330129,.0015261382,.0016253153,.0017309374,.0018434235,.0019632195,.0020908006,.0022266726,.0023713743,.0025254795,.0026895994,.0028643847,.0030505286,.0032487691,.0034598925,.0036847358,.0039241906,.0041792066,.004450795,.0047400328,.0050480668,.0053761186,.0057254891,.0060975636,.0064938176,.0069158225,.0073652516,.0078438871,.0083536271,.0088964928,.009474637,.010090352,.01074608,.011444421,.012188144,.012980198,.013823725,.014722068,.015678791,.016697687,.017782797,.018938423,.020169149,.021479854,.022875735,.02436233,.025945531,.027631618,.029427276,.031339626,.033376252,.035545228,.037855157,.040315199,.042935108,.045725273,.048696758,.051861348,.055231591,.05882085,.062643361,.066714279,.071049749,.075666962,.080584227,.085821044,.091398179,.097337747,.1036633,.11039993,.11757434,.12521498,.13335215,.14201813,.15124727,.16107617,.1715438,.18269168,.19456402,.20720788,.22067342,.23501402,.25028656,.26655159,.28387361,.30232132,.32196786,.34289114,.36517414,.38890521,.41417847,.44109412,.4697589,.50028648,.53279791,.56742212,.6042964,.64356699,.68538959,.72993007,.77736504,.8278826,.88168307,.9389798,1],gi.GL_RGBA16F=34842,gi.GL_RGBA32F=34836,gi.GL_R16F=33325,gi.GL_R32F=33326,gi.GL_DEPTH_COMPONENT24=33190,gi.GL_DEPTH24_STENCIL8=35056,gi.GL_DEPTH32F_STENCIL8=36013,xi.bufferSize=1500,Ii.bufferSize=100,Ii.triangleBufferSize=100,Si.bufferSize=100,Oi.__meta__={fields:{sendAxisEvent:{input:null},sendButtonEvent:{input:null}}},Oi.instances=[],ji.__meta__={fields:{sendDownEvent:{input:null},sendUpEvent:{input:null},sendPressEvent:{input:null}}},Xi.__meta__={fields:{sendLeaveEvent:{input:null},sendDownEvent:{input:null},sendUpEvent:{input:null},sendMoveEvent:{input:null},sendWheelEvent:{input:null}}},Qi.bufferSize=2e3,Ji.exposurePattern=new n("EXPOSURE=\\s*([0-9]*[.][0-9]*)","i"),Ji.formatPattern=new n("FORMAT=32-bit_rle_rgbe","i"),Ji.widthHeightPattern=new n("-Y ([0-9]+) \\+X ([0-9]+)","i"),qi.todo=[],na.loading=[],_a.nextId=0,d.main()}("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);